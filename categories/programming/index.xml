<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Simply Patrick </title>
    <link>https://blog.simplypatrick.com/categories/programming/</link>
    <author>Patrick Tsai</author>
    <rights>Copyright (c) 2003 - 2016, Patrick Tsai; all rights reserved.</rights>
    <updated>2026-02-18 00:00:00 -0800 -0800</updated>
    
    <item>
      <title>Rust 媒體元資料探索器：用 FFmpeg 剖析影音檔案與打造 TUI</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-18-media-metadata-explorer/</link>
      <pubDate>Wed, 18 Feb 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-18-media-metadata-explorer/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-18-media-metadata-explorer/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;這次的 rust-52-projects 系列帶來了 &lt;code&gt;media-metadata-explorer&lt;/code&gt;——一個能深入剖析影音檔案內部結構的 CLI 工具。它透過 FFmpeg 的 &lt;code&gt;libavformat&lt;/code&gt; 函式庫讀取媒體容器資訊，同時還做了一件很有趣的事：附帶了一個 &lt;code&gt;libavformat-ffi&lt;/code&gt; companion crate，示範三種不同的 Rust FFI 呼叫方式（詳見&lt;a href=&#34;https://blog.simplypatrick.com/posts/2026/01-17-ffi-comparison&#34;&gt;之前的 FFI 比較文章&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;這篇文章會聚焦在工具本身的設計——三個實用的 CLI 子命令，以及用 &lt;code&gt;crossterm&lt;/code&gt; 打造互動式 TUI 的過程。&lt;/p&gt;
&lt;h3 id=&#34;專案功能概覽&#34;&gt;專案功能概覽&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;media-metadata-explorer&lt;/code&gt; 提供三個子命令，對應三種使用情境：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;inspect &amp;lt;file&amp;gt; [--json]&lt;/code&gt;&lt;/strong&gt; 是最基本的單檔檢視模式。打開一個 &lt;code&gt;.mkv&lt;/code&gt; 或 &lt;code&gt;.mp3&lt;/code&gt;，它會列出容器格式名稱、總時長、檔案大小、位元率、容器層級的 metadata 標籤（如 title、encoder），以及每條串流的詳細資訊：影片串流會顯示解析度與幀率，音訊串流則顯示取樣率、聲道數、語言標籤等。加上 &lt;code&gt;--json&lt;/code&gt; 旗標可以輸出結構化的 &lt;code&gt;MediaReport&lt;/code&gt;，方便接到其他工具做二次處理。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;catalog &amp;lt;dir&amp;gt; [--recursive] [--json]&lt;/code&gt;&lt;/strong&gt; 是媒體庫整理利器。它會走訪目錄，篩選 &lt;code&gt;mp4&lt;/code&gt;、&lt;code&gt;mkv&lt;/code&gt;、&lt;code&gt;mov&lt;/code&gt;、&lt;code&gt;avi&lt;/code&gt;、&lt;code&gt;webm&lt;/code&gt;、&lt;code&gt;mp3&lt;/code&gt;、&lt;code&gt;flac&lt;/code&gt;、&lt;code&gt;wav&lt;/code&gt; 等常見副檔名，逐一探測後彙整成 &lt;code&gt;CatalogReport&lt;/code&gt;：總時長、容器格式出現頻率（依次排序）、編解碼器統計，以及探測失敗的檔案清單。有個小細節：FFmpeg 回傳的格式名稱常常是 &lt;code&gt;&amp;quot;mov,mp4,m4a,3gp,3g2,mj2&amp;quot;&lt;/code&gt; 這樣一串，程式只取第一個 token，讓統計結果更好讀。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;tui &amp;lt;file&amp;gt; [--max-packets N]&lt;/code&gt;&lt;/strong&gt; 則是整個專案最有趣的部分——互動式終端瀏覽器，下一節細說。&lt;/p&gt;
&lt;h3 id=&#34;tui-設計用-crossterm-打造終端介面&#34;&gt;TUI 設計：用 crossterm 打造終端介面&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;tui&lt;/code&gt; 子命令會先讀取最多 N 個封包（預設 2000），在記憶體中建立一棵樹，再用 &lt;code&gt;crossterm&lt;/code&gt; 啟動全螢幕互動介面。&lt;/p&gt;
&lt;p&gt;樹狀結構分三個頂層節點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Container Info&lt;/strong&gt;：格式名稱、時長、位元率、檔案大小、metadata 標籤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Streams&lt;/strong&gt;：每條串流展開後顯示編解碼器參數、串流標籤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Packets&lt;/strong&gt;：依串流索引分群，每個封包顯示 PTS、DTS、大小、是否為關鍵幀&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;導覽鍵支援 Vim 風格（&lt;code&gt;j&lt;/code&gt;/&lt;code&gt;k&lt;/code&gt; 上下、&lt;code&gt;h&lt;/code&gt;/&lt;code&gt;l&lt;/code&gt; 收合/展開）以及方向鍵、PageUp/PageDown、Home/End。Space 切換展開狀態，&lt;code&gt;q&lt;/code&gt; 或 Esc 退出。顏色區分不同節點類型：cyan 是標題、magenta 是容器資訊、blue 是串流節點、green 是封包節點、yellow 是標籤值。&lt;/p&gt;
&lt;h4 id=&#34;crossterm-的角色&#34;&gt;crossterm 的角色&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;crossterm&lt;/code&gt; 是 Rust 生態系裡最常見的跨平台終端控制函式庫，名字裡的 &amp;ldquo;cross&amp;rdquo; 就是這個意思——同一套 API 可以在 Windows、macOS、Linux 上跑，不用自己處理 ANSI escape code 或 Windows Console API 的差異。&lt;/p&gt;
&lt;p&gt;它的 API 設計圍繞著「命令（command）」的概念，每個動作都是一個實作 &lt;code&gt;Command&lt;/code&gt; trait 的型別：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; crossterm::{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cursor::{Hide, MoveTo, Show},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    event::{self, Event, KeyCode},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    style::{Color, Print, ResetColor, SetBackgroundColor, SetForegroundColor},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    terminal::{self, Clear, ClearType, EnterAlternateScreen, LeaveAlternateScreen},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;執行命令有兩個 macro：&lt;code&gt;execute!&lt;/code&gt; 會立刻寫入並 flush，&lt;code&gt;queue!&lt;/code&gt; 只是把命令放進緩衝區。TUI 的 render 函式全程用 &lt;code&gt;queue!&lt;/code&gt; 積攢所有繪製動作，最後才呼叫一次 &lt;code&gt;out.flush()&lt;/code&gt;——這樣終端只會看到一個完整畫面，不會因為部分更新而閃爍：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;queue!&lt;/span&gt;(out, MoveTo(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;), Clear(ClearType::All))&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ... 積攢所有列的繪製命令 ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;out.flush()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 一次送出
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;進入 TUI 之前，程式需要做三件準備工作：啟用 &lt;strong&gt;raw mode&lt;/strong&gt;（讓按鍵立刻送達、不等換行、不回顯到螢幕）、切換到 &lt;strong&gt;alternate screen&lt;/strong&gt;（保留原本的終端內容，退出後可以還原）、以及隱藏游標。這三步統一在 &lt;code&gt;TerminalGuard::enter()&lt;/code&gt; 裡完成，&lt;code&gt;Drop&lt;/code&gt; 時反向還原：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;enter&lt;/span&gt;(out: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Stdout) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    terminal::enable_raw_mode()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;execute!&lt;/span&gt;(out, EnterAlternateScreen, Hide)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(Self)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Drop &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; TerminalGuard {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;drop&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; _ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; terminal::disable_raw_mode();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; _ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;execute!&lt;/span&gt;(stdout(), Show, LeaveAlternateScreen);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;事件迴圈用 &lt;code&gt;event::read()&lt;/code&gt; 阻塞等待下一個事件，&lt;code&gt;Event::Key&lt;/code&gt; 處理按鍵，&lt;code&gt;Event::Resize&lt;/code&gt; 處理視窗大小改變。Resize 事件不需要任何邏輯——只要設 &lt;code&gt;dirty = true&lt;/code&gt;，下一個 frame 就會用新的 &lt;code&gt;terminal::size()&lt;/code&gt; 重繪，自然就適應了新的寬高。&lt;/p&gt;
&lt;h4 id=&#34;三層資料結構設計&#34;&gt;三層資料結構設計&lt;/h4&gt;
&lt;p&gt;TUI 的樹狀結構採用了一個乾淨的三層分離設計。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第一層：&lt;code&gt;TreeNode&lt;/code&gt;（資料層）&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TreeNode&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    id: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    label: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    children: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;TreeNode&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這是一棵遞迴的 owned tree，&lt;code&gt;children&lt;/code&gt; 直接擁有子節點，不用指標也不用 &lt;code&gt;Rc&lt;/code&gt;。每個節點的 &lt;code&gt;id&lt;/code&gt; 由建構時的 &lt;code&gt;&amp;amp;mut usize&lt;/code&gt; counter 遞增分配，全域唯一。&lt;strong&gt;這棵樹只管結構，完全不知道展開/收合狀態。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第二層：&lt;code&gt;TreeState&lt;/code&gt;（狀態層）&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TreeState&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    selected: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,          &lt;span style=&#34;color:#75715e&#34;&gt;// 游標在第幾行（flat index）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    scroll: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,            &lt;span style=&#34;color:#75715e&#34;&gt;// viewport 捲動偏移
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    expanded: &lt;span style=&#34;color:#a6e22e&#34;&gt;BTreeSet&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// 哪些 node_id 目前是展開的
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;展開狀態完全分離在 &lt;code&gt;BTreeSet&amp;lt;node_id&amp;gt;&lt;/code&gt; 裡，不碰 &lt;code&gt;TreeNode&lt;/code&gt; 本身。要展開一個節點就 &lt;code&gt;insert(id)&lt;/code&gt;，要收合就 &lt;code&gt;remove(id)&lt;/code&gt;，操作極其簡單。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第三層：&lt;code&gt;FlatLine&lt;/code&gt;（視圖層）&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FlatLine&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node_id: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    label: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    depth: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    has_children: &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    expanded: &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;每次重繪前，&lt;code&gt;flatten_tree()&lt;/code&gt; 遍歷 &lt;code&gt;TreeNode&lt;/code&gt;、搭配 &lt;code&gt;expanded&lt;/code&gt; set，產生「目前可見行」的扁平 &lt;code&gt;Vec&amp;lt;FlatLine&amp;gt;&lt;/code&gt;。如果一個節點的 id 不在 &lt;code&gt;expanded&lt;/code&gt; 裡，它的子節點就不會被加入——視覺上就「消失」了：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;flatten_tree&lt;/span&gt;(node: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;TreeNode&lt;/span&gt;, expanded_ids: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;BTreeSet&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, depth: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;, out: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;FlatLine&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; expanded &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; expanded_ids.contains(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;node.id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    out.push(FlatLine { node_id: &lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt;.id, label: &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;., depth, has_children: &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;., expanded });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; has_children &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; expanded {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; child &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;node.children {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            flatten_tree(child, expanded_ids, depth &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, out);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這是典型的 &lt;strong&gt;document-view 分離&lt;/strong&gt;：&lt;code&gt;TreeNode&lt;/code&gt; 是不可變的文件結構，一次建立後不再修改；&lt;code&gt;TreeState.expanded&lt;/code&gt; 是可變的互動狀態；&lt;code&gt;Vec&amp;lt;FlatLine&amp;gt;&lt;/code&gt; 則是每個 render frame 重新推導的視圖，不需要維護反向指標。&lt;code&gt;selected&lt;/code&gt; 和 &lt;code&gt;scroll&lt;/code&gt; 追蹤的是 flat list 的 index，不是 &lt;code&gt;node_id&lt;/code&gt;，因為鍵盤導覽只關心「螢幕上第幾行」。&lt;/p&gt;
&lt;p&gt;實作上有幾個設計值得一提：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Dirty flag 避免不必要重繪。&lt;/strong&gt; TUI 的事件迴圈維護一個 &lt;code&gt;dirty: bool&lt;/code&gt;，只有真正改變畫面狀態的按鍵（移動選取、展開/收合、視窗 resize）才設 &lt;code&gt;dirty = true&lt;/code&gt;，下一個迴圈才重繪。這比每個 tick 無條件清屏再重畫要省 CPU，也避免畫面閃爍。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;TerminalGuard&lt;/code&gt; 確保終端狀態復原。&lt;/strong&gt; 進入 TUI 前需要切換到 alternate screen、啟用 raw mode、隱藏游標。為了確保不論正常退出還是 panic，終端都能恢復正常，程式定義了一個零大小的 &lt;code&gt;TerminalGuard&lt;/code&gt; struct，在 &lt;code&gt;Drop&lt;/code&gt; 裡執行清理動作（disable raw mode、show cursor、leave alternate screen）。這是 Rust RAII 慣用法的典型應用。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Parent 節點搜尋是 O(n) 的線性掃描。&lt;/strong&gt; 當使用者按 &lt;code&gt;h&lt;/code&gt; 要跳到父節點時，程式從當前行往上掃，找第一個 &lt;code&gt;depth == current_depth - 1&lt;/code&gt; 的行。雖然理論上是 O(n)，但實際上樹的深度有限、總行數也不多，這個簡單實作完全夠用，不需要額外維護父節點指標。&lt;/p&gt;
&lt;h3 id=&#34;開發心得與踩坑記錄&#34;&gt;開發心得與踩坑記錄&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;BTreeMap 讓輸出穩定有序。&lt;/strong&gt; 容器和串流的 metadata 標籤改用 &lt;code&gt;BTreeMap&amp;lt;String, String&amp;gt;&lt;/code&gt; 而非 &lt;code&gt;HashMap&lt;/code&gt;，好處是不論 JSON 輸出還是 TUI 顯示，標籤永遠按字母順序排列，不會因 hash 隨機性產生不穩定的輸出。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FFmpeg 的「不知道」值要小心處理。&lt;/strong&gt; FFmpeg 大量使用 &lt;code&gt;0&lt;/code&gt; 或 &lt;code&gt;-1&lt;/code&gt; 表示「未知/不可用」。程式定義了 &lt;code&gt;to_u64(i64) -&amp;gt; Option&amp;lt;u64&amp;gt;&lt;/code&gt; 和 &lt;code&gt;to_u32(i32) -&amp;gt; Option&amp;lt;u32&amp;gt;&lt;/code&gt; 兩個轉換幫手，把 0 和負值都變成 &lt;code&gt;None&lt;/code&gt;，對外 API 就能乾淨地用 &lt;code&gt;Option&lt;/code&gt; 表達可選欄位，不用每次都檢查魔法數值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EOF 的位元運算。&lt;/strong&gt; FFmpeg 用負數的四字元碼表示 EOF 錯誤（&lt;code&gt;AVERROR_EOF = -((&#39;E&#39; | &#39;O&#39;&amp;lt;&amp;lt;8 | &#39;F&#39;&amp;lt;&amp;lt;16 | &#39; &#39;&amp;lt;&amp;lt;24))&lt;/code&gt;）。Rust 端重建這個常數的方式和 C 端一樣，不依賴外部匯入的常數，讓 EOF 和真正的讀取錯誤可以明確區分。第一次看到這個寫法還楞了一下，仔細想才明白這是 FFmpeg 的 FOURCC 慣例。&lt;/p&gt;
&lt;p&gt;整體而言，這個專案把「實用工具」和「教學示範」結合得很好——&lt;code&gt;media-metadata-explorer&lt;/code&gt; 本身就是個可以日常使用的媒體檔案檢視器，而 &lt;code&gt;libavformat-ffi&lt;/code&gt; companion crate 則是學習 Rust FFI 的絕佳參考資料。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>TileSplit WASM：把 Ultra HDR 圖片切割搬到瀏覽器</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-15-tilesplit-wasm/</link>
      <pubDate>Sun, 15 Feb 2026 10:00:00 &#43;0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-15-tilesplit-wasm/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://blog.simplypatrick.com/posts/2026/02-14-tilesplit/&#34;&gt;上一篇&lt;/a&gt;介紹了 &lt;code&gt;tilesplit&lt;/code&gt; CLI，一個用 Rust 寫的工具，可以在切割圖片的同時保留 Ultra HDR 資訊。但要用 CLI 切個照片還得先裝 Rust 工具鏈&amp;hellip; 不如直接在瀏覽器裡搞定？&lt;/p&gt;
&lt;p&gt;這篇就來聊聊怎麼把 &lt;code&gt;tilesplit&lt;/code&gt; 移植到 WebAssembly，讓任何人&lt;a href=&#34;https://blog.simplypatrick.com/demos/tilesplit/&#34;&gt;打開網頁&lt;/a&gt;就能用。&lt;/p&gt;
&lt;h2 id=&#34;先玩再說&#34;&gt;先玩再說&lt;/h2&gt;
&lt;iframe src=&#34;https://blog.simplypatrick.com/demos/tilesplit/&#34; style=&#34;width: 100%; height: 730px; border: 1px solid #333; border-radius: 8px; background: #0f1117;&#34; loading=&#34;lazy&#34;&gt;&lt;/iframe&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;使用方式&lt;/strong&gt;：拖一張 JPEG 進去（支援 3:2 或 16:10 比例），調整品質後按 Split。如果是 Ultra HDR 照片，會自動偵測並顯示 HDR 標籤。切完的圖可以直接下載。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;從-cli-到-wasm關鍵差異&#34;&gt;從 CLI 到 WASM：關鍵差異&lt;/h2&gt;
&lt;p&gt;把 &lt;code&gt;tilesplit&lt;/code&gt; 搬到瀏覽器不是改個編譯目標就完事的。最大的挑戰在於&lt;strong&gt;依賴庫的替換&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;CLI 版本用了兩個 C/C++ FFI 的 crate：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ultrahdr-rs&lt;/code&gt;&lt;/strong&gt;：Google &lt;code&gt;libultrahdr&lt;/code&gt; 的封裝，處理 Ultra HDR 的編解碼和容器組裝&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;jpegli-rs&lt;/code&gt;&lt;/strong&gt;：Google &lt;code&gt;jpegli&lt;/code&gt; 的封裝，高品質 JPEG 編解碼器，支援讀寫 Gain Map&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;問題是：&lt;strong&gt;WASM 沒辦法呼叫 C FFI&lt;/strong&gt;。這兩個 crate 都需要編譯 C/C++ 原始碼，在 &lt;code&gt;wasm32-unknown-unknown&lt;/code&gt; 目標下根本編不過。&lt;/p&gt;
&lt;p&gt;WASM 版本的替代方案：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;功能&lt;/th&gt;
          &lt;th&gt;CLI 版本&lt;/th&gt;
          &lt;th&gt;WASM 版本&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;JPEG 編解碼&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;jpegli-rs&lt;/code&gt; (C FFI)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;image&lt;/code&gt; crate (純 Rust)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Ultra HDR metadata&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ultrahdr-rs&lt;/code&gt; (C FFI)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ultrahdr-core&lt;/code&gt; (純 Rust)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;容器組裝&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ultrahdr-rs&lt;/code&gt; 的 &lt;code&gt;add_gainmap()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;手動組裝 MPF 格式&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href=&#34;https://crates.io/crates/ultrahdr-core&#34;&gt;&lt;code&gt;ultrahdr-core&lt;/code&gt;&lt;/a&gt; 是個輕量的純 Rust crate，只做 metadata 解析和 XMP 生成，不碰任何 C 程式碼——正好適合 WASM。而 &lt;a href=&#34;https://crates.io/crates/image&#34;&gt;&lt;code&gt;image&lt;/code&gt;&lt;/a&gt; crate 的 JPEG 功能雖然沒有 &lt;code&gt;jpegli&lt;/code&gt; 那麼強，但對我們的需求來說夠用了。&lt;/p&gt;
&lt;p&gt;最麻煩的是容器組裝。CLI 版本靠 &lt;code&gt;jpegli-rs&lt;/code&gt; 的 &lt;code&gt;.add_gainmap()&lt;/code&gt; 一行搞定，但 WASM 版本得自己手動把 XMP marker、MPF header、Gain Map JPEG 按照正確的格式塞回主圖裡。這部分後面會詳細說明。&lt;/p&gt;
&lt;h2 id=&#34;wasm-api-設計&#34;&gt;WASM API 設計&lt;/h2&gt;
&lt;p&gt;WASM 模組只暴露三個函式給 JavaScript：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;validate_image&lt;/span&gt;(data: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;JsValue, JsValue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    console_error_panic_hook::set_once();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; img &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; image::load_from_memory(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .map_err(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; JsValue::from_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;format!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to decode image: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{e}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)))&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (width, height) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (img.width(), img.height());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; is_ultra_hdr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; detect_ultrahdr(data).is_some();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (left, _) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; compute_split_rectangles(width, height)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .map_err(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; JsValue::from_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;e))&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; info &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ImageInfo { width, height, &lt;span style=&#34;color:#75715e&#34;&gt;/* ... */&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    serde_wasm_bindgen::to_value(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;info)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .map_err(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; JsValue::from_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;format!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Serialization error: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{e}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;split_left&lt;/span&gt;(data: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;], quality: &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, JsValue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    console_error_panic_hook::set_once();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    split_tile(data, quality, Side::Left).map_err(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; JsValue::from_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;e))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;split_right&lt;/span&gt;(data: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;], quality: &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, JsValue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    console_error_panic_hook::set_once();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    split_tile(data, quality, Side::Right).map_err(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; JsValue::from_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;e))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;回傳給 JS 的 &lt;code&gt;ImageInfo&lt;/code&gt; 用 &lt;code&gt;serde&lt;/code&gt; 序列化成 JS object：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Serialize)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ImageInfo&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    width: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    height: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aspect: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[serde(rename = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;isUltraHdr&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    is_ultra_hdr: &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[serde(rename = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tileWidth&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tile_width: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[serde(rename = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tileHeight&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tile_height: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;資料流很直覺：JS 透過 &lt;code&gt;FileReader&lt;/code&gt; 讀取使用者選的檔案，轉成 &lt;code&gt;Uint8Array&lt;/code&gt; 傳進 WASM，WASM 處理完回傳 &lt;code&gt;Vec&amp;lt;u8&amp;gt;&lt;/code&gt;（自動轉成 &lt;code&gt;Uint8Array&lt;/code&gt;），JS 再包成 Blob URL 給 &lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt; 顯示和下載。&lt;/p&gt;
&lt;h2 id=&#34;ultra-hdr-偵測&#34;&gt;Ultra HDR 偵測&lt;/h2&gt;
&lt;p&gt;WASM 版本的 Ultra HDR 偵測是直接解析 JPEG 的二進制結構，不靠任何外部庫的 JPEG 解碼器：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;detect_ultrahdr&lt;/span&gt;(data: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;UltraHdrData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 1. 從 JPEG 的 APP1 marker 裡撈出 XMP metadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; extract_xmp_from_jpeg_bytes(data)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 2. 解析 XMP 得到 GainMapMetadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; metadata, _) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ultrahdr_core::metadata::xmp::parse_xmp(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;xmp).ok()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 3. 從 MPF (Multi-Picture Format) 裡提取 Gain Map JPEG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap_jpeg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; extract_gainmap_from_mpf(data)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 主圖的 metadata 可能不完整，試試從 Gain Map 自己的 XMP 補齊
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; metadata_looks_default_or_incomplete(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;metadata) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; Some(gm_xmp) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; extract_xmp_from_jpeg_bytes(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap_jpeg) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; Ok((&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; gm_meta, _)) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ultrahdr_core::metadata::xmp::parse_xmp(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gm_xmp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                apply_lenient_xmp_overrides(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gm_xmp, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; gm_meta);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;metadata_looks_default_or_incomplete(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gm_meta) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    metadata &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gm_meta;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    apply_lenient_xmp_overrides(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;xmp, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; metadata);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Some(UltraHdrData { metadata, gainmap_jpeg })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;跟 CLI 版本比起來，最大的差異是 XMP 提取。CLI 版本靠 &lt;code&gt;jpegli&lt;/code&gt; 解碼器順便把 XMP 和 Gain Map 從 JPEG extras 裡讀出來。WASM 版本沒有 &lt;code&gt;jpegli&lt;/code&gt;，只好自己掃描 JPEG marker——找 &lt;code&gt;0xFFE1&lt;/code&gt; (APP1) 拿 XMP，再用 &lt;code&gt;ultrahdr-core&lt;/code&gt; 的 MPF parser 找 Gain Map 的位置。&lt;/p&gt;
&lt;h2 id=&#34;手動組裝-ultra-hdr-容器&#34;&gt;手動組裝 Ultra HDR 容器&lt;/h2&gt;
&lt;p&gt;這是 WASM 移植裡最複雜的部分。CLI 版本一行 &lt;code&gt;.add_gainmap()&lt;/code&gt; 就搞定的事，在 WASM 版本得手動處理 MPF (Multi-Picture Format) 的二進制結構。&lt;/p&gt;
&lt;p&gt;一張 Ultra HDR JPEG 的結構大概長這樣：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;┌─────────────────────────────────┐
│ SOI (0xFFD8)                    │
│ APP1 - XMP metadata             │  ← 告訴系統「我是 Ultra HDR」
│ APP2 - MPF header               │  ← 告訴系統「Gain Map 在哪裡」
│ ... 正常的 JPEG 資料 ...         │
│ EOI (0xFFD9)                    │
├─────────────────────────────────┤
│ Gain Map JPEG (完整的第二張圖)   │  ← 亮度增益資訊
└─────────────────────────────────┘&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;assemble_ultrahdr_tile&lt;/code&gt; 函式負責把這些東西拼在一起：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assemble_ultrahdr_tile&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sdr_jpeg: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    gainmap_jpeg: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    metadata: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GainMapMetadata&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 1. 在 Gain Map JPEG 裡嵌入 XMP metadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap_xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; generate_gainmap_xmp(metadata);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap_jpeg_with_xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; embed_xmp_in_jpeg(gainmap_jpeg, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap_xmp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 2. 產生主圖的 XMP APP1 marker（包含完整參數 + Container directory）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; generate_primary_xmp(metadata, gainmap_jpeg_with_xmp.len());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; xmp_marker &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ultrahdr_core::metadata::xmp::create_xmp_app1_marker(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;xmp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 3. 把 XMP 插到 SOI 後面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; primary_with_xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Vec::with_capacity(sdr_jpeg.len() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; xmp_marker.len());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    primary_with_xmp.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;sdr_jpeg[&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]); &lt;span style=&#34;color:#75715e&#34;&gt;// SOI
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    primary_with_xmp.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;xmp_marker);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    primary_with_xmp.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;sdr_jpeg[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 4. 找到插入 MPF APP2 的位置（在 APP0/APP1 之後）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; insert_pos &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; find_mpf_insert_position(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;primary_with_xmp)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 5. 計算 MPF header（需要知道最終的 primary 大小，所以先算一次）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gm_len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gainmap_jpeg_with_xmp.len() &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; placeholder_mpf &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; create_mpf_app2(&lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;::&lt;span style=&#34;color:#66d9ef&#34;&gt;MAX&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;[gm_len], insert_pos);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; primary_final_size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (primary_with_xmp.len() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; placeholder_mpf.len()) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; mpf_header &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; create_mpf_app2(primary_final_size, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;[gm_len], insert_pos);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 6. 組裝最終輸出
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; output &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Vec::with_capacity(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        primary_with_xmp.len() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; mpf_header.len() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; gainmap_jpeg_with_xmp.len()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    output.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;primary_with_xmp[&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;insert_pos]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    output.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;mpf_header);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    output.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;primary_with_xmp[insert_pos&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    output.extend_from_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap_jpeg_with_xmp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(output)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;MPF header 裡面是個迷你的 TIFF IFD 結構，記錄了每張圖片的大小和偏移量。這裡有個雞生蛋的問題：MPF header 裡需要填 primary 的最終大小，但 primary 的大小又取決於 MPF header 有多大。解法是先用 placeholder 算出 MPF 的固定大小，再用正確的數值重新生成。&lt;/p&gt;
&lt;h2 id=&#34;wasm-體積優化&#34;&gt;WASM 體積優化&lt;/h2&gt;
&lt;p&gt;WASM 版本最終編出來的 &lt;code&gt;.wasm&lt;/code&gt; 檔案大約 &lt;strong&gt;286 KB&lt;/strong&gt;，對一個包含完整 JPEG 編解碼和 Ultra HDR 處理的模組來說算很小了。主要靠幾個手段：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;profile&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;release&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;opt-level&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;s&amp;#34;&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# 優化體積而非速度&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lto&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;         &lt;span style=&#34;color:#75715e&#34;&gt;# 跨 crate 的 Link-Time Optimization&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;加上 &lt;code&gt;image&lt;/code&gt; crate 只啟用 &lt;code&gt;jpeg&lt;/code&gt; feature，不拉進 PNG、GIF 等不需要的格式：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;image&lt;/span&gt; = { &lt;span style=&#34;color:#a6e22e&#34;&gt;version&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.25.5&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;default-features&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;jpeg&amp;#34;&lt;/span&gt;] }&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;default-features = false&lt;/code&gt; 很重要——&lt;code&gt;image&lt;/code&gt; crate 預設會拉進一大堆圖片格式的支援，對 WASM 體積影響很大。&lt;/p&gt;
&lt;h2 id=&#34;js-端的整合&#34;&gt;JS 端的整合&lt;/h2&gt;
&lt;p&gt;前端部分很簡單，用原生的 ES module 載入 WASM：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;, { &lt;span style=&#34;color:#a6e22e&#34;&gt;validate_image&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;split_left&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;split_right&lt;/span&gt; } &lt;span style=&#34;color:#a6e22e&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./tilesplit_wasm.js&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;();  &lt;span style=&#34;color:#75715e&#34;&gt;// 載入並初始化 WASM 模組
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;console&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;TileSplit WASM loaded&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;wasm-pack build --target web&lt;/code&gt; 產生的 JS glue code 會自動處理 WASM 的載入和記憶體管理。&lt;code&gt;init()&lt;/code&gt; 內部用 &lt;code&gt;WebAssembly.instantiateStreaming&lt;/code&gt; 做串流載入，瀏覽器可以在下載 WASM 的同時開始編譯，體驗很流暢。&lt;/p&gt;
&lt;p&gt;圖片處理的流程：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 使用者選擇檔案後
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FileReader&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;onload&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Uint8Array&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;target&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;info&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;validate_image&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// WASM 驗證
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 顯示圖片資訊...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;readAsArrayBuffer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 按下 Split 後
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leftBytes&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;split_left&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;currentData&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;quality&lt;/span&gt;);   &lt;span style=&#34;color:#75715e&#34;&gt;// WASM 切割
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rightBytes&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;split_right&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;currentData&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;quality&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leftBlob&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Blob&lt;/span&gt;([&lt;span style=&#34;color:#a6e22e&#34;&gt;leftBytes&lt;/span&gt;], { &lt;span style=&#34;color:#a6e22e&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;image/jpeg&amp;#39;&lt;/span&gt; });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;previewLeft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;src&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;URL&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;createObjectURL&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;leftBlob&lt;/span&gt;);       &lt;span style=&#34;color:#75715e&#34;&gt;// 顯示預覽
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;整個過程都在瀏覽器本地完成，圖片不會上傳到任何伺服器。&lt;/p&gt;
&lt;h3 id=&#34;小結&#34;&gt;小結&lt;/h3&gt;
&lt;p&gt;Ultra HDR 的「正確」其實散落在規格的各個角落。光看 &lt;a href=&#34;https://www.iso.org/standard/81379.html&#34;&gt;ISO 21496-1&lt;/a&gt; 規格書不夠，得拿 Lightroom、Google Photos 等軟體的實際輸出來對照，才能確定哪些欄位是必要的、viewer 實際上怎麼解析。&lt;/p&gt;
&lt;h2 id=&#34;結語&#34;&gt;結語&lt;/h2&gt;
&lt;p&gt;把 Rust CLI 工具移植到 WASM 最大的收穫是：&lt;strong&gt;降低了使用門檻&lt;/strong&gt;。不需要安裝任何東西，打開網頁就能用。對於像 &lt;code&gt;tilesplit&lt;/code&gt; 這種偶爾才用一次的小工具，WASM 版本可能比 CLI 更實用。&lt;/p&gt;
&lt;p&gt;當然也有取捨——WASM 版本用的 &lt;code&gt;image&lt;/code&gt; crate JPEG 編碼器品質沒有 &lt;code&gt;jpegli&lt;/code&gt; 好，處理速度也稍慢一些。但對於「切一張照片發 IG」這個使用情境來說，完全夠用。&lt;/p&gt;
&lt;p&gt;完整程式碼在 &lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/main/tilesplit-wasm&#34;&gt;GitHub&lt;/a&gt; 上。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>TileSplit：用 Rust 打造保留 Ultra HDR 資訊的圖片切割工具</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-14-tilesplit/</link>
      <pubDate>Sat, 14 Feb 2026 10:00:00 &#43;0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-14-tilesplit/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-14-tilesplit/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;每次要把橫幅風景照發 Instagram，都得打開 Lightroom 手動裁切——調整裁切框、對齊、最後再匯出。於是我就寫了 &lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/tilesplit&#34;&gt;&lt;code&gt;tilesplit&lt;/code&gt;&lt;/a&gt;，一個用 Rust 打造的小工具，專門在分割圖片的同時保留 Ultra HDR 資訊。這篇文章來聊聊 Ultra HDR 是什麼，以及這個工具背後的技術細節。&lt;/p&gt;
&lt;h2 id=&#34;為什麼需要-tilesplit&#34;&gt;為什麼需要 TileSplit？&lt;/h2&gt;
&lt;p&gt;我最主要的使用情境是&lt;strong&gt;把 3:2 的橫幅風景照發到 Instagram 上&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;雖然 Instagram 現在允許以原始比例上傳照片，但橫幅照片在動態牆上顯示得比直幅照片小很多，視覺衝擊力大打折扣。所以現在 IG 很流行「無縫滑動」的發法：把一張橫幅照片切成兩張（或更多）直幅圖，使用者左右滑的時候會有連續的視覺體驗，同時每張圖在動態牆上都能佔滿版面。但如果這張照片是 Ultra HDR 格式，用一般工具切完，HDR 就沒了——原本在 HDR 螢幕上那種亮眼的層次感，瞬間變得平淡。&lt;/p&gt;
&lt;p&gt;原因很簡單：&lt;strong&gt;大多數工具在處理圖片時，根本不知道 Gain Map 的存在&lt;/strong&gt;。它們只保留了 SDR 的部分，Gain Map 直接被丟掉了。&lt;/p&gt;
&lt;h2 id=&#34;什麼是-ultra-hdr&#34;&gt;什麼是 Ultra HDR？&lt;/h2&gt;
&lt;p&gt;Ultra HDR 是 Google 在 Android 14 引入的圖片格式，本質上還是 JPEG，但多藏了一些東西。它最厲害的地方在於&lt;strong&gt;向後兼容&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;傳統的 HDR 圖片（像 10-bit HEIF 或 AVIF）在舊手機或不支援 HDR 的螢幕上，常常會顏色怪怪的或是過暗。Ultra HDR 用了一個很聰明的方法解決這個問題：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;SDR 基礎圖片&lt;/strong&gt;：本質上就是一張普通的 JPEG，任何軟體都能打開、正常顯示。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gain Map（增益圖）&lt;/strong&gt;：在 JPEG 裡面偷偷塞了一張「變亮地圖」——告訴系統每個區域可以變多亮。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HDR 重建&lt;/strong&gt;：在支援 HDR 的螢幕上，系統把 SDR 圖片和 Gain Map 合在一起算，就能還原出更亮的高光和更豐富的細節。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;同一張圖片，舊手機上正常顯示，新手機上閃閃發光。&lt;/p&gt;
&lt;h2 id=&#34;tilesplit-是如何工作的&#34;&gt;TileSplit 是如何工作的？&lt;/h2&gt;
&lt;p&gt;核心目標很單純：切圖的同時，把 Ultra HDR 的資料完整保留下來。整個流程大概分四步：&lt;/p&gt;
&lt;h3 id=&#34;1-偵測與解析&#34;&gt;1. 偵測與解析&lt;/h3&gt;
&lt;p&gt;程式先用 &lt;code&gt;jpegli&lt;/code&gt; 去讀輸入檔案，檢查 JPEG 裡有沒有 XMP Metadata 和 Gain Map。如果 &lt;code&gt;jpegli&lt;/code&gt; 讀不出來（不同手機產生的 Ultra HDR 格式會有差異），就退回去用 Google 原生的 &lt;code&gt;ultrahdr&lt;/code&gt; 解碼器做更深入的解析。&lt;/p&gt;
&lt;h3 id=&#34;2-雙層解碼&#34;&gt;2. 雙層解碼&lt;/h3&gt;
&lt;p&gt;確認是 Ultra HDR 之後，程式會把圖片拆成兩層：&lt;strong&gt;SDR 主圖&lt;/strong&gt;（標準 RGB 像素）和 &lt;strong&gt;Gain Map&lt;/strong&gt;（亮度增益資料）。同時提取 Metadata（像 &lt;code&gt;hdrgm:GainMapMin&lt;/code&gt;、&lt;code&gt;hdrgm:Gamma&lt;/code&gt; 等），這些參數決定了 SDR 和 Gain Map 怎麼合成 HDR。&lt;/p&gt;
&lt;p&gt;來看看程式碼長什麼樣子（省略了 debug logging）：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;try_extract_ultrahdr_with_jpegli&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    source_bytes: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    debug: &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;(ultrahdr::GainMapMetadata, RawImage, GainMap, Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 用 catch_unwind 保護 jpegli 解碼——某些損壞的 JPEG 會造成 panic
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; decoded &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; catch_unwind_quiet(AssertUnwindSafe(&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        JpegDecoder::new()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .preserve(PreserveConfig::default())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .output_format(JpegPixelFormat::Rgb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .decode(source_bytes)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(Ok(image)) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; image,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 從 JPEG extras 裡挖出 XMP metadata 和 Gain Map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; extras &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; decoded.extras()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; xmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; extras.xmp()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (metadata, _) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ultrahdr::metadata::xmp::parse_xmp(xmp).ok()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; extras.gainmap() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Some(gainmap) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; gainmap.to_vec(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// extras 裡找不到的話，試試 MPF（Multi-Picture Format）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        None &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; extract_gainmap_jpeg_from_mpf(source_bytes, debug)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 有些手機的 XMP metadata 不完整，嘗試從 Gain Map 本身的 XMP 補齊
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; metadata &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; metadata_looks_default_or_incomplete(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;metadata) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        extract_metadata_from_gainmap_xmp(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap, debug).unwrap_or(metadata)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        metadata
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; icc_profile &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; extras.icc_profile().map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;icc&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; icc.to_vec());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 把像素資料包成 RawImage 結構
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; sdr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RawImage::from_data(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoded.width, decoded.height,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        PixelFormat::Rgb8, ColorGamut::Bt709, ColorTransfer::Srgb,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoded.data,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ).ok()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Gain Map 的 JPEG 也需要解碼成像素資料
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; decode_gainmap_jpeg(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap, ColorGamut::Bt709).ok()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Some((metadata, sdr, gainmap, icc_profile))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;幾個值得注意的設計：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;catch_unwind_quiet&lt;/code&gt;&lt;/strong&gt;：jpegli 是 C 庫的封裝，遇到格式損壞可能會 panic，用 &lt;code&gt;catch_unwind&lt;/code&gt; 接住避免整個程式崩潰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MPF fallback&lt;/strong&gt;：有些手機（特別是早期支援 Ultra HDR 的機型）把 Gain Map 存在 JPEG 的 Multi-Picture Format 區段而非 Extras 裡，需要額外處理&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Metadata 補齊&lt;/strong&gt;：某些裝置產生的 XMP metadata 不完整，程式會嘗試從 Gain Map 自身的 XMP 中提取更完整的參數&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-幾何映射與分割&#34;&gt;3. 幾何映射與分割&lt;/h3&gt;
&lt;p&gt;根據使用者要的比例（像 4:5 for Instagram），程式算出 SDR 主圖的裁剪區域。&lt;/p&gt;
&lt;p&gt;這裡有個坑：&lt;strong&gt;Gain Map 的解析度通常比主圖小&lt;/strong&gt;（常見是 1/4 大小），所以不能直接拿主圖的座標去切 Gain Map。需要根據兩者的比例做精確映射，不然切出來的 HDR 重建會位置偏移，高光對不準。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;map_rect_to_gainmap&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rect: &lt;span style=&#34;color:#a6e22e&#34;&gt;Rect&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    source_width: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    source_height: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    gainmap_width: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    gainmap_height: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Rect&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 用整數運算避免浮點誤差
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; x0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (rect.x &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; gainmap_width &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; source_width &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; y0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (rect.y &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; gainmap_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; source_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; right_edge &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rect.x.saturating_add(rect.width);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bottom_edge &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rect.y.saturating_add(rect.height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 右下角用 ceiling division，確保不會少切到像素
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; x1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; div_ceil_u64(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        right_edge &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; gainmap_width &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        source_width &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; y1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; div_ceil_u64(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bottom_edge &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; gainmap_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        source_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 邊界保護
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x1.clamp(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, gainmap_width);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; y1.clamp(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, gainmap_height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; x1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; x0 {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        x1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (x0 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;).min(gainmap_width);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; y1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; y0 {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        y1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (y0 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;).min(gainmap_height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Rect {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        x: &lt;span style=&#34;color:#a6e22e&#34;&gt;x0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        y: &lt;span style=&#34;color:#a6e22e&#34;&gt;y0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        width: &lt;span style=&#34;color:#a6e22e&#34;&gt;x1&lt;/span&gt;.saturating_sub(x0),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        height: &lt;span style=&#34;color:#a6e22e&#34;&gt;y1&lt;/span&gt;.saturating_sub(y0),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;4-編碼與重組&#34;&gt;4. 編碼與重組&lt;/h3&gt;
&lt;p&gt;最後一步是把切好的東西重新包裝成合法的 Ultra HDR JPEG。流程是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把裁剪後的 Gain Map 編碼成獨立的 JPEG，並嵌入 XMP metadata&lt;/li&gt;
&lt;li&gt;用 &lt;code&gt;jpegli&lt;/code&gt; 編碼 SDR 主圖，保留 ICC Color Profile&lt;/li&gt;
&lt;li&gt;手動組裝 Ultra HDR 容器：插入 XMP APP1 和 MPF APP2，再接上 Gain Map JPEG&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;為什麼不用 &lt;code&gt;jpegli&lt;/code&gt; 的 &lt;code&gt;.add_gainmap()&lt;/code&gt; 一行搞定？因為它生成的 MPF 偏移量是錯的（用了絕對偏移而非 MPF 規格要求的相對偏移），導致 viewer 找不到 Gain Map，HDR 就失效了。所以得自己手動組裝容器。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encode_ultrahdr_tile&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sdr_tile: &lt;span style=&#34;color:#a6e22e&#34;&gt;RawImage&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    gainmap_tile: &lt;span style=&#34;color:#a6e22e&#34;&gt;GainMap&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    metadata: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ultrahdr&lt;/span&gt;::GainMapMetadata,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    source_icc_profile: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 1. Gain Map 編碼成 JPEG，同時嵌入 XMP metadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; gainmap_jpeg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; encode_gainmap_jpeg(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap_tile, metadata)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 2. 編碼 SDR 主圖（不含 Gain Map，容器組裝交給 assemble_ultrahdr_jpeg）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; config &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; EncoderConfig::ycbcr(&lt;span style=&#34;color:#66d9ef&#34;&gt;SDR_TILE_JPEG_QUALITY&lt;/span&gt;, ChromaSubsampling::None);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; Some(icc_profile) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; source_icc_profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;icc_profile.is_empty()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        config &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; config.icc_profile(icc_profile.to_vec());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (pixel_layout, pixel_data) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; sdr_tile.format {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        PixelFormat::Rgb8 &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; (PixelLayout::Rgb8Srgb, Cow::Borrowed(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;sdr_tile.data)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        PixelFormat::Rgba8 &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* RGBA → RGB 轉換 */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Err(&lt;span style=&#34;color:#66d9ef&#34;&gt;EXIT_IO_ERROR&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; sdr_jpeg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* jpegli encode */&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 3. 手動組裝 Ultra HDR 容器
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assemble_ultrahdr_jpeg(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;sdr_jpeg, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gainmap_jpeg, metadata)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;assemble_ultrahdr_jpeg&lt;/code&gt; 做的事：把 XMP APP1 和 MPF APP2 插到主圖裡，再把 Gain Map JPEG 接在主圖後面。MPF header 裡的偏移量必須&lt;strong&gt;相對於 TIFF header&lt;/strong&gt;（&lt;code&gt;mpf_marker_offset + 8&lt;/code&gt;），這個細節後面的「踩坑」章節會詳細說明。&lt;/p&gt;
&lt;p&gt;這樣輸出的每一張切片都是完整的 Ultra HDR 檔案，可以在支援的設備上獨立顯示 HDR 效果。&lt;/p&gt;
&lt;h2 id=&#34;關於重新編碼與畫質&#34;&gt;關於重新編碼與畫質&lt;/h2&gt;
&lt;p&gt;你可能會問：「重新編碼會不會讓照片變糟？」&lt;/p&gt;
&lt;p&gt;會。但可以把損失降到很低。&lt;/p&gt;
&lt;p&gt;JPEG 每次重新編碼都會因為 DCT 量化而失去一些細節。為了盡量保住畫質，&lt;code&gt;tilesplit&lt;/code&gt; 做了幾件事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;用 Jpegli 編碼器&lt;/strong&gt;：Google 開源的 &lt;code&gt;jpegli&lt;/code&gt; 在同樣檔案大小下，畫質比傳統 &lt;code&gt;libjpeg&lt;/code&gt; 好不少&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;高畫質設定&lt;/strong&gt;：預設 Quality 100，在 Instagram 上基本看不出和原圖的差異&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;避免不必要的轉換&lt;/strong&gt;：直接操作解碼後的原始像素，不做多餘的格式轉換&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;技術上不是「絕對無損」——要做到無損得用 &lt;code&gt;jpegtran&lt;/code&gt; 那種直接操作 DCT 係數的方式，但那要同時處理 Ultra HDR 的 Metadata 封裝會極其困難。實際用起來，&lt;code&gt;tilesplit&lt;/code&gt; 產出的畫質對攝影愛好者來說完全夠用。&lt;/p&gt;
&lt;h2 id=&#34;關鍵相依庫&#34;&gt;關鍵相依庫&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;tilesplit&lt;/code&gt; 主要靠這三個 Rust crate：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://crates.io/crates/image&#34;&gt;&lt;code&gt;image&lt;/code&gt;&lt;/a&gt;&lt;/strong&gt;：Rust 生態系最常用的圖像處理庫，負責基礎的裁剪、格式轉換和非 HDR 圖片的處理。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://crates.io/crates/jpegli-rs&#34;&gt;&lt;code&gt;jpegli-rs&lt;/code&gt;&lt;/a&gt;&lt;/strong&gt;：Google &lt;code&gt;jpegli&lt;/code&gt; 的 Rust 封裝，壓縮率比 &lt;code&gt;libjpeg&lt;/code&gt; 好，而且支援 JPEG Extras——可以讀寫嵌在 JPEG 裡的 XMP Metadata 和 Gain Map。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://crates.io/crates/ultrahdr-rs&#34;&gt;&lt;code&gt;ultrahdr-rs&lt;/code&gt;&lt;/a&gt;&lt;/strong&gt;：Google &lt;code&gt;libultrahdr&lt;/code&gt; 的封裝，包含 Ultra HDR 的核心邏輯（Metadata 解析、SDR/HDR 轉換公式等）。遇到格式比較特殊的圖片時，靠它來兜底。它的純 Rust 子 crate &lt;code&gt;ultrahdr-core&lt;/code&gt; 也用來生成 XMP APP1 marker。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;為什麼選擇-rust&#34;&gt;為什麼選擇 Rust？&lt;/h2&gt;
&lt;p&gt;Rust 剛好適合這種場景：記憶體安全（不用擔心 segfault）、執行效率接近 C++、而且 FFI 很方便——&lt;code&gt;libultrahdr&lt;/code&gt; 和 &lt;code&gt;jpegli&lt;/code&gt; 都是 C/C++ 的庫，Rust 可以直接呼叫再包一層安全介面。加上 &lt;code&gt;Result&lt;/code&gt; 型別強制處理所有錯誤情況，遇到檔案損壞或 metadata 缺失，不會直接 crash，而是給出有意義的錯誤訊息。&lt;/p&gt;
&lt;h2 id=&#34;安裝與使用&#34;&gt;安裝與使用&lt;/h2&gt;
&lt;p&gt;如果你也有類似需求，可以直接從 GitHub 安裝：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install --git https://github.com/p47t/rust-52-projects --branch tilesplit&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;用法很簡單：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 基本用法，自動生成 photo-left.jpg 和 photo-right.jpg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tilesplit --input photo.jpg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 指定輸出路徑&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tilesplit --input photo.jpg --left-output left.jpg --right-output right.jpg&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;原始碼在 &lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/tilesplit&#34;&gt;rust-52-projects/tilesplit&lt;/a&gt; 上。&lt;/p&gt;
&lt;h2 id=&#34;踩過的坑亮度為什麼不對&#34;&gt;踩過的坑：亮度為什麼不對？&lt;/h2&gt;
&lt;p&gt;做完初版後，切出來的圖在 HDR 螢幕上看起來比原圖暗很多。花了不少時間 debug 才搞清楚，「把 Gain Map 塞進去」跟「讓 viewer 正確解讀」是兩回事。以下是踩過的幾個主要坑：&lt;/p&gt;
&lt;h3 id=&#34;mpf-偏移量的基準點&#34;&gt;MPF 偏移量的基準點&lt;/h3&gt;
&lt;p&gt;Ultra HDR JPEG 是兩張圖接在一起——主圖和 Gain Map。MPF (Multi-Picture Format) APP2 marker 裡有個 TIFF IFD 結構，記錄 Gain Map 的位置。關鍵是：&lt;strong&gt;偏移量是相對於 MPF 裡的 TIFF header&lt;/strong&gt;，不是檔案開頭。&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;MPF APP2 的二進制結構：
FF E2          ← marker (2 bytes)
xx xx          ← length (2 bytes)
4D 50 46 00    ← &amp;#34;MPF\0&amp;#34; (4 bytes)
4D 4D 00 2A    ← TIFF header ← 偏移量從這裡算起&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;TIFF header 在 MPF marker 起始位置 +8 bytes 的地方。一開始用了 &lt;code&gt;jpegli&lt;/code&gt; 的 &lt;code&gt;.add_gainmap()&lt;/code&gt; API，發現它寫入的是絕對偏移而非相對偏移，viewer 根本找不到 Gain Map。改成手動組裝容器才修好。&lt;/p&gt;
&lt;h3 id=&#34;主圖和-gain-map-都要有-xmp&#34;&gt;主圖和 Gain Map 都要有 XMP&lt;/h3&gt;
&lt;p&gt;原本以為只要主圖的 XMP 有完整參數就行。結果拿 Lightroom 匯出的 Ultra HDR 對比——&lt;strong&gt;主圖的 XMP 只有 &lt;code&gt;hdrgm:Version=&amp;quot;1.0&amp;quot;&lt;/code&gt;，完整的 &lt;code&gt;GainMapMin&lt;/code&gt;、&lt;code&gt;GainMapMax&lt;/code&gt;、&lt;code&gt;Gamma&lt;/code&gt; 等參數全在 Gain Map JPEG 自己的 XMP 裡&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;這表示很多 viewer（包括 Android 的 Photos 和 Chrome）是優先從 Gain Map 的 XMP 讀取參數的。Gain Map JPEG 如果沒嵌入 XMP，viewer 可能拿不到正確的 boost 參數，畫面就是暗的。&lt;/p&gt;
&lt;h3 id=&#34;rdfseq-才是標準格式&#34;&gt;rdf:Seq 才是標準格式&lt;/h3&gt;
&lt;p&gt;Gain Map 參數是 per-channel 的（RGB 各通道可以不同），在 XMP 裡有兩種表達方式：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;!-- 逗號分隔（有些 viewer 不認） --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;rdf:Description&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;hdrgm:GainMapMax=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-0.699, -0.615, -0.603&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;!-- rdf:Seq（標準，所有 viewer 都認） --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;hdrgm:GainMapMax&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;rdf:Seq&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;rdf:li&amp;gt;&lt;/span&gt;-0.699220&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/rdf:li&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;rdf:li&amp;gt;&lt;/span&gt;-0.614892&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/rdf:li&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;rdf:li&amp;gt;&lt;/span&gt;-0.603440&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/rdf:li&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/rdf:Seq&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/hdrgm:GainMapMax&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ultrahdr-rs&lt;/code&gt; crate 的 &lt;code&gt;generate_xmp()&lt;/code&gt; 用的是逗號分隔格式，實測某些 viewer 會 fallback 到預設值。改成 &lt;code&gt;rdf:Seq&lt;/code&gt; 格式後就正常了。&lt;/p&gt;
&lt;h3 id=&#34;gain-map-品質不能省&#34;&gt;Gain Map 品質不能省&lt;/h3&gt;
&lt;p&gt;Gain Map 每個像素代表 HDR boost 強度，套用公式大致是 &lt;code&gt;boost = max_boost^(pixel/255)&lt;/code&gt;。因為是&lt;strong&gt;指數關係&lt;/strong&gt;，JPEG 壓縮的量化誤差會被指數放大——pixel 值差個 5，亮度可能差 5% 以上。所以 Gain Map 一律用 quality 100 編碼，不管使用者設的 SDR 品質是多少。&lt;/p&gt;
&lt;h3 id=&#34;教訓&#34;&gt;教訓&lt;/h3&gt;
&lt;p&gt;Ultra HDR 的正確性散落在 MPF 規格、XMP schema、和各家 viewer 的實作細節裡。光看 &lt;a href=&#34;https://www.iso.org/standard/81379.html&#34;&gt;ISO 21496-1&lt;/a&gt; 不夠，得拿 Lightroom、Google Photos 等軟體的實際輸出做二進制比對，才能確認哪些欄位是必要的、viewer 怎麼解析。&lt;/p&gt;
&lt;h2 id=&#34;結語&#34;&gt;結語&lt;/h2&gt;
&lt;p&gt;HDR 螢幕越來越普及，Ultra HDR 這種格式以後只會更常見。現有的圖像處理工具大多還沒跟上，&lt;code&gt;tilesplit&lt;/code&gt; 算是填補了這個小空白。如果你也有保留 HDR 切圖的需求，希望這個工具能幫到你。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Rust Proc Macro：builder-derive 實戰</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-13-rust-proc-macro-builder-derive/</link>
      <pubDate>Fri, 13 Feb 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-13-rust-proc-macro-builder-derive/</guid>
      <description>&lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-13-rust-proc-macro-builder-derive/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近在看 &lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/main/builder-derive&#34;&gt;&lt;code&gt;builder-derive&lt;/code&gt;&lt;/a&gt; 這個小專案時，會再次被 Rust 的 procedural macro 驚艷到：&lt;/p&gt;
&lt;p&gt;你在程式碼裡只寫一行 &lt;code&gt;#[derive(Builder)]&lt;/code&gt;，編譯器就幫你生出一整套 Builder API。&lt;/p&gt;
&lt;p&gt;但它到底怎麼做到的？&lt;/p&gt;
&lt;p&gt;這篇就用 &lt;code&gt;builder-derive&lt;/code&gt; 的實作，從 &lt;code&gt;TokenStream&lt;/code&gt; 一路追到實際生成的程式碼，拆解 Rust proc macro 的完整流程。&lt;/p&gt;
&lt;h2 id=&#34;先看使用端我們到底得到了什麼&#34;&gt;先看使用端：我們到底得到了什麼&lt;/h2&gt;
&lt;p&gt;先看最終使用方式：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; builder_derive::Builder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Builder, Debug)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;User&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    username: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    email: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    age: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tags: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; user &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; User::builder()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .username(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;alice&amp;#34;&lt;/span&gt;.to_string())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .email(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;alice@example.com&amp;#34;&lt;/span&gt;.to_string())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .age(&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .build()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這裡我們沒有手寫 &lt;code&gt;UserBuilder&lt;/code&gt;，也沒有手寫 setter、&lt;code&gt;build()&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#[derive(Builder)]&lt;/code&gt; 在編譯期把這些東西全部產生出來。&lt;/p&gt;
&lt;h2 id=&#34;proc-macro-的核心心法編譯期程式碼產生器&#34;&gt;Proc Macro 的核心心法：編譯期程式碼產生器&lt;/h2&gt;
&lt;p&gt;很多人第一次接觸 macro 會覺得它像「文字替換」。
Rust 的 procedural macro 比這個更嚴謹：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;編譯器把你標註 &lt;code&gt;derive&lt;/code&gt; 的語法轉成 &lt;code&gt;TokenStream&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;macro crate 用 &lt;code&gt;syn&lt;/code&gt; 把 token parse 成 AST（語法樹）&lt;/li&gt;
&lt;li&gt;你在 AST 上做檢查與分析&lt;/li&gt;
&lt;li&gt;用 &lt;code&gt;quote&lt;/code&gt; 產生新的 Rust tokens 丟回編譯器&lt;/li&gt;
&lt;li&gt;編譯器把這段新程式碼當成真的程式去編譯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 的模組切分很清楚：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;src/lib.rs&lt;/code&gt;：入口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;src/parse.rs&lt;/code&gt;：輸入合法性檢查&lt;/li&gt;
&lt;li&gt;&lt;code&gt;src/field.rs&lt;/code&gt;：欄位型別分析&lt;/li&gt;
&lt;li&gt;&lt;code&gt;src/generate.rs&lt;/code&gt;：程式碼生成&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;第-1-步入口函式librs&#34;&gt;第 1 步：入口函式（lib.rs）&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 的入口非常典型：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[proc_macro_derive(Builder)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;derive_builder&lt;/span&gt;(input: &lt;span style=&#34;color:#a6e22e&#34;&gt;TokenStream&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TokenStream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; input &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;parse_macro_input!&lt;/span&gt;(input &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; DeriveInput);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; generate::impl_builder(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;input) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(tokens) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; tokens.into(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Err(e) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; e.to_compile_error().into(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這段有三個重點：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;#[proc_macro_derive(Builder)]&lt;/code&gt; 把這個函式註冊成 derive macro。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;parse_macro_input!&lt;/code&gt; 把原始 token 解析成 &lt;code&gt;syn::DeriveInput&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;發生錯誤時用 &lt;code&gt;to_compile_error()&lt;/code&gt; 轉成編譯錯誤，而不是 panic。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;也就是說，macro 的錯誤訊息其實是你主動設計出來的 UX。&lt;/p&gt;
&lt;h2 id=&#34;第-2-步先擋掉不支援的型別parsers&#34;&gt;第 2 步：先擋掉不支援的型別（parse.rs）&lt;/h2&gt;
&lt;p&gt;在 &lt;code&gt;parse.rs&lt;/code&gt; 裡，專案先做輸入驗證：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只接受「具名欄位 struct」&lt;/li&gt;
&lt;li&gt;拒絕 enum / union / tuple struct / unit struct&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這個設計超務實。因為 Builder 的生成邏輯依賴欄位名稱，沒有欄位名就沒辦法安全產生 setter。&lt;/p&gt;
&lt;p&gt;像這段 compile-fail 測試會得到清楚錯誤：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Builder)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MyEnum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Variant1,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Variant2,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;錯誤訊息是：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Builder can only be derived for structs, not enums&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 這裡做得很對：把「不可能支援」的 case 儘早在編譯期擋下來，使用者不用等到 runtime 才踩雷。&lt;/p&gt;
&lt;h2 id=&#34;第-3-步欄位分析fieldrs&#34;&gt;第 3 步：欄位分析（field.rs）&lt;/h2&gt;
&lt;p&gt;接著是整個 macro 的關鍵資料結構 &lt;code&gt;FieldInfo&lt;/code&gt;，每個欄位會被分析出：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;欄位名稱 &lt;code&gt;name&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;原始型別 &lt;code&gt;ty&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;是否 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt; 的內層型別 &lt;code&gt;T&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;是否 &lt;code&gt;Vec&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;怎麼判斷-optiont&#34;&gt;怎麼判斷 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;？&lt;/h3&gt;
&lt;p&gt;它用 &lt;code&gt;syn::Type&lt;/code&gt; pattern matching：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先確認是 &lt;code&gt;Type::Path&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;抓路徑最後一段（例如 &lt;code&gt;Option&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;看識別字是不是 &lt;code&gt;Option&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;若是，從 angle-bracket 參數拿出 &lt;code&gt;T&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;這是 proc macro 最常見也最實用的技巧：
&lt;strong&gt;不要自己 parse 字串；直接操作 AST。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;syn-到底在做什麼&#34;&gt;&lt;code&gt;syn&lt;/code&gt; 到底在做什麼？&lt;/h3&gt;
&lt;p&gt;可以把 &lt;code&gt;syn&lt;/code&gt; 想成「Rust 語法的解析器 + AST 資料模型」。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;builder-derive&lt;/code&gt; 裡，&lt;code&gt;syn&lt;/code&gt; 主要做三件事：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把 &lt;code&gt;TokenStream&lt;/code&gt; 轉成 &lt;code&gt;DeriveInput&lt;/code&gt;（看到 struct 名稱、可見性、欄位）&lt;/li&gt;
&lt;li&gt;用 enum pattern matching 檢查資料型別（&lt;code&gt;Data::Struct&lt;/code&gt; / &lt;code&gt;Fields::Named&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;深入欄位型別結構（&lt;code&gt;Type::Path&lt;/code&gt; -&amp;gt; &lt;code&gt;PathSegment&lt;/code&gt; -&amp;gt; &lt;code&gt;PathArguments&lt;/code&gt;）判斷 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;、&lt;code&gt;Vec&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;為什麼這很重要？因為 procedural macro 要的是「語法結構」，不是字串比對。&lt;/p&gt;
&lt;p&gt;舉例來說，&lt;code&gt;Option&amp;lt;String&amp;gt;&lt;/code&gt;、&lt;code&gt;std::option::Option&amp;lt;String&amp;gt;&lt;/code&gt; 在字串上看起來不同，但在 AST 層都能被一致處理。這就是 &lt;code&gt;syn&lt;/code&gt; 在 macro 裡的核心價值。&lt;/p&gt;
&lt;p&gt;另外像 &lt;code&gt;syn::Error::new_spanned(...)&lt;/code&gt; 也很關鍵：它可以把錯誤綁在原始程式碼 span 上，讓編譯錯誤直接指到真正寫錯的那一行。&lt;/p&gt;
&lt;h3 id=&#34;這個專案一個值得注意的設計&#34;&gt;這個專案一個值得注意的設計&lt;/h3&gt;
&lt;p&gt;對 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt; 欄位，setter 參數型別是 &lt;code&gt;T&lt;/code&gt;，不是 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;也就是你寫：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.age(&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;而不是：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.age(Some(&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這讓 API 更順手。不過 tradeoff 是：目前 API 不能顯式設定 &lt;code&gt;None&lt;/code&gt;，只能「不呼叫 setter」來得到 &lt;code&gt;None&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;第-4-步用-quote-生成程式碼generaters&#34;&gt;第 4 步：用 quote 生成程式碼（generate.rs）&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;generate.rs&lt;/code&gt; 裡把生成工作拆成四塊，這個切法很值得學：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;generate_builder_struct&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;generate_builder_constructor&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;generate_setter_methods&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;generate_build_method&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;quote-怎麼把-ast-變回-rust-程式&#34;&gt;&lt;code&gt;quote!&lt;/code&gt; 怎麼把 AST 變回 Rust 程式？&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;quote&lt;/code&gt; 的角色是「把分析結果重新組裝成 token」。&lt;/p&gt;
&lt;p&gt;在這個專案裡，最常用的語法有兩個：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;#var&lt;/code&gt;：把變數插進模板&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#(...)*&lt;/code&gt;：把 iterator 產生的多段程式碼展開&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;例如：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; builder_fields &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; field_infos.iter().map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;field&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;field.name;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; builder_ty &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; field.builder_field_type();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;quote!&lt;/span&gt; { #name: #builder_ty }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;quote!&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; #builder_name {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        #(#builder_fields,)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這段可以讀成：「每個欄位先變成一小段 token，最後用 repetition 一次展開成完整 struct 欄位列表。」&lt;/p&gt;
&lt;p&gt;也因為這種寫法，macro 可以維持很強的可組合性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每個生成函式只負責一種片段&lt;/li&gt;
&lt;li&gt;最後在 &lt;code&gt;impl_builder&lt;/code&gt; 把片段拼回完整輸出&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;對大型 macro 專案來說，這比單一巨大 &lt;code&gt;quote!&lt;/code&gt; 區塊更容易維護。&lt;/p&gt;
&lt;h3 id=&#34;41-生成-builder-struct&#34;&gt;4.1 生成 Builder struct&lt;/h3&gt;
&lt;p&gt;每個 builder 欄位都用 &lt;code&gt;Option&amp;lt;...&amp;gt;&lt;/code&gt; 包起來，目的是追蹤「這個欄位有沒有被設定」。&lt;/p&gt;
&lt;h3 id=&#34;42-生成-builder&#34;&gt;4.2 生成 &lt;code&gt;builder()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;在原始 struct 上加：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; User {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;builder&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;UserBuilder&lt;/span&gt; { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;所有欄位初始化成 &lt;code&gt;None&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;43-生成-setter可-chain&#34;&gt;4.3 生成 setter（可 chain）&lt;/h3&gt;
&lt;p&gt;每個 setter 都是這個形狀：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;field&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, value: &lt;span style=&#34;color:#a6e22e&#34;&gt;T&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.field &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(value);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;self&lt;/code&gt; by value + 回傳 &lt;code&gt;Self&lt;/code&gt;，就是 fluent API 的來源。&lt;/p&gt;
&lt;h3 id=&#34;44-生成-build而且不同欄位策略不同&#34;&gt;4.4 生成 &lt;code&gt;build()&lt;/code&gt;，而且不同欄位策略不同&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 在這裡把欄位分三類處理：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;：直接 passthrough（沒設就 &lt;code&gt;None&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Vec&amp;lt;T&amp;gt;&lt;/code&gt;：沒設就 &lt;code&gt;unwrap_or_default()&lt;/code&gt;，變空陣列&lt;/li&gt;
&lt;li&gt;其他欄位：必填，沒設就回 &lt;code&gt;Err(&amp;quot;field is required&amp;quot;)&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;這個策略很實用，因為 &lt;code&gt;Vec&amp;lt;T&amp;gt;&lt;/code&gt; 在很多 config 型別裡確實適合預設空集合。&lt;/p&gt;
&lt;h2 id=&#34;展開後大概長怎樣&#34;&gt;展開後大概長怎樣？&lt;/h2&gt;
&lt;p&gt;以這個輸入：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Builder)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    host: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    port: &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    timeout: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    features: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;macro 會產生近似這樣的程式碼（簡化版）：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigBuilder&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    host: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    port: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    timeout: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    features: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Config {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;builder&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigBuilder&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ConfigBuilder {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            host: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            port: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            timeout: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            features: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; ConfigBuilder {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;host&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, value: String) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.host &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(value);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;port&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, value: &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.port &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(value);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;timeout&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, value: &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.timeout &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(value);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, value: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.features &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(value);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;build&lt;/span&gt;(self) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Config, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(Config {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            host: &lt;span style=&#34;color:#a6e22e&#34;&gt;self&lt;/span&gt;.host.ok_or_else(&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;host is required&amp;#34;&lt;/span&gt;.to_string())&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            port: &lt;span style=&#34;color:#a6e22e&#34;&gt;self&lt;/span&gt;.port.ok_or_else(&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;port is required&amp;#34;&lt;/span&gt;.to_string())&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            timeout: &lt;span style=&#34;color:#a6e22e&#34;&gt;self&lt;/span&gt;.timeout,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            features: &lt;span style=&#34;color:#a6e22e&#34;&gt;self&lt;/span&gt;.features.unwrap_or_default(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;重點是：這些都發生在編譯期，你 runtime 不需要額外 macro 成本。&lt;/p&gt;
&lt;h2 id=&#34;錯誤處理compile-time-跟-runtime-分工&#34;&gt;錯誤處理：compile-time 跟 runtime 分工&lt;/h2&gt;
&lt;p&gt;這個專案的錯誤策略很清楚：&lt;/p&gt;
&lt;h3 id=&#34;compile-timemacro-階段&#34;&gt;Compile-time（macro 階段）&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;型別不支援就直接編譯失敗&lt;/li&gt;
&lt;li&gt;錯誤訊息會標到對應程式碼位置（透過 &lt;code&gt;syn::Error::new_spanned&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;runtimebuild-階段&#34;&gt;Runtime（build 階段）&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;缺必要欄位時，&lt;code&gt;build()&lt;/code&gt; 回 &lt;code&gt;Result::Err(String)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這種分工很合理：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;能在語法層判斷的，就盡量提早失敗&lt;/li&gt;
&lt;li&gt;必須等使用者呼叫流程才能判斷的，就用 &lt;code&gt;Result&lt;/code&gt; 回報&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;為什麼這個範例很適合學-proc-macro&#34;&gt;為什麼這個範例很適合學 proc macro&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 的好處是它「剛好夠真實，但不會太重」：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;有完整 pipeline（parse -&amp;gt; analyze -&amp;gt; generate）&lt;/li&gt;
&lt;li&gt;有 compile-fail test（&lt;code&gt;trybuild&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;有 integration tests 驗證行為&lt;/li&gt;
&lt;li&gt;邏輯分層乾淨，不會全部擠在一個檔案&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果正要開始學 proc macro，建議順序是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先看 &lt;code&gt;src/lib.rs&lt;/code&gt; 入口&lt;/li&gt;
&lt;li&gt;再看 &lt;code&gt;parse.rs&lt;/code&gt; 怎麼做輸入保護&lt;/li&gt;
&lt;li&gt;再看 &lt;code&gt;field.rs&lt;/code&gt; 怎麼做型別判斷&lt;/li&gt;
&lt;li&gt;最後看 &lt;code&gt;generate.rs&lt;/code&gt; 的 &lt;code&gt;quote!&lt;/code&gt; 拼裝&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;這樣你比較不會一開始就被 &lt;code&gt;quote!&lt;/code&gt; 的 token interpolation 淹沒。&lt;/p&gt;
&lt;h2 id=&#34;目前限制與下一步&#34;&gt;目前限制與下一步&lt;/h2&gt;
&lt;p&gt;以目前實作來看，還有幾個可以進化的方向：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;支援 generics（例如 &lt;code&gt;struct Foo&amp;lt;T&amp;gt;&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;支援 &lt;code&gt;#[builder(...)]&lt;/code&gt; 欄位屬性（default、setter(into)、skip）&lt;/li&gt;
&lt;li&gt;更結構化的錯誤型別（取代 &lt;code&gt;String&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;允許 optional setter 傳 &lt;code&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;（可顯式設 &lt;code&gt;None&lt;/code&gt;）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;但以「教學用、理解 proc macro 原理」來說，現在這個版本其實已經很漂亮了。&lt;/p&gt;
&lt;h2 id=&#34;結語&#34;&gt;結語&lt;/h2&gt;
&lt;p&gt;Rust 的 procedural macro 真正厲害的地方，不是語法炫技，而是把重複樣板在「編譯期」變成可驗證、可維護的程式碼生成流程。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;builder-derive&lt;/code&gt; 這個專案剛好把這件事示範得很清楚：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用 &lt;code&gt;syn&lt;/code&gt; 看懂你的 Rust 程式&lt;/li&gt;
&lt;li&gt;用 &lt;code&gt;quote&lt;/code&gt; 生成你本來不想手寫的 boilerplate&lt;/li&gt;
&lt;li&gt;用型別檢查和測試把 macro 行為收斂到可預期&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下次看到 &lt;code&gt;#[derive(...)]&lt;/code&gt;，你可以把它想成：
&lt;strong&gt;「這不是魔法，是一個在編譯器裡跑的小型 code generator。」&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;專案連結：&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/main/builder-derive&#34;&gt;&lt;code&gt;rust-52-projects/builder-derive&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>用 Rust &#43; WebGPU 在瀏覽器跑 Game of Life</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-09-wgpu-game-of-life/</link>
      <pubDate>Mon, 09 Feb 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-09-wgpu-game-of-life/</guid>
      <description>&lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-09-wgpu-game-of-life/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;這個專案把 Conway&amp;rsquo;s Game of Life 搬到 GPU 上面跑——用 Rust 的 &lt;a href=&#34;https://wgpu.rs/&#34;&gt;wgpu&lt;/a&gt; 寫 WebGPU compute shader，編譯成 WASM 在瀏覽器裡執行。128x128 的網格、上萬個細胞的模擬，全部在 GPU 上平行計算。&lt;/p&gt;
&lt;p&gt;專案原始碼：&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/wgpu-game-of-life&#34;&gt;wgpu-game-of-life&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;先玩再說&#34;&gt;先玩再說&lt;/h2&gt;
&lt;iframe src=&#34;https://blog.simplypatrick.com/demos/wgpu-game-of-life/&#34; style=&#34;width: 100%; height: 730px; border: 1px solid #333; border-radius: 8px; background: #0e0e18;&#34; loading=&#34;lazy&#34;&gt;&lt;/iframe&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;操作方式&lt;/strong&gt;：Play/Pause 開始模擬，點擊畫布可以畫細胞，Speed 調整速度。需要 WebGPU 支援的瀏覽器（Chrome 113+、Edge 113+、Firefox 141+）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;顏色代表細胞年齡：綠色是新生的，黃色是年輕的，橘色是成熟的，白色是古老的 still life 結構。&lt;/p&gt;
&lt;h2 id=&#34;為什麼做這個&#34;&gt;為什麼做這個？&lt;/h2&gt;
&lt;p&gt;在完成 &lt;a href=&#34;https://blog.simplypatrick.com/posts/2026/01-06-rust-wasm-markdown-editor/&#34;&gt;WASM Markdown 編輯器&lt;/a&gt;之後，我想更深入探索 WASM 的可能性。Markdown 編輯器純粹是 CPU 計算，但現代瀏覽器已經支援 WebGPU——可以直接存取 GPU 的算力。&lt;/p&gt;
&lt;p&gt;Game of Life 是個完美的入門專案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;天然適合平行計算&lt;/strong&gt;：每個細胞的下一代只取決於鄰居，可以完全並行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;需要 compute shader + render pipeline&lt;/strong&gt;：同時學兩種 GPU 程式設計模式&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;視覺回饋即時&lt;/strong&gt;：寫完馬上看到結果&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;規模剛好&lt;/strong&gt;：不會太大，但足以理解 GPU 程式設計的核心概念&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;技術架構&#34;&gt;技術架構&lt;/h2&gt;
&lt;h3 id=&#34;整體流程&#34;&gt;整體流程&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-goat&#34; data-lang=&#34;goat&#34;&gt;[Storage Buffer A] ──read──▶ [Compute Shader] ──write──▶ [Storage Buffer B]
                                                              │
                              [Render Pipeline] ◀──read───────┘
                                    │
                              [Canvas Output]&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;核心是 &lt;strong&gt;ping-pong 雙緩衝&lt;/strong&gt;：兩個 storage buffer 交替讀寫。每一步模擬時，compute shader 從一個 buffer 讀取當前狀態，計算下一代寫入另一個 buffer，然後交換。Render pipeline 負責把結果畫到畫面上。&lt;/p&gt;
&lt;h3 id=&#34;專案結構&#34;&gt;專案結構&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wgpu-game-of-life/
├── Cargo.toml
├── src/
│   ├── lib.rs           # WASM 進入點，匯出 API
│   ├── gpu.rs           # wgpu 初始化、pipeline 建立、模擬邏輯
│   ├── compute.wgsl     # Compute shader（Game of Life 規則）
│   └── render.wgsl      # Vertex + Fragment shader（網格視覺化）
├── index.html
└── www/
    ├── index.js         # 控制邏輯、動畫迴圈、滑鼠互動
    └── styles.css&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;rust-依賴項&#34;&gt;Rust 依賴項&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;wgpu&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;24&amp;#34;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;# WebGPU API&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;wasm-bindgen&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.2&amp;#34;&lt;/span&gt;               &lt;span style=&#34;color:#75715e&#34;&gt;# JS 互操作&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;wasm-bindgen-futures&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.4&amp;#34;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;# async 支援（wgpu 初始化是 async 的）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;web-sys&lt;/span&gt; = { &lt;span style=&#34;color:#a6e22e&#34;&gt;version&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.3&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Document&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Window&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Element&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HtmlCanvasElement&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;console&amp;#34;&lt;/span&gt;] }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;console_error_panic_hook&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;js-sys&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;bytemuck&lt;/span&gt; = { &lt;span style=&#34;color:#a6e22e&#34;&gt;version&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;derive&amp;#34;&lt;/span&gt;] }&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;跟 Markdown 編輯器比，多了 &lt;code&gt;wgpu&lt;/code&gt;（核心）、&lt;code&gt;wasm-bindgen-futures&lt;/code&gt;（因為 GPU 初始化是非同步的）和 &lt;code&gt;bytemuck&lt;/code&gt;（安全地把 Rust 資料轉成 GPU buffer 需要的位元組）。&lt;/p&gt;
&lt;h2 id=&#34;compute-shadergame-of-life-規則&#34;&gt;Compute Shader：Game of Life 規則&lt;/h2&gt;
&lt;p&gt;這是整個專案最核心的部分——用 WGSL 寫的 compute shader：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-wgsl&#34; data-lang=&#34;wgsl&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@group&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;@binding&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;uniform&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; grid: vec2u;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@group&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;@binding&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;storage, read&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cells_in: array&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;u32&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@group&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;@binding&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;storage, read_write&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cells_out: array&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;u32&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@compute&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;@workgroup_size&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; main(&lt;span style=&#34;color:#a6e22e&#34;&gt;@builtin&lt;/span&gt;(global_invocation_id) id: vec3u) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (id.x &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; grid.x &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; id.y &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; grid.y) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 數 8 個鄰居（環形邊界）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; neighbors: u32 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; dy: i32 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dy &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dy&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; dx: i32 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dx &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dx&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dx &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; dy &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) { &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; nx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; u32((i32(id.x) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; dx &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; i32(grid.x)) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; i32(grid.x));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ny &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; u32((i32(id.y) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; dy &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; i32(grid.y)) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; i32(grid.y));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            neighbors &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; select(&lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;, cells_in[cell_index(nx, ny)] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; idx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cell_index(id.x, id.y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cells_in[idx];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Conway&amp;#39;s rules + 年齡追蹤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (neighbors &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3u&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cells_out[idx] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;;                    &lt;span style=&#34;color:#75715e&#34;&gt;// 誕生
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (neighbors &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2u&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; neighbors &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3u&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cells_out[idx] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; min(age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;255u&lt;/span&gt;);   &lt;span style=&#34;color:#75715e&#34;&gt;// 存活，年齡 +1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cells_out[idx] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;;                    &lt;span style=&#34;color:#75715e&#34;&gt;// 死亡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;幾個重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@workgroup_size(8, 8)&lt;/code&gt;&lt;/strong&gt;：每個工作群組處理 8x8 = 64 個細胞，GPU 會自動分配到各個核心&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;cells_in&lt;/code&gt; 是唯讀，&lt;code&gt;cells_out&lt;/code&gt; 是可寫&lt;/strong&gt;：避免讀寫衝突，這就是為什麼需要兩個 buffer&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;環形邊界（toroidal wrapping）&lt;/strong&gt;：左邊超出會接到右邊，上面超出接到下面&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;年齡追蹤&lt;/strong&gt;：不只是 0/1，而是記錄細胞存活了幾代（上限 255）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;128x128 的網格需要 dispatch &lt;code&gt;ceil(128/8) × ceil(128/8) = 16 × 16 = 256&lt;/code&gt; 個工作群組，每個群組 64 個執行緒，總共 16,384 個 GPU 執行緒平行計算。&lt;/p&gt;
&lt;h2 id=&#34;render-shader年齡上色&#34;&gt;Render Shader：年齡上色&lt;/h2&gt;
&lt;p&gt;Fragment shader 根據年齡把細胞染成不同顏色：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-wgsl&#34; data-lang=&#34;wgsl&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; age_color(age: u32) -&amp;gt; vec4f {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (age &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; vec4f(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.06&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.06&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.12&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 死亡：深色背景
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; clamp(f32(age &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50.0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 顏色漸層：亮綠 → 黃綠 → 橘 → 暖白
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; c0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec3f(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.90&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.30&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 新生
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; c1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec3f(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.80&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.90&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 年輕
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; c2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec3f(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.95&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.60&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.10&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 成熟
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; c3 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec3f(&lt;span style=&#34;color:#ae81ff&#34;&gt;1.00&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.85&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.70&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 古老
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 三段線性插值
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.33&lt;/span&gt;) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; mix(c0, c1, t &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.33&lt;/span&gt;); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.66&lt;/span&gt;) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; mix(c1, c2, (t &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.33&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.33&lt;/span&gt;); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; mix(c2, c3, (t &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.66&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.34&lt;/span&gt;); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;渲染方式是畫一個全螢幕四邊形（6 個頂點、2 個三角形），fragment shader 根據 UV 座標查詢對應的細胞年齡。這比為每個細胞生成幾何體（instanced rendering）更簡單，而且效能足夠。&lt;/p&gt;
&lt;h2 id=&#34;rust-端wgpu-初始化&#34;&gt;Rust 端：wgpu 初始化&lt;/h2&gt;
&lt;p&gt;wgpu 在 WASM 環境下的初始化跟 native 基本一樣，只是 surface 從 canvas 建立：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 從 HTML canvas 建立 surface
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; instance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; wgpu::Instance::new(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;wgpu::InstanceDescriptor {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    backends: &lt;span style=&#34;color:#a6e22e&#34;&gt;wgpu&lt;/span&gt;::Backends::&lt;span style=&#34;color:#66d9ef&#34;&gt;BROWSER_WEBGPU&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; wgpu::Backends::&lt;span style=&#34;color:#66d9ef&#34;&gt;GL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; surface &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; instance
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .create_surface(wgpu::SurfaceTarget::Canvas(canvas))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;failed to create surface&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 請求 adapter 和 device（非同步）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; adapter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; instance.request_adapter(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;wgpu::RequestAdapterOptions {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    compatible_surface: Some(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;surface),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;.expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no adapter&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (device, queue) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; adapter.request_device(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;wgpu::DeviceDescriptor {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        required_limits: &lt;span style=&#34;color:#a6e22e&#34;&gt;wgpu&lt;/span&gt;::Limits::downlevel_webgl2_defaults()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .using_resolution(adapter.limits()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;.expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no device&amp;#34;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;Backends::BROWSER_WEBGPU | Backends::GL&lt;/code&gt; 讓它在支援 WebGPU 的瀏覽器用 WebGPU，不支援的用 WebGL2 作為 fallback。&lt;/p&gt;
&lt;h3 id=&#34;ping-pong-雙緩衝&#34;&gt;Ping-Pong 雙緩衝&lt;/h3&gt;
&lt;p&gt;最有趣的設計是 bind group 的建立——為了實現 ping-pong，我們建兩組 bind group：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; compute_bind_groups &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Step 0: 讀 A，寫 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    create_bind_group(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cell_buffers[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cell_buffers[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Step 1: 讀 B，寫 A
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    create_bind_group(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cell_buffers[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cell_buffers[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;];&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;每一步模擬只要切換 &lt;code&gt;step_index&lt;/code&gt;，就自動交換讀寫方向。&lt;/p&gt;
&lt;h2 id=&#34;wasm-api-設計&#34;&gt;WASM API 設計&lt;/h2&gt;
&lt;p&gt;Rust 端透過 &lt;code&gt;thread_local!&lt;/code&gt; 儲存全域狀態，匯出簡單的函式給 JavaScript：&lt;/p&gt;
&lt;p&gt;為什麼需要 &lt;code&gt;thread_local!&lt;/code&gt;？因為 &lt;code&gt;#[wasm_bindgen]&lt;/code&gt; 匯出的必須是自由函式，JavaScript 呼叫 &lt;code&gt;step()&lt;/code&gt;、&lt;code&gt;render()&lt;/code&gt; 時不會帶著物件——所以 &lt;code&gt;Simulation&lt;/code&gt; 必須存在模組層級的 &lt;code&gt;static&lt;/code&gt; 裡。但一般的 &lt;code&gt;static&lt;/code&gt; 要求內容必須實作 &lt;code&gt;Sync&lt;/code&gt;，而 &lt;code&gt;RefCell&lt;/code&gt; 不是 &lt;code&gt;Sync&lt;/code&gt;。&lt;code&gt;Simulation&lt;/code&gt; 裡面持有的 wgpu 資源（&lt;code&gt;Device&lt;/code&gt;、&lt;code&gt;Queue&lt;/code&gt;、&lt;code&gt;Surface&lt;/code&gt; 等）也不是 &lt;code&gt;Send&lt;/code&gt;/&lt;code&gt;Sync&lt;/code&gt; 的。&lt;code&gt;thread_local!&lt;/code&gt; 讓每個執行緒擁有自己的副本，繞過了 &lt;code&gt;Sync&lt;/code&gt; 的限制——在 WASM 環境下本來就只有一個執行緒，所以它實際上就是一個不需要 &lt;code&gt;Sync&lt;/code&gt; 的全域可變變數。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;thread_local!&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SIMULATION&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;RefCell&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Simulation&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RefCell::new(None);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;start&lt;/span&gt;(canvas_id: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;, grid_width: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;, grid_height: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    console_error_panic_hook::set_once();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; sim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Simulation::new(canvas_id, grid_width, grid_height).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;SIMULATION&lt;/span&gt;.with(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;s.borrow_mut() &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(sim));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;step&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    with_sim(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sim&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; sim.step());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;toggle_cell&lt;/span&gt;(x: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;, y: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    with_sim(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sim&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; sim.toggle_cell(x, y));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;start()&lt;/code&gt; 是 &lt;code&gt;async&lt;/code&gt; 的，因為 wgpu 初始化（&lt;code&gt;request_adapter&lt;/code&gt;、&lt;code&gt;request_device&lt;/code&gt;）都是非同步操作。其他函式都是同步的。&lt;/p&gt;
&lt;h3 id=&#34;cpu-端的細胞鏡像&#34;&gt;CPU 端的細胞鏡像&lt;/h3&gt;
&lt;p&gt;一個實作上的巧妙之處：我們在 CPU 端維護一份細胞狀態的副本。&lt;/p&gt;
&lt;p&gt;為什麼？因為當使用者點擊畫布要切換某個細胞時，從 GPU 讀回資料（readback）是很昂貴的操作。所以我們在 CPU 端維護一份鏡像，toggle 時修改 CPU 資料再上傳到 GPU：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;toggle_cell&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, x: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;, y: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; idx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (y &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self.grid_width &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; x) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.cells[idx] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self.cells[idx] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; { &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.queue.write_buffer(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self.cell_buffers[buf_idx], &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bytemuck::cast_slice(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self.cells));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;每次 &lt;code&gt;step()&lt;/code&gt; 時也同步執行 CPU 端的模擬，確保鏡像保持一致。&lt;/p&gt;
&lt;h2 id=&#34;建置與執行&#34;&gt;建置與執行&lt;/h2&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd wgpu-game-of-life
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wasm-pack build --target web
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python -m http.server &lt;span style=&#34;color:#ae81ff&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開啟 http://localhost:8080&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;建置輸出：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WASM 檔案&lt;/strong&gt;：117 KB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JS 膠水程式碼&lt;/strong&gt;：57 KB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;總計&lt;/strong&gt;：~174 KB&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;比 Markdown 編輯器的 235 KB 還小，主要因為 wgpu 的 WASM backend 大部分邏輯在瀏覽器原生的 WebGPU API 裡。&lt;/p&gt;
&lt;h2 id=&#34;學到的東西&#34;&gt;學到的東西&lt;/h2&gt;
&lt;h3 id=&#34;webgpu--wgpu-特定&#34;&gt;WebGPU / wgpu 特定&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Compute shader 比想像中簡單&lt;/strong&gt;：WGSL 語法接近 Rust，workgroup/dispatch 的概念很直覺&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bind group 是關鍵抽象&lt;/strong&gt;：它定義了 shader 能存取哪些資源，切換 bind group 就能改變資料流向&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;wgpu 的跨平台設計很優秀&lt;/strong&gt;：同一份 Rust 程式碼，換個 backend 就能在 native 和 WASM 上跑&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GPU readback 很貴&lt;/strong&gt;：不要隨便從 GPU 讀資料回來，用 CPU 鏡像是常見的解法&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;跟-markdown-編輯器的比較&#34;&gt;跟 Markdown 編輯器的比較&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;Markdown 編輯器&lt;/th&gt;
          &lt;th&gt;Game of Life&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;GPU 使用&lt;/td&gt;
          &lt;td&gt;無&lt;/td&gt;
          &lt;td&gt;Compute + Render&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;非同步初始化&lt;/td&gt;
          &lt;td&gt;否&lt;/td&gt;
          &lt;td&gt;是（wgpu 需要 async）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;主要瓶頸&lt;/td&gt;
          &lt;td&gt;CPU 解析&lt;/td&gt;
          &lt;td&gt;GPU shader 編譯&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;互動模式&lt;/td&gt;
          &lt;td&gt;文字輸入&lt;/td&gt;
          &lt;td&gt;滑鼠繪圖 + 動畫迴圈&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;套件大小&lt;/td&gt;
          &lt;td&gt;235 KB&lt;/td&gt;
          &lt;td&gt;174 KB&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;結語&#34;&gt;結語&lt;/h2&gt;
&lt;p&gt;這是我第一次寫 GPU shader 程式——用 Rust 配 wgpu 的體驗非常好。wgpu 把 WebGPU 的複雜性封裝得很乾淨，而 WGSL shader 語言的設計也很現代。&lt;/p&gt;
&lt;p&gt;如果你也想學 WebGPU，Game of Life 真的是個很好的起點：概念簡單、視覺效果漂亮、而且剛好涵蓋 compute pipeline 和 render pipeline 兩個核心概念。&lt;/p&gt;
&lt;h2 id=&#34;參考資源&#34;&gt;參考資源&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://wgpu.rs/&#34;&gt;wgpu 官方網站&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sotrh.github.io/learn-wgpu/&#34;&gt;Learn Wgpu 教學&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://webgpufundamentals.org/&#34;&gt;WebGPU Fundamentals&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://foo.net/projects/wgpu-life/&#34;&gt;Conway&amp;rsquo;s Game of Life using wgpu&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/scttfrdmn/webgpu-compute-exploration&#34;&gt;WebGPU Compute Exploration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>深入理解 cargo-apk：從 Rust 到 Android APK 的完整流程</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-09-cargo-apk/</link>
      <pubDate>Sun, 08 Feb 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-09-cargo-apk/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-09-cargo-apk/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;當我們用 Rust 開發 Android 應用時，cargo-apk 是一個自動化整個建置流程的工具——從 Rust 原始碼編譯、產生 AndroidManifest.xml、整合 Gradle、到最後簽章產出 APK。這篇文章深入探討 cargo-apk 的內部運作機制，以及現代替代方案。&lt;/p&gt;
&lt;h3 id=&#34;什麼是-cargo-apk&#34;&gt;什麼是 cargo-apk&lt;/h3&gt;
&lt;p&gt;cargo-apk 是 rust-mobile 團隊開發的命令列工具，負責：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;將 Rust cdylib 編譯為多個架構的 &lt;code&gt;.so&lt;/code&gt; 檔案（ARM64、ARMv7、x86 等）&lt;/li&gt;
&lt;li&gt;從 Cargo.toml 自動產生 AndroidManifest.xml&lt;/li&gt;
&lt;li&gt;呼叫 aapt/aapt2 處理 Android 資源&lt;/li&gt;
&lt;li&gt;透過 Gradle 組裝 APK（DEX 編譯 + ZIP 打包）&lt;/li&gt;
&lt;li&gt;用 keystore 簽章 APK&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;重要提醒&lt;/strong&gt;：cargo-apk 在 2024-2025 年已標記為 deprecated，官方推薦改用 &lt;a href=&#34;https://github.com/rust-mobile/xbuild&#34;&gt;xbuild&lt;/a&gt;，後者支援跨平台（Android、iOS、Web、桌面）且持續維護。本文仍詳細介紹 cargo-apk 的運作原理，因為理解這些底層機制有助於除錯和選擇合適的建置工具。&lt;/p&gt;
&lt;h3 id=&#34;1-apk-檔案結構剖析&#34;&gt;1. APK 檔案結構剖析&lt;/h3&gt;
&lt;p&gt;APK 本質上是一個 ZIP 壓縮檔，包含應用程式執行所需的所有元件。理解 APK 結構是掌握建置流程的第一步。&lt;/p&gt;
&lt;h4 id=&#34;標準-apk-目錄結構&#34;&gt;標準 APK 目錄結構&lt;/h4&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;app.apk (ZIP archive)
├── AndroidManifest.xml         # 應用程式中繼資料（二進位 XML）
├── classes.dex                 # Dalvik Executable（Android Runtime 執行檔）
├── classes2.dex                # 額外的 DEX 檔案（若超過大小限制）
├── resources.arsc              # 編譯後的資源表（二進位格式）
├── META-INF/                   # 簽章和資訊清單
│   ├── MANIFEST.MF             # 套件資訊清單
│   ├── CERT.SF                 # 簽章檔案
│   └── CERT.RSA                # 憑證和簽章資料
├── assets/                     # 開發者自訂的未編譯資源
│   └── (custom files)
├── res/                        # 編譯後的資源（不在 resources.arsc 中）
│   ├── drawable/
│   ├── layout/
│   └── values/
└── lib/                        # 平台特定的原生函式庫
    ├── arm64-v8a/              # ARM 64-bit（現代裝置主流）
    │   └── libflashcard_app.so
    ├── armeabi-v7a/            # ARM 32-bit（舊裝置支援）
    │   └── libflashcard_app.so
    ├── x86/                    # Intel 32-bit（模擬器/平板）
    │   └── libflashcard_app.so
    └── x86_64/                 # Intel 64-bit（模擬器）
        └── libflashcard_app.so&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;rust-為什麼編譯成-so-檔案&#34;&gt;Rust 為什麼編譯成 &lt;code&gt;.so&lt;/code&gt; 檔案？&lt;/h4&gt;
&lt;p&gt;Android 要求所有原生程式碼編譯為&lt;strong&gt;動態連結函式庫&lt;/strong&gt;（shared object, &lt;code&gt;.so&lt;/code&gt;），放在 &lt;code&gt;lib/&amp;lt;ABI&amp;gt;/&lt;/code&gt; 目錄下。Rust 專案必須將 &lt;code&gt;crate-type&lt;/code&gt; 設為 &lt;code&gt;[&amp;quot;cdylib&amp;quot;]&lt;/code&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;lib&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;crate-type&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cdylib&amp;#34;&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;cdylib&lt;/code&gt; 產生 C-compatible 的動態函式庫，Android Runtime 可以在執行時載入並呼叫其中的符號（透過 &lt;code&gt;System.loadLibrary()&lt;/code&gt;）。&lt;/p&gt;
&lt;h3 id=&#34;2-建置流程五階段&#34;&gt;2. 建置流程五階段&lt;/h3&gt;
&lt;p&gt;cargo-apk 的建置流程可以拆解為五個連續的階段。理解每個階段的輸入輸出，有助於除錯建置問題。&lt;/p&gt;
&lt;h4 id=&#34;phase-1-rust-編譯&#34;&gt;Phase 1: Rust 編譯&lt;/h4&gt;
&lt;p&gt;cargo-apk 針對每個目標架構呼叫 &lt;code&gt;rustc&lt;/code&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 對於 ARM64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rustc --target aarch64-linux-android &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      --crate-type cdylib &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      -C linker&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;aarch64-linux-android-clang &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 對於 ARMv7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rustc --target armv7-linux-androideabi &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      --crate-type cdylib &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      -C linker&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;armv7a-linux-androideabi-clang &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ...&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵環節：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NDK 工具鏈選擇&lt;/strong&gt;：每個架構使用對應的 clang linker（由 &lt;code&gt;ANDROID_NDK_ROOT&lt;/code&gt; 提供）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sysroot 連結&lt;/strong&gt;：連結到 NDK 的平台 headers 和 libraries&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RUSTFLAGS 設定&lt;/strong&gt;：加入 &lt;code&gt;-L&lt;/code&gt; 指定 NDK 函式庫路徑&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;輸出：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;target/aarch64-linux-android/release/libmyapp.so
target/armv7-linux-androideabi/release/libmyapp.so
target/x86_64-linux-android/release/libmyapp.so&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;phase-2-androidmanifestxml-產生&#34;&gt;Phase 2: AndroidManifest.xml 產生&lt;/h4&gt;
&lt;p&gt;cargo-apk 從 Cargo.toml 的 &lt;code&gt;[package.metadata.android]&lt;/code&gt; 讀取設定，自動產生 manifest：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;com.example.flashcard_app&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;min_sdk_version&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;target_sdk_version&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 權限宣告&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;permissions&lt;/span&gt; = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.permission.INTERNET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.permission.WRITE_EXTERNAL_STORAGE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 建置目標架構&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;build_targets&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aarch64-linux-android&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;armv7-linux-androideabi&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Activity 主題&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;activity_theme&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;@android:style/Theme.NoTitleBar.Fullscreen&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;產生的 AndroidManifest.xml 範例：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;manifest&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xmlns:android=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;package=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;com.example.flashcard_app&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;uses-sdk&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:minSdkVersion=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;21&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:targetSdkVersion=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;33&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;uses-permission&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.permission.INTERNET&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;activity&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.app.NativeActivity&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#a6e22e&#34;&gt;android:theme=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;@android:style/Theme.NoTitleBar.Fullscreen&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;!-- 指定要載入的原生函式庫名稱 --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;meta-data&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.app.lib_name&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#a6e22e&#34;&gt;android:value=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flashcard_app&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;intent-filter&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;action&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.intent.action.MAIN&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;category&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android:name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.intent.category.LAUNCHER&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/intent-filter&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/activity&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/manifest&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵觀念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NativeActivity&lt;/strong&gt;：Android 提供的類別，自動處理原生程式碼的生命週期&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;android.app.lib_name&lt;/strong&gt;：指定要載入的 &lt;code&gt;.so&lt;/code&gt; 檔案名稱（不含 &lt;code&gt;lib&lt;/code&gt; 前綴和 &lt;code&gt;.so&lt;/code&gt; 後綴）&lt;/li&gt;
&lt;li&gt;Rust 程式碼必須實作 &lt;code&gt;android_main&lt;/code&gt; 函式作為進入點&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;phase-3-資源處理aaptaapt2&#34;&gt;Phase 3: 資源處理（aapt/aapt2）&lt;/h4&gt;
&lt;p&gt;Android Asset Packaging Tool 負責編譯資源檔：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;aapt2 compile --dir res/ -o compiled_resources/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;aapt2 link --manifest AndroidManifest.xml &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           -o base.apk &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           compiled_resources/*.flat&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;輸出：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;resources.arsc&lt;/code&gt;：二進位資源表，包含所有字串、顏色、尺寸定義&lt;/li&gt;
&lt;li&gt;編譯後的 XML 資源檔案&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;phase-4-gradle-apk-組裝&#34;&gt;Phase 4: Gradle APK 組裝&lt;/h4&gt;
&lt;p&gt;cargo-apk 呼叫 Gradle 進行最終組裝：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;複製 .so 檔案&lt;/strong&gt;到 &lt;code&gt;jniLibs/&amp;lt;arch&amp;gt;/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;編譯 Java/Kotlin 程式碼&lt;/strong&gt;（若有）為 bytecode&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;產生 DEX&lt;/strong&gt;：將 bytecode 轉換為 Dalvik Executable&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;打包 ZIP&lt;/strong&gt;：將所有元件組合成 APK&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Gradle 的 build.gradle 片段：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-groovy&#34; data-lang=&#34;groovy&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;android &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    compileSdkVersion &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sourceSets &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        main &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            jniLibs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;srcDirs&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;jniLibs&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 原生函式庫來源
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;phase-5-apk-簽章&#34;&gt;Phase 5: APK 簽章&lt;/h4&gt;
&lt;p&gt;最後一步是用 keystore 簽章 APK：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Debug 簽章&lt;/strong&gt;（預設）：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apksigner sign --ks ~/.android/debug.keystore &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               --ks-pass pass:android &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               --ks-key-alias androiddebugkey &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               app-debug.apk&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Release 簽章&lt;/strong&gt;（自訂 keystore）：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_path&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/release.jks&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_password&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;env:KEYSTORE_PASSWORD&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_key_alias&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my-key&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;簽章過程會在 APK 的 &lt;code&gt;META-INF/&lt;/code&gt; 目錄加入三個檔案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MANIFEST.MF&lt;/strong&gt;：列出 APK 中所有檔案及其 SHA-256 雜湊值&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CERT.SF&lt;/strong&gt;：MANIFEST.MF 的簽章&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CERT.RSA&lt;/strong&gt;：憑證和 RSA 簽章資料&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Android OS 在安裝時會驗證這些簽章，確保 APK 沒有被竄改。&lt;/p&gt;
&lt;h3 id=&#34;3-cargotoml-設定詳解&#34;&gt;3. Cargo.toml 設定詳解&lt;/h3&gt;
&lt;p&gt;完整的 &lt;code&gt;[package.metadata.android]&lt;/code&gt; 設定範例：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 應用程式識別碼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;com.example.flashcard_app&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;apk_name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flashcard-app&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# SDK 版本&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;min_sdk_version&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# Android 5.0 Lollipop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;target_sdk_version&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# Android 13&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;max_sdk_version&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;34&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 建置目標架構&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;build_targets&lt;/span&gt; = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aarch64-linux-android&amp;#34;&lt;/span&gt;,      &lt;span style=&#34;color:#75715e&#34;&gt;# ARM64（主要）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;armv7-linux-androideabi&amp;#34;&lt;/span&gt;     &lt;span style=&#34;color:#75715e&#34;&gt;# ARMv7（相容性）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 權限宣告&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;permissions&lt;/span&gt; = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.permission.INTERNET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.permission.ACCESS_FINE_LOCATION&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 硬體功能需求&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.hardware.location&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Activity 設定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;activity_theme&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;@android:style/Theme.NoTitleBar.Fullscreen&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;main_activity_attributes&lt;/span&gt; = {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android:screenOrientation&amp;#34;&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;portrait&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Intent Filters（深度連結）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;intent_filters&lt;/span&gt;]]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;actions&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.intent.action.VIEW&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;categories&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.intent.category.DEFAULT&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android.intent.category.BROWSABLE&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; = [{ &lt;span style=&#34;color:#a6e22e&#34;&gt;scheme&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;host&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;example.com&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;path_prefix&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/app&amp;#34;&lt;/span&gt; }]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 除錯設定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;strip_symbols&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;     &lt;span style=&#34;color:#75715e&#34;&gt;# 保留符號以供除錯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;debug&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Release 簽章&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_path&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/release.jks&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_password&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;env:KEYSTORE_PASSWORD&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_key_alias&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my-key&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;release_keystore_key_password&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;env:KEY_PASSWORD&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;4-ndk-整合機制&#34;&gt;4. NDK 整合機制&lt;/h3&gt;
&lt;p&gt;cargo-apk 如何找到並使用 Android NDK：&lt;/p&gt;
&lt;h4 id=&#34;ndk-路徑解析&#34;&gt;NDK 路徑解析&lt;/h4&gt;
&lt;p&gt;優先順序：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ANDROID_NDK_ROOT&lt;/code&gt; 環境變數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ANDROID_NDK_HOME&lt;/code&gt; 環境變數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;local.properties&lt;/code&gt; 檔案中的 &lt;code&gt;ndk.dir&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;工具鏈選擇按架構&#34;&gt;工具鏈選擇（按架構）&lt;/h4&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;架構&lt;/th&gt;
          &lt;th&gt;Rust Target&lt;/th&gt;
          &lt;th&gt;NDK Linker&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;ARM 64-bit&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;aarch64-linux-android&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;aarch64-linux-android-clang&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ARM 32-bit&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;armv7-linux-androideabi&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;armv7a-linux-androideabi-clang&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Intel 64-bit&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;x86_64-linux-android&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;x86_64-linux-android-clang&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Intel 32-bit&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;i686-linux-android&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;i686-linux-android-clang&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;sysroot-和-api-level&#34;&gt;Sysroot 和 API Level&lt;/h4&gt;
&lt;p&gt;NDK 為每個 API level 提供不同的 sysroot（系統標頭檔和函式庫）：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/
├── sysroot/
│   └── usr/
│       ├── include/         # C/C++ 標頭檔
│       └── lib/
│           ├── aarch64-linux-android/21/  # API 21 的 ARM64 函式庫
│           ├── aarch64-linux-android/28/  # API 28 的 ARM64 函式庫
│           └── ...&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Rust 編譯時會連結到對應 API level 的 sysroot，確保產生的 &lt;code&gt;.so&lt;/code&gt; 與目標 Android 版本相容。&lt;/p&gt;
&lt;h3 id=&#34;5-與手動-ndk-整合的比較&#34;&gt;5. 與手動 NDK 整合的比較&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;面向&lt;/th&gt;
          &lt;th&gt;cargo-apk&lt;/th&gt;
          &lt;th&gt;手動 NDK 整合&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;設定複雜度&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;cargo install cargo-apk&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;下載 NDK、設定路徑、撰寫建置腳本&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Manifest 產生&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;自動從 Cargo.toml&lt;/td&gt;
          &lt;td&gt;手動編寫 XML&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;多架構建置&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;自動迴圈處理&lt;/td&gt;
          &lt;td&gt;每個架構手動呼叫&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;APK 組裝&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Gradle 自動整合&lt;/td&gt;
          &lt;td&gt;手動呼叫 aapt + gradle&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;簽章&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;自動 keystore 處理&lt;/td&gt;
          &lt;td&gt;手動呼叫 apksigner&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;控制粒度&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;高層自動化&lt;/td&gt;
          &lt;td&gt;完全控制每個步驟&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;學習曲線&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;低（單一指令）&lt;/td&gt;
          &lt;td&gt;高（理解整個 Android 建置鏈）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;cargo-apk 的核心價值是&lt;strong&gt;自動化&lt;/strong&gt;——一行指令完成從 Rust 到 APK 的所有步驟。但代價是較少的客製化彈性，並且依賴 Gradle（可能增加建置時間）。&lt;/p&gt;
&lt;h3 id=&#34;6-目前狀態與替代方案&#34;&gt;6. 目前狀態與替代方案&lt;/h3&gt;
&lt;h4 id=&#34;cargo-apk-的現況&#34;&gt;cargo-apk 的現況&lt;/h4&gt;
&lt;p&gt;cargo-apk 在 2024 年標記為 deprecated，原因：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;缺乏跨平台支援（僅限 Android）&lt;/li&gt;
&lt;li&gt;維護資源有限&lt;/li&gt;
&lt;li&gt;更現代的工具（xbuild）提供更好的開發體驗&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;xbuild現代化的替代方案&#34;&gt;xbuild：現代化的替代方案&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/rust-mobile/xbuild&#34;&gt;xbuild&lt;/a&gt; 是 rust-mobile 團隊的新工具，支援多平台：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;優勢&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;跨平台支援&lt;/strong&gt;：Android、iOS、Windows、Linux、Web&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;統一命令介面&lt;/strong&gt;：&lt;code&gt;x build&lt;/code&gt;、&lt;code&gt;x run&lt;/code&gt;、&lt;code&gt;x doctor&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;裝置管理&lt;/strong&gt;：&lt;code&gt;x devices&lt;/code&gt; 列出所有連接的裝置&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;持續開發&lt;/strong&gt;：活躍維護，積極修復問題&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;App Store 發佈&lt;/strong&gt;：內建發佈到 Google Play 和 App Store 的支援&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;安裝與使用&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 安裝&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install xbuild
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 檢查環境&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;x doctor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 建置並部署到裝置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;x devices                        &lt;span style=&#34;color:#75715e&#34;&gt;# 列出裝置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;x build --device adb:&amp;lt;device-id&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 建置並安裝&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;三階段建置流程&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Fetch&lt;/strong&gt;：下載預編譯的 Rust 標準函式庫&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Build&lt;/strong&gt;：透過 Cargo 編譯 Rust 程式碼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Package&lt;/strong&gt;：產生平台特定套件（APK、iOS bundle 等）&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;cargo-ndk函式庫專用工具&#34;&gt;cargo-ndk：函式庫專用工具&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/bbqsrc/cargo-ndk&#34;&gt;cargo-ndk&lt;/a&gt; 適合只需要編譯 Rust 函式庫（不需要完整 APK）的專案：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install cargo-ndk
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo ndk -t arm64-v8a -t armeabi-v7a &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          -o ./jniLibs &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          build --release&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;輸出為標準的 &lt;code&gt;jniLibs/&lt;/code&gt; 目錄結構，可直接整合到現有的 Android Studio 專案。&lt;/p&gt;
&lt;h4 id=&#34;工具比較表&#34;&gt;工具比較表&lt;/h4&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;工具&lt;/th&gt;
          &lt;th&gt;用途&lt;/th&gt;
          &lt;th&gt;平台支援&lt;/th&gt;
          &lt;th&gt;開發狀態&lt;/th&gt;
          &lt;th&gt;適用場景&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;cargo-apk&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;完整 APK 建置&lt;/td&gt;
          &lt;td&gt;Android only&lt;/td&gt;
          &lt;td&gt;Deprecated (2024)&lt;/td&gt;
          &lt;td&gt;舊專案維護&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;xbuild&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;跨平台應用建置&lt;/td&gt;
          &lt;td&gt;Android/iOS/Web/Desktop&lt;/td&gt;
          &lt;td&gt;活躍開發&lt;/td&gt;
          &lt;td&gt;新專案首選&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;cargo-ndk&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;NDK 函式庫編譯&lt;/td&gt;
          &lt;td&gt;Android (library)&lt;/td&gt;
          &lt;td&gt;活躍開發&lt;/td&gt;
          &lt;td&gt;整合到現有 Android 專案&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;7-踩過的坑與解決方案&#34;&gt;7. 踩過的坑與解決方案&lt;/h3&gt;
&lt;p&gt;實際使用 cargo-apk 時常見的問題：&lt;/p&gt;
&lt;h4 id=&#34;問題-1ndk-找不到&#34;&gt;問題 1：NDK 找不到&lt;/h4&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Error: Failed to read source.properties: Os { code: 2, kind: NotFound }&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：cargo-apk 找不到 NDK 安裝路徑。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解法&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 設定環境變數（Windows PowerShell）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Environment&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;::SetEnvironmentVariable&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ANDROID_NDK_ROOT&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C:\Users\p47ts\scoop\apps\android-clt\current\ndk\29.0.14206865&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;User&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Environment&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;::SetEnvironmentVariable&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ANDROID_HOME&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C:\Users\p47ts\scoop\apps\android-clt\current&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;User&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 或在當前 shell（bash）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export ANDROID_NDK_ROOT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/ndk/29.0.14206865&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export ANDROID_HOME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/android-sdk&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;問題-2錯誤的架構&#34;&gt;問題 2：錯誤的架構&lt;/h4&gt;
&lt;p&gt;APK 安裝後閃退，logcat 顯示：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;E/linker: library &amp;#34;libmyapp.so&amp;#34; not found&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：裝置的 ABI 與 &lt;code&gt;build_targets&lt;/code&gt; 不符（例如裝置是 ARM64，但只編譯了 ARMv7）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解法&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;確認裝置 ABI：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adb shell getprop ro.product.cpu.abi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 輸出：arm64-v8a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;修改 Cargo.toml 加入對應架構：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;build_targets&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aarch64-linux-android&amp;#34;&lt;/span&gt;]  &lt;span style=&#34;color:#75715e&#34;&gt;# 對應 arm64-v8a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;問題-3apk-檔案過大&#34;&gt;問題 3：APK 檔案過大&lt;/h4&gt;
&lt;p&gt;Release APK 超過 100MB，包含大量除錯符號。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解法&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;啟用符號剝離：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;metadata&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;strip_symbols&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 移除除錯符號&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;或在 Cargo.toml 設定 release profile：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;profile&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;release&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;strip&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;# 剝離符號&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;opt-level&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;z&amp;#34;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 最小化檔案大小&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lto&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;         &lt;span style=&#34;color:#75715e&#34;&gt;# Link-Time Optimization&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;問題-4feature-flag-統一導致桌面建置失敗&#34;&gt;問題 4：Feature flag 統一導致桌面建置失敗&lt;/h4&gt;
&lt;p&gt;使用 target-conditional 依賴時，Cargo 仍會統一 feature：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ❌ 錯誤：桌面建置也會拉入 Android 依賴&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;target&lt;/span&gt;.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;cfg(target_os = &amp;#34;android&amp;#34;)&amp;#39;&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;slint&lt;/span&gt; = { &lt;span style=&#34;color:#a6e22e&#34;&gt;version&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.9&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;backend-android-activity-06&amp;#34;&lt;/span&gt;] }&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;解法&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;改用 feature flag：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;slint/backend-android-activity-06&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;slint&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.9&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;建置時明確啟用：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo apk build --features android --target aarch64-linux-android --lib&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;問題-5windows-上的-pdb-檔名衝突&#34;&gt;問題 5：Windows 上的 PDB 檔名衝突&lt;/h4&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;warning: output filename collision.
The bin target `flashcard-app` has the same output filename as the lib target `flashcard_app`.
Colliding filename is: flashcard_app.pdb&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：&lt;code&gt;crate-type = [&amp;quot;cdylib&amp;quot;, &amp;quot;lib&amp;quot;]&lt;/code&gt; 搭配同名的 &lt;code&gt;[[bin]]&lt;/code&gt; 在 Windows 產生相同的 PDB 除錯檔案。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解法&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;讓 bin 名稱與 package 名稱不同：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flashcard-app&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[[&lt;span style=&#34;color:#a6e22e&#34;&gt;bin&lt;/span&gt;]]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flashcard&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 不同於 package name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;path&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;src/main.rs&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;8-完整建置範例&#34;&gt;8. 完整建置範例&lt;/h3&gt;
&lt;p&gt;從零開始建置 Android APK 的完整流程：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. 建立專案&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo new --lib my-android-app
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd my-android-app
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. 設定 Cargo.toml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt;&amp;gt; Cargo.toml &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[lib]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;crate-type = [&amp;#34;cdylib&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[package.metadata.android]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;package = &amp;#34;com.example.myapp&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;min_sdk_version = 21
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;target_sdk_version = 33
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;build_targets = [&amp;#34;aarch64-linux-android&amp;#34;, &amp;#34;armv7-linux-androideabi&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 3. 撰寫 Rust 入口點（src/lib.rs）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt; src/lib.rs &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#[cfg(target_os = &amp;#34;android&amp;#34;)]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#[no_mangle]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;fn android_main(app: android_activity::AndroidApp) {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    // 應用程式邏輯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 4. 設定環境變數（依實際路徑調整）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export ANDROID_NDK_ROOT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/ndk/29.0.14206865&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export ANDROID_HOME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/android-sdk&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 5. 安裝 Rust Android target&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rustup target add aarch64-linux-android armv7-linux-androideabi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 6. 安裝 cargo-apk&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install cargo-apk
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 7. 建置 APK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo apk build --release
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 內部流程：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   [Phase 1] rustc --target aarch64-linux-android ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#             → target/aarch64-linux-android/release/libmyapp.so&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   [Phase 2] Generate AndroidManifest.xml from Cargo.toml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   [Phase 3] aapt2 compile resources&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   [Phase 4] Gradle: package DEX + .so → APK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   [Phase 5] apksigner sign with release.jks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 輸出：target/release/apk/my-android-app.apk&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 8. 安裝到裝置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo apk run --release&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;建置完成後，APK 位置：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;target/
└── release/
    └── apk/
        └── my-android-app.apk  # 已簽章的 APK&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;檢查 APK 內容：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;unzip -l target/release/apk/my-android-app.apk
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 輸出：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# lib/arm64-v8a/libmyapp.so&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# lib/armeabi-v7a/libmyapp.so&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# AndroidManifest.xml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# classes.dex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# META-INF/MANIFEST.MF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ...&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;從 Rust 程式碼到可安裝的 Android APK，cargo-apk 自動化了複雜的建置鏈：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;階段&lt;/th&gt;
          &lt;th&gt;輸入&lt;/th&gt;
          &lt;th&gt;輸出&lt;/th&gt;
          &lt;th&gt;關鍵技術&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;1. Rust 編譯&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;src/*.rs + Cargo.toml&lt;/td&gt;
          &lt;td&gt;libmyapp.so (多架構)&lt;/td&gt;
          &lt;td&gt;rustc + NDK toolchain&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;2. Manifest 產生&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;[package.metadata.android]&lt;/td&gt;
          &lt;td&gt;AndroidManifest.xml&lt;/td&gt;
          &lt;td&gt;NativeActivity 設定&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;3. 資源處理&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;res/, assets/&lt;/td&gt;
          &lt;td&gt;resources.arsc&lt;/td&gt;
          &lt;td&gt;aapt/aapt2&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;4. APK 組裝&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;.so + DEX + resources&lt;/td&gt;
          &lt;td&gt;unsigned APK (ZIP)&lt;/td&gt;
          &lt;td&gt;Gradle&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;5. 簽章&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;APK + keystore&lt;/td&gt;
          &lt;td&gt;signed APK&lt;/td&gt;
          &lt;td&gt;apksigner&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;何時使用哪個工具？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;新專案&lt;/strong&gt;：優先選擇 &lt;strong&gt;xbuild&lt;/strong&gt;（跨平台、活躍開發、統一工具鏈）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;整合現有 Android 專案&lt;/strong&gt;：使用 &lt;strong&gt;cargo-ndk&lt;/strong&gt;（只編譯 .so，由 Android Studio 處理其餘）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;舊專案維護&lt;/strong&gt;：可繼續使用 &lt;strong&gt;cargo-apk&lt;/strong&gt;，但建議遷移到 xbuild&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;關鍵觀念回顧&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;APK 是 ZIP&lt;/strong&gt;：理解目錄結構有助於除錯打包問題&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cdylib 必要性&lt;/strong&gt;：Android 只能載入動態函式庫&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;多架構建置&lt;/strong&gt;：一個 APK 包含所有架構的 .so，安裝時系統自動選擇&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Manifest 自動化&lt;/strong&gt;：Cargo.toml 配置轉換為 Android 設定&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NDK 整合&lt;/strong&gt;：正確設定環境變數是成功建置的關鍵&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;透過理解這些底層機制，即使遇到建置問題也能快速定位原因並解決。&lt;/p&gt;
&lt;h3 id=&#34;參考資源&#34;&gt;參考資源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rust-mobile/cargo-apk&#34;&gt;cargo-apk GitHub&lt;/a&gt; - 官方原始碼與文件&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rust-mobile/xbuild&#34;&gt;xbuild GitHub&lt;/a&gt; - 現代化的跨平台建置工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/bbqsrc/cargo-ndk&#34;&gt;cargo-ndk GitHub&lt;/a&gt; - NDK 函式庫編譯工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.android.com/ndk&#34;&gt;Android NDK 文件&lt;/a&gt; - 官方 NDK 開發指南&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Apk_(file_format)&#34;&gt;APK 檔案格式&lt;/a&gt; - APK 結構詳解&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.android.com/build/gradle-build-overview&#34;&gt;Android Gradle Build 流程&lt;/a&gt; - Gradle 建置系統文件&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>從間隔重複記憶卡學習 Rust 程式設計</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-08-flashcard-app/</link>
      <pubDate>Sun, 08 Feb 2026 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-08-flashcard-app/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-08-flashcard-app/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近用 &lt;a href=&#34;https://slint.dev/&#34;&gt;Slint&lt;/a&gt; UI 框架實作了一個間隔重複記憶卡應用，可以在桌面和 Android 上執行。這個專案涵蓋了狀態管理、演算法實作、跨平台建置等實用的 Rust 程式設計概念。&lt;/p&gt;
&lt;h3 id=&#34;專案概述&#34;&gt;專案概述&lt;/h3&gt;
&lt;p&gt;這個記憶卡應用的功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SM-2 間隔重複演算法排程複習&lt;/li&gt;
&lt;li&gt;四個畫面：卡牌組列表、學習、新增卡片、統計&lt;/li&gt;
&lt;li&gt;JSON 檔案持久化儲存&lt;/li&gt;
&lt;li&gt;同時支援桌面與 Android 平台&lt;/li&gt;
&lt;li&gt;內建範例卡牌組（Rust 基礎、世界首都）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;1-slint-的宣告式-ui-與頁面路由&#34;&gt;1. Slint 的宣告式 UI 與頁面路由&lt;/h3&gt;
&lt;p&gt;Slint 使用自己的標記語言定義 UI，和 Rust 程式碼分離。頁面路由透過一個整數屬性控制，用條件渲染切換畫面：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-slint&#34; data-lang=&#34;slint&#34;&gt;export component MainWindow inherits Window {
    // 0=卡牌組列表, 1=學習, 2=編輯, 3=統計
    in-out property &amp;lt;int&amp;gt; current-page: 0;

    // 條件渲染：只有符合條件的頁面會被建立
    if current-page == 0: DeckListPage {
        study-deck(idx) =&amp;gt; { root.study-deck(idx); }
    }

    if current-page == 1: StudyPage {
        revealed: root.card-revealed;
        reveal-card() =&amp;gt; { root.reveal-card(); }
        rate-card(q) =&amp;gt; { root.rate-card(q); }
    }
}&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Slint 的 &lt;code&gt;.slint&lt;/code&gt; 檔案在編譯時由 &lt;code&gt;slint-build&lt;/code&gt; 轉換為 Rust 程式碼，所以 UI 結構的型別檢查在編譯期就完成。&lt;code&gt;.slint&lt;/code&gt; 中定義的 struct 和 callback 會自動產生對應的 Rust 型別和方法。&lt;/p&gt;
&lt;p&gt;值得注意的是，Slint 的屬性名稱使用 kebab-case（例如 &lt;code&gt;card-count&lt;/code&gt;），在 Rust 端會自動轉換為 snake_case（&lt;code&gt;card_count&lt;/code&gt;）。&lt;/p&gt;
&lt;h3 id=&#34;2-rcrefcellt單執行緒的內部可變性&#34;&gt;2. &lt;code&gt;Rc&amp;lt;RefCell&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt;：單執行緒的內部可變性&lt;/h3&gt;
&lt;p&gt;Slint 的事件迴圈是單執行緒的，所以不需要 &lt;code&gt;Arc&amp;lt;Mutex&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt;。改用 &lt;code&gt;Rc&amp;lt;RefCell&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt; 來在多個閉包間共享可變狀態：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Rc::new(RefCell::new(AppState {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    decks,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    current_session: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    editor_deck_index: None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data_path: &lt;span style=&#34;color:#a6e22e&#34;&gt;path&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 每個 callback 閉包都 clone 一份 Rc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Rc::clone(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;state);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    window.on_study_deck(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;deck_index&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; st &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; state.borrow_mut(); &lt;span style=&#34;color:#75715e&#34;&gt;// 執行時借用檢查
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 修改 st...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Rc::clone(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;state);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    window.on_rate_card(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;rating_int&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; st &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; state.borrow_mut();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 修改 st...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵觀念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Rc&lt;/code&gt;&lt;/strong&gt;：引用計數智慧指標，讓多個閉包共享同一份資料的所有權&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;RefCell&lt;/code&gt;&lt;/strong&gt;：將借用檢查從編譯期移到執行期，允許在不可變引用的情況下修改內容&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Rc::clone&lt;/code&gt;&lt;/strong&gt;：只增加引用計數（O(1)），不會深複製資料&lt;/li&gt;
&lt;li&gt;這個模式比 &lt;code&gt;Arc&amp;lt;Mutex&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt; 更輕量——沒有原子操作、沒有鎖的開銷——但&lt;strong&gt;只能在單執行緒使用&lt;/strong&gt;（多執行緒會無法編譯）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-weak-引用避免循環參考&#34;&gt;3. Weak 引用避免循環參考&lt;/h3&gt;
&lt;p&gt;每個 callback 都需要存取 Slint 視窗來更新 UI，但直接持有視窗的強引用會造成循環參考。Slint 提供 &lt;code&gt;as_weak()&lt;/code&gt; 來解決：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; window_weak &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; window.as_weak();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;window.on_reveal_card(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; window &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; window_weak.unwrap(); &lt;span style=&#34;color:#75715e&#34;&gt;// 從 Weak 升級為強引用
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    window.set_card_revealed(&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ComponentHandle&lt;/code&gt; 和 &lt;code&gt;Model&lt;/code&gt; 是 Slint 的 trait，需要明確引入才能使用 &lt;code&gt;as_weak()&lt;/code&gt;、&lt;code&gt;run()&lt;/code&gt;、&lt;code&gt;row_count()&lt;/code&gt; 等方法：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; slint::{ComponentHandle, Model, ModelRc, VecModel};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;4-借用衝突的實戰解法&#34;&gt;4. 借用衝突的實戰解法&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;rate_card&lt;/code&gt; callback 是整個專案最複雜的部分——需要同時讀取 session 資訊和修改卡片資料，但它們都在同一個 &lt;code&gt;AppState&lt;/code&gt; 裡：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 這樣寫會編譯失敗！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; session &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; st.current_session.as_mut(); &lt;span style=&#34;color:#75715e&#34;&gt;// &amp;amp;mut st
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; card &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;st.decks[session.deck_index];  &lt;span style=&#34;color:#75715e&#34;&gt;// &amp;amp;st — 衝突！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;解法：先用 &lt;code&gt;as_ref()&lt;/code&gt; 從 session 提取需要的純值到區域變數，釋放對 &lt;code&gt;st&lt;/code&gt; 的借用後再存取 &lt;code&gt;st.decks&lt;/code&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 先提取 session 的純值（Copy 型別），立即釋放借用
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (deck_idx, card_idx, _position, due_len) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; session &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; st.current_session.as_ref() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Some(s) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; s,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        None &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        session.deck_index,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        session.due_cards[session.current_position],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        session.current_position,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        session.due_cards.len(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}; &lt;span style=&#34;color:#75715e&#34;&gt;// session 的借用在這裡結束
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 現在可以安全地借用 st.decks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sm2::review(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;st.decks[deck_idx].cards[card_idx], rating);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; card &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; st.decks[deck_idx].cards[card_idx];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;card.ease_factor &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; result.new_ease_factor;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 再次借用 session 來更新進度
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; session &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; st.current_session.as_mut().unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;session.cards_reviewed &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;session.current_position &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這個模式的核心概念：&lt;strong&gt;當同一個 struct 的不同欄位需要不同的借用模式時，用區域變數搭配作用域來交錯借用&lt;/strong&gt;。Rust 的借用檢查器是以作用域為單位的，所以只要確保可變和不可變借用不重疊，就能通過編譯。&lt;/p&gt;
&lt;h3 id=&#34;5-sm-2-間隔重複演算法&#34;&gt;5. SM-2 間隔重複演算法&lt;/h3&gt;
&lt;p&gt;SM-2 是 SuperMemo 2 演算法的簡稱，核心概念很簡單：答對的卡片間隔越來越長，答錯就重置。實作為純函數，方便測試：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;review&lt;/span&gt;(card: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Card&lt;/span&gt;, rating: &lt;span style=&#34;color:#a6e22e&#34;&gt;ReviewRating&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReviewResult&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; q &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rating.quality() &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 更新簡易度因子：EF&amp;#39; = EF + (0.1 - (5-q) * (0.08 + (5-q) * 0.02))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; new_ef &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (card.ease_factor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;5.0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; q) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.08&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;5.0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; q) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.02&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .max(&lt;span style=&#34;color:#ae81ff&#34;&gt;1.3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;// 最低 1.3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (new_interval, new_repetition) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; rating &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; ReviewRating::Again {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// 答錯：重置為 1 天
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; new_rep &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; card.repetition &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; interval &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; new_rep {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,                                          &lt;span style=&#34;color:#75715e&#34;&gt;// 第一次：1 天
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,                                          &lt;span style=&#34;color:#75715e&#34;&gt;// 第二次：6 天
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; (card.interval &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; new_ef).ceil() &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// 之後：前次間隔 × EF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (interval, new_rep)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ReviewResult {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_ease_factor: &lt;span style=&#34;color:#a6e22e&#34;&gt;new_ef&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_interval,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_repetition,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        next_review: &lt;span style=&#34;color:#a6e22e&#34;&gt;Utc&lt;/span&gt;::now() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; chrono::Duration::days(new_interval &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;i64&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;幾個設計重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;純函數&lt;/strong&gt;：輸入卡片狀態和評分，輸出新的排程結果。不修改任何全域狀態&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;match&lt;/code&gt; 做模式比對&lt;/strong&gt;：前兩次複習有固定間隔（1 天、6 天），第三次開始才用 EF 計算&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;max(1.3)&lt;/code&gt; 限制下限&lt;/strong&gt;：避免 EF 降到太低讓間隔收斂到 0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;判斷哪些卡片到期也很直觀：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;due_cards&lt;/span&gt;(cards: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[Card]) -&amp;gt; Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; now &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Utc::now();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cards
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .iter()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .enumerate()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .filter(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;(_, card)&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; card.next_review &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; now)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;(i, _)&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; i)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .collect()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;6-跨平台建置桌面與-android&#34;&gt;6. 跨平台建置：桌面與 Android&lt;/h3&gt;
&lt;p&gt;這個專案同時支援桌面和 Android。關鍵在於 Cargo 的條件編譯和 feature flag：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;lib&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;crate-type&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cdylib&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib&amp;#34;&lt;/span&gt;]  &lt;span style=&#34;color:#75715e&#34;&gt;# cdylib 給 Android，lib 給桌面&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[[&lt;span style=&#34;color:#a6e22e&#34;&gt;bin&lt;/span&gt;]]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flashcard&amp;#34;&lt;/span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;# 桌面執行檔名稱和 package 不同，避免 PDB 衝突&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;path&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;src/main.rs&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;slint&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.9&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;android&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;slint/backend-android-activity-06&amp;#34;&lt;/span&gt;]  &lt;span style=&#34;color:#75715e&#34;&gt;# Android 後端用 feature 控制&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;入口點用 &lt;code&gt;#[cfg]&lt;/code&gt; 區分：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// src/main.rs — 桌面入口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flashcard_app::run();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// src/lib.rs — Android 入口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[cfg(target_os = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[no_mangle]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;android_main&lt;/span&gt;(app: &lt;span style=&#34;color:#a6e22e&#34;&gt;slint&lt;/span&gt;::android::AndroidApp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    slint::android::init(app).unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    run();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;踩過的坑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PDB 檔名衝突&lt;/strong&gt;：在 Windows 上，&lt;code&gt;crate-type = [&amp;quot;cdylib&amp;quot;, &amp;quot;lib&amp;quot;]&lt;/code&gt; 搭配同名的 &lt;code&gt;[[bin]]&lt;/code&gt; 會產生 PDB（程式偵錯資訊）衝突。解法是讓 bin 名稱和 package 名稱不同（package = &lt;code&gt;flashcard-app&lt;/code&gt;，bin = &lt;code&gt;flashcard&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Feature 統一問題&lt;/strong&gt;：用 &lt;code&gt;[target.&#39;cfg(target_os = &amp;quot;android&amp;quot;)&#39;.dependencies]&lt;/code&gt; 指定 Android 依賴，Cargo 仍會統一 feature，導致桌面建置也拉入 NDK 依賴。解法是改用 &lt;code&gt;[features]&lt;/code&gt; 區段，建置 Android 時明確傳入 &lt;code&gt;--features android&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#[unsafe(no_mangle)]&lt;/code&gt;&lt;/strong&gt;：這個語法需要 nightly Rust，stable 上要用 &lt;code&gt;#[no_mangle]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;7-共享結構避免循環匯入&#34;&gt;7. 共享結構避免循環匯入&lt;/h3&gt;
&lt;p&gt;Slint 的多檔案架構可能遇到循環匯入。例如 &lt;code&gt;main.slint&lt;/code&gt; 匯入 &lt;code&gt;deck_list.slint&lt;/code&gt;，而 &lt;code&gt;deck_list.slint&lt;/code&gt; 又需要 &lt;code&gt;main.slint&lt;/code&gt; 中定義的 &lt;code&gt;DeckInfo&lt;/code&gt; struct。&lt;/p&gt;
&lt;p&gt;解法：把共享的 struct 抽到獨立的 &lt;code&gt;types.slint&lt;/code&gt;：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-slint&#34; data-lang=&#34;slint&#34;&gt;// ui/types.slint — 共享的資料結構
export struct DeckInfo {
    name: string,
    description: string,
    card-count: int,
    due-count: int,
}&lt;/code&gt;&lt;/pre&gt;


  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-slint&#34; data-lang=&#34;slint&#34;&gt;// ui/deck_list.slint — 從 types.slint 匯入，不匯入 main.slint
import { DeckInfo } from &amp;#34;types.slint&amp;#34;;

export component DeckListPage inherits Rectangle {
    in property &amp;lt;[DeckInfo]&amp;gt; decks;
    // ...
}&lt;/code&gt;&lt;/pre&gt;


  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-slint&#34; data-lang=&#34;slint&#34;&gt;// ui/main.slint — 匯入 components 和 re-export types
import { DeckListPage } from &amp;#34;deck_list.slint&amp;#34;;
export { DeckInfo, DeckStats } from &amp;#34;types.slint&amp;#34;;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;8-json-序列化與-include_str&#34;&gt;8. JSON 序列化與 &lt;code&gt;include_str!&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;資料持久化用 serde + serde_json，模型上加 derive 就搞定：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, Clone, Serialize, Deserialize)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Card&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; id: &lt;span style=&#34;color:#a6e22e&#34;&gt;Uuid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; front: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; back: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; ease_factor: &lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; interval: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; repetition: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; next_review: &lt;span style=&#34;color:#a6e22e&#34;&gt;DateTime&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Utc&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;範例資料用 &lt;code&gt;include_str!&lt;/code&gt; 在編譯時嵌入二進位檔：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample_decks&lt;/span&gt;() -&amp;gt; Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Deck&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;include_str!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../data/sample_decks.json&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; samples: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;SampleDeck&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_json::from_str(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;invalid sample data&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    samples.into_iter().map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sd&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; deck &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Deck::new(sd.name, sd.description);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        deck.cards &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sd.cards.into_iter()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;c&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; Card::new(c.front, c.back))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .collect();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        deck
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }).collect()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;include_str!&lt;/code&gt; 在編譯期讀取檔案內容，嵌入到二進位檔中。好處是不需要在執行時處理檔案路徑問題，特別適合 Android 環境。&lt;/p&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;這個記憶卡專案涵蓋了多個重要的 Rust 概念：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;概念&lt;/th&gt;
          &lt;th&gt;應用場景&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Rc&amp;lt;RefCell&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;單執行緒多閉包共享可變狀態&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Weak 引用&lt;/td&gt;
          &lt;td&gt;避免 UI 元件的循環參考&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;借用衝突解法&lt;/td&gt;
          &lt;td&gt;用作用域交錯不同借用模式&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;SM-2 演算法&lt;/td&gt;
          &lt;td&gt;純函數實作間隔重複排程&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Feature flag&lt;/td&gt;
          &lt;td&gt;條件編譯控制跨平台依賴&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;cfg&lt;/code&gt; 屬性&lt;/td&gt;
          &lt;td&gt;桌面 vs Android 入口點切換&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Slint 宣告式 UI&lt;/td&gt;
          &lt;td&gt;編譯時型別安全的 UI 定義&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;include_str!&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;編譯期嵌入靜態資源&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;serde derive&lt;/td&gt;
          &lt;td&gt;零樣板的 JSON 序列化&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;如果你想找一個結合 UI 框架、演算法和跨平台建置的 Rust 練習專案，間隔重複記憶卡是個很好的選擇。從 SM-2 演算法開始，逐步加入 UI、持久化、Android 支援，每一步都能學到不同面向的 Rust 技巧。&lt;/p&gt;
&lt;h3 id=&#34;參考資源&#34;&gt;參考資源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/flashcard-app&#34;&gt;flashcard-app 原始碼&lt;/a&gt; - 本文範例的完整程式碼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slint.dev/&#34;&gt;Slint 官方網站&lt;/a&gt; - Rust 跨平台 UI 框架&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://super-memory.com/english/ol/sm2.htm&#34;&gt;SM-2 演算法&lt;/a&gt; - Wozniak 的原始規格&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.slint.dev/latest/docs/rust/slint/android/&#34;&gt;Slint Android 文件&lt;/a&gt; - Android 平台支援&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>從吉他指板視覺化學習 Rust 程式設計</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-07-guitar-fretboard/</link>
      <pubDate>Sat, 07 Feb 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-07-guitar-fretboard/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-07-guitar-fretboard/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近用 &lt;a href=&#34;https://iced.rs/&#34;&gt;iced&lt;/a&gt; 框架實作了一個吉他指板視覺化工具，可以顯示 C 大調音階、繪製弦和琴格，並在點擊音符時播放逼真的撥弦音效。這個專案雖然不大，但涵蓋了多個實用的 Rust 程式設計概念。&lt;/p&gt;
&lt;h3 id=&#34;專案概述&#34;&gt;專案概述&lt;/h3&gt;
&lt;p&gt;這個吉他指板視覺化工具的功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;顯示標準調弦（E A D G B E）的 22 格指板&lt;/li&gt;
&lt;li&gt;以不同顏色標示 C 大調音階音符&lt;/li&gt;
&lt;li&gt;使用 Canvas 繪製琴弦、琴格和位置標記&lt;/li&gt;
&lt;li&gt;點擊音符播放 Karplus-Strong 合成的撥弦音效&lt;/li&gt;
&lt;li&gt;半透明音符圓圈，讓底層指板隱約可見&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;1-the-elm-architecturetea&#34;&gt;1. The Elm Architecture（TEA）&lt;/h3&gt;
&lt;p&gt;iced 框架採用 The Elm Architecture，這是一種函數式 UI 架構。整個應用只需要三個核心元素：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;App&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    _output_stream: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;OutputStream&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    stream_handle: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;rodio::OutputStreamHandle&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, Clone)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    NoteClicked(&lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;), &lt;span style=&#34;color:#75715e&#34;&gt;// (string_index, fret)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; App {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, message: &lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; message {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Message::NoteClicked(string_idx, fret) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                self.play_note(string_idx, fret);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;view&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Element&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&amp;#39;_, Message&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 建構 UI 樹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;TEA 的三個核心：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Model&lt;/strong&gt;（&lt;code&gt;App&lt;/code&gt; struct）：應用程式的狀態&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Message&lt;/strong&gt;（&lt;code&gt;Message&lt;/code&gt; enum）：所有可能的使用者互動事件&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Update + View&lt;/strong&gt;：&lt;code&gt;update&lt;/code&gt; 根據 Message 更新狀態，&lt;code&gt;view&lt;/code&gt; 根據狀態產生 UI&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這種架構的好處是&lt;strong&gt;單向資料流&lt;/strong&gt;——狀態變更只透過 Message 觸發，UI 是狀態的純函數，讓程式邏輯容易理解和除錯。&lt;/p&gt;
&lt;h3 id=&#34;2-實作-trait-來整合外部框架&#34;&gt;2. 實作 Trait 來整合外部框架&lt;/h3&gt;
&lt;p&gt;這個專案大量使用了 Rust 的 trait 系統來與兩個外部框架（iced 和 rodio）整合。&lt;/p&gt;
&lt;h4 id=&#34;canvas-繪圖實作-canvasprogram&#34;&gt;Canvas 繪圖：實作 &lt;code&gt;canvas::Program&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;iced 的 Canvas widget 要求實作 &lt;code&gt;canvas::Program&lt;/code&gt; trait 來自定義繪圖邏輯：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FretboardCanvas&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; canvas::Program&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Message&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; FretboardCanvas {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;State&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;draw&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _state: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt;::State,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        renderer: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Renderer&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _theme: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Theme&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bounds: &lt;span style=&#34;color:#a6e22e&#34;&gt;Rectangle&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _cursor: &lt;span style=&#34;color:#a6e22e&#34;&gt;iced&lt;/span&gt;::mouse::Cursor,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) -&amp;gt; Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;canvas::Geometry&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Renderer&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; frame &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; canvas::Frame::new(renderer, bounds.size());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 繪製指板背景（木頭色）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        frame.fill_rectangle(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Point::new(fretboard_x, fretboard_y),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Size::new(fretboard_width, fretboard_height),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            canvas::Fill::from(iced::Color::from_rgb8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x3d&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x2b&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x1f&lt;/span&gt;)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 繪製琴格（銀色垂直線）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; fret &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;NUM_FRETS&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fretboard_x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (fret &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FRET_WIDTH&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            frame.fill_rectangle(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Point::new(x, fretboard_y),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Size::new(&lt;span style=&#34;color:#ae81ff&#34;&gt;3.0&lt;/span&gt;, fretboard_height),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                canvas::Fill::from(iced::Color::from_rgb8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0xc0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xc0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xc0&lt;/span&gt;)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 繪製弦（粗細和顏色依弦種不同）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; string_thicknesses &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3.0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;vec!&lt;/span&gt;[frame.into_geometry()]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這裡展示了 trait 的強大之處——只要實作 &lt;code&gt;draw&lt;/code&gt; 方法，就能在 iced 的 Canvas 上繪製任意圖形。&lt;code&gt;FretboardCanvas&lt;/code&gt; 是一個 zero-sized type（ZST），不佔任何記憶體，純粹作為 trait 實作的載體。&lt;/p&gt;
&lt;h4 id=&#34;音訊來源實作-iterator--source&#34;&gt;音訊來源：實作 &lt;code&gt;Iterator&lt;/code&gt; + &lt;code&gt;Source&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;rodio 的音訊播放需要實作兩個 trait：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Iterator &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; KarplusStrong {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Item&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;next&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self.samples_remaining &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; None;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.samples_remaining &lt;span style=&#34;color:#f92672&#34;&gt;-=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; current &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.buffer[self.index];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 低通濾波器：與下一個取樣值取平均
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; next_idx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (self.index &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; self.buffer.len();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; filtered &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (current &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; self.buffer[next_idx]) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self.decay;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.buffer[self.index] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; filtered;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.index &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (self.index &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; self.buffer.len();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Some(current)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Source &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; KarplusStrong {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;current_frame_len&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; { None }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;channels&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt; { &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample_rate&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt; { self.sample_rate }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;total_duration&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Duration&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; { None }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵觀念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Iterator&lt;/code&gt; 提供逐一產生取樣值的能力&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Source&lt;/code&gt; 描述音訊格式（取樣率、聲道數等）&lt;/li&gt;
&lt;li&gt;兩者結合後，rodio 就能播放自訂的音訊來源&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-karplus-strong-撥弦合成&#34;&gt;3. Karplus-Strong 撥弦合成&lt;/h3&gt;
&lt;p&gt;這是本專案最有趣的部分——用物理建模合成法模擬吉他撥弦聲。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;KarplusStrong&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    buffer: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,         &lt;span style=&#34;color:#75715e&#34;&gt;// 環形延遲緩衝區
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    index: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;// 目前在緩衝區中的位置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sample_rate: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    samples_remaining: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// 持續時間控制
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    decay: &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;// 衰減因子
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; KarplusStrong {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;new&lt;/span&gt;(frequency: &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;, duration_ms: &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; sample_rate &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;44100&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; delay_samples &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (sample_rate &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; frequency).round() &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; total_samples &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (sample_rate &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; duration_ms &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 用白噪音填充緩衝區（模擬撥弦的初始能量）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; rng &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rand::thread_rng();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; buffer: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;delay_samples)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; rng.gen::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .collect();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Self {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            buffer,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            index: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            sample_rate,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            samples_remaining: &lt;span style=&#34;color:#a6e22e&#34;&gt;total_samples&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            decay: &lt;span style=&#34;color:#ae81ff&#34;&gt;0.999&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;演算法的核心概念：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;延遲緩衝區長度決定音高&lt;/strong&gt;：&lt;code&gt;delay_samples = sample_rate / frequency&lt;/code&gt;，例如 440Hz 的 A 音需要 &lt;code&gt;44100 / 440 = 100&lt;/code&gt; 個取樣&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;白噪音初始化&lt;/strong&gt;：隨機值模擬撥弦時弦的不規則振動&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;低通濾波回饋&lt;/strong&gt;：每次取出一個值後，與下一個值取平均再放回，模擬弦的能量自然衰減&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;decay 參數&lt;/strong&gt;：控制聲音持續的長度，0.999 接近電吉他的效果&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;這個演算法展示了 Rust 在數值運算上的優勢——沒有 GC 暫停，每個取樣都能在確定的時間內計算完成，非常適合即時音訊處理。&lt;/p&gt;
&lt;h3 id=&#34;4-stackui-圖層疊加&#34;&gt;4. Stack：UI 圖層疊加&lt;/h3&gt;
&lt;p&gt;指板的視覺效果需要將 Canvas（繪製弦和琴格）與按鈕（互動音符）疊加在一起。iced 的 &lt;code&gt;stack!&lt;/code&gt; macro 正好解決這個問題：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;view_fretboard&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Element&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&amp;#39;_, Message&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; fretboard_canvas: &lt;span style=&#34;color:#a6e22e&#34;&gt;Canvas&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;FretboardCanvas, Message, Theme, Renderer&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        canvas(FretboardCanvas)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .width(canvas_width &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .height(canvas_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Canvas 在底層，按鈕在上層
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;stack!&lt;/span&gt;[fretboard_canvas, buttons_layer]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .width(Length::Fill)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .height(canvas_height &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u16&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .into()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;stack!&lt;/code&gt; 的行為類似 CSS 的 &lt;code&gt;position: absolute&lt;/code&gt;——後面的元素疊加在前面的元素上方。搭配半透明的按鈕背景，可以讓底層的指板圖案隱約可見：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (bg_color, text_color) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; is_root {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0xff&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x9e&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x64&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.85&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1a1b26&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; is_c_major {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x7d&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xcf&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xff&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.60&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1a1b26&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x41&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x48&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x68&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.70&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0xa9b1d6&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;5-閉包與按鈕樣式&#34;&gt;5. 閉包與按鈕樣式&lt;/h3&gt;
&lt;p&gt;每個音符按鈕都有自定義樣式，根據音符類型（根音、音階內、其他）和互動狀態（一般、hover）顯示不同顏色：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; style &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_theme: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Theme&lt;/span&gt;, status: &lt;span style=&#34;color:#a6e22e&#34;&gt;button&lt;/span&gt;::Status&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; status {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        button::Status::Hovered &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; button::Status::Pressed &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; is_root {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0xff&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xb3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.95&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; is_c_major {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x9d&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xd6&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0xff&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.80&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                iced::Color::from_rgba8(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x56&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x5f&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x89&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.85&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; bg_color,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    button::Style {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        background: Some(bg.into()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        text_color,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        border: &lt;span style=&#34;color:#a6e22e&#34;&gt;iced&lt;/span&gt;::Border {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            radius: (circle_size &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0&lt;/span&gt;).into(), &lt;span style=&#34;color:#75715e&#34;&gt;// 圓形按鈕
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;button::Style::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這裡的重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;move&lt;/code&gt; 閉包&lt;/strong&gt;：將 &lt;code&gt;is_root&lt;/code&gt;、&lt;code&gt;is_c_major&lt;/code&gt;、&lt;code&gt;bg_color&lt;/code&gt; 等變數的所有權移入閉包&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;border.radius&lt;/code&gt; 做圓形&lt;/strong&gt;：設定 radius 為直徑的一半，矩形按鈕變成圓形&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;多層條件判斷&lt;/strong&gt;：根音 &amp;gt; 音階音 &amp;gt; 其他音，優先級清晰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-常數與領域知識的編碼&#34;&gt;6. 常數與領域知識的編碼&lt;/h3&gt;
&lt;p&gt;將音樂理論編碼為 Rust 常數，讓程式碼自文件化（self-documenting）：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CHROMATIC_NOTES&lt;/span&gt;: [&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;; &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C#&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;D&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;D#&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;E&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;F&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;F#&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;G&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;G#&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A#&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;C_MAJOR_SCALE&lt;/span&gt;: [&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;D&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;E&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;F&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;G&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 標準調弦的 MIDI 音符編號
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;OPEN_STRING_MIDI&lt;/span&gt;: [&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;45&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;55&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;59&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;midi_to_frequency&lt;/span&gt;(midi_note: &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ae81ff&#34;&gt;440.0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0_&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;.powf((midi_note &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;69.0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_note_name&lt;/span&gt;(string_idx: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;, fret: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;) -&amp;gt; String {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; midi_note &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;OPEN_STRING_MIDI&lt;/span&gt;[string_idx] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; fret &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; note_idx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (midi_note &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;CHROMATIC_NOTES&lt;/span&gt;[note_idx].to_string()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這段程式碼展示了幾個 Rust 的特色：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;固定大小陣列&lt;/strong&gt; &lt;code&gt;[&amp;amp;str; 12]&lt;/code&gt;：編譯時確定大小，存取時有邊界檢查&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MIDI 音高公式&lt;/strong&gt;：&lt;code&gt;440 * 2^((n - 69) / 12)&lt;/code&gt; 是標準的十二平均律公式&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;取餘數做循環&lt;/strong&gt;：&lt;code&gt;midi_note % 12&lt;/code&gt; 將任何 MIDI 編號映射回 0-11 的音名索引&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;7-所有權與音訊資源管理&#34;&gt;7. 所有權與音訊資源管理&lt;/h3&gt;
&lt;p&gt;音訊播放涉及作業系統資源，Rust 的所有權系統自然地處理了生命週期：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;App&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    _output_stream: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;OutputStream&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,      &lt;span style=&#34;color:#75715e&#34;&gt;// 必須持有，否則音訊會停止
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    stream_handle: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;rodio::OutputStreamHandle&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// 用來建立 Sink
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Default &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; App {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;default&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; (stream, handle) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OutputStream::try_default().ok().unzip();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Self {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            _output_stream: &lt;span style=&#34;color:#a6e22e&#34;&gt;stream&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            stream_handle: &lt;span style=&#34;color:#a6e22e&#34;&gt;handle&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;幾個關鍵細節：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;_output_stream&lt;/code&gt; 的底線前綴&lt;/strong&gt;：表示這個欄位不會被直接使用，但必須保持存活，因為它代表與音訊驅動程式的連接。一旦被 drop，所有音訊都會停止&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Option&lt;/code&gt; 包裝&lt;/strong&gt;：音訊初始化可能失敗（例如沒有音訊裝置），用 &lt;code&gt;Option&lt;/code&gt; 優雅處理&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ok().unzip()&lt;/code&gt;&lt;/strong&gt;：將 &lt;code&gt;Result&amp;lt;(A, B)&amp;gt;&lt;/code&gt; 轉換為 &lt;code&gt;(Option&amp;lt;A&amp;gt;, Option&amp;lt;B&amp;gt;)&lt;/code&gt;，一行解決錯誤處理&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;這個吉他指板專案涵蓋了多個重要的 Rust 概念：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;概念&lt;/th&gt;
          &lt;th&gt;應用場景&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;TEA 架構&lt;/td&gt;
          &lt;td&gt;iced 應用的 Model-Message-Update-View&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Trait 實作&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;canvas::Program&lt;/code&gt; 和 &lt;code&gt;Source&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Iterator&lt;/td&gt;
          &lt;td&gt;Karplus-Strong 音訊取樣產生&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;閉包 + move&lt;/td&gt;
          &lt;td&gt;按鈕樣式與事件處理&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;所有權&lt;/td&gt;
          &lt;td&gt;音訊資源的生命週期管理&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;常數陣列&lt;/td&gt;
          &lt;td&gt;音樂理論的領域知識編碼&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Stack 佈局&lt;/td&gt;
          &lt;td&gt;Canvas 與互動元件的疊加&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;物理建模&lt;/td&gt;
          &lt;td&gt;即時音訊合成&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;如果你想找一個結合 GUI、音訊和數學的 Rust 練習專案，吉他指板是個很好的選擇。從簡單的視覺化開始，逐步加入音訊合成、Canvas 繪圖、半透明效果，每一步都能學到新的 Rust 技巧。&lt;/p&gt;


  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-07-guitar-fretboard/guitar-fretboard.png&#34; alt=&#34;guitar-fretboard.png&#34; width=&#34;1402&#34; height=&#34;512&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;h3 id=&#34;參考資源&#34;&gt;參考資源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/guitar-fretboard&#34;&gt;guitar-fretboard 原始碼&lt;/a&gt; - 本文範例的完整程式碼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://iced.rs/&#34;&gt;iced 官方網站&lt;/a&gt; - Rust 跨平台 GUI 框架&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/RustAudio/rodio&#34;&gt;rodio&lt;/a&gt; - Rust 音訊播放函式庫&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Karplus%E2%80%93Strong_string_synthesis&#34;&gt;Karplus-Strong 演算法&lt;/a&gt; - 物理建模弦樂合成&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Vibe Coding 實戰：打造 AlphaGPS</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-05-vibe-coding-alphagps/</link>
      <pubDate>Thu, 05 Feb 2026 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-05-vibe-coding-alphagps/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-05-vibe-coding-alphagps/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近「Vibe Coding」這個詞在開發者社群中掀起熱議——與其逐行敲鍵盤，不如用自然語言描述你想要的功能，讓 AI 幫你實現。聽起來很美好，但真的能用來開發生產級別的應用嗎？&lt;/p&gt;
&lt;p&gt;我決定用 Claude Code 和 Claude 4.5 Opus 來驗證這個想法，從零開始打造一款完整的 iOS 應用程式：&lt;strong&gt;AlphaGPS&lt;/strong&gt;——一個透過藍牙低功耗（BLE）將 iPhone GPS 資料同步到 Sony 相機的工具。&lt;/p&gt;
&lt;p&gt;值得一提的是：&lt;strong&gt;我從來沒有寫過任何 Swift 程式&lt;/strong&gt;。雖然我有 Objective-C 的 iOS 開發經驗，但 Swift 和現代 iOS 開發框架對我來說是全新的領域——SwiftUI、Combine 框架、async/await 語法、Live Activity，這些我都是第一次接觸。&lt;/p&gt;
&lt;p&gt;這不是一個簡單的 Hello World 專案。它涉及 BLE 硬體協議、iOS 背景執行限制、複雜的狀態管理，以及 Live Activity 整合。最終成果？約 4,100 行 Swift 程式碼、30 個檔案、90 個 commits，以及一個真正能用的產品。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;為什麼選擇這個專案&#34;&gt;為什麼選擇這個專案？&lt;/h2&gt;
&lt;p&gt;作為攝影愛好者，我一直希望照片能自動記錄拍攝地點。雖然 Sony 有官方的 Creators App，但它的背景同步體驗並不理想——經常需要手動重新連線，而且會中斷其他藍牙連接。&lt;/p&gt;
&lt;p&gt;我想要的是：打開相機就自動連線、App 在背景時持續同步、完全不需要人工干預。&lt;/p&gt;
&lt;p&gt;這個需求恰好涵蓋了許多有趣的技術挑戰，非常適合測試 AI 輔助開發的極限。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;vibe-coding-的實際體驗&#34;&gt;Vibe Coding 的實際體驗&lt;/h2&gt;
&lt;h3 id=&#34;第一天111從協議規格到基礎架構&#34;&gt;第一天（1/11）：從協議規格到基礎架構&lt;/h3&gt;
&lt;p&gt;第一個 commit 是 &lt;code&gt;Initial commit with Sony GPS protocol spec&lt;/code&gt;——我先把逆向工程得到的 Sony 藍牙 GPS 協議文件放進去，然後告訴 Claude：「根據這份協議規格，幫我設計一個 iOS App。」&lt;/p&gt;
&lt;p&gt;接下來的兩個 commits 分別是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;feat(phase1): implement iOS app foundation for Sony camera GPS sync&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;feat(phase2): implement BLE foundation and GPS encoding&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Claude 建議使用 Multi-Manager Singleton 模式搭配 Combine 響應式框架：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;「你的 App 需要協調多個系統：藍牙掃描、GPS 定位、相機連線狀態。
建議使用獨立的 Manager 單例，各自管理 @Published 狀態，
透過 Combine 讓 UI 自動響應變化。」&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;這不是 Claude 隨意生成的建議——它是基於 iOS 開發的最佳實踐，考慮到 CoreBluetooth 的 Delegate 模式和 SwiftUI 的響應式特性。&lt;/p&gt;
&lt;h3 id=&#34;第二到第三天112-113攻克背景執行&#34;&gt;第二到第三天（1/12-1/13）：攻克背景執行&lt;/h3&gt;
&lt;p&gt;iOS 對背景執行有嚴格限制。大多數 App 在進入背景後很快就會被系統終止。但我需要的是：即使 App 被殺掉，當相機重新開機時也能自動重連。&lt;/p&gt;
&lt;p&gt;這部分的開發歷程可以從 commit 歷史看出挑戰有多大：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;feat(phase4): implement background lifecycle and persistence&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Implement iOS background BLE state preservation and cleanup code&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Start scanning in background when cameras exist but none connected&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Start scanning when last connected camera disconnects in background&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Abort connecting cameras when app enters background&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Stop scanning when camera connects in background&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這就是 iOS Core Bluetooth State Preservation 登場的時候。我向 Claude 解釋了需求：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;「我需要相機關機後再開機時自動重連，
即使使用者已經完全關閉 App。」&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Claude 不只給了程式碼，還解釋了整個機制：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用 &lt;code&gt;CBCentralManagerOptionRestoreIdentifierKey&lt;/code&gt; 初始化藍牙管理器&lt;/li&gt;
&lt;li&gt;iOS 會在背景記住連線意圖&lt;/li&gt;
&lt;li&gt;當藍牙事件發生時，iOS 會喚醒 App 並呼叫 &lt;code&gt;willRestoreState&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;App 需要在這個回調中重建狀態並恢復連線&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最困難的是處理邊界情況：藍牙 UUID 可能改變、相機可能同時連線多台、恢復可能在位置權限授權之前發生。Claude 幫我逐一考慮這些情況，最終實現了真正的「零操作」體驗。&lt;/p&gt;
&lt;h3 id=&#34;sony-的-ble-協議&#34;&gt;Sony 的 BLE 協議&lt;/h3&gt;
&lt;p&gt;Sony 沒有公開他們的藍牙 GPS 同步協議。幸運的是，我在網路上找到了其他開發者的逆向工程成果（特別是 &lt;a href=&#34;https://github.com/nicjansma/camera-gps-link&#34;&gt;camera-gps-link&lt;/a&gt; 專案），他們已經分析出協議的細節。我把整理後的協議規格放在 &lt;code&gt;docs/sony-gps-protocol-spec.md&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;協議的關鍵：寫入 GPS 資料需要一個三步驟的「解鎖」序列：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;寫入解鎖指令到 DD30 characteristic&lt;/li&gt;
&lt;li&gt;寫入鎖定指令到 DD31 characteristic&lt;/li&gt;
&lt;li&gt;寫入 GPS 封包到 DD11 characteristic（91 或 95 bytes）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;跳過任何一步，相機會靜默忽略資料——沒有錯誤回報。&lt;/p&gt;
&lt;p&gt;當我把這個發現告訴 Claude 時，它立刻理解了非同步寫入的挑戰：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-swift&#34; data-lang=&#34;swift&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Claude 建議的解決方案&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; unlockWriteComplete = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; lockWriteComplete = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 只有在兩個階段都完成後才發送 GPS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;checkAndWriteLocation&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;guard&lt;/span&gt; unlockWriteComplete, lockWriteComplete &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 發送 GPS 封包...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這種狀態追蹤模式解決了 BLE 寫入回調可能亂序或遺失的問題。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;印象深刻的地方&#34;&gt;印象深刻的地方&lt;/h2&gt;
&lt;h3 id=&#34;1-理解上下文的能力&#34;&gt;1. 理解上下文的能力&lt;/h3&gt;
&lt;p&gt;1/13 那天，我花了不少時間實作 Live Activity。Commit 歷史反映了這段旅程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Implement Live Activity for camera connection status&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Fix iOS availability checks for Live Activity API&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Fix Widget Extension bundle configuration&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Fix ActivityViewContext build error by inlining Live Activity view&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;後來在 1/16，我發現「這個 Live Activity 在斷線時沒有正確結束」。Claude 不只是搜尋關鍵字，它追蹤了整個程式碼流程，發現問題出在狀態轉換的時序：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;didConnect → 狀態設為 .connected → 啟動 Live Activity
    ↓
handleConnection → 狀態改為 .connecting（進行服務發現）
    ↓
didDisconnect → wasConnected 檢查回傳 false → Live Activity 沒有結束！&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;修復結果就是 &lt;code&gt;fix(ble): always end Live Activity on disconnect&lt;/code&gt; 這個 commit。有這種程度的理解，除錯快了很多。&lt;/p&gt;
&lt;h3 id=&#34;2-主動考慮邊界情況&#34;&gt;2. 主動考慮邊界情況&lt;/h3&gt;
&lt;p&gt;在實作電池優化時，Claude 主動提出：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;「你需要考慮這些情況：
- App 在背景但沒有相機連線 → 應該暫停 GPS
- 相機在背景連線 → 立即恢復 GPS
- 使用者關閉背景同步設定 → 停止所有更新」&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;這最終成為 &lt;code&gt;feat(location): stop GPS updates when no cameras connected in background&lt;/code&gt; 這個 commit。這些不是我明確要求的，但對產品品質至關重要。&lt;/p&gt;
&lt;h3 id=&#34;3-架構一致性&#34;&gt;3. 架構一致性&lt;/h3&gt;
&lt;p&gt;隨著專案成長到 30 個 Swift 檔案，Claude 始終記得我們建立的模式：Manager 單例、原子性狀態更新、Combine 訂閱管理。它不會突然建議一個風格完全不同的實作。&lt;/p&gt;
&lt;p&gt;看看這些 refactor commits，Claude 幫我持續改進架構而不破壞一致性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Refactor to single camera list and state-based architecture&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Consolidate Camera discovering and connecting states&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Refactor autoConnect to separate field from connection state&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Consolidate connected and syncing states into single connected state&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;refactor: simplify connecting state by removing retryCount&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;不完美的地方&#34;&gt;不完美的地方&lt;/h2&gt;
&lt;p&gt;坦白說，Vibe Coding 不是萬能的。從 90 個 commits 中可以看到很多 fix commits：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Bug fixes 佔了很大比例&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fix(ble): clear peripheral when aborting connection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fix(ble): cancel connection timeout on disconnect&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fix(ble): fix critical disconnect handling issues&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fix(ble): clear stale peripheral on background disconnect&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這些都是在實機測試時發現的問題。Claude 可以寫出結構良好的程式碼，但 BLE 和 iOS 背景執行的邊界情況太多，只有實際測試才能發現。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;需要明確指示&lt;/strong&gt;：Claude 有時會過度工程化。我必須明確說「保持簡單，不要加額外功能」。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;測試依然困難&lt;/strong&gt;：BLE 和 Live Activity 無法在模擬器中測試。我仍然需要在實體裝置上手動測試每個功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;領域知識必要&lt;/strong&gt;：雖然 Claude 幫我寫程式碼，但理解 Sony 協議、iOS 背景限制、BLE 特性——這些需要我自己研究。AI 是超強的副駕駛，但你還是需要知道要去哪裡。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;成果總覽&#34;&gt;成果總覽&lt;/h2&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;指標&lt;/th&gt;
          &lt;th&gt;數值&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;程式碼行數&lt;/td&gt;
          &lt;td&gt;~4,100 行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Swift 檔案數量&lt;/td&gt;
          &lt;td&gt;30&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Git commits&lt;/td&gt;
          &lt;td&gt;90&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;開發時間&lt;/td&gt;
          &lt;td&gt;6 天（兼職，1/11 - 1/16）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;手動寫的程式碼&lt;/td&gt;
          &lt;td&gt;&amp;lt; 5%&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;功能清單：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自動掃描和連接 Sony 相機&lt;/li&gt;
&lt;li&gt;背景 GPS 同步（App 在背景時持續運作）&lt;/li&gt;
&lt;li&gt;Live Activity 即時顯示同步狀態&lt;/li&gt;
&lt;li&gt;相機斷線自動重連&lt;/li&gt;
&lt;li&gt;電池優化的智慧掃描&lt;/li&gt;
&lt;li&gt;支援 iOS 15.0+，完整功能需 iOS 16.1+&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;我學到的事&#34;&gt;我學到的事&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Vibe Coding 是真的&lt;/strong&gt;：對於有經驗的開發者，AI 可以將生產力提升 5-10 倍。關鍵是你要能驗證和引導它的輸出。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;對話品質決定結果&lt;/strong&gt;：模糊的指示得到模糊的程式碼。具體描述需求、約束和邊界情況，Claude 就能給出專業級的解決方案。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Claude 4.5 Opus 的差異&lt;/strong&gt;：相比之前的模型，Opus 4.5 在理解複雜系統、保持上下文一致性、主動考慮邊界情況方面有明顯提升。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;這不是取代學習&lt;/strong&gt;：AI 讓你更快實現想法，但你還是需要理解底層技術。否則你無法判斷 AI 的建議是否正確。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;寫在最後&#34;&gt;寫在最後&lt;/h2&gt;
&lt;p&gt;AlphaGPS 現在是我日常使用的工具。每次出門拍照，相機開機就自動連接、照片自動標記位置、全程不需要碰手機。&lt;/p&gt;
&lt;p&gt;回頭看這個專案，最有意思的不是程式碼本身，而是這種新的開發方式：我專注於「想要什麼」和「為什麼」，Claude 幫我處理「怎麼做」的細節。&lt;/p&gt;
&lt;p&gt;這就是 Vibe Coding 的精髓——不是讓 AI 取代你，而是讓你把精力放在真正重要的事情上。&lt;/p&gt;
&lt;p&gt;如果你也想嘗試，我的建議是：找一個你真正想解決的問題，然後跟 Claude 聊聊。你可能會驚訝於它能帶你走多遠。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;這篇文章本身也是用 Claude 協助撰寫的——用 AI 寫一篇關於 AI 開發的文章，似乎也是剛好而已。&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Rust GUI 框架比較：GPUI vs Iced</title>
      <link>https://blog.simplypatrick.com/posts/2026/02-01-gpui-vs-iced/</link>
      <pubDate>Sun, 01 Feb 2026 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/02-01-gpui-vs-iced/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/02-01-gpui-vs-iced/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近用兩個不同的 Rust GUI 框架實作了同一個計算機專案，分別是 &lt;a href=&#34;https://www.gpui.rs/&#34;&gt;GPUI&lt;/a&gt; 和 &lt;a href=&#34;https://iced.rs/&#34;&gt;Iced&lt;/a&gt;。這篇文章比較兩者的架構差異和開發體驗。&lt;/p&gt;
&lt;h3 id=&#34;框架背景&#34;&gt;框架背景&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;框架&lt;/th&gt;
          &lt;th&gt;開發者&lt;/th&gt;
          &lt;th&gt;特色&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;GPUI&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Zed Industries&lt;/td&gt;
          &lt;td&gt;GPU 加速、為 Zed 編輯器打造&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Iced&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;社群驅動&lt;/td&gt;
          &lt;td&gt;受 Elm 啟發、跨平台、純 Rust&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;兩者都是相對新的框架，目前都還在 0.x 版本階段。&lt;/p&gt;
&lt;h3 id=&#34;1-架構設計&#34;&gt;1. 架構設計&lt;/h3&gt;
&lt;h4 id=&#34;gpui物件導向--render-trait&#34;&gt;GPUI：物件導向 + Render Trait&lt;/h4&gt;
&lt;p&gt;GPUI 採用類似 React 的元件模式，每個元件是一個 struct，透過實作 &lt;code&gt;Render&lt;/code&gt; trait 來定義 UI：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CalculatorApp&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    input: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    result: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    engine: &lt;span style=&#34;color:#a6e22e&#34;&gt;Calculator&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Render &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; CalculatorApp {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;render&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, _window: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Window, cx: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Context&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;impl&lt;/span&gt; IntoElement {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .flex()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .flex_col()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .size_full()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .bg(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1e1e1e&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .child(self.render_display())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .child(self.render_keypad(cx))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;icedelm-架構-model-view-update&#34;&gt;Iced：Elm 架構 (Model-View-Update)&lt;/h4&gt;
&lt;p&gt;Iced 採用函數式的 Elm 架構，將應用程式分為三個部分：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Model（狀態）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;App&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    input: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    result: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    engine: &lt;span style=&#34;color:#a6e22e&#34;&gt;Calculator&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Message（事件）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, Clone)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ButtonPressed(String),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Clear,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Evaluate,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Update（狀態轉換）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; App {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, message: &lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; message {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Message::Clear &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; self.input.clear(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Message::Evaluate &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* ... */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Message::ButtonPressed(s) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; self.input.push_str(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;s),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// View（UI 描述）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; App {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;view&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Element&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&amp;#39;_, Message&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;column!&lt;/span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self.view_display(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self.view_keypad(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ].into()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;關鍵差異&lt;/strong&gt;：GPUI 的事件處理是內嵌在 view 中的閉包，而 Iced 強制將所有事件抽象為 &lt;code&gt;Message&lt;/code&gt; enum，再透過獨立的 &lt;code&gt;update&lt;/code&gt; 函數處理。&lt;/p&gt;
&lt;h3 id=&#34;2-事件處理&#34;&gt;2. 事件處理&lt;/h3&gt;
&lt;h4 id=&#34;gpui閉包直接修改狀態&#34;&gt;GPUI：閉包直接修改狀態&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .on_click(cx.listener(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;this, _event, _window, cx&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; label.as_str() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.clear(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.evaluate(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            other &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.append(other),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cx.notify();  &lt;span style=&#34;color:#75715e&#34;&gt;// 手動觸發重新渲染
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;icedmessage--pattern-matching&#34;&gt;Iced：Message + Pattern Matching&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// View 中只發送 Message
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;button(text(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .on_press(Message::Clear)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;button(text(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .on_press(Message::Evaluate)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Update 中統一處理
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, message: &lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; message {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Message::Clear &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; self.input.clear(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Message::Evaluate &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* ... */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 自動重新渲染，不需手動觸發
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Iced 的優點&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有狀態變更集中在 &lt;code&gt;update&lt;/code&gt; 函數，易於追蹤和測試&lt;/li&gt;
&lt;li&gt;Message enum 是可序列化的，方便實作 undo/redo 或時間旅行除錯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;GPUI 的優點&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;閉包可以直接存取局部變數，程式碼更緊湊&lt;/li&gt;
&lt;li&gt;不需要為每個動作定義 Message variant&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-樣式系統&#34;&gt;3. 樣式系統&lt;/h3&gt;
&lt;h4 id=&#34;gpuitailwind-風格的-fluent-api&#34;&gt;GPUI：Tailwind 風格的 Fluent API&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .flex()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .flex_col()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .p_4()           &lt;span style=&#34;color:#75715e&#34;&gt;// padding: 16px
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .gap_3()         &lt;span style=&#34;color:#75715e&#34;&gt;// gap: 12px
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .bg(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1e1e1e&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .rounded_lg()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .text_xl()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .text_color(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0xffffff&lt;/span&gt;))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這種 API 對熟悉 Tailwind CSS 的開發者非常直覺。&lt;/p&gt;
&lt;h4 id=&#34;icedclosure-based-styling&#34;&gt;Iced：Closure-based Styling&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;container(content)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .padding(&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .width(Length::Fill)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .style(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_theme&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; container::Style {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        background: Some(&lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x2d2d2d&lt;/span&gt;).into()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        border: &lt;span style=&#34;color:#a6e22e&#34;&gt;iced&lt;/span&gt;::Border {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            radius: &lt;span style=&#34;color:#ae81ff&#34;&gt;8.0.&lt;/span&gt;into(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Iced 的樣式透過 &lt;code&gt;style&lt;/code&gt; 方法傳入閉包，可以根據 theme 和 widget status 動態決定樣式。&lt;/p&gt;
&lt;h4 id=&#34;按鈕樣式比較&#34;&gt;按鈕樣式比較&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;GPUI&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .bg(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x3c3c3c&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .hover(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;style&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; style.bg(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x4a4a4a&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .rounded_md()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Iced&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;button(content)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .style(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_theme, status&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; status {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            button::Status::Hovered &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x5a5a5a&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;color!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x3c3c3c&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        button::Style {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            background: Some(bg.into()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            border: &lt;span style=&#34;color:#a6e22e&#34;&gt;iced&lt;/span&gt;::Border { radius: &lt;span style=&#34;color:#ae81ff&#34;&gt;6.0.&lt;/span&gt;into(), &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default() },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;4-主題支援&#34;&gt;4. 主題支援&lt;/h3&gt;
&lt;h4 id=&#34;gpui&#34;&gt;GPUI&lt;/h4&gt;
&lt;p&gt;GPUI 沒有內建主題系統，需要自己定義顏色常數：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;BG_DARK&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x1e1e1e&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;BG_BUTTON&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x3c3c3c&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TEXT_PRIMARY&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xffffff&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;iced&#34;&gt;Iced&lt;/h4&gt;
&lt;p&gt;Iced 內建多種主題，只需一行切換：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iced::application(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Calculator&amp;#34;&lt;/span&gt;, App::update, App::view)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .theme(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; Theme::TokyoNightStorm)  &lt;span style=&#34;color:#75715e&#34;&gt;// 或 Theme::Dark, Theme::Light 等
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .run()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;5-程式進入點&#34;&gt;5. 程式進入點&lt;/h3&gt;
&lt;h4 id=&#34;gpui-1&#34;&gt;GPUI&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;()&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; app &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Application::new();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    app.run(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;cx&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bounds &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Bounds::centered(None, size(px(&lt;span style=&#34;color:#ae81ff&#34;&gt;340.&lt;/span&gt;), px(&lt;span style=&#34;color:#ae81ff&#34;&gt;480.&lt;/span&gt;)), cx);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cx.open_window(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            WindowOptions {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                window_bounds: Some(WindowBounds::Windowed(bounds)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;Default::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_window, cx&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; cx.new(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_cx&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; CalculatorApp::new()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ).expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to open window&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;iced-1&#34;&gt;Iced&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iced&lt;/span&gt;::Result {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    iced::application(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Iced Calculator&amp;#34;&lt;/span&gt;, App::update, App::view)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .theme(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;_&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; Theme::TokyoNightStorm)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .window_size((&lt;span style=&#34;color:#ae81ff&#34;&gt;340.0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;480.0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .run()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Iced 的 builder pattern 更簡潔，GPUI 則提供更多底層控制。&lt;/p&gt;
&lt;h3 id=&#34;6-跨平台支援&#34;&gt;6. 跨平台支援&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;平台&lt;/th&gt;
          &lt;th&gt;GPUI&lt;/th&gt;
          &lt;th&gt;Iced&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;macOS&lt;/td&gt;
          &lt;td&gt;完整支援 (Metal)&lt;/td&gt;
          &lt;td&gt;完整支援&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Windows&lt;/td&gt;
          &lt;td&gt;實驗性&lt;/td&gt;
          &lt;td&gt;完整支援&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Linux&lt;/td&gt;
          &lt;td&gt;支援 (Vulkan)&lt;/td&gt;
          &lt;td&gt;完整支援&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Web&lt;/td&gt;
          &lt;td&gt;不支援&lt;/td&gt;
          &lt;td&gt;支援 (WebGPU/WebGL)&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Iced 在跨平台方面明顯更成熟。&lt;/p&gt;
&lt;h3 id=&#34;7-程式碼行數比較&#34;&gt;7. 程式碼行數比較&lt;/h3&gt;
&lt;p&gt;同樣的計算機功能：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;檔案&lt;/th&gt;
          &lt;th&gt;GPUI&lt;/th&gt;
          &lt;th&gt;Iced&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;main.rs&lt;/td&gt;
          &lt;td&gt;~250 行&lt;/td&gt;
          &lt;td&gt;~260 行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;總計&lt;/td&gt;
          &lt;td&gt;差不多&lt;/td&gt;
          &lt;td&gt;差不多&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;兩者的程式碼量相當，但結構不同。&lt;/p&gt;
&lt;h3 id=&#34;8-編譯時間與依賴&#34;&gt;8. 編譯時間與依賴&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# GPUI&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo build  &lt;span style=&#34;color:#75715e&#34;&gt;# ~2 分鐘，743 個 crates&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Iced&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo build  &lt;span style=&#34;color:#75715e&#34;&gt;# ~1.5 分鐘，415 個 crates&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Iced 的依賴較少，編譯速度稍快。&lt;/p&gt;
&lt;h3 id=&#34;選擇建議&#34;&gt;選擇建議&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;選擇 GPUI 如果你&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;正在為 Zed 編輯器開發插件&lt;/li&gt;
&lt;li&gt;偏好物件導向的元件設計&lt;/li&gt;
&lt;li&gt;需要極致的渲染效能&lt;/li&gt;
&lt;li&gt;主要目標平台是 macOS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;選擇 Iced 如果你&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;需要跨平台支援（特別是 Web）&lt;/li&gt;
&lt;li&gt;喜歡 Elm 架構的狀態管理&lt;/li&gt;
&lt;li&gt;想要內建主題支援&lt;/li&gt;
&lt;li&gt;偏好穩定的 API（雖然都還在 0.x）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;特性&lt;/th&gt;
          &lt;th&gt;GPUI&lt;/th&gt;
          &lt;th&gt;Iced&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;架構&lt;/td&gt;
          &lt;td&gt;物件導向 + Render&lt;/td&gt;
          &lt;td&gt;Elm (MVU)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;樣式&lt;/td&gt;
          &lt;td&gt;Tailwind-like&lt;/td&gt;
          &lt;td&gt;Closure-based&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;主題&lt;/td&gt;
          &lt;td&gt;手動定義&lt;/td&gt;
          &lt;td&gt;內建多種&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;事件&lt;/td&gt;
          &lt;td&gt;閉包 + &lt;code&gt;cx.notify()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Message enum&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;跨平台&lt;/td&gt;
          &lt;td&gt;有限&lt;/td&gt;
          &lt;td&gt;優秀&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;成熟度&lt;/td&gt;
          &lt;td&gt;較新&lt;/td&gt;
          &lt;td&gt;較成熟&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;兩個框架都展示了 Rust GUI 開發的可能性。GPUI 代表了高效能、GPU 加速的方向，而 Iced 則體現了函數式、跨平台的設計理念。選擇哪個取決於你的專案需求和個人偏好。&lt;/p&gt;
&lt;h3 id=&#34;參考資源&#34;&gt;參考資源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/gpui-calculator&#34;&gt;gpui-calculator 原始碼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/iced-calculator&#34;&gt;iced-calculator 原始碼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.gpui.rs/&#34;&gt;GPUI 官方網站&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://iced.rs/&#34;&gt;Iced 官方網站&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.iced.rs/&#34;&gt;Iced Book&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>從 GPUI 計算機學習 Rust 程式設計</title>
      <link>https://blog.simplypatrick.com/posts/2026/01-31-gpui-calculator/</link>
      <pubDate>Sat, 31 Jan 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/01-31-gpui-calculator/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/01-31-gpui-calculator/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;最近用 &lt;a href=&#34;https://www.gpui.rs/&#34;&gt;GPUI&lt;/a&gt; 框架實作了一個圖形化計算機，過程中學到不少 Rust 的實用技巧。這篇文章整理了從這個專案中可以學到的 Rust 程式設計概念。&lt;/p&gt;
&lt;h3 id=&#34;專案概述&#34;&gt;專案概述&lt;/h3&gt;
&lt;p&gt;這個計算機支援基本四則運算、指數運算 (&lt;code&gt;^&lt;/code&gt;)、取餘數 (&lt;code&gt;%&lt;/code&gt;)、變數賦值，以及內建常數 &lt;code&gt;pi&lt;/code&gt; 和 &lt;code&gt;e&lt;/code&gt;。UI 使用 Zed 編輯器團隊開發的 GPUI 框架，這是一個 GPU 加速的 Rust UI 框架。&lt;/p&gt;


  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/01-31-gpui-calculator/gpui-calculator.png&#34; alt=&#34;gpui-calculator.png&#34; width=&#34;342&#34; height=&#34;512&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;h3 id=&#34;1-使用-enum-定義-token&#34;&gt;1. 使用 Enum 定義 Token&lt;/h3&gt;
&lt;p&gt;Rust 的 enum 非常適合用來定義詞法分析器 (lexer) 的 token 類型：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, Clone, PartialEq)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Token&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Name(String),    &lt;span style=&#34;color:#75715e&#34;&gt;// 變數名稱
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Number(&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;),     &lt;span style=&#34;color:#75715e&#34;&gt;// 數字
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Plus,            &lt;span style=&#34;color:#75715e&#34;&gt;// +
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Minus,           &lt;span style=&#34;color:#75715e&#34;&gt;// -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Mul,             &lt;span style=&#34;color:#75715e&#34;&gt;// *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Div,             &lt;span style=&#34;color:#75715e&#34;&gt;// /
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Mod,             &lt;span style=&#34;color:#75715e&#34;&gt;// %
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Pow,             &lt;span style=&#34;color:#75715e&#34;&gt;// ^
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Print,           &lt;span style=&#34;color:#75715e&#34;&gt;// ;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Assign,          &lt;span style=&#34;color:#75715e&#34;&gt;// =
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;LP&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;// (
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;RP&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;// )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這種設計的好處：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;類型安全&lt;/strong&gt;：編譯器確保你處理所有可能的 token 類型&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;資料攜帶&lt;/strong&gt;：&lt;code&gt;Name(String)&lt;/code&gt; 和 &lt;code&gt;Number(f64)&lt;/code&gt; 可以攜帶額外資料&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;模式匹配&lt;/strong&gt;：配合 &lt;code&gt;match&lt;/code&gt; 表達式，程式碼清晰易讀&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-實作-iterator-trait&#34;&gt;2. 實作 Iterator Trait&lt;/h3&gt;
&lt;p&gt;將 lexer 實作為 Iterator，讓程式碼更符合 Rust 慣例：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TokenStream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    input: Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    offset: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Iterator &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; TokenStream {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Item&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Token;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;next&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self::Item&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self.offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; self.input.len() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; None;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ch &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.input[self.offset];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self.offset &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; ch {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;+&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Some(Token::Plus),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Some(Token::Minus),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Some(Token::Mul),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#75715e&#34;&gt;// ... 其他 token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                x &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; x.is_whitespace() &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; None,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;實作 &lt;code&gt;Iterator&lt;/code&gt; trait 的好處：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以使用 &lt;code&gt;.collect()&lt;/code&gt; 收集所有 token&lt;/li&gt;
&lt;li&gt;可以搭配其他 iterator 方法如 &lt;code&gt;.map()&lt;/code&gt;、&lt;code&gt;.filter()&lt;/code&gt; 等&lt;/li&gt;
&lt;li&gt;延遲求值 (lazy evaluation)，不會一次解析完整個輸入&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-遞迴下降解析器&#34;&gt;3. 遞迴下降解析器&lt;/h3&gt;
&lt;p&gt;計算機的核心是一個遞迴下降解析器 (recursive descent parser)，這是編譯器課程中的經典技術：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Calculator {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 加減法 (最低優先級)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;expr&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, token: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Token&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.term(token)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; self.current_token {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(Token::Plus) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; self.term(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(Token::Minus) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;-=&lt;/span&gt; self.term(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Ok(left),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 乘除法、取餘數 (中等優先級)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, token: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Token&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.power(token)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; self.current_token {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(Token::Mul) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;*=&lt;/span&gt; self.power(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(Token::Div) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;/=&lt;/span&gt; self.power(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(Token::Mod) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;%=&lt;/span&gt; self.power(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                _ &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Ok(left),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 指數運算 (高優先級，右結合)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;power&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, token: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Token&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.prim(token)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; Some(Token::Pow) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.current_token {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; exp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.power(None)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 遞迴實現右結合
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Ok(base.powf(exp))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Ok(base)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 基本元素 (最高優先級)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prim&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, token: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Token&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 處理數字、變數、括號、一元負號
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這個設計的關鍵：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;運算子優先級&lt;/strong&gt;：透過函數呼叫順序自然實現（&lt;code&gt;expr&lt;/code&gt; → &lt;code&gt;term&lt;/code&gt; → &lt;code&gt;power&lt;/code&gt; → &lt;code&gt;prim&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;結合性&lt;/strong&gt;：左結合用迴圈，右結合用遞迴&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;錯誤處理&lt;/strong&gt;：使用 &lt;code&gt;Result&amp;lt;f64, String&amp;gt;&lt;/code&gt; 和 &lt;code&gt;?&lt;/code&gt; 運算子傳遞錯誤&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-gpui-的-render-trait&#34;&gt;4. GPUI 的 Render Trait&lt;/h3&gt;
&lt;p&gt;GPUI 使用 trait 來定義 UI 元件的渲染邏輯：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Render &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; CalculatorApp {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;render&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, _window: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Window, cx: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Context&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;impl&lt;/span&gt; IntoElement {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .flex()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .flex_col()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .size_full()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .bg(rgb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1e1e1e&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .p_4()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .gap_3()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .child(self.render_display())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .child(self.render_keypad(cx))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;GPUI 的特色：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;宣告式 UI&lt;/strong&gt;：類似 SwiftUI 或 Flutter 的風格&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tailwind 風格的樣式&lt;/strong&gt;：&lt;code&gt;.flex()&lt;/code&gt;、&lt;code&gt;.p_4()&lt;/code&gt;、&lt;code&gt;.gap_3()&lt;/code&gt; 等方法&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GPU 加速&lt;/strong&gt;：比 Electron 少 60-80% 記憶體使用量&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-事件處理與閉包&#34;&gt;5. 事件處理與閉包&lt;/h3&gt;
&lt;p&gt;按鈕點擊事件使用閉包 (closure) 和 &lt;code&gt;cx.listener()&lt;/code&gt; 來處理：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;div()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .id(SharedString::from(&lt;span style=&#34;color:#a6e22e&#34;&gt;format!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;btn_&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, label)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .on_click(cx.listener(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;this, _event, _window, cx&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; label_owned.as_str() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.clear(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;⌫&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.backspace(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.evaluate(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;±&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.toggle_sign(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;π&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.append(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pi&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            other &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; this.append(other),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cx.notify();  &lt;span style=&#34;color:#75715e&#34;&gt;// 通知 UI 更新
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這裡展示了 Rust 閉包的幾個重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;move&lt;/code&gt; 關鍵字將變數所有權移入閉包&lt;/li&gt;
&lt;li&gt;閉包可以捕獲外部變數（&lt;code&gt;label_owned&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cx.notify()&lt;/code&gt; 觸發 UI 重新渲染&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-模組化設計&#34;&gt;6. 模組化設計&lt;/h3&gt;
&lt;p&gt;專案採用清晰的模組結構：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;src/
├── main.rs           # 進入點 + UI 元件
└── calculator/
    ├── mod.rs        # 模組宣告
    ├── token.rs      # Token 定義
    ├── lexer.rs      # 詞法分析器
    └── parser.rs     # 語法分析器 + 測試&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;這種結構的好處：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;關注點分離&lt;/strong&gt;：UI 和計算邏輯分開&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可測試性&lt;/strong&gt;：parser 可以獨立測試&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可重用性&lt;/strong&gt;：calculator 模組可以用於其他專案&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;7-單元測試&#34;&gt;7. 單元測試&lt;/h3&gt;
&lt;p&gt;Rust 內建強大的測試框架，測試直接寫在同一個檔案：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[cfg(test)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mod&lt;/span&gt; tests {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;::&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[test]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_exponentiation&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; calc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Calculator::new();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;assert_eq!&lt;/span&gt;(calc.evaluate(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2^3&amp;#34;&lt;/span&gt;).unwrap(), &lt;span style=&#34;color:#ae81ff&#34;&gt;8.0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;assert_eq!&lt;/span&gt;(calc.evaluate(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2^3^2&amp;#34;&lt;/span&gt;).unwrap(), &lt;span style=&#34;color:#ae81ff&#34;&gt;512.0&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 右結合
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;assert_eq!&lt;/span&gt;(calc.evaluate(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2 + 3^2&amp;#34;&lt;/span&gt;).unwrap(), &lt;span style=&#34;color:#ae81ff&#34;&gt;11.0&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// 優先級
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[test]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_modulo&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; calc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Calculator::new();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;assert_eq!&lt;/span&gt;(calc.evaluate(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;10 % 3&amp;#34;&lt;/span&gt;).unwrap(), &lt;span style=&#34;color:#ae81ff&#34;&gt;1.0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;assert_eq!&lt;/span&gt;(calc.evaluate(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;17 % 5&amp;#34;&lt;/span&gt;).unwrap(), &lt;span style=&#34;color:#ae81ff&#34;&gt;2.0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Rust 測試的特點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#[cfg(test)]&lt;/code&gt; 確保測試碼不會編譯進正式版本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#[test]&lt;/code&gt; 標記測試函數&lt;/li&gt;
&lt;li&gt;執行 &lt;code&gt;cargo test&lt;/code&gt; 即可運行所有測試&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;8-錯誤處理&#34;&gt;8. 錯誤處理&lt;/h3&gt;
&lt;p&gt;使用 &lt;code&gt;Result&lt;/code&gt; 類型和 &lt;code&gt;?&lt;/code&gt; 運算子進行錯誤處理：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;evaluate&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, input: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.tokens &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; TokenStream::new(input).collect();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self.tokens.is_empty() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Err(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;empty expression&amp;#34;&lt;/span&gt;.to_owned());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; first_token &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.next_token();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.expr(first_token)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 使用 ? 運算子傳遞錯誤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;expr&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, token: Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Token&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;, String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.term(token)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 如果 term 失敗，錯誤會被傳遞
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這種模式的好處：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;明確標示可能失敗的操作&lt;/li&gt;
&lt;li&gt;錯誤類型清楚（這裡用 &lt;code&gt;String&lt;/code&gt;，正式專案建議用自定義錯誤類型）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;?&lt;/code&gt; 運算子讓錯誤處理程式碼簡潔&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;這個計算機專案雖然簡單，但涵蓋了多個重要的 Rust 概念：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;概念&lt;/th&gt;
          &lt;th&gt;應用場景&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Enum + Pattern Matching&lt;/td&gt;
          &lt;td&gt;Token 定義與解析&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Iterator Trait&lt;/td&gt;
          &lt;td&gt;詞法分析器&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Recursive Descent&lt;/td&gt;
          &lt;td&gt;語法分析器&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Trait (Render)&lt;/td&gt;
          &lt;td&gt;UI 元件定義&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Closure&lt;/td&gt;
          &lt;td&gt;事件處理&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Module System&lt;/td&gt;
          &lt;td&gt;程式碼組織&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Unit Testing&lt;/td&gt;
          &lt;td&gt;驗證解析邏輯&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Result + ?&lt;/td&gt;
          &lt;td&gt;錯誤處理&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;如果你想深入學習 Rust，動手實作一個計算機是很好的練習。從簡單的四則運算開始，逐步加入變數、函數、甚至自定義語法，你會學到很多編譯器和語言設計的知識。&lt;/p&gt;
&lt;h3 id=&#34;參考資源&#34;&gt;參考資源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/gpui-calculator&#34;&gt;gpui-calculator 原始碼&lt;/a&gt; - 本文範例的完整程式碼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.gpui.rs/&#34;&gt;GPUI 官方網站&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/longbridge/gpui-component&#34;&gt;gpui-component&lt;/a&gt; - GPUI 的 UI 元件庫&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.stroustrup.com/4th.html&#34;&gt;The C++ Programming Language, 4th edition&lt;/a&gt; - 計算機範例的原始出處&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://craftinginterpreters.com/&#34;&gt;Crafting Interpreters&lt;/a&gt; - 編譯器入門好書&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Rust FFI 完整指南：從手寫綁定到 AI 輔助的 Safe Wrapper</title>
      <link>https://blog.simplypatrick.com/posts/2026/01-17-ffi-comparison/</link>
      <pubDate>Sat, 17 Jan 2026 00:00:00 &#43;0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/01-17-ffi-comparison/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/01-17-ffi-comparison/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;Rust 的 FFI（Foreign Function Interface）讓我們可以呼叫 C 函式庫，但正確實作並不容易。手寫綁定容易出錯，維護成本高；bindgen 自動產生綁定但仍需要 unsafe；safe wrapper 提供安全的 API 但設計繁瑣。&lt;/p&gt;
&lt;p&gt;本文以綁定 FFmpeg 的 libavformat 為例，完整介紹：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;三種 FFI 方式&lt;/strong&gt;的優缺點比較&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;手寫綁定的常見陷阱&lt;/strong&gt;：結構體大小、欄位順序、對齊、生命週期&amp;hellip;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bindgen 的工作原理&lt;/strong&gt;：如何用 libclang 解析 C 標頭檔&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Safe Wrapper 設計原則&lt;/strong&gt;：RAII、類型狀態、錯誤處理、thiserror&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AI Coding Agent 如何加速開發&lt;/strong&gt;：讓最佳實踐不再繁瑣&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果你正在考慮綁定一個 C 函式庫，或是想了解為什麼「先用 unsafe 頂著」是個壞主意，這篇文章應該能幫到你。&lt;/p&gt;
&lt;h2 id=&#34;三種-ffi-方式&#34;&gt;三種 FFI 方式&lt;/h2&gt;
&lt;h3 id=&#34;1-手寫-ffimanual&#34;&gt;1. 手寫 FFI（Manual）&lt;/h3&gt;
&lt;p&gt;最傳統的方式：手動撰寫 &lt;code&gt;extern &amp;quot;C&amp;quot;&lt;/code&gt; 宣告。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[link(name = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;avformat&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;avformat_open_input&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ps: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        url: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; c_char,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        fmt: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; c_void,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        options: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; c_void,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c_int&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;優點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;完全掌控型別定義&lt;/li&gt;
&lt;li&gt;無編譯時依賴&lt;/li&gt;
&lt;li&gt;只定義需要的部分&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;缺點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;容易出錯：必須精確對應 C 的結構體佈局&lt;/li&gt;
&lt;li&gt;維護負擔：函式庫更新時需手動同步&lt;/li&gt;
&lt;li&gt;ABI 細節容易遺漏&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-bindgen-自動生成&#34;&gt;2. Bindgen 自動生成&lt;/h3&gt;
&lt;p&gt;使用 &lt;code&gt;bindgen&lt;/code&gt; 在編譯時從 C 標頭檔自動產生綁定：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// build.rs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bindings &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bindgen::Builder::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .header_contents(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;wrapper.h&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        #include &amp;lt;libavformat/avformat.h&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;#&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .allowlist_function(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;avformat_open_input&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .generate()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate bindings&amp;#34;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;優點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;準確：直接從 C 標頭檔產生&lt;/li&gt;
&lt;li&gt;完整：包含所有型別、函式、常數&lt;/li&gt;
&lt;li&gt;可維護：標頭檔更新時自動同步&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;缺點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;編譯時需要 libclang&lt;/li&gt;
&lt;li&gt;產生的程式碼冗長&lt;/li&gt;
&lt;li&gt;可能包含不需要的內容&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-安全封裝safe-wrapper&#34;&gt;3. 安全封裝（Safe Wrapper）&lt;/h3&gt;
&lt;p&gt;在 bindgen 綁定之上，建立符合 Rust 慣例的 API：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FormatContext&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; bindgen::AVFormatContext,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;open&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;P: AsRef&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Path&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;(path: &lt;span style=&#34;color:#a6e22e&#34;&gt;P&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 安全的 Rust API，內部處理所有 unsafe
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Drop &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;drop&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; { bindgen::avformat_close_input(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self.ptr); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;優點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用者不需要寫 &lt;code&gt;unsafe&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;RAII 自動管理資源&lt;/li&gt;
&lt;li&gt;編譯器協助防止錯誤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;缺點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;需要額外的抽象層&lt;/li&gt;
&lt;li&gt;可能有輕微的效能開銷&lt;/li&gt;
&lt;li&gt;設計 API 需要深思熟慮&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;手寫-ffi-的常見陷阱&#34;&gt;手寫 FFI 的常見陷阱&lt;/h2&gt;
&lt;p&gt;手寫 FFI 看似簡單，但有許多隱藏的坑。以下是實際可能發生的錯誤：&lt;/p&gt;
&lt;h3 id=&#34;1-結構體大小不匹配&#34;&gt;1. 結構體大小不匹配&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 你的定義（40 bytes）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[repr(C)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVPacket&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; pts: &lt;span style=&#34;color:#66d9ef&#34;&gt;i64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; dts: &lt;span style=&#34;color:#66d9ef&#34;&gt;i64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; data: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; size: &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 實際 C 結構體（104 bytes）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 還有很多你沒定義的欄位
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; 當 FFmpeg 寫入結構體時，會覆寫超出你定義範圍的記憶體 → 程式崩潰或資料損壞。&lt;/p&gt;
&lt;h3 id=&#34;2-欄位順序錯誤&#34;&gt;2. 欄位順序錯誤&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 錯誤的順序
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVRational&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; den: &lt;span style=&#34;color:#a6e22e&#34;&gt;c_int&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// 你把分母放前面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; num: &lt;span style=&#34;color:#a6e22e&#34;&gt;c_int&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// C 標頭檔的定義
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVRational&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    int num;  &lt;span style=&#34;color:#75715e&#34;&gt;// 分子在前！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    int den;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; 你的 &lt;code&gt;num&lt;/code&gt; 讀到分母，&lt;code&gt;den&lt;/code&gt; 讀到分子 → 計算錯誤、除以零。&lt;/p&gt;
&lt;h3 id=&#34;3-對齊問題&#34;&gt;3. 對齊問題&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[repr(C)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Misaligned&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; flag: &lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; value: &lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// 期望 8-byte 對齊
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; 在某些平台上，C 會在 &lt;code&gt;flag&lt;/code&gt; 後加 7 bytes 的 padding。如果 Rust 沒有，&lt;code&gt;value&lt;/code&gt; 欄位就會讀到垃圾值。&lt;/p&gt;
&lt;h3 id=&#34;4-列舉值不匹配&#34;&gt;4. 列舉值不匹配&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 你的猜測
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVMediaType&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Video &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Audio &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 實際 FFmpeg（不同版本）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// FFmpeg 4.x: Video = 0, Audio = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// FFmpeg 6.x: Unknown = -1, Video = 0, Audio = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; 檢查 &lt;code&gt;if type == Video&lt;/code&gt; 可能失敗，因為數值已經偏移。&lt;/p&gt;
&lt;h3 id=&#34;5-指標生命週期&#34;&gt;5. 指標生命週期&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// C 函式內部儲存了這個指標
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; path &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CString::new(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/path/to/file&amp;#34;&lt;/span&gt;).unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;avformat_open_input(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; ctx, path.as_ptr(), &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;drop(path);  &lt;span style=&#34;color:#75715e&#34;&gt;// CString 被釋放！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ctx 現在持有一個指向已釋放記憶體的懸空指標
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; Use-after-free → 崩潰或安全漏洞。&lt;/p&gt;
&lt;h3 id=&#34;6-呼叫慣例錯誤&#34;&gt;6. 呼叫慣例錯誤&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;callback&lt;/span&gt;(x: &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 假設是 cdecl
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 但 FFmpeg 在 Windows 上可能期望 stdcall
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; 堆疊損壞、錯誤的返回值。&lt;/p&gt;
&lt;h3 id=&#34;7-版本相依的欄位&#34;&gt;7. 版本相依的欄位&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 在 FFmpeg 5.0 上正常運作
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVCodecParameters&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; codec_type: &lt;span style=&#34;color:#a6e22e&#34;&gt;AVMediaType&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; codec_id: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; bit_rate: &lt;span style=&#34;color:#66d9ef&#34;&gt;i64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// FFmpeg 6.0 在 bit_rate 之前新增了一個欄位
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;後果：&lt;/strong&gt; &lt;code&gt;bit_rate&lt;/code&gt; 現在從錯誤的偏移量讀取 → 得到無意義的值。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;這就是為什麼 &lt;strong&gt;bindgen 是更安全的選擇&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&#34;bindgen-如何避免這些陷阱&#34;&gt;Bindgen 如何避免這些陷阱&lt;/h2&gt;
&lt;p&gt;Bindgen 的核心原理是：&lt;strong&gt;在編譯時讀取實際的 C 標頭檔，使用 libclang 解析 AST，然後產生對應的 Rust 程式碼&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;工作流程&#34;&gt;工作流程&lt;/h3&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    flowchart TD
    A[&#34;C 標頭檔 (avformat.h)&#34;] --&gt; B[&#34;libclang 解析&#34;]
    B --&gt; C[&#34;AST（抽象語法樹）&#34;]
    C --&gt; D[&#34;bindgen 轉換&#34;]
    D --&gt; E[&#34;Rust 綁定 (bindings.rs)&#34;]
  &lt;/div&gt;

&lt;h3 id=&#34;為什麼能避免手寫的陷阱&#34;&gt;為什麼能避免手寫的陷阱&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;陷阱&lt;/th&gt;
          &lt;th&gt;Bindgen 如何解決&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;結構體大小&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;從 AST 讀取精確的 &lt;code&gt;sizeof&lt;/code&gt;，產生正確大小的 Rust struct&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;欄位順序&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;按照 C 標頭檔中的宣告順序產生欄位&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;對齊問題&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;讀取每個欄位的 &lt;code&gt;alignof&lt;/code&gt;，自動加入正確的 &lt;code&gt;#[repr(C)]&lt;/code&gt; 和 padding&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;列舉值&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;直接從標頭檔讀取每個列舉的數值&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;版本相依&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;每次編譯時重新產生，自動適應安裝的函式庫版本&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;實際產生的程式碼&#34;&gt;實際產生的程式碼&lt;/h3&gt;
&lt;p&gt;當 bindgen 處理 &lt;code&gt;AVRational&lt;/code&gt; 時：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bindgen 產生的程式碼（自動）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[repr(C)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, Copy, Clone)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVRational&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; num: ::std::os::raw::c_int,  &lt;span style=&#34;color:#75715e&#34;&gt;// 順序正確
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; den: ::std::os::raw::c_int,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;對於複雜的結構體如 &lt;code&gt;AVFormatContext&lt;/code&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bindgen 產生數百行，包含所有欄位
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[repr(C)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AVFormatContext&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; av_class: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AVClass,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; iformat: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AVInputFormat,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; oformat: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AVOutputFormat,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; priv_data: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; ::std::os::raw::c_void,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; pb: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVIOContext,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; ctx_flags: ::std::os::raw::c_int,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; nb_streams: ::std::os::raw::c_uint,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; streams: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVStream,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ... 還有幾十個欄位 ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;bindgen-的限制&#34;&gt;Bindgen 的限制&lt;/h3&gt;
&lt;p&gt;Bindgen 不是萬能的，它&lt;strong&gt;無法解決&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 跨版本相容性&lt;/strong&gt;&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;編譯時：FFmpeg 6.0 安裝 → bindings.rs 對應 FFmpeg 6.0
執行時：FFmpeg 7.0 安裝 → ABI 不相容 → 未定義行為&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;解決方案：&lt;/strong&gt; 重新編譯，或使用版本檢查。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. 指標生命週期&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Bindgen 只產生型別定義，不會幫你管理生命週期：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bindgen 產生的函式簽名
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;avformat_open_input&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ps: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    url: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; ::std::os::raw::c_char,  &lt;span style=&#34;color:#75715e&#34;&gt;// 誰負責這個指標的生命週期？
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) -&amp;gt; ::std::os::raw::c_int;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;解決方案：&lt;/strong&gt; 在 safe wrapper 層處理。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. 語意正確性&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Bindgen 確保 ABI 正確，但不保證你正確使用 API：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 這段程式碼 ABI 正確，但語意錯誤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ctx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; avformat_open_input(&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 忘記呼叫 avformat_find_stream_info()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; streams &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ctx).nb_streams;  &lt;span style=&#34;color:#75715e&#34;&gt;// 可能是 0 或垃圾值
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;解決方案：&lt;/strong&gt; 閱讀文件，或使用 safe wrapper 強制正確的呼叫順序。&lt;/p&gt;
&lt;h3 id=&#34;結論三層防護&#34;&gt;結論：三層防護&lt;/h3&gt;
&lt;p&gt;理想的 FFI 架構是三層：&lt;/p&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    block-beta
    columns 1
    block:layer1
        A[&#34;Safe Wrapper（語意正確性）← 人類設計&#34;]
    end
    block:layer2
        B[&#34;Bindgen 綁定（ABI 正確性）← 工具產生&#34;]
    end
    block:layer3
        C[&#34;C 函式庫（實際實作）← 外部依賴&#34;]
    end
  &lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Bindgen&lt;/strong&gt; 確保 Rust 和 C 之間的 ABI 匹配&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Safe Wrapper&lt;/strong&gt; 確保 API 被正確使用&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;人類&lt;/strong&gt; 負責設計 wrapper 的 API 和處理邊界情況&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;手寫 FFI 適合學習底層原理，但在生產環境中，bindgen + safe wrapper 的組合才是正確的選擇。&lt;/p&gt;
&lt;h2 id=&#34;safe-wrapper-的設計原則&#34;&gt;Safe Wrapper 的設計原則&lt;/h2&gt;
&lt;p&gt;Safe wrapper 是 FFI 的最後一道防線，設計得好可以讓使用者完全不需要接觸 &lt;code&gt;unsafe&lt;/code&gt;。以下是幾個關鍵原則：&lt;/p&gt;
&lt;h3 id=&#34;1-raii資源獲取即初始化&#34;&gt;1. RAII：資源獲取即初始化&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 用 Rust 的所有權系統管理 C 資源的生命週期。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FormatContext&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext,  &lt;span style=&#34;color:#75715e&#34;&gt;// C 資源
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;open&lt;/span&gt;(path: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std::ptr::null_mut();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ret &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; { avformat_open_input(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; ptr, &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.) };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ret &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Err(AvError::from_code(ret));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(FormatContext { ptr })  &lt;span style=&#34;color:#75715e&#34;&gt;// 獲取資源
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Drop &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;drop&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; { avformat_close_input(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self.ptr); }  &lt;span style=&#34;color:#75715e&#34;&gt;// 自動釋放
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 使用者不可能忘記釋放資源，編譯器保證。&lt;/p&gt;
&lt;h3 id=&#34;2-類型狀態模式編譯時強制正確順序&#34;&gt;2. 類型狀態模式：編譯時強制正確順序&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 用不同的類型表示不同的狀態，讓編譯器阻止錯誤的呼叫順序。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 未初始化的 context
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;UninitializedContext&lt;/span&gt; { ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 已讀取 stream info 的 context
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReadyContext&lt;/span&gt; { ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; UninitializedContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;find_stream_info&lt;/span&gt;(self) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;ReadyContext&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ret &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; { avformat_find_stream_info(self.ptr, &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.) };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ret &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Err(&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(ReadyContext { ptr: &lt;span style=&#34;color:#a6e22e&#34;&gt;self&lt;/span&gt;.ptr })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; ReadyContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 只有 ReadyContext 才能讀取 packets
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_packet&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Packet&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 不可能在 &lt;code&gt;find_stream_info()&lt;/code&gt; 之前呼叫 &lt;code&gt;read_packet()&lt;/code&gt;，編譯器會報錯。&lt;/p&gt;
&lt;h3 id=&#34;3-借用而非擁有避免不必要的複製&#34;&gt;3. 借用而非擁有：避免不必要的複製&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 對於 C 結構體內的資料，返回借用而非複製。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Packet {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 返回借用，避免複製整個 packet 資料
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;self.ptr).data;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;self.ptr).size;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ptr.is_null() &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; size &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                None
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Some(std::slice::from_raw_parts(ptr, size &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 零複製存取，效能與直接使用 C API 相同。&lt;/p&gt;
&lt;h3 id=&#34;4-錯誤類型化用-rust-的-result-取代錯誤碼&#34;&gt;4. 錯誤類型化：用 Rust 的 Result 取代錯誤碼&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 把 C 的錯誤碼轉換成有意義的 Rust 錯誤類型。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, thiserror::Error)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AvError&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End of file&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Eof,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to open input: {0}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenInput(String),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FFmpeg error ({code}): {message}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ffmpeg { code: &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;, message: String },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; AvError {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;from_code&lt;/span&gt;(code: &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; code &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;AVERROR_EOF&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; AvError::Eof;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_error_string(code);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        AvError::Ffmpeg { code, message }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 使用者可以用 &lt;code&gt;match&lt;/code&gt; 處理特定錯誤，IDE 有自動完成。&lt;/p&gt;
&lt;h4 id=&#34;為什麼用-thiserror&#34;&gt;為什麼用 thiserror？&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;thiserror&lt;/code&gt; 是定義錯誤類型的最佳選擇，原因如下：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 自動實作 &lt;code&gt;std::error::Error&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 手寫需要這些
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; std::fmt::Display &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; AvError { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; std::error::Error &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; AvError { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// thiserror 一行搞定
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(thiserror::Error)]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;2. 錯誤訊息內嵌在類型定義中&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, thiserror::Error)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AvError&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to open &amp;#39;{path}&amp;#39;: {reason}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenInput { path: String, reason: String },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Codec not found: {0}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    CodecNotFound(String),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;程式碼和文件在同一處，不會不同步。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. 支援錯誤鏈（Error Source）&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, thiserror::Error)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AvError&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IO error&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Io(&lt;span style=&#34;color:#75715e&#34;&gt;#[from]&lt;/span&gt; std::io::Error),  &lt;span style=&#34;color:#75715e&#34;&gt;// 自動實作 From&amp;lt;std::io::Error&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid path: {0}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    InvalidPath(&lt;span style=&#34;color:#75715e&#34;&gt;#[source]&lt;/span&gt; std::ffi::NulError),  &lt;span style=&#34;color:#75715e&#34;&gt;// 保留原始錯誤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;使用者可以用 &lt;code&gt;.source()&lt;/code&gt; 追溯錯誤來源。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. 與 anyhow 完美搭配&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 函式庫用 thiserror 定義具體錯誤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(thiserror::Error)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AvError&lt;/span&gt; { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 應用程式用 anyhow 統一處理
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;anyhow&lt;/span&gt;::Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;()&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; ctx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FormatContext::open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;video.mp4&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// AvError 自動轉換
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;5. 零執行時開銷&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;thiserror&lt;/code&gt; 是純粹的 proc-macro，所有程式碼在編譯時產生，執行時沒有任何額外成本。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;比較：不同錯誤處理方式&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;方式&lt;/th&gt;
          &lt;th&gt;優點&lt;/th&gt;
          &lt;th&gt;缺點&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;返回 &lt;code&gt;i32&lt;/code&gt; 錯誤碼&lt;/td&gt;
          &lt;td&gt;與 C API 一致&lt;/td&gt;
          &lt;td&gt;無類型安全、難以理解&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;手寫 &lt;code&gt;Error&lt;/code&gt; trait&lt;/td&gt;
          &lt;td&gt;完全控制&lt;/td&gt;
          &lt;td&gt;樣板程式碼多&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;thiserror&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;簡潔、類型安全&lt;/td&gt;
          &lt;td&gt;需要依賴（但很輕量）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;anyhow::Error&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;最簡單&lt;/td&gt;
          &lt;td&gt;丟失具體類型，不適合函式庫&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;結論：&lt;/strong&gt; 函式庫應該用 &lt;code&gt;thiserror&lt;/code&gt; 定義具體錯誤類型，讓使用者可以精確處理每種錯誤情況。&lt;/p&gt;
&lt;h3 id=&#34;5-隱藏指標不暴露原始指標給使用者&#34;&gt;5. 隱藏指標：不暴露原始指標給使用者&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 所有原始指標都應該是 &lt;code&gt;struct&lt;/code&gt; 的私有欄位。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FormatContext&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext,  &lt;span style=&#34;color:#75715e&#34;&gt;// 私有！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 提供安全的存取方法
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nb_streams&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; { (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;self.ptr).nb_streams &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 如果真的需要原始指標（進階使用），標記為 unsafe
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as_ptr&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.ptr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 一般使用者完全不需要寫 &lt;code&gt;unsafe&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;6-迭代器模式讓集合存取符合-rust-慣例&#34;&gt;6. 迭代器模式：讓集合存取符合 Rust 慣例&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 用迭代器取代 C 風格的索引存取。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;streams&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;impl&lt;/span&gt; Iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Item &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; StreamInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &amp;#39;_ {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;self.nb_streams()).map(&lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; self.stream_info(i).unwrap())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 使用方式
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; stream &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; ctx.streams() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;println!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Stream &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{:?}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, stream.index, stream.media_type);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;效果：&lt;/strong&gt; 符合 Rust 慣例，可以用 &lt;code&gt;filter&lt;/code&gt;、&lt;code&gt;map&lt;/code&gt; 等方法鏈。&lt;/p&gt;
&lt;h3 id=&#34;7-文件化不變量清楚說明-safety-條件&#34;&gt;7. 文件化不變量：清楚說明 Safety 條件&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原則：&lt;/strong&gt; 即使是 safe 函式，也要說明前提條件和可能的 panic。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// Read the next packet from the container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;///
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// # Returns
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// - `Ok(true)` if a packet was read
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// - `Ok(false)` if end of file reached
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// - `Err(...)` if an error occurred
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;///
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// # Panics
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;/// Never panics. All errors are returned as `Err`.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_packet&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, packet: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; Packet) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;設計檢查清單&#34;&gt;設計檢查清單&lt;/h3&gt;
&lt;p&gt;設計 safe wrapper 時，問自己這些問題：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;問題&lt;/th&gt;
          &lt;th&gt;如果答案是「否」&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;使用者需要寫 &lt;code&gt;unsafe&lt;/code&gt; 嗎？&lt;/td&gt;
          &lt;td&gt;提供更高層的 API&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;使用者可能忘記釋放資源嗎？&lt;/td&gt;
          &lt;td&gt;實作 &lt;code&gt;Drop&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;使用者可能呼叫順序錯誤嗎？&lt;/td&gt;
          &lt;td&gt;使用類型狀態模式&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;使用者可能傳入無效參數嗎？&lt;/td&gt;
          &lt;td&gt;在建構時驗證&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;錯誤訊息有意義嗎？&lt;/td&gt;
          &lt;td&gt;定義專屬的錯誤類型&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;API 符合 Rust 慣例嗎？&lt;/td&gt;
          &lt;td&gt;參考標準庫的設計&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;好的 safe wrapper 讓使用者感覺像在用純 Rust 函式庫，完全不知道底下是 C。&lt;/p&gt;
&lt;h2 id=&#34;ai-coding-agent-與-ffi-開發&#34;&gt;AI Coding Agent 與 FFI 開發&lt;/h2&gt;
&lt;p&gt;Bindgen + Safe Wrapper 的組合是最佳實踐，但過去有個問題：&lt;strong&gt;太繁瑣了&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;設定 &lt;code&gt;build.rs&lt;/code&gt;、處理 pkg-config、設計 wrapper API、實作 Drop、寫文件、寫測試&amp;hellip; 這些工作加起來可能比實際的業務邏輯還多。這也是為什麼很多人選擇「先用 unsafe 頂著，以後再說」。&lt;/p&gt;
&lt;p&gt;AI coding agent 改變了這個權衡。&lt;/p&gt;
&lt;h3 id=&#34;ai-擅長的-ffi-任務&#34;&gt;AI 擅長的 FFI 任務&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. Build Script 設定&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;告訴 AI：「用 bindgen 綁定 libavformat，只需要這幾個函式&amp;hellip;」&lt;/p&gt;
&lt;p&gt;AI 會產生完整的 &lt;code&gt;build.rs&lt;/code&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// AI 產生，包含 pkg-config 偵測、bindgen 設定、錯誤處理
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; lib &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pkg_config::probe_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;libavformat&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;libavformat not found&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; bindings &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bindgen::Builder::default()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .header_contents(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;wrapper.h&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#&amp;#34;#include &amp;lt;libavformat/avformat.h&amp;gt;&amp;#34;#&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .allowlist_function(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;avformat_open_input&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .allowlist_function(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;avformat_find_stream_info&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ... 完整設定
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .generate()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .expect(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate bindings&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 輸出到正確位置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bindings.write_to_file(out_path.join(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bindings.rs&amp;#34;&lt;/span&gt;)).unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;手寫這個需要查文件、試錯、處理邊界情況。AI 幾秒鐘搞定。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Safe Wrapper 骨架&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;告訴 AI：「為 AVFormatContext 建立 safe wrapper，實作 RAII」&lt;/p&gt;
&lt;p&gt;AI 會產生符合所有設計原則的程式碼：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FormatContext&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ptr: &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; AVFormatContext,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;open&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;P: AsRef&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Path&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;(path: &lt;span style=&#34;color:#a6e22e&#34;&gt;P&lt;/span&gt;) -&amp;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Self&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nb_streams&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt; { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;streams&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;impl&lt;/span&gt; Iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Item &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; StreamInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &amp;#39;_ { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; Drop &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; FormatContext {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;drop&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self) { &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;包含：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;正確的生命週期標註&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Result&lt;/code&gt; 錯誤處理&lt;/li&gt;
&lt;li&gt;迭代器 API&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Drop&lt;/code&gt; 實作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. 錯誤類型定義&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;告訴 AI：「用 thiserror 定義錯誤類型，涵蓋 FFmpeg 的錯誤碼」&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Debug, thiserror::Error)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AvError&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End of file&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Eof,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to open input: {0}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenInput(String),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[error(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FFmpeg error ({code}): {message}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ffmpeg { code: &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;, message: String },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;4. 文件和測試&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;AI 自動產生：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/// # Safety&lt;/code&gt; 段落&lt;/li&gt;
&lt;li&gt;參數和返回值說明&lt;/li&gt;
&lt;li&gt;基本的單元測試&lt;/li&gt;
&lt;li&gt;使用範例&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這些在手動開發時往往被省略，但對使用者很重要。&lt;/p&gt;
&lt;h3 id=&#34;人類的角色&#34;&gt;人類的角色&lt;/h3&gt;
&lt;p&gt;AI 不是萬能的。人類仍然負責：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;任務&lt;/th&gt;
          &lt;th&gt;為什麼需要人類&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;決定要綁定哪些函式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;需要理解業務需求&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;審查 API 設計&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;確保符合 Rust 慣例和使用者期望&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;驗證 ABI 正確性&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;編譯成功不代表執行時正確&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;處理邊界情況&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;AI 可能遺漏特殊情況&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;效能調校&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;需要實際測量和分析&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;實際工作流程&#34;&gt;實際工作流程&lt;/h3&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    flowchart TD
    A[&#34;1. 人類：「綁定 libavformat 的 open/read/close」&#34;] --&gt; B[&#34;2. AI：產生 Cargo.toml、build.rs、bindgen 設定&#34;]
    B --&gt; C[&#34;3. 人類：cargo build，確認編譯成功&#34;]
    C --&gt; D[&#34;4. AI：產生 safe wrapper（FormatContext, Packet...）&#34;]
    D --&gt; E[&#34;5. 人類：審查 API，要求修改（「加上迭代器」）&#34;]
    E --&gt; F[&#34;6. AI：修改 + 補充文件和測試&#34;]
    F --&gt; G[&#34;7. 人類：用真實檔案測試，確認功能正確&#34;]
  &lt;/div&gt;

&lt;p&gt;整個過程可能只需要 30 分鐘，而不是以前的一整天。&lt;/p&gt;
&lt;h3 id=&#34;為什麼-ffi-特別適合-ai-輔助&#34;&gt;為什麼 FFI 特別適合 AI 輔助&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;模式明確&lt;/strong&gt;：bindgen 設定、RAII wrapper、錯誤處理都有標準模式&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;正確性可驗證&lt;/strong&gt;：能編譯、能執行、測試通過&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;重複性高&lt;/strong&gt;：每個函式的 wrapper 結構類似&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;文件密集&lt;/strong&gt;：需要大量的 Safety 說明和使用範例&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;AI 處理這些機械性工作，人類專注於設計決策和驗證。&lt;/p&gt;
&lt;h2 id=&#34;結論&#34;&gt;結論&lt;/h2&gt;
&lt;p&gt;FFI 開發的最佳實踐是 &lt;strong&gt;bindgen + safe wrapper&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Bindgen&lt;/strong&gt; 確保 ABI 正確性（結構體大小、欄位順序、對齊）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Safe Wrapper&lt;/strong&gt; 確保語意正確性（資源管理、呼叫順序、錯誤處理）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;過去這個組合太繁瑣，很多人選擇捷徑。現在有了 AI coding agent，完整實作的成本大幅降低。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不要再「先用 unsafe 頂著」了。讓 AI 幫你產生正確的 bindgen + safe wrapper，你只需要審查和測試。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;這就是 AI 時代的 FFI 開發：人類做設計決策，AI 做繁瑣實作，最終得到安全、符合慣例的 Rust 綁定。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;專案原始碼：&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/main/libavformat-ffi&#34;&gt;rust-52-projects/libavformat-ffi&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>用 Rust 和 WebAssembly 打造即時 Markdown 編輯器</title>
      <link>https://blog.simplypatrick.com/posts/2026/01-06-rust-wasm-markdown-editor/</link>
      <pubDate>Tue, 06 Jan 2026 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/01-06-rust-wasm-markdown-editor/</guid>
      <description>&lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/01-06-rust-wasm-markdown-editor/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;這個專案是我「52 個 Rust 專案」學習計畫的一部分。在完成了 16 個專案後，我發現 WebAssembly 是一個重要的學習缺口，於是決定用 Rust 來打造一個即時 Markdown 編輯器。&lt;/p&gt;
&lt;p&gt;專案原始碼：&lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/wasm-markdown-editor&#34;&gt;wasm-markdown-editor&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;為什麼選擇這個專案&#34;&gt;為什麼選擇這個專案？&lt;/h2&gt;
&lt;p&gt;在分析了之前完成的專案後，我發現幾個學習上的空白：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;已掌握的領域&lt;/strong&gt;：Async/await、網路程式設計（TCP/UDP/HTTP/WebSockets）、解析器、CLI 工具、錯誤處理&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;待加強的領域&lt;/strong&gt;：資料庫 ORM、程序宏、FFI、&lt;strong&gt;WebAssembly&lt;/strong&gt;、進階測試、GUI/圖形&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;選擇 Markdown 編輯器的原因：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;填補關鍵缺口&lt;/strong&gt;：之前沒有任何 WASM 專案&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;善用既有技能&lt;/strong&gt;：運用之前在計算機、shell、EBML 等專案中學到的解析技巧&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;互動性強&lt;/strong&gt;：能立即看到成果，滿足感高&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;實用價值&lt;/strong&gt;：這是真正能用的工具，不只是 demo&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;現代技術棧&lt;/strong&gt;：WASM 在 Rust 生態系中越來越重要&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;技術架構&#34;&gt;技術架構&lt;/h2&gt;
&lt;h3 id=&#34;rust-依賴項&#34;&gt;Rust 依賴項&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;dependencies&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;wasm-bindgen&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.2&amp;#34;&lt;/span&gt;           &lt;span style=&#34;color:#75715e&#34;&gt;# JavaScript 互操作層&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pulldown-cmark&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.12&amp;#34;&lt;/span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# 經過實戰驗證的 Markdown 解析器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;web-sys&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.3&amp;#34;&lt;/span&gt;                &lt;span style=&#34;color:#75715e&#34;&gt;# Web API 綁定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;serde&lt;/span&gt; = { &lt;span style=&#34;color:#a6e22e&#34;&gt;version&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.0&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;features&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;derive&amp;#34;&lt;/span&gt;] }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;serde-wasm-bindgen&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.6&amp;#34;&lt;/span&gt;     &lt;span style=&#34;color:#75715e&#34;&gt;# Rust/JS 之間的資料序列化&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;console_error_panic_hook&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.1&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 瀏覽器中更好的錯誤訊息&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;專案結構&#34;&gt;專案結構&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wasm-markdown-editor/
├── Cargo.toml              # Rust 專案設定
├── index.html              # 主進入點
├── src/
│   ├── lib.rs             # WASM 進入點
│   ├── parser.rs          # Markdown 解析 + 統計邏輯
│   └── utils.rs           # Panic hook 和工具函式
├── www/
│   ├── index.js           # JavaScript 應用邏輯
│   └── styles.css         # 樣式
└── pkg/                   # 建置輸出
    ├── wasm_markdown_editor.js
    └── wasm_markdown_editor_bg.wasm&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;核心實作&#34;&gt;核心實作&lt;/h2&gt;
&lt;h3 id=&#34;將函式匯出到-javascript&#34;&gt;將函式匯出到 JavaScript&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; wasm_bindgen::prelude::&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// WASM 模組載入時自動執行
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen(start)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    utils::set_panic_hook();  &lt;span style=&#34;color:#75715e&#34;&gt;// 更好的錯誤訊息
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 簡單的字串轉換
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;markdown_to_html&lt;/span&gt;(markdown: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; String {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    parser::parse_markdown(markdown)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 複雜結構 → JavaScript 物件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[wasm_bindgen]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_statistics&lt;/span&gt;(text: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;JsValue&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; stats &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; parser::calculate_stats(text);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    serde_wasm_bindgen::to_value(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;stats).unwrap()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵模式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#[wasm_bindgen]&lt;/code&gt; 標記要匯出給 JS 的函式&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#[wasm_bindgen(start)]&lt;/code&gt; 在模組初始化時自動執行&lt;/li&gt;
&lt;li&gt;簡單型別（str、數字、布林）自動轉換&lt;/li&gt;
&lt;li&gt;複雜型別需要 &lt;code&gt;serde-wasm-bindgen&lt;/code&gt; 進行序列化&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;markdown-解析&#34;&gt;Markdown 解析&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; pulldown_cmark::{html, Options, Parser};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;parse_markdown&lt;/span&gt;(markdown: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; String {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; options &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Options::empty();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    options.insert(Options::&lt;span style=&#34;color:#66d9ef&#34;&gt;ENABLE_STRIKETHROUGH&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    options.insert(Options::&lt;span style=&#34;color:#66d9ef&#34;&gt;ENABLE_TABLES&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    options.insert(Options::&lt;span style=&#34;color:#66d9ef&#34;&gt;ENABLE_FOOTNOTES&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    options.insert(Options::&lt;span style=&#34;color:#66d9ef&#34;&gt;ENABLE_TASKLISTS&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; parser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Parser::new_ext(markdown, options);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; html_output &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; String::new();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    html::push_html(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; html_output, parser);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    html_output
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;啟用的功能：刪除線、表格、註腳、任務清單、標題屬性。&lt;/p&gt;
&lt;h3 id=&#34;統計資訊計算&#34;&gt;統計資訊計算&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Serialize)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Statistics&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; characters: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; characters_no_spaces: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; words: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; lines: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; paragraphs: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; reading_time_minutes: &lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;calculate_stats&lt;/span&gt;(text: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;str&lt;/span&gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Statistics&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; words &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; text.split_whitespace().count();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; paragraphs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; text
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .filter(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;s.trim().is_empty())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .count();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 平均閱讀速度：每分鐘 200 字
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; reading_time_minutes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (words &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f64&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200.0&lt;/span&gt;).ceil();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;javascript-整合&#34;&gt;JavaScript 整合&lt;/h2&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;markdown_to_html&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;get_statistics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} &lt;span style=&#34;color:#a6e22e&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;../pkg/wasm_markdown_editor.js&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 初始化 WASM 模組
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 現在可以使用 Rust 函式了
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;html&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;markdown_to_html&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;markdown&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;stats&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_statistics&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;text&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 效能優化：防抖動
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;debounceTimer&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DEBOUNCE_DELAY&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;300&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handleInput&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;debounceTimer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;clearTimeout&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;debounceTimer&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;updateStatistics&lt;/span&gt;();  &lt;span style=&#34;color:#75715e&#34;&gt;// 立即更新（快速）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;debounceTimer&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;setTimeout&lt;/span&gt;(() =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;updatePreview&lt;/span&gt;();   &lt;span style=&#34;color:#75715e&#34;&gt;// 防抖動（較重）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;saveToStorage&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }, &lt;span style=&#34;color:#a6e22e&#34;&gt;DEBOUNCE_DELAY&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;關鍵重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ES6 模組匯入 WASM&lt;/li&gt;
&lt;li&gt;呼叫 Rust 函式前必須先執行非同步的 &lt;code&gt;init()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;防抖動避免過度渲染&lt;/li&gt;
&lt;li&gt;統計立即更新（便宜），預覽防抖動（昂貴）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;wasm-編譯深入解析&#34;&gt;WASM 編譯深入解析&lt;/h2&gt;
&lt;h3 id=&#34;編譯流程&#34;&gt;編譯流程&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. Rust 原始碼 (lib.rs, parser.rs, utils.rs)
   ↓
2. rustc --target wasm32-unknown-unknown
   ↓
3. 原始 .wasm 二進位檔（WebAssembly 位元組碼）
   ↓
4. wasm-bindgen（產生 JS 膠水程式碼）
   ↓
5. wasm-opt（Binaryen 優化）
   ↓
6. 最終輸出：.wasm + .js + .d.ts&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;記憶體模型&#34;&gt;記憶體模型&lt;/h3&gt;
&lt;p&gt;WASM 使用&lt;strong&gt;線性記憶體&lt;/strong&gt;（單一連續區塊），JavaScript 和 Rust 透過這塊共享記憶體交換資料：&lt;/p&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    sequenceDiagram
    participant JS as JavaScript
    participant Mem as WASM 線性記憶體
    participant Rust as Rust

    JS-&gt;&gt;Mem: 1. 寫入字串
    JS-&gt;&gt;Rust: 2. 傳遞指標 + 長度
    Rust-&gt;&gt;Rust: 3. 處理資料
    Rust-&gt;&gt;Mem: 4. 寫入結果
    Rust-&gt;&gt;JS: 5. 回傳結果指標
    JS-&gt;&gt;Mem: 6. 讀取結果
    JS-&gt;&gt;Mem: 7. 釋放記憶體
  &lt;/div&gt;

&lt;p&gt;&lt;strong&gt;字串傳遞流程&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;JS 字串寫入 WASM 線性記憶體&lt;/li&gt;
&lt;li&gt;傳遞指標和長度給 Rust 函式&lt;/li&gt;
&lt;li&gt;Rust 處理資料&lt;/li&gt;
&lt;li&gt;Rust 將結果寫入記憶體&lt;/li&gt;
&lt;li&gt;回傳結果的指標給 JS&lt;/li&gt;
&lt;li&gt;JS 從記憶體讀取結果字串&lt;/li&gt;
&lt;li&gt;釋放不再需要的記憶體&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;型別轉換對照表&#34;&gt;型別轉換對照表&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Rust 型別&lt;/th&gt;
          &lt;th&gt;WASM 型別&lt;/th&gt;
          &lt;th&gt;JavaScript 型別&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;amp;str&lt;/code&gt;, &lt;code&gt;String&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;i32 (ptr) + i32 (len)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;string&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;i32&lt;/code&gt;, &lt;code&gt;u32&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;i32&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;number&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;f64&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;f64&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;number&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;bool&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;i32 (0 或 1)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;boolean&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;JsValue&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;externref&lt;/td&gt;
          &lt;td&gt;any&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;可序列化 struct&lt;/td&gt;
          &lt;td&gt;externref&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;object&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;建置與效能&#34;&gt;建置與效能&lt;/h2&gt;
&lt;h3 id=&#34;建置指令&#34;&gt;建置指令&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 安裝 wasm-pack（只需一次）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install wasm-pack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 建置 WASM 模組&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wasm-pack build --target web
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 執行 Rust 單元測試&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo test
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 在瀏覽器中執行 WASM 測試&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wasm-pack test --headless --firefox&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;建置輸出&#34;&gt;建置輸出&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WASM 套件&lt;/strong&gt;：222 KB（已優化）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JS 膠水程式碼&lt;/strong&gt;：13 KB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;總下載量&lt;/strong&gt;：235 KB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;建置時間&lt;/strong&gt;：約 8 秒（增量）、約 13 秒（完整）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cargotoml-關鍵設定&#34;&gt;Cargo.toml 關鍵設定&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;lib&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;crate-type&lt;/span&gt; = [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cdylib&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rlib&amp;#34;&lt;/span&gt;]  &lt;span style=&#34;color:#75715e&#34;&gt;# WASM 編譯必需&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;profile&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;release&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;opt-level&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;s&amp;#34;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 優化檔案大小（而非速度）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lto&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;         &lt;span style=&#34;color:#75715e&#34;&gt;# 連結時優化，產生更小的套件&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;為什麼這些設定很重要：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cdylib&lt;/code&gt; = C 動態函式庫類型，WASM 必需&lt;/li&gt;
&lt;li&gt;&lt;code&gt;opt-level = &amp;quot;s&amp;quot;&lt;/code&gt; 產生的二進位檔比 &amp;ldquo;3&amp;rdquo; 小約 30%&lt;/li&gt;
&lt;li&gt;LTO 消除整個依賴樹中的死碼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;遇到的問題與解決方案&#34;&gt;遇到的問題與解決方案&lt;/h2&gt;
&lt;h3 id=&#34;問題404-錯誤&#34;&gt;問題：404 錯誤&lt;/h3&gt;
&lt;p&gt;從 &lt;code&gt;www/&lt;/code&gt; 目錄提供服務時，瀏覽器無法存取 &lt;code&gt;../pkg/&lt;/code&gt;（在提供的目錄之外）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;初始嘗試&lt;/strong&gt;：從 &lt;code&gt;www/&lt;/code&gt; 目錄提供服務&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;http://localhost:8080/  → www/index.html
http://localhost:8080/pkg/...  → 404 錯誤&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;解決方案&lt;/strong&gt;：在專案根目錄建立 &lt;code&gt;index.html&lt;/code&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 從專案根目錄提供服務，而非 www/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd wasm-markdown-editor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python -m http.server &lt;span style=&#34;color:#ae81ff&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 存取 http://localhost:8080&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;實作的功能&#34;&gt;實作的功能&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;✅ 帶防抖動的即時預覽&lt;/li&gt;
&lt;li&gt;✅ 即時統計（字數、字元數、閱讀時間）&lt;/li&gt;
&lt;li&gt;✅ LocalStorage 自動儲存&lt;/li&gt;
&lt;li&gt;✅ 帶內嵌 CSS 的 HTML 匯出&lt;/li&gt;
&lt;li&gt;✅ 範例 Markdown 載入器&lt;/li&gt;
&lt;li&gt;✅ 鍵盤快捷鍵（Ctrl+S、Ctrl+K）&lt;/li&gt;
&lt;li&gt;✅ 響應式分割視窗佈局&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;學習成果&#34;&gt;學習成果&lt;/h2&gt;
&lt;h3 id=&#34;wasm-特定技能&#34;&gt;WASM 特定技能&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;✅ 理解 &lt;code&gt;cdylib&lt;/code&gt; crate 類型及其作用&lt;/li&gt;
&lt;li&gt;✅ 使用 &lt;code&gt;#[wasm_bindgen]&lt;/code&gt; 屬性匯出給 JS&lt;/li&gt;
&lt;li&gt;✅ 管理 Rust/JavaScript 邊界的記憶體&lt;/li&gt;
&lt;li&gt;✅ 型別轉換（簡單型別 vs. 複雜結構）&lt;/li&gt;
&lt;li&gt;✅ WASM 模組初始化模式&lt;/li&gt;
&lt;li&gt;✅ 在瀏覽器 DevTools 中除錯 WASM&lt;/li&gt;
&lt;li&gt;✅ 套件大小優化技術&lt;/li&gt;
&lt;li&gt;✅ 建置工具（&lt;code&gt;wasm-pack&lt;/code&gt;、&lt;code&gt;wasm-bindgen&lt;/code&gt;）&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;什麼時候該用-wasm&#34;&gt;什麼時候該用 WASM？&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;適合的場景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 計算密集型操作（解析、圖像處理）&lt;/li&gt;
&lt;li&gt;✅ 想重用現有的 Rust 函式庫&lt;/li&gt;
&lt;li&gt;✅ 效能關鍵路徑&lt;/li&gt;
&lt;li&gt;✅ 套件大小可接受時&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;不太適合的場景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;❌ 大量 DOM 操作（用 JS）&lt;/li&gt;
&lt;li&gt;❌ 微小的工具函式（開銷不值得）&lt;/li&gt;
&lt;li&gt;❌ 簡單的 CRUD 操作&lt;/li&gt;
&lt;li&gt;❌ 套件大小是關鍵考量時&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;與純-javascript-方案的比較&#34;&gt;與純 JavaScript 方案的比較&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;效能&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Markdown 解析：比 JS 替代方案快約 2-3 倍&lt;/li&gt;
&lt;li&gt;打字時沒有 GC 暫停&lt;/li&gt;
&lt;li&gt;可預測的記憶體使用&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;套件大小&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;與流行的 JS 函式庫相當或更小&lt;/li&gt;
&lt;li&gt;markdown-it.js：約 320 KB&lt;/li&gt;
&lt;li&gt;我們的方案：&lt;strong&gt;235 KB&lt;/strong&gt;（包含解析器 + 統計）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;反思&#34;&gt;反思&lt;/h2&gt;
&lt;h3 id=&#34;順利的部分&#34;&gt;順利的部分&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;流暢的建置過程&lt;/strong&gt;：wasm-pack「直接就能用」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;優秀的文件&lt;/strong&gt;：Rust WASM book 非常有價值&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;型別安全&lt;/strong&gt;：編譯時就能捕捉錯誤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;效能&lt;/strong&gt;：解析明顯流暢&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;工具鏈&lt;/strong&gt;：自動產生的 TypeScript 定義很有幫助&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;克服的挑戰&#34;&gt;克服的挑戰&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;路徑解析&lt;/strong&gt;：404 錯誤需要理解 WASM 服務方式&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;記憶體模型&lt;/strong&gt;：理解線性記憶體花了一些時間&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;型別轉換&lt;/strong&gt;：學習何時用 JsValue vs. 簡單型別&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;非同步初始化&lt;/strong&gt;：理解 init() 的必要性&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;驚喜的發現&#34;&gt;驚喜的發現&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;套件大小&lt;/strong&gt;：比預期小（222 KB 含完整解析器！）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;建置速度&lt;/strong&gt;：增量建置很快（8 秒）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;瀏覽器支援&lt;/strong&gt;：所有現代瀏覽器都能用，不需要 polyfill&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;開發體驗&lt;/strong&gt;：在 DevTools 中除錯 WASM 相當不錯&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;結論&#34;&gt;結論&lt;/h2&gt;
&lt;p&gt;這個專案成功填補了我 rust-52-projects 學習旅程中的一個主要缺口。它證明了 &lt;strong&gt;Rust + WASM 已經可以用於生產環境&lt;/strong&gt;的互動式 Web 應用程式，尤其是像解析這樣的計算密集型任務。&lt;/p&gt;
&lt;p&gt;Rust 的效能和安全性與 JavaScript 的普及性結合，創造了一個強大的開發模式。工具鏈（&lt;code&gt;wasm-pack&lt;/code&gt;、&lt;code&gt;wasm-bindgen&lt;/code&gt;）已經成熟到體驗流暢且高效的程度。&lt;/p&gt;
&lt;p&gt;這是一個很好的「第一個 WASM 專案」，在學習核心概念的同時建構出真正實用的東西。&lt;/p&gt;
&lt;h2 id=&#34;參考資源&#34;&gt;參考資源&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rustwasm.github.io/docs/book/&#34;&gt;Rust and WebAssembly Book&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rustwasm.github.io/wasm-bindgen/&#34;&gt;wasm-bindgen Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.rs/pulldown-cmark/&#34;&gt;pulldown-cmark Docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.rs/serde-wasm-bindgen/&#34;&gt;serde-wasm-bindgen&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>使用 Rust 實作非同步任務佇列：系統設計與核心概念</title>
      <link>https://blog.simplypatrick.com/posts/2026/01-03-async-job-queue/</link>
      <pubDate>Sat, 03 Jan 2026 15:12:56 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2026/01-03-async-job-queue/</guid>
      <description>

  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2026/01-03-async-job-queue/featured.svg&#34; alt=&#34;featured.svg&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;h2 id=&#34;專案概述&#34;&gt;專案概述&lt;/h2&gt;
&lt;p&gt;本文將探討如何使用 Rust 實作一個生產級的非同步任務佇列系統。這個專案展示了多個重要的 Rust 概念和系統設計原則，包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;模組化設計與封裝&lt;/li&gt;
&lt;li&gt;Trait 系統的應用&lt;/li&gt;
&lt;li&gt;並發安全與資料競爭處理&lt;/li&gt;
&lt;li&gt;非同步程式設計 (Tokio)&lt;/li&gt;
&lt;li&gt;SQLite 資料持久化&lt;/li&gt;
&lt;li&gt;CLI 工具設計&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;專案原始碼：&lt;/strong&gt; &lt;a href=&#34;https://github.com/p47t/rust-52-projects/tree/master/async-job-queue&#34;&gt;https://github.com/p47t/rust-52-projects/tree/master/async-job-queue&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;系統架構&#34;&gt;系統架構&lt;/h2&gt;
&lt;h3 id=&#34;核心組件&#34;&gt;核心組件&lt;/h3&gt;
&lt;p&gt;我們的任務佇列系統由三個主要模組組成：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;async-job-queue/
├── src/
│   ├── job.rs        # 任務定義與狀態管理
│   ├── storage.rs    # SQLite 儲存層
│   ├── worker.rs     # 工作池與任務處理
│   ├── lib.rs        # 公開 API
│   └── bin/
│       ├── producer.rs  # 生產者 CLI
│       └── worker.rs    # 消費者 CLI&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;資料流程&#34;&gt;資料流程&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Producer (CLI) → SQLite Database ← Worker Pool (多個 workers)
                      ↓
                 [Pending Jobs]
                      ↓
                 [Running Jobs]
                      ↓
              [Completed/Failed/Dead Letter]&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;rust-核心概念解析&#34;&gt;Rust 核心概念解析&lt;/h2&gt;
&lt;h3 id=&#34;1-模組可見性mod-vs-pub-mod&#34;&gt;1. 模組可見性：&lt;code&gt;mod&lt;/code&gt; vs &lt;code&gt;pub mod&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;問題：&lt;/strong&gt; 如何設計乾淨的公開 API？&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;lib.rs&lt;/code&gt; 中，我們使用私有模組配合公開重匯出：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 私有模組 - 隱藏內部實作細節
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mod&lt;/span&gt; job;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mod&lt;/span&gt; storage;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mod&lt;/span&gt; worker;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 公開重匯出 - 只暴露需要的類型
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; job::{Job, JobHandler, JobStatus, Priority};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; storage::{Storage, StorageError};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; worker::WorkerPool;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;優點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 使用者只能透過 &lt;code&gt;use async_job_queue::{Job, Storage}&lt;/code&gt; 匯入&lt;/li&gt;
&lt;li&gt;✅ 內部模組結構可以自由重構而不影響公開 API&lt;/li&gt;
&lt;li&gt;✅ 更好的封裝性，隱藏實作細節&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;替代方案（不推薦）：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mod&lt;/span&gt; job;  &lt;span style=&#34;color:#75715e&#34;&gt;// 暴露整個模組，使用者可存取所有公開項目
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;2-trait定義行為抽象&#34;&gt;2. Trait：定義行為抽象&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;JobHandler&lt;/code&gt; trait 定義了任務處理的介面：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;trait&lt;/span&gt; JobHandler: Send &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Sync {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handle&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self, payload: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]) -&amp;gt; Result&lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lt&lt;/span&gt;;(), String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;設計考量：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Send + Sync&lt;/code&gt;：確保可以在執行緒間安全傳遞和共享&lt;/li&gt;
&lt;li&gt;接受 &lt;code&gt;&amp;amp;[u8]&lt;/code&gt; 而非具體類型：保持通用性，支援任何序列化格式&lt;/li&gt;
&lt;li&gt;回傳 &lt;code&gt;Result&amp;lt;(), String&amp;gt;&lt;/code&gt;：簡單的錯誤處理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;使用範例：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;EchoHandler&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; JobHandler &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; EchoHandler {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handle&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self, payload: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;]) -&amp;gt; Result&lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lt&lt;/span&gt;;(), String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; String::from_utf8_lossy(payload);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;println!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;處理任務：&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, message);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;3-newtype-模式的應用場景&#34;&gt;3. Newtype 模式的應用場景&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;討論：&lt;/strong&gt; 應該使用 &lt;code&gt;Vec&amp;lt;u8&amp;gt;&lt;/code&gt; 還是 &lt;code&gt;JobPayload&lt;/code&gt; 新類型？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目前實作（&lt;code&gt;Vec&amp;lt;u8&amp;gt;&lt;/code&gt;）：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Job&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; payload: Vec&lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lt&lt;/span&gt;;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Newtype 模式：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;JobPayload&lt;/span&gt;(Vec&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; JobPayload {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;new&lt;/span&gt;(bytes: Vec&lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lt&lt;/span&gt;;&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Self(bytes)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as_bytes&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) -&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;u8&lt;/span&gt;] {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; From&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;String&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; JobPayload {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;from&lt;/span&gt;(s: String) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Self&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Self(s.into_bytes())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;何時使用 Newtype：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 提供型別安全（避免混淆不同的 &lt;code&gt;Vec&amp;lt;u8&amp;gt;&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;✅ 零成本抽象（編譯時展開，無執行時開銷）&lt;/li&gt;
&lt;li&gt;✅ API 更清晰（&lt;code&gt;Job::new(JobPayload, ...)&lt;/code&gt; vs &lt;code&gt;Job::new(Vec&amp;lt;u8&amp;gt;, ...)&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;✅ 未來擴充性（可加入驗證、壓縮等功能）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;目前專案的選擇：&lt;/strong&gt;
保持 &lt;code&gt;Vec&amp;lt;u8&amp;gt;&lt;/code&gt; 是合理的，因為：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系統設計為通用型，不關心具體格式&lt;/li&gt;
&lt;li&gt;API 介面簡單，不易混淆&lt;/li&gt;
&lt;li&gt;遵循 YAGNI 原則（You Aren&amp;rsquo;t Gonna Need It）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-列舉型別與-display-trait&#34;&gt;4. 列舉型別與 Display Trait&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;問題：&lt;/strong&gt; 如何為列舉實作 &lt;code&gt;Display&lt;/code&gt;？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;手動實作（目前方式）：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;impl&lt;/span&gt; fmt::Display &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; Priority {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self, f: &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mut&lt;/span&gt; fmt::Formatter&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;&amp;#39;_&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;) -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;::Result {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; self {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Priority::Low &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;write!&lt;/span&gt;(f, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;low&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Priority::Normal &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;write!&lt;/span&gt;(f, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;normal&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Priority::High &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;write!&lt;/span&gt;(f, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;high&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Priority::Critical &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;write!&lt;/span&gt;(f, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;critical&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;使用第三方 crate（&lt;code&gt;strum&lt;/code&gt;）：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; strum_macros::Display;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Display)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[strum(serialize_all = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lowercase&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Priority&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Low,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Normal,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    High,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Critical,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;建議：&lt;/strong&gt; 對於簡單列舉，手動實作更清晰，無需額外依賴。&lt;/p&gt;
&lt;h3 id=&#34;5-非同步程式設計tokio-的角色&#34;&gt;5. 非同步程式設計：Tokio 的角色&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Tokio 在專案中的使用：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#[tokio::main]&lt;/code&gt;&lt;/strong&gt; - 設定非同步執行環境&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[tokio::main]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() -&amp;gt; Result&lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lt&lt;/span&gt;;(), Box&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;dyn&lt;/span&gt; std::error::Error&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;tokio::spawn&lt;/code&gt;&lt;/strong&gt; - 並發執行多個 worker&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; worker_id &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;self.num_workers {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; handle &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokio::spawn(&lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;move&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        worker_loop(worker_id, storage, handler, poll_interval).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    handles.push(handle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;tokio::time::sleep&lt;/code&gt;&lt;/strong&gt; - 非阻塞延遲&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sleep(poll_interval).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 輪詢間隔
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;有趣的觀察：&lt;/strong&gt;
這個專案實際上是「假非同步」！核心操作都是同步的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SQLite 操作使用 &lt;code&gt;rusqlite&lt;/code&gt;（同步 API）&lt;/li&gt;
&lt;li&gt;任務處理是同步函式&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;std::sync::Mutex&lt;/code&gt; 而非 &lt;code&gt;tokio::sync::Mutex&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;為什麼還要用 Tokio？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;方便建立並發 worker（比 &lt;code&gt;std::thread&lt;/code&gt; 更輕量）&lt;/li&gt;
&lt;li&gt;非阻塞的 sleep（不會凍結整個執行緒）&lt;/li&gt;
&lt;li&gt;為未來的非同步擴充做準備&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-stdsyncmutex-vs-tokiosyncmutex&#34;&gt;6. &lt;code&gt;std::sync::Mutex&lt;/code&gt; vs &lt;code&gt;tokio::sync::Mutex&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;關鍵差異：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;特性&lt;/th&gt;
          &lt;th&gt;&lt;code&gt;std::sync::Mutex&lt;/code&gt;&lt;/th&gt;
          &lt;th&gt;&lt;code&gt;tokio::sync::Mutex&lt;/code&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;等待鎖時&lt;/td&gt;
          &lt;td&gt;阻塞整個執行緒&lt;/td&gt;
          &lt;td&gt;讓出執行權給其他 task&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;使用方式&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;mutex.lock().unwrap()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;mutex.lock().await&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;適用場景&lt;/td&gt;
          &lt;td&gt;短時間持鎖、同步操作&lt;/td&gt;
          &lt;td&gt;長時間持鎖、跨 await&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;效能&lt;/td&gt;
          &lt;td&gt;更快（作業系統級）&lt;/td&gt;
          &lt;td&gt;稍慢（需協調排程）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;目前專案的正確選擇：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Storage&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn: &lt;span style=&#34;color:#a6e22e&#34;&gt;Arc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Connection&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// ✅ std::sync::Mutex
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_next_pending&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;amp;&lt;/span&gt;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Job&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;, StorageError&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; conn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.conn.lock().unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 執行快速的同步資料庫操作
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 沒有在持鎖期間 await
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(job)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;何時必須使用 &lt;code&gt;tokio::sync::Mutex&lt;/code&gt;：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ❌ 錯誤：在持有 std::sync::Mutex 時 await
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; guard &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std_mutex.lock().unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;async_operation().&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 會阻塞整個執行緒！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ✅ 正確：使用 tokio::sync::Mutex
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; guard &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokio_mutex.lock().&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;async_operation().&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// OK，會讓出執行權
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;並發安全與資料競爭&#34;&gt;並發安全與資料競爭&lt;/h2&gt;
&lt;h3 id=&#34;發現的競爭條件問題&#34;&gt;發現的競爭條件問題&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原始設計的漏洞：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ❌ 有競爭條件的程式碼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_next_pending&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;amp;&lt;/span&gt;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Job&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;, StorageError&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 步驟 1：讀取待處理任務
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; job &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;. &lt;span style=&#34;color:#66d9ef&#34;&gt;WHERE&lt;/span&gt; status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Pending &lt;span style=&#34;color:#66d9ef&#34;&gt;LIMIT&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ⚠️ 問題：Worker 2 可能在這裡也讀取到相同任務！
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(job)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Worker 處理邏輯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; job &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; storage.get_next_pending()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 取得任務
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;job.mark_running();                     &lt;span style=&#34;color:#75715e&#34;&gt;// 標記為執行中
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;storage.update(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;job)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;                  &lt;span style=&#34;color:#75715e&#34;&gt;// 更新資料庫
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;時序圖展示問題：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;時間&lt;/th&gt;
          &lt;th&gt;Worker 1&lt;/th&gt;
          &lt;th&gt;Worker 2&lt;/th&gt;
          &lt;th&gt;資料庫狀態&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;T1&lt;/td&gt;
          &lt;td&gt;get_next_pending()&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;Job A: Pending&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T2&lt;/td&gt;
          &lt;td&gt;讀取 Job A&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T3&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;get_next_pending()&lt;/td&gt;
          &lt;td&gt;Job A: Pending&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T4&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;讀取 Job A (相同!)&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T5&lt;/td&gt;
          &lt;td&gt;mark_running()&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T6&lt;/td&gt;
          &lt;td&gt;update(Job A)&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;Job A: Running&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T7&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;mark_running()&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T8&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;update(Job A)&lt;/td&gt;
          &lt;td&gt;Job A: Running&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T9&lt;/td&gt;
          &lt;td&gt;處理 Job A&lt;/td&gt;
          &lt;td&gt;處理 Job A&lt;/td&gt;
          &lt;td&gt;❌ 重複處理！&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;解決方案原子性操作&#34;&gt;解決方案：原子性操作&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;修正後的實作：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_next_pending&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;self) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;amp;&lt;/span&gt;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Option&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;Job&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;, StorageError&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; conn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self.conn.lock().unwrap();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ✅ 原子性的 UPDATE + RETURNING（一個 SQL 語句完成）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; stmt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; conn.prepare(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;UPDATE jobs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;         SET status = ?1, updated_at = ?2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;         WHERE id = (
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;             SELECT id FROM jobs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;             WHERE status = ?3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;             ORDER BY priority DESC, created_at ASC
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;             LIMIT 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;         )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;         RETURNING id, payload, priority, status, retry_count, max_retries,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;                   created_at, updated_at, error_message&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; now &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Utc::now().to_rfc3339();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; job &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stmt
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .query_row(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;params!&lt;/span&gt;[JobStatus::Running &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;, now, JobStatus::Pending &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;i32&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;row&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; Ok(self.row_to_job(row)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .optional()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(job)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;為什麼這樣可以解決問題：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;原子性保證：&lt;/strong&gt; &lt;code&gt;UPDATE ... RETURNING&lt;/code&gt; 是單一 SQL 語句&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mutex 保護：&lt;/strong&gt; 同一時間只有一個 worker 能執行此查詢&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;狀態立即改變：&lt;/strong&gt; 任務在被回傳前就已標記為 Running&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;資料庫層級鎖定：&lt;/strong&gt; SQLite 的 EXCLUSIVE 鎖確保寫入安全&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;修正後的時序：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;時間&lt;/th&gt;
          &lt;th&gt;Worker 1&lt;/th&gt;
          &lt;th&gt;Worker 2&lt;/th&gt;
          &lt;th&gt;資料庫狀態&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;T1&lt;/td&gt;
          &lt;td&gt;取得 Mutex&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T2&lt;/td&gt;
          &lt;td&gt;UPDATE Job A → Running&lt;/td&gt;
          &lt;td&gt;等待 Mutex&lt;/td&gt;
          &lt;td&gt;Job A: Running&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T3&lt;/td&gt;
          &lt;td&gt;釋放 Mutex，回傳 Job A&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T4&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;取得 Mutex&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T5&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;UPDATE (找不到 Pending)&lt;/td&gt;
          &lt;td&gt;Job A: Running&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T6&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;回傳 None&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;T7&lt;/td&gt;
          &lt;td&gt;處理 Job A&lt;/td&gt;
          &lt;td&gt;等待下一輪&lt;/td&gt;
          &lt;td&gt;✅ 無重複處理&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;worker-程式碼簡化&#34;&gt;Worker 程式碼簡化&lt;/h3&gt;
&lt;p&gt;因為 &lt;code&gt;get_next_pending()&lt;/code&gt; 已經原子性地標記任務，worker 程式碼更簡潔：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ✅ 修正後
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; storage.get_next_pending() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(Some(&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; job)) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 任務已經是 Running 狀態，直接處理
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; handler.handle(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;job.payload) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Ok(()) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; job.mark_completed(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Err(e) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; job.mark_failed(e),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        storage.update(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;job)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(None) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sleep(poll_interval).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// 無任務，等待
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Err(e) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* 處理錯誤 */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;日誌與除錯&#34;&gt;日誌與除錯&lt;/h2&gt;
&lt;h3 id=&#34;tracing-vs-println&#34;&gt;&lt;code&gt;tracing&lt;/code&gt; vs &lt;code&gt;println!&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;何時使用 &lt;code&gt;println!&lt;/code&gt;：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ✅ 使用者導向的輸出
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;println!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Job ID: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, job.id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;println!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Status: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, job.status);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;何時使用 &lt;code&gt;tracing&lt;/code&gt;：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ✅ 操作性日誌、除錯資訊
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tracing::&lt;span style=&#34;color:#a6e22e&#34;&gt;info!&lt;/span&gt;(job_id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;job.id, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Processing job&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tracing::&lt;span style=&#34;color:#a6e22e&#34;&gt;error!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Database error: {}&amp;#34;&lt;/span&gt;, e);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;在 CLI 工具中：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;producer&lt;/code&gt; 使用 &lt;code&gt;println!&lt;/code&gt; 顯示命令結果（使用者期望的輸出）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;worker&lt;/code&gt; 使用 &lt;code&gt;tracing&lt;/code&gt; 記錄操作日誌（方便監控和除錯）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;初始化-tracing&#34;&gt;初始化 tracing&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[tokio::main]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;amp;&lt;/span&gt;gt; Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;(), Box&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;dyn&lt;/span&gt; std::error::Error&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 設定日誌格式與過濾級別
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tracing_subscriber::fmt()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .with_env_filter(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            tracing_subscriber::EnvFilter::from_default_env()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                .add_directive(tracing::Level::&lt;span style=&#34;color:#66d9ef&#34;&gt;INFO&lt;/span&gt;.into()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .init();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;使用方式：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 預設 INFO 級別&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./worker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 設定為 DEBUG 級別&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUST_LOG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;debug ./worker&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;資料持久化設計&#34;&gt;資料持久化設計&lt;/h2&gt;
&lt;h3 id=&#34;sqlite-schema&#34;&gt;SQLite Schema&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TABLE&lt;/span&gt; jobs (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    id TEXT &lt;span style=&#34;color:#66d9ef&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;KEY&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    payload BLOB &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    priority INTEGER &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    status INTEGER &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    retry_count INTEGER &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_retries INTEGER &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    created_at TEXT &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    updated_at TEXT &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    error_message TEXT
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INDEX&lt;/span&gt; idx_status_priority
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; jobs(status, priority &lt;span style=&#34;color:#66d9ef&#34;&gt;DESC&lt;/span&gt;, created_at &lt;span style=&#34;color:#66d9ef&#34;&gt;ASC&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;索引設計考量：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;status&lt;/code&gt; 在前：快速過濾待處理任務&lt;/li&gt;
&lt;li&gt;&lt;code&gt;priority DESC&lt;/code&gt;：高優先順序優先&lt;/li&gt;
&lt;li&gt;&lt;code&gt;created_at ASC&lt;/code&gt;：相同優先順序時，先進先出 (FIFO)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;狀態轉換&#34;&gt;狀態轉換&lt;/h3&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;         ┌─────────────┐
         │   Pending   │
         └──────┬──────┘
                │
                ↓
         ┌──────────────┐
         │   Running    │
         └──────┬───────┘
                │
        ┌───────┴────────┐
        │                │
        ↓ (成功)          ↓ (失敗)
  ┌───────────┐    ┌─────────┐
  │ Completed │    │ Failed  │
  └───────────┘    └────┬────┘
                        │
                ┌───────┴────────┐
                │                │
                ↓ (可重試)        ↓ (超過最大重試)
           [Pending]        ┌──────────────┐
          (retry_count++)   │ DeadLetter   │
                            └──────────────┘&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;失敗處理:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pub&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mark_failed&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; self, error: String) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self.can_retry() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self.retry_count &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        JobStatus::Pending  &lt;span style=&#34;color:#75715e&#34;&gt;// 重新排程
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        JobStatus::DeadLetter  &lt;span style=&#34;color:#75715e&#34;&gt;// 移至死信佇列
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.error_message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Some(error);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    self.updated_at &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Utc::now();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;cli-設計&#34;&gt;CLI 設計&lt;/h2&gt;
&lt;h3 id=&#34;producer生產者&#34;&gt;Producer（生產者）&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 提交任務&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;producer submit -p &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello, World!&amp;#34;&lt;/span&gt; -r high -m &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 查詢狀態&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;producer status --job-id &amp;amp;lt;uuid&amp;amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 統計資料&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;producer stats&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;使用 Clap 實作：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Parser)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[command(name = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;producer&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[command(about = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Job queue producer - submit and manage jobs&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Cli&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[arg(short, long, default_value = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;jobs.db&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    database: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#[command(subcommand)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    command: &lt;span style=&#34;color:#a6e22e&#34;&gt;Commands&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#[derive(Subcommand)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Commands&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Submit {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;#[arg(short, long)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        payload: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;#[arg(short = &amp;#39;r&amp;#39;, long, default_value = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;normal&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        priority: String,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;#[arg(short, long, default_value = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        max_retries: &lt;span style=&#34;color:#66d9ef&#34;&gt;u32&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Status { &lt;span style=&#34;color:#75715e&#34;&gt;/* ... */&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Stats,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;worker消費者&#34;&gt;Worker（消費者）&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 啟動 4 個 workers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;worker -w &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 使用不同的資料庫&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;worker --database /path/to/jobs.db --workers &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;效能考量&#34;&gt;效能考量&lt;/h2&gt;
&lt;h3 id=&#34;輪詢-vs-事件驅動&#34;&gt;輪詢 vs 事件驅動&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;目前實作（輪詢）：&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;match&lt;/span&gt; storage.get_next_pending() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(Some(job)) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* 處理 */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Ok(None) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; sleep(poll_interval).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// 等待 1 秒
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Err(e) &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* 錯誤處理 */&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;優點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 實作簡單&lt;/li&gt;
&lt;li&gt;✅ 可靠性高（無需額外機制）&lt;/li&gt;
&lt;li&gt;✅ 易於理解和維護&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;缺點：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;❌ 延遲：最多 &lt;code&gt;poll_interval&lt;/code&gt; 的延遲&lt;/li&gt;
&lt;li&gt;❌ 資源浪費：無任務時仍在輪詢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;改進方案（事件驅動）：&lt;/strong&gt;
可以使用 &lt;code&gt;tokio::sync::Notify&lt;/code&gt; 或資料庫的 NOTIFY/LISTEN：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 生產者插入任務後通知
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;notifier.notify_waiters();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Worker 等待通知
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;notifier.notified().&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;指數退避exponential-backoff&#34;&gt;指數退避（Exponential Backoff）&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; job.retry_count &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; backoff &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Duration::from_secs(&lt;span style=&#34;color:#ae81ff&#34;&gt;2_&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;u64&lt;/span&gt;.pow(job.retry_count.min(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sleep(backoff).&lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;退避時間：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第 1 次重試：2^1 = 2 秒&lt;/li&gt;
&lt;li&gt;第 2 次重試：2^2 = 4 秒&lt;/li&gt;
&lt;li&gt;第 3 次重試：2^3 = 8 秒&lt;/li&gt;
&lt;li&gt;第 4 次重試：2^4 = 16 秒&lt;/li&gt;
&lt;li&gt;第 5 次以上：2^5 = 32 秒（最大值）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;目的：&lt;/strong&gt; 避免快速重試造成系統負擔，給下游服務恢復時間。&lt;/p&gt;
&lt;h2 id=&#34;最佳實踐總結&#34;&gt;最佳實踐總結&lt;/h2&gt;
&lt;h3 id=&#34;1-模組設計&#34;&gt;1. 模組設計&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;使用私有模組 + 公開重匯出控制 API&lt;/li&gt;
&lt;li&gt;清晰的關注點分離&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-型別安全&#34;&gt;2. 型別安全&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;考慮使用 newtype 模式增加型別安全&lt;/li&gt;
&lt;li&gt;平衡抽象與簡潔性&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-並發處理&#34;&gt;3. 並發處理&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;識別臨界區（critical section）&lt;/li&gt;
&lt;li&gt;使用原子操作避免競爭條件&lt;/li&gt;
&lt;li&gt;選擇適當的同步原語（Mutex、RwLock 等）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-錯誤處理&#34;&gt;4. 錯誤處理&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;thiserror&lt;/code&gt; 定義清晰的錯誤類型&lt;/li&gt;
&lt;li&gt;區分可恢復與不可恢復的錯誤&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-日誌策略&#34;&gt;5. 日誌策略&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;CLI 輸出用 &lt;code&gt;println!&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;操作日誌用 &lt;code&gt;tracing&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;使用環境變數控制日誌級別&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-非同步選擇&#34;&gt;6. 非同步選擇&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;評估是否真的需要 async/await&lt;/li&gt;
&lt;li&gt;混合使用同步與非同步程式碼時要小心&lt;/li&gt;
&lt;li&gt;理解 &lt;code&gt;std::sync&lt;/code&gt; 與 &lt;code&gt;tokio::sync&lt;/code&gt; 的差異&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;擴充方向&#34;&gt;擴充方向&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;真正的非同步化：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;sqlx&lt;/code&gt; 或 &lt;code&gt;tokio-rusqlite&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;非同步的 &lt;code&gt;JobHandler&lt;/code&gt; trait&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;分散式支援：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 PostgreSQL 的 &lt;code&gt;SELECT FOR UPDATE SKIP LOCKED&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Redis 作為訊息佇列&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;監控與觀測：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus metrics&lt;/li&gt;
&lt;li&gt;分散式追蹤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;進階功能：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;延遲任務（scheduled jobs）&lt;/li&gt;
&lt;li&gt;任務優先順序調整&lt;/li&gt;
&lt;li&gt;動態 worker 擴縮容&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;結論&#34;&gt;結論&lt;/h2&gt;
&lt;p&gt;這個專案展示了如何使用 Rust 構建可靠的系統軟體。關鍵要點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;型別系統&lt;/strong&gt;讓我們在編譯期捕獲許多錯誤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;所有權模型&lt;/strong&gt;確保記憶體安全與執行緒安全&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Trait 系統&lt;/strong&gt;提供零成本抽象&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;並發原語&lt;/strong&gt;幫助我們正確處理競爭條件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Rust 的「如果編譯通過，通常就能正確運行」的特性，讓我們能夠自信地構建複雜的並發系統。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The future of AI coding</title>
      <link>https://blog.simplypatrick.com/posts/2025/12-39-ai-coding/</link>
      <pubDate>Tue, 30 Dec 2025 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2025/12-39-ai-coding/</guid>
      <description>&lt;p&gt;這兩篇文章確實形成了一個有趣且互補的觀點組合：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://bits.logic.inc/p/ai-is-forcing-us-to-write-good-code&#34;&gt;AI is forcing us to write good code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://codemanship.wordpress.com/2025/11/25/the-future-of-software-development-is-software-developers/&#34;&gt;The future of software development is software developers&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;核心互補性&#34;&gt;核心互補性&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Jason Gorman 的文章&lt;/strong&gt;（Codemanship）強調：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AI &lt;strong&gt;不會取代&lt;/strong&gt;程式設計師&lt;/li&gt;
&lt;li&gt;程式設計的難點在於&lt;strong&gt;將人類思維轉化為精確的計算思維&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;LLM 只是模式匹配，不真正理解代碼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Steve Krenzel 的文章&lt;/strong&gt;（Bits of Logic）則說明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AI 代理&lt;strong&gt;需要高品質的代碼環境才能有效工作&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;良好的實踐（測試、類型、文檔）從「可選」變成「必需」&lt;/li&gt;
&lt;li&gt;AI 會「放大代碼庫最糟糕的傾向」&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;三個層次的互補&#34;&gt;三個層次的互補&lt;/h2&gt;
&lt;h3 id=&#34;1-戰略層面的一致性&#34;&gt;1. &lt;strong&gt;戰略層面的一致性&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;兩位作者都認同：&lt;strong&gt;人類程式設計師仍然是核心&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Gorman：「當事情重要時，軟體開發人員會掌舵」&lt;/li&gt;
&lt;li&gt;Krenzel：「代理只有在你為它們創造的環境中才有效」&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這不是「AI vs 人類」的零和遊戲，而是&lt;strong&gt;人類定義規則，AI 在規則內執行&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;2-技術層面的呼應&#34;&gt;2. &lt;strong&gt;技術層面的呼應&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Gorman 指出 LLM 的根本限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不理解代碼，只做統計預測&lt;/li&gt;
&lt;li&gt;相同提示產生不同結果&lt;/li&gt;
&lt;li&gt;需要人類驗證輸出&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Krenzel 的解決方案正好針對這些限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;100% 代碼覆蓋率&lt;/strong&gt;：強制 AI 用可執行範例證明每一行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;強類型系統&lt;/strong&gt;：縮小 AI 的搜索空間，消除非法狀態&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;快速反饋循環&lt;/strong&gt;：保持 AI「在短繩上」，小改動→檢查→修復&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這實際上是在說：&lt;strong&gt;既然 AI 不理解代碼，我們就用機械化的護欄來約束它&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;3-實踐層面的轉化&#34;&gt;3. &lt;strong&gt;實踐層面的轉化&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Gorman 的悲觀預測：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;「LLM 實際上讓大多數團隊變慢，軟體更不可靠、更難維護」&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Krenzel 提供了避免這種情況的路徑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不是讓 AI 自由發揮，而是&lt;strong&gt;建立嚴格的自動化護欄&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;不是期待 AI 理解業務邏輯，而是&lt;strong&gt;通過類型和測試外化邏輯&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;不是一次性生成大量代碼，而是&lt;strong&gt;快速迭代、持續驗證&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;深層洞察ai-作為放大器&#34;&gt;深層洞察：AI 作為「放大器」&lt;/h2&gt;
&lt;p&gt;兩篇文章共同揭示了一個關鍵真理：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AI 不是替代品，而是放大器&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果你的代碼庫混亂、測試不足、類型鬆散 → AI 會放大這些問題（Gorman 的警告）&lt;/li&gt;
&lt;li&gt;如果你的代碼庫結構良好、測試完整、類型嚴格 → AI 會放大生產力（Krenzel 的承諾）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這解釋了為什麼：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Gorman 看到的失敗案例&lt;/strong&gt;：團隊試圖用 AI 彌補技術債，結果債務加倍&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Krenzel 看到的成功案例&lt;/strong&gt;：團隊先支付「技術稅」，然後用 AI 收穫紅利&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;對實踐的啟示&#34;&gt;對實踐的啟示&lt;/h2&gt;
&lt;p&gt;這兩篇文章合起來給出了一個完整的策略：&lt;/p&gt;
&lt;h3 id=&#34;短期現在&#34;&gt;短期（現在）&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;不要裁員程式設計師&lt;/strong&gt;（Gorman 的建議）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;投資於代碼品質基礎設施&lt;/strong&gt;（Krenzel 的路線圖）
&lt;ul&gt;
&lt;li&gt;建立 100% 測試覆蓋率&lt;/li&gt;
&lt;li&gt;遷移到強類型語言&lt;/li&gt;
&lt;li&gt;自動化所有可自動化的檢查&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;中期1-3-年&#34;&gt;中期（1-3 年）&lt;/h3&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;將 AI 視為「受監督的實習生」&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;可以處理重複性任務&lt;/li&gt;
&lt;li&gt;需要明確的規則和即時反饋&lt;/li&gt;
&lt;li&gt;不能做架構決策&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;長期3-年&#34;&gt;長期（3+ 年）&lt;/h3&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;重新定義「程式設計師」的角色&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;從「寫代碼」轉向「設計系統和護欄」&lt;/li&gt;
&lt;li&gt;從「實現功能」轉向「定義不變量和約束」&lt;/li&gt;
&lt;li&gt;更像「系統架構師 + 品質工程師」的混合體&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;一個有趣的悖論&#34;&gt;一個有趣的悖論&lt;/h2&gt;
&lt;p&gt;Krenzel 的文章標題是「AI 正在迫使我們寫好代碼」，但實際上：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AI 沒有迫使任何人做任何事&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;真正發生的是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;那些&lt;strong&gt;已經想寫好代碼&lt;/strong&gt;的團隊，發現 AI 給了他們一個絕佳的理由去說服管理層投資&lt;/li&gt;
&lt;li&gt;那些&lt;strong&gt;不想投資品質&lt;/strong&gt;的團隊，會發現 AI 讓情況變得更糟&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這與 Gorman 的觀察完全一致：&lt;strong&gt;AI 不會改變基本面，只會加速既有趨勢&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&#34;結論&#34;&gt;結論&lt;/h2&gt;
&lt;p&gt;這兩篇文章不是矛盾的，而是同一枚硬幣的兩面：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gorman 告訴我們「為什麼」&lt;/strong&gt;：為什麼 AI 不會取代程式設計師（因為難點不在語法）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Krenzel 告訴我們「如何」&lt;/strong&gt;：如何讓 AI 成為有效的工具（通過建立嚴格的環境）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;合在一起，它們描繪了一個清晰的未來：&lt;strong&gt;更多的程式設計師，寫更好的代碼，用 AI 處理繁瑣的部分&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;但這個未來不會自動到來——它需要有意識的投資和紀律。那些理解這一點的團隊會繁榮，那些不理解的會掙扎。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;您的團隊目前在這個光譜的哪個位置？您認為哪些「技術稅」最值得優先支付？&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>試用 Gemini 3 Pro</title>
      <link>https://blog.simplypatrick.com/posts/2025/11-20-gemini-3-pro/</link>
      <pubDate>Thu, 20 Nov 2025 01:45:01 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2025/11-20-gemini-3-pro/</guid>
      <description>&lt;p&gt;我使用 Gemini 3 Pro 和 Antigravity IDE 建立了 &lt;a href=&#34;https://github.com/p47t/rec.2020&#34;&gt;https://github.com/p47t/rec.2020&lt;/a&gt;。你可以在 &lt;a href=&#34;https://p47t.github.io/rec.2020/&#34;&gt;https://p47t.github.io/rec.2020/&lt;/a&gt; 查看已建立的應用程式。&lt;/p&gt;


  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2025/11-20-gemini-3-pro/rec.2020.png&#34; alt=&#34;rec.2020.png&#34; width=&#34;745&#34; height=&#34;1168&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;p&gt;以下是建構 &lt;a href=&#34;https://github.com/p47t/rec.2020&#34;&gt;https://github.com/p47t/rec.2020&lt;/a&gt; 的過程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;專案初始化&lt;/strong&gt;：我首先要求 Gemini「建立一個視覺化 Rec.2020 色域的 web 應用程式」。它立即使用基本的 canvas 實作建立了專案檔案。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;改進&lt;/strong&gt;：接著我要求更多改進來優化使用者介面。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;互動功能&lt;/strong&gt;：為了讓它更實用，我請求「在滑鼠移動時顯示座標」，Gemini 完美地實作了這個功能，並正確處理了座標轉換。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;色彩準確度&lt;/strong&gt;：我還要求修正不正確的 sRGB 色域檢查，並繪製 sRGB 三角形以便於驗證。Gemini 理解色彩科學的需求，並實作了正確的數學轉換，以便在 Rec.2020 空間內顯示 sRGB 三角形。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;部署&lt;/strong&gt;：最後，我要求一份「部署指南」，它便生成了一份包含詳細說明的 &lt;code&gt;DEPLOY.md&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;錯誤修復&lt;/strong&gt;：我發現了另一個由畫布縮放顯示引起的問題，導致顏色選擇不準確。Gemini 識別出了問題，並修復了座標計算以支援調整視窗大小。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;整個過程非常順暢。我幾乎不需要寫任何樣板程式碼。Gemini 3 Pro 同樣出色地理解高層次的意圖和複雜的領域知識（如色彩空間）。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Git 的痛點到未來：Jujutsu (jj)</title>
      <link>https://blog.simplypatrick.com/posts/2025/11-12-jujutsu/</link>
      <pubDate>Tue, 11 Nov 2025 17:11:34 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2025/11-12-jujutsu/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;AI 生成聲明：&lt;/strong&gt; 本文初稿由 Gemini 2.5 Flash AI 生成, 再由個人手動修改而成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Git 改變了世界，但也留下了無數「分支地獄」的故事。今天，我們將從兩個被低估的 Git 外掛工具開始，一步步引導你走向一個更現代、更人性化的版本控制未來 —— &lt;strong&gt;Jujutsu (jj)&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;引言git-的輝煌與隱憂&#34;&gt;引言：Git 的輝煌與隱憂&lt;/h2&gt;
&lt;p&gt;你是否曾經：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;為了改一個 typo，敲了 &lt;code&gt;git rebase -i HEAD~5&lt;/code&gt;，然後工作目錄瞬間爆炸？&lt;/li&gt;
&lt;li&gt;在 10 個依賴分支之間切來切去，忘記自己正在做什麼？&lt;/li&gt;
&lt;li&gt;看著 &lt;code&gt;git log&lt;/code&gt; 像聖誕樹一樣亂七八糟，卻無從下手？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Git 無疑是偉大的，但它的設計來自 2005 年。那個年代沒有 stacked diff、沒有 PR stack、沒有即時 CI。&lt;br&gt;
今天，我們需要的不只是「能用」，而是「好用」。&lt;/p&gt;
&lt;p&gt;這篇文章將帶你走過一條&lt;strong&gt;進化之路&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph LR
    A[git-revise] --&gt; B[git-branchstack] --&gt; C[Jujutsu]
    style C fill:#6c5ce7,stroke:#333,color:#fff
    style A fill:#fab1a0
    style B fill:#fdcb6e
  &lt;/div&gt;

&lt;p&gt;從小修小補，到系統性革新。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;第一站git-revise--讓歷史編輯不再破壞&#34;&gt;第一站：&lt;code&gt;git-revise&lt;/code&gt; —— 讓歷史編輯不再「破壞」&lt;/h2&gt;
&lt;h3 id=&#34;問題git-rebase-的副作用&#34;&gt;問題：&lt;code&gt;git rebase&lt;/code&gt; 的副作用&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git rebase -i HEAD~3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 衝突！工作目錄被打斷，stash 忘記了，崩潰中...&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;rebase&lt;/code&gt; 雖然能重寫歷史，但它會&lt;strong&gt;強制中斷你的工作流&lt;/strong&gt;。&lt;/p&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph TD
    subgraph &#34;Git rebase 問題&#34;
        A[工作目錄] --&gt; B[rebase 開始]
        B --&gt; C[衝突中斷]
        C --&gt; D[stash / reset]
        D --&gt; A
    end
    style C fill:#e17055,stroke:#333,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖1：傳統 &lt;code&gt;git rebase&lt;/code&gt; 常導致工作流循環中斷&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;解法git-revise&#34;&gt;解法：&lt;code&gt;git-revise&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;git-revise&lt;/code&gt; 是 Git 的子命令，專注於&lt;strong&gt;非破壞性提交編輯&lt;/strong&gt;。它在記憶體中操作，&lt;strong&gt;不影響工作目錄&lt;/strong&gt;。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 安裝&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pipx install git-revise
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 修復最近一個 commit 的拼字錯誤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Fix typo in login button&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 分割最後一個大 commit 成兩個小塊&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise --split&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    graph LR
    subgraph &#34;git-revise 流程&#34;
        A[記憶體中編輯] --&gt; B[更新 commit]
        B --&gt; C[工作目錄不變]
        C --&gt; A
    end
    style B fill:#00b894,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖2：&lt;code&gt;git-revise&lt;/code&gt; 在記憶體中安全編輯，工作流不中斷&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;靈感來源&lt;/strong&gt;：&lt;code&gt;git-revise&lt;/code&gt; 是 jj 創始人 &lt;strong&gt;Martin von Zweigbergk&lt;/strong&gt; 早期作品之一。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;它讓「修補歷史」從痛苦變成愉悅，但它只解決了&lt;strong&gt;單點問題&lt;/strong&gt;。分支管理呢？還是一團亂。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;第二站git-branchstack--分支堆疊的魔法&#34;&gt;第二站：&lt;code&gt;git-branchstack&lt;/code&gt; —— 分支堆疊的魔法&lt;/h2&gt;
&lt;h3 id=&#34;問題分支依賴地獄&#34;&gt;問題：分支依賴地獄&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 手動流程&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout -b feature/login
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ... coding ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout -b feature/login-validation  &lt;span style=&#34;color:#75715e&#34;&gt;# 依賴 login&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout feature/login
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 切來切去，build 重跑，頭暈&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;在團隊使用 &lt;strong&gt;stacked diff&lt;/strong&gt;（如 Gerrit、Phabricator）時，這種切換簡直是災難。&lt;/p&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph TD
    A[main] --&gt; B[feature/login]
    B --&gt; C[feature/login-validation]
    C --&gt; B
    B --&gt; D[feature/other]
    style B fill:#fd79a8
    style C fill:#fd79a8
    style D fill:#fd79a8
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖3：傳統 Git 分支切換形成雜亂的依賴網&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;解法git-branchstack&#34;&gt;解法：&lt;code&gt;git-branchstack&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;這是一個&lt;strong&gt;輕量級堆疊分支管理器&lt;/strong&gt;，核心概念：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;用 commit message 的 &lt;code&gt;[topic]&lt;/code&gt; tag 自動建立分支堆疊&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;安裝&#34;&gt;安裝&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pipx install git-branchstack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pipx install git-revise  &lt;span style=&#34;color:#75715e&#34;&gt;# 建議一起用&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;實戰範例&#34;&gt;實戰範例&lt;/h4&gt;
&lt;p&gt;假設你在 &lt;code&gt;local-dev&lt;/code&gt; 分支上有 3 個 commits：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 用 git-revise 加上 topic tags&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise --interactive --edit&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;編輯後的 commit message：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[auth] Add login endpoint
[auth] Validate JWT token
[ui] Update login button style&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;執行：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git branchstack&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    gitGraph
   commit id: &#34;main&#34;
   branch auth
   checkout auth
   commit id: &#34;Add login&#34;
   commit id: &#34;Validate JWT&#34;
   branch ui
   checkout ui
   commit id: &#34;Update button&#34;
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖4：&lt;code&gt;git branchstack&lt;/code&gt; 自動建立清晰的堆疊結構&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;推送整個堆疊&#34;&gt;推送整個堆疊&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 設定 alias 更方便&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git config alias.bspush &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;!git push -u origin $(git branchstack --list-local)&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git bspush&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;來源：&lt;a href=&#34;https://github.com/krobelus/git-branchstack&#34;&gt;git-branchstack GitHub&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;它讓「分支堆疊」從手動變成自動，但它仍是 &lt;strong&gt;Git 的外掛&lt;/strong&gt;，無法改變核心體驗。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;高潮jujutsu-jj--版本控制的未來已來&#34;&gt;高潮：Jujutsu (jj) —— 版本控制的未來已來&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;jj = git-revise 的靈魂 + git-branchstack 的堆疊 + Git 的相容性 + 全新設計&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;由 Google 工程師 &lt;strong&gt;Martin von Zweigbergk&lt;/strong&gt; 開發，jj 已在 Google 內部逐步取代舊 VCS。&lt;/p&gt;
&lt;h3 id=&#34;核心創新對比&#34;&gt;核心創新對比&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;概念&lt;/th&gt;
          &lt;th&gt;Git&lt;/th&gt;
          &lt;th&gt;jj&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;提交單位&lt;/td&gt;
          &lt;td&gt;不可變 commit&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;可變 change&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;歷史追蹤&lt;/td&gt;
          &lt;td&gt;線性 log&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;操作日誌 (operation log)&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;分支管理&lt;/td&gt;
          &lt;td&gt;手動切換&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;自動書籤 + 堆疊&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;衝突處理&lt;/td&gt;
          &lt;td&gt;手動&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;內建多方解析器&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;相容性&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;100% Git 互通&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph LR
    subgraph &#34;jj 核心模型&#34;
        C[Change] --&gt; O[Operation Log]
        C --&gt; B[Bookmarks]
        B --&gt; G[Git 互通]
    end
    style C fill:#6c5ce7,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖5：jj 的 changes + bookmarks + operation log 核心架構&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;關鍵特性一changes-而非-commits&#34;&gt;關鍵特性一：&lt;strong&gt;Changes 而非 Commits&lt;/strong&gt;&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# jj：提交是「活的」&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new               &lt;span style=&#34;color:#75715e&#34;&gt;# 創建新 change&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fix&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; file   &lt;span style=&#34;color:#75715e&#34;&gt;# 修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj amend             &lt;span style=&#34;color:#75715e&#34;&gt;# 更新當前 change（像 git amend）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj split             &lt;span style=&#34;color:#75715e&#34;&gt;# 輕鬆分割 change&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    graph LR
    A[原始 change] --&gt; B[jj amend]
    B --&gt; C[更新後 change]
    C --&gt; A
    style B fill:#00b894,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖6：&lt;code&gt;jj amend&lt;/code&gt; 即時更新 change，無需 rebase&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;所有操作都在記憶體中，&lt;strong&gt;不中斷工作流&lt;/strong&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id=&#34;關鍵特性二操作日誌-operation-log&#34;&gt;關鍵特性二：&lt;strong&gt;操作日誌 (Operation Log)&lt;/strong&gt;&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj op log&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@  abc123  2分鐘前  new change
├─ def456  5分鐘前  amend change
├─ ghi789  10分鐘前 rebase -d main&lt;/code&gt;&lt;/pre&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    graph TD
    A[rebase -d main] --&gt; B[amend change]
    B --&gt; C[new change]
    style C fill:#6c5ce7,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖7：&lt;code&gt;jj op log&lt;/code&gt; 提供完整操作歷史，永不迷路&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;你永遠知道「系統怎麼變成這樣的」。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;關鍵特性三自動堆疊書籤進階版&#34;&gt;關鍵特性三：&lt;strong&gt;自動堆疊書籤（進階版）&lt;/strong&gt;&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 從 main 開始&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new main -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[auth] Add login&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj bookmark create auth   &lt;span style=&#34;color:#75715e&#34;&gt;# 手動標記（僅此一次）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 繼續堆疊&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[ui] Update button&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj bookmark create ui     &lt;span style=&#34;color:#75715e&#34;&gt;# 標記上層&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;jj log 顯示&lt;/strong&gt;：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ jj log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;@  ooo  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;ui&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Update login button
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│  │   &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;你正在編輯&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├─ ooo  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;auth&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Add login endpoint
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│  │
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;○──○──○ main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    gitGraph
   commit id: &#34;main&#34;
   branch auth
   checkout auth
   commit id: &#34;Add login&#34;
   branch ui
   checkout ui
   commit id: &#34;Update button&#34;
   checkout main
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖8：&lt;code&gt;jj log&lt;/code&gt; 內建堆疊視覺化，無需額外工具&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;小提醒&lt;/strong&gt;：bookmark 需手動 &lt;code&gt;create&lt;/code&gt;，但一旦建立，後續 &lt;code&gt;amend&lt;/code&gt;/&lt;code&gt;rebase&lt;/code&gt; 會&lt;strong&gt;自動移動上層&lt;/strong&gt;，無需手動調整。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;推送整個堆疊-1&#34;&gt;推送整個堆疊&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git push --all-bookmarks&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;h3 id=&#34;對比git-vs-jj-的-rebase&#34;&gt;對比：Git vs jj 的 rebase&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;動作&lt;/th&gt;
          &lt;th&gt;Git&lt;/th&gt;
          &lt;th&gt;jj&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;重新基於 main&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;git rebase main&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;jj rebase -d main&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;工作目錄中斷？&lt;/td&gt;
          &lt;td&gt;是&lt;/td&gt;
          &lt;td&gt;否&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;歷史可回溯？&lt;/td&gt;
          &lt;td&gt;靠 reflog&lt;/td&gt;
          &lt;td&gt;內建 op log&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;分支堆疊保留？&lt;/td&gt;
          &lt;td&gt;手動&lt;/td&gt;
          &lt;td&gt;自動&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph LR
    subgraph &#34;Git rebase&#34;
        G1[main] --&gt; G2[feature]
        G2 --&gt; G3[rebase 後]
        style G3 fill:#e17055
    end
    subgraph &#34;jj rebase&#34;
        J1[main] --&gt; J2[auth]
        J2 --&gt; J3[ui]
        J3 --&gt; J4[自動調整]
        style J4 fill:#00b894,color:#fff
    end
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖9：jj rebase 自動調整堆疊，Git 需手動修補&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;實戰30-秒上手-jj&#34;&gt;實戰：30 秒上手 jj&lt;/h2&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. 安裝（需要 Rust）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install jj
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. 從現有 Git repo 啟動&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd my-project
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 3. 開始使用&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fix typo&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; file
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj amend
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git push&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;div class=&#34;mermaid&#34;&gt;
    graph TD
    A[安裝 jj] --&gt; B[初始化 repo]
    B --&gt; C[開始使用]
    C --&gt; D[無痛 amend]
    style D fill:#6c5ce7,color:#fff
  &lt;/div&gt;

&lt;p&gt;&lt;em&gt;圖10：從 Git 遷移到 jj 的 3 步流程&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;官方文檔：&lt;a href=&#34;https://github.com/jj-vcs/jj&#34;&gt;github.com/jj-vcs/jj&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&#34;結論擁抱進化別讓工具綁住你&#34;&gt;結論：擁抱進化，別讓工具綁住你&lt;/h2&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;工具&lt;/th&gt;
          &lt;th&gt;定位&lt;/th&gt;
          &lt;th&gt;適合對象&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;git-revise&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;局部修補&lt;/td&gt;
          &lt;td&gt;想提升 rebase 體驗&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;git-branchstack&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;堆疊管理&lt;/td&gt;
          &lt;td&gt;stacked diff 團隊&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Jujutsu (jj)&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;全面替代&lt;/td&gt;
          &lt;td&gt;追求未來 VCS 的人&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

  &lt;div class=&#34;mermaid&#34;&gt;
    graph TD
    A[痛苦的 Git 日常] --&gt; B[嘗試 git-revise]
    B --&gt; C[愛上 git-branchstack]
    C --&gt; D[擁抱 Jujutsu]
    style D fill:#6c5ce7,stroke:#333,color:#fff
  &lt;/div&gt;

&lt;p&gt;從 &lt;code&gt;git-revise&lt;/code&gt; 的小修小補，到 &lt;code&gt;git-branchstack&lt;/code&gt; 的分支魔法，&lt;strong&gt;jj 將這些碎片融為一體&lt;/strong&gt;，開啟版本控制的新紀元。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;下次 &lt;code&gt;rebase&lt;/code&gt; 讓你崩潰時，試試 &lt;code&gt;jj&lt;/code&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;你不會想回去的。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;行動呼籲&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;現在就試試：&lt;code&gt;cargo install jj&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;從你的 Git repo 匯入：&lt;code&gt;jj git init&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;留言分享你的第一個 &lt;code&gt;jj amend&lt;/code&gt; 體驗！&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;本文作者使用 jj 撰寫，無 rebase 崩潰，僅有快樂。&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>版本控制的個人效率追尋</title>
      <link>https://blog.simplypatrick.com/posts/2025/11-11-jujutsu/</link>
      <pubDate>Tue, 11 Nov 2025 02:58:58 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2025/11-11-jujutsu/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;AI 生成聲明：&lt;/strong&gt; 本文初稿由 &lt;strong&gt;Claude AI Sonnect 4.5 模型&lt;/strong&gt; 生成, 再由個人手動修改而成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;前言git-工作流的痛點&#34;&gt;前言：Git 工作流的痛點&lt;/h2&gt;
&lt;p&gt;當我們使用 Git 進行開發時, 經常會遇到這些情況:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;想修改歷史 commit, 需要用 &lt;code&gt;git rebase -i&lt;/code&gt; 進入互動模式&lt;/li&gt;
&lt;li&gt;管理多個相關的 feature branches, 需要手動追蹤分支間的依賴關係&lt;/li&gt;
&lt;li&gt;不小心改錯了想回到之前的狀態, 得靠 &lt;code&gt;git reflog&lt;/code&gt; 救援&lt;/li&gt;
&lt;li&gt;Commit 之後才發現忘記加檔案, 又要 &lt;code&gt;git commit --amend&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這些操作雖然強大, 但往往需要記住複雜的命令組合, 對新手不友善。更重要的是, 它們打斷了開發者的思考流程, 讓人把注意力從「解決問題」轉移到「操作工具」。&lt;/p&gt;
&lt;p&gt;對於追求高效工作流的開發者來說, 這些摩擦累積起來是不可忽視的時間成本。於是, 一些人開始探索更符合自己工作習慣的版本控制方式&amp;hellip;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;第一步git-revise--簡化歷史編輯&#34;&gt;第一步：git-revise — 簡化歷史編輯&lt;/h2&gt;
&lt;h3 id=&#34;誕生背景&#34;&gt;誕生背景&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;git-revise&lt;/code&gt; 是為了解決 &lt;code&gt;git rebase -i&lt;/code&gt; 的複雜性而生。對於經常需要修改 commit 歷史的開發者來說, 互動式 rebase 的流程實在太繁瑣了。git-revise 提供了更直接的方式來達成同樣的目標。&lt;/p&gt;
&lt;h3 id=&#34;核心特點&#34;&gt;核心特點&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 傳統 git rebase 的方式&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git rebase -i HEAD~3  &lt;span style=&#34;color:#75715e&#34;&gt;# 進入編輯器, 標記 edit/reword/squash...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# git-revise 的方式&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. 先修改檔案&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim some_file.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. Stage 你的修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git add some_file.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 3. 應用到目標 commit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise &amp;lt;commit-hash&amp;gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 將 staged changes 應用到該 commit&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;優勢&#34;&gt;優勢&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;更安全&lt;/strong&gt;: 自動保留原始狀態,隨時可以恢復&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;更直覺&lt;/strong&gt;: 直接操作目標 commit,不需要互動式編輯器&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;避免衝突&lt;/strong&gt;: 智能處理 commit 間的依賴關係&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;限制&#34;&gt;限制&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;仍然基於 Git 的 branch 模型&lt;/li&gt;
&lt;li&gt;無法徹底解決多分支管理的複雜性&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;第二步git-branchstack--branchless-工作流的個人實踐&#34;&gt;第二步：git-branchstack — Branchless 工作流的個人實踐&lt;/h2&gt;
&lt;h3 id=&#34;為什麼需要它&#34;&gt;為什麼需要它？&lt;/h3&gt;
&lt;p&gt;許多開發者發現, 傳統的「一個 feature 一個 branch」模式在實際工作中很不順手:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每次切換 branch 都要重新 build&lt;/li&gt;
&lt;li&gt;多個相關的 PR 需要手動維護依賴關係&lt;/li&gt;
&lt;li&gt;在不同 branch 間來回跳轉打斷思緒&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;git-branchstack 是一個個人效率工具, 讓你能用更自然的方式工作: 所有開發都在一個 branch 上進行, 只在需要提交 PR 時才生成對應的分支。&lt;/p&gt;
&lt;h3 id=&#34;問題場景&#34;&gt;問題場景&lt;/h3&gt;
&lt;p&gt;你想在&lt;strong&gt;單一分支&lt;/strong&gt;上開發多個功能, 每個功能對應一個 PR:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;功能 A: 重構 authentication&lt;/li&gt;
&lt;li&gt;功能 B: 新增 profile 頁面 (依賴 A)&lt;/li&gt;
&lt;li&gt;功能 C: 一個無關的 bugfix&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;傳統做法需要:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;為每個功能建立獨立分支&lt;/li&gt;
&lt;li&gt;在分支間來回切換&lt;/li&gt;
&lt;li&gt;每次切換都重新 build, 浪費時間&lt;/li&gt;
&lt;li&gt;手動管理分支間的依賴關係&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;git-branchstack-的創新解法&#34;&gt;git-branchstack 的創新解法&lt;/h3&gt;
&lt;p&gt;git-branchstack 讓你&lt;strong&gt;留在本地分支&lt;/strong&gt;, 用 commit message 的標籤來標記主題:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 在本地分支上正常開發&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[auth-refactor] Update login logic&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[auth-refactor] Add JWT support&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[profile-page:auth-refactor] Add profile component&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[bugfix-123] Fix memory leak&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 一行命令生成所有分支&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git branchstack&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這會自動生成:&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;* local-branch (HEAD)
|   - [bugfix-123] Fix memory leak
|   - [profile-page:auth-refactor] Add profile component  
|   - [auth-refactor] Add JWT support
|   - [auth-refactor] Update login logic
|
|-- bugfix-123 (branch)
|     - Fix memory leak
|
|-- profile-page (branch)
|     - Add profile component
|     (based on auth-refactor)
|
|-- auth-refactor (branch)
      - Add JWT support
      - Update login logic&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;核心概念&#34;&gt;核心概念&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;標籤語法&lt;/strong&gt;: &lt;code&gt;[topic]&lt;/code&gt; 或 &lt;code&gt;[topic:dependency]&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;[auth-refactor]&lt;/code&gt; - 獨立主題&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[profile:auth-refactor]&lt;/code&gt; - profile 依賴 auth-refactor&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Branchless 開發體驗&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有工作在一個分支上進行&lt;/li&gt;
&lt;li&gt;不需要切換分支, build 不會失效&lt;/li&gt;
&lt;li&gt;修改任何 commit 後, 重跑 &lt;code&gt;git branchstack&lt;/code&gt; 更新所有分支&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;利用 git-revise&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;底層使用 git-revise, 不碰工作目錄&lt;/li&gt;
&lt;li&gt;速度快, 不影響正在進行的工作&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;實際工作流&#34;&gt;實際工作流&lt;/h3&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. 開發階段 - 在本地分支上自由開發&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[feature-A] Implement part 1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[feature-A] Implement part 2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[feature-B:feature-A] Build on A&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. 需要修改之前的 commit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise --interactive --edit  &lt;span style=&#34;color:#75715e&#34;&gt;# 編輯 commit message 加標籤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise &amp;lt;commit-hash&amp;gt;          &lt;span style=&#34;color:#75715e&#34;&gt;# 或直接修改內容&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 3. 生成/更新分支用於 PR&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git branchstack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 4. 推送到 GitHub&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git push origin feature-A
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git push origin feature-B&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;優勢與限制&#34;&gt;優勢與限制&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;優勢&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;真正的 branchless 體驗, 留在本地分支工作&lt;/li&gt;
&lt;li&gt;自動處理依賴關係&lt;/li&gt;
&lt;li&gt;支援 git rerere 記住衝突解決方案&lt;/li&gt;
&lt;li&gt;永不修改工作目錄, 不影響 build&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;限制&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;需要在 commit message 中手動標記主題&lt;/li&gt;
&lt;li&gt;依賴關係的改變需要修改 commit message&lt;/li&gt;
&lt;li&gt;作者本人已轉向 Jujutsu (根據 &lt;a href=&#34;https://github.com/krobelus/git-branchstack&#34;&gt;git-branchstack README&lt;/a&gt;, 作者表示 &lt;a href=&#34;https://github.com/jj-vcs/jj&#34;&gt;jj&lt;/a&gt; 提供了更乾淨和強大的解決方案)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;革命性轉變jujutsu-jj--重新定義個人版本控制體驗&#34;&gt;革命性轉變：Jujutsu (jj) — 重新定義個人版本控制體驗&lt;/h2&gt;
&lt;h3 id=&#34;為什麼誕生&#34;&gt;為什麼誕生？&lt;/h3&gt;
&lt;p&gt;即使有了 git-revise 和 git-branchstack 這些工具, Git 的基礎模型仍然存在根本性的摩擦。Jujutsu 的作者 Martin von Zweigbergk (同時也是 Google 內部版本控制系統的開發者) 決定: 與其不斷在 Git 上打補丁, 不如從頭設計一個真正符合現代工作流的版本控制系統。&lt;/p&gt;
&lt;p&gt;這不是為了取代 Git 成為「標準」, 而是為追求極致效率的個人開發者提供更好的選擇。&lt;/p&gt;
&lt;h3 id=&#34;核心理念轉變&#34;&gt;核心理念轉變&lt;/h3&gt;
&lt;p&gt;Jujutsu 不是在 Git 上加工具, 而是&lt;strong&gt;重新思考版本控制該是什麼樣子&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Change-based, 而非 Commit-based&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每個修改都是一個獨立的 &amp;ldquo;change&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Change 可以隨時修改, 不需要 amend 或 rebase&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Working Copy 即 Commit&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;你的工作目錄就是一個 commit&lt;/li&gt;
&lt;li&gt;不需要 &lt;code&gt;git add&lt;/code&gt; + &lt;code&gt;git commit&lt;/code&gt; 兩階段&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;真正的非線性歷史&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不需要 branch 也能管理多條開發線&lt;/li&gt;
&lt;li&gt;衝突作為一等公民存在於歷史中&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;實際操作對比&#34;&gt;實際操作對比&lt;/h3&gt;
&lt;h4 id=&#34;場景一修改歷史-commit&#34;&gt;場景一：修改歷史 Commit&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Git 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git rebase -i HEAD~3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 標記要修改的 commit 為 &amp;#39;edit&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 進行修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git add .
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit --amend
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git rebase --continue&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;git-revise 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 進行修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim some_file.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Stage 修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git add some_file.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 應用到目標 commit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise &amp;lt;commit-hash&amp;gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 直接更新該 commit&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Jujutsu 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj edit &amp;lt;change-id&amp;gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 直接切換到該 change&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 進行修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;updated&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 自動更新該 change&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;場景二管理多個功能開發&#34;&gt;場景二：管理多個功能開發&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;傳統 Git 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout -b feature-A
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發 feature-A&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout -b feature-B
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發 feature-B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 要修改 A 時&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout feature-A
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit --amend
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout feature-B
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git rebase feature-A  &lt;span style=&#34;color:#75715e&#34;&gt;# 手動 rebase&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;git-branchstack 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 所有工作在本地分支進行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[feature-A] Implement A&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[feature-B:feature-A] Implement B&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 生成分支&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git branchstack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 要修改 A 時&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git add modified_files
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git revise &amp;lt;commit-hash-of-A&amp;gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 修改 A 的 commit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 重新生成分支, 自動處理依賴&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git branchstack&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Jujutsu 方式:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 不需要建立 branch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;feature A&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 創建新 change&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發 feature A&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;feature B&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 基於當前創建新 change&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發 feature B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 要修改 A 時&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj edit &amp;lt;change-A-id&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 修改完自動處理依賴&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;jujutsu-的核心特性&#34;&gt;Jujutsu 的核心特性&lt;/h3&gt;
&lt;h4 id=&#34;1-自動追蹤所有歷史&#34;&gt;1. 自動追蹤所有歷史&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj op log  &lt;span style=&#34;color:#75715e&#34;&gt;# 查看所有操作歷史&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj op undo  &lt;span style=&#34;color:#75715e&#34;&gt;# 撤銷任何操作&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj op restore  &lt;span style=&#34;color:#75715e&#34;&gt;# 恢復到任何時間點&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;不需要 &lt;code&gt;git reflog&lt;/code&gt;, 所有操作都可追溯和回復。&lt;/p&gt;
&lt;h4 id=&#34;2-衝突處理的新思路&#34;&gt;2. 衝突處理的新思路&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Jujutsu 讓你可以 commit 帶有衝突的狀態&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new  &lt;span style=&#34;color:#75715e&#34;&gt;# 即使有衝突也能繼續開發&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj resolve  &lt;span style=&#34;color:#75715e&#34;&gt;# 稍後解決衝突&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;3-與-git-無縫協作&#34;&gt;3. 與 Git 無縫協作&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Jujutsu 可以操作 Git repo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git clone &amp;lt;url&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git push
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git fetch
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 現有 Git repo 也能用 jj&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd my-git-repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj init --git-repo .&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;h2 id=&#34;為什麼-jujutsu-是個人效率工具的終極形態&#34;&gt;為什麼 Jujutsu 是個人效率工具的終極形態？&lt;/h2&gt;
&lt;h3 id=&#34;心智模型更簡單&#34;&gt;心智模型更簡單&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Git&lt;/strong&gt;: Branch → Stage → Commit → Push → Rebase → Merge&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Jujutsu&lt;/strong&gt;: Change → Edit → Evolve&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;對於個人開發者來說, 這意味著更少的認知負擔, 更多的時間專注在實際問題上。&lt;/p&gt;
&lt;h3 id=&#34;更安全的實驗&#34;&gt;更安全的實驗&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;所有操作都可以輕鬆撤銷&lt;/li&gt;
&lt;li&gt;不需要擔心「搞壞」歷史&lt;/li&gt;
&lt;li&gt;鼓勵更頻繁的實驗和重構&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;更適合現代個人工作流&#34;&gt;更適合現代個人工作流&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Code Review 驅動的開發&lt;/li&gt;
&lt;li&gt;頻繁的 Commit 修改&lt;/li&gt;
&lt;li&gt;多個 PR 同時進行&lt;/li&gt;
&lt;li&gt;不需要團隊統一工具 (可以單人使用 jj, 推送時轉為 Git)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;實戰案例用-jujutsu-管理-feature-stack&#34;&gt;實戰案例：用 Jujutsu 管理 Feature Stack&lt;/h2&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 初始化&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git clone https://github.com/user/repo.git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 創建第一個功能&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Add user authentication&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj describe -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Add login form and validation&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 基於此創建第二個功能&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Add user profile page&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 創建第三個功能&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj new -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Add profile editing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 開發...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 查看當前狀態&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 發現第一個功能需要修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj edit &amp;lt;auth-change-id&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 修改...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj describe -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Updated authentication logic&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 自動處理後續依賴, 不需要手動 rebase!&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 推送到 GitHub&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jj git push --change &amp;lt;change-id&amp;gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# 為每個 change 推送對應分支&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;學習曲線&#34;&gt;學習曲線&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;現有 Git 用戶&lt;/strong&gt;: 可以繼續在 Git repo 中使用 &lt;code&gt;jj&lt;/code&gt;, 逐步適應&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;新專案&lt;/strong&gt;: 直接用 &lt;code&gt;jj git init&lt;/code&gt; 開始, 享受完整體驗&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;團隊協作&lt;/strong&gt;: 個人可以用 jj 提升效率, 推送時轉換為 Git, 不影響團隊其他成員&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;這是一個&lt;strong&gt;個人選擇&lt;/strong&gt;, 不需要說服整個團隊改變工作流程。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;結語效率工具的個人化旅程&#34;&gt;結語：效率工具的個人化旅程&lt;/h2&gt;
&lt;p&gt;從 &lt;code&gt;git-revise&lt;/code&gt; 到 &lt;code&gt;git-branchstack&lt;/code&gt;, 再到 Jujutsu, 這是一段持續追求更高效率的旅程。每個工具都代表了開發者對「版本控制應該如何輔助我的工作」的不同思考。&lt;/p&gt;
&lt;p&gt;這些工具的共同點是:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;它們都是&lt;strong&gt;個人效率工具&lt;/strong&gt;, 不需要整個團隊採用&lt;/li&gt;
&lt;li&gt;它們都在挑戰 Git 的既有模式&lt;/li&gt;
&lt;li&gt;它們都專注於減少摩擦, 讓開發者更專注於解決問題&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Jujutsu 的特別之處在於, 它不只是改善 Git 的某個面向, 而是重新思考了整個版本控制的心智模型。對於願意投資學習新工具來提升長期效率的開發者來說, 它可能是最佳選擇。&lt;/p&gt;
&lt;p&gt;最重要的是: &lt;strong&gt;這是一個個人選擇&lt;/strong&gt;。你不需要等待團隊共識, 不需要說服所有人。如果 Git 的複雜性讓你感到疲憊, 如果你想要更流暢的開發體驗, 那就試試這些工具吧。&lt;/p&gt;
&lt;p&gt;或許你會發現, 提升效率的關鍵不是更努力地使用現有工具, 而是找到更適合你的工具。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;延伸資源&#34;&gt;延伸資源&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jj-vcs.github.io/jj/latest/&#34;&gt;Jujutsu 官方文檔&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/jj-vcs/jj&#34;&gt;Jujutsu GitHub Repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jj-vcs.github.io/jj/latest/git-comparison/&#34;&gt;從 Git 遷移到 Jujutsu 指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://discord.gg/dkmfj3aGQN&#34;&gt;Jujutsu Discord 社群&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://steveklabnik.github.io/jujutsu-tutorial/&#34;&gt;Steve Klabnik 的 Jujutsu 教程&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;試試看,你可能再也回不去 Git 了! 🚀&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>版本控制的「柔術」🥋</title>
      <link>https://blog.simplypatrick.com/posts/2025/11-10-jujutsu/</link>
      <pubDate>Mon, 10 Nov 2025 00:00:00 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2025/11-10-jujutsu/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;AI 生成聲明：&lt;/strong&gt; 本文初稿由 &lt;strong&gt;Gemini AI 2.5 Flash 模型&lt;/strong&gt; 生成, 再由個人手動修改而成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;從-git-修訂工具到-jujutsu-的優雅進化&#34;&gt;從 Git 修訂工具到 Jujutsu 的優雅進化&lt;/h1&gt;
&lt;p&gt;許多資深開發者都對 &lt;strong&gt;Git&lt;/strong&gt; 的強大功能愛恨交織。它強大, 但某些操作（特別是修改歷史和管理一系列依賴的變更時）卻異常複雜, 像是 &lt;code&gt;git rebase -i&lt;/code&gt; 這樣的指令既是利器, 也常是困擾的源頭。&lt;/p&gt;
&lt;p&gt;我們將探討一種更優雅、更直覺的版本控制解決方案：&lt;strong&gt;Jujutsu (jj)&lt;/strong&gt;。它並不是要取代 Git, 而是作為一個建立在 Git 基礎上的現代化前端, 帶來革命性的工作流程。&lt;/p&gt;
&lt;h2 id=&#34;第一階段git-生態系統的修補與嘗試&#34;&gt;第一階段：Git 生態系統的修補與嘗試&lt;/h2&gt;
&lt;p&gt;在 &lt;strong&gt;Jujutsu&lt;/strong&gt; 誕生之前, 許多工具試圖修補 Git 的「歷史修改」痛點。這些嘗試為 &lt;code&gt;jj&lt;/code&gt; 的核心設計奠定了基礎。&lt;/p&gt;
&lt;h3 id=&#34;痛點一修訂歷史的麻煩---git-revise-的出現&#34;&gt;痛點一：修訂歷史的麻煩 - &lt;strong&gt;git-revise&lt;/strong&gt; 的出現&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;問題：&lt;/strong&gt; 在 Git 中修改一個比較舊的 commit, 你需要用 &lt;code&gt;git rebase -i&lt;/code&gt;, 找到那一行, 將 &lt;code&gt;pick&lt;/code&gt; 改成 &lt;code&gt;edit&lt;/code&gt;, 修改後再 &lt;code&gt;git commit --amend&lt;/code&gt;, 最後 &lt;code&gt;git rebase --continue&lt;/code&gt;。過程繁瑣且容易出錯。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;解決方案的萌芽：&lt;/strong&gt; 像 &lt;a href=&#34;https://github.com/git-revise/git-revise&#34;&gt;git-revise&lt;/a&gt; 這樣的工具, 讓修訂一個舊 commit 變得更簡單, 通常只需一個指令, 就能自動處理中斷和繼續的步驟。它證明了「&lt;strong&gt;歷史修訂可以更簡單&lt;/strong&gt;」的可能性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;痛點二依賴變更的管理---git-branchstack-的概念&#34;&gt;痛點二：依賴變更的管理 - &lt;strong&gt;git-branchstack&lt;/strong&gt; 的概念&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;問題：&lt;/strong&gt; 當你在一個功能上提交了多個依賴的 commits, 如果底層重構的 commit 需要修改, 後續所有 commits 都需要手動 &lt;code&gt;rebase&lt;/code&gt;, 或者面對重複的衝突解決。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;解決方案的探索：&lt;/strong&gt; &lt;a href=&#34;https://github.com/krobelus/git-branchstack&#34;&gt;git-branchstack&lt;/a&gt; 等工具, 嘗試建立一個「堆疊式分支」的概念, 讓開發者能更清楚地追蹤和操作一系列相互依賴的變更。這突顯了開發者對「&lt;strong&gt;自動化處理變基&lt;/strong&gt;」的渴望。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;第二階段jujutsu-的誕生與核心概念&#34;&gt;第二階段：Jujutsu 的誕生與核心概念&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://jj-vcs.github.io/jj/latest/&#34;&gt;Jujutsu&lt;/a&gt; 正是吸收了這些工具的經驗和願景, 將其融入一個全新的版本控制系統介面中。它重新定義了幾個核心概念：&lt;/p&gt;
&lt;h3 id=&#34;核心概念一工作區即提交-working-copy-is-a-commit&#34;&gt;核心概念一：工作區即提交 (Working Copy is a Commit)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;告別暫存區 (Staging Area)：&lt;/strong&gt; 在 &lt;code&gt;jj&lt;/code&gt; 中, 你的工作目錄狀態&lt;strong&gt;永遠&lt;/strong&gt;是一個提交（commit）。你對檔案的修改會自動被視為對當前工作提交的修改。
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;好處：&lt;/em&gt; 不再需要 &lt;code&gt;git add&lt;/code&gt;, 也沒有 &lt;code&gt;git stash&lt;/code&gt; 的概念。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心概念二不變的變更-id-change-id&#34;&gt;核心概念二：不變的「變更 ID」 (Change ID)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Git 的問題：&lt;/strong&gt; 在 Git 中, 你修改一個舊提交（例如使用 &lt;code&gt;amend&lt;/code&gt; 或 &lt;code&gt;rebase&lt;/code&gt;）會產生一個全新的 &lt;strong&gt;Commit ID&lt;/strong&gt; (SHA-1 hash)。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Jujutsu 的解決：&lt;/strong&gt; &lt;code&gt;jj&lt;/code&gt; 為每個邏輯變更（Change）分配一個不變的 &lt;strong&gt;Change ID&lt;/strong&gt;。當你修訂一個 commit 時, 它的 &lt;strong&gt;Commit ID&lt;/strong&gt; 會改變, 但 &lt;strong&gt;Change ID&lt;/strong&gt; 保持不變。
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;好處：&lt;/em&gt; 讓 &lt;code&gt;jj&lt;/code&gt; 能夠在底層追蹤變更的演進, 即使歷史被重寫, 邏輯變更仍可追溯。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心概念三自動安全且強大的變基-automatic-rebasing&#34;&gt;核心概念三：自動、安全且強大的變基 (Automatic Rebasing)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;終結 &lt;code&gt;rebase&lt;/code&gt; 的恐懼：&lt;/strong&gt; 這是 &lt;code&gt;jj&lt;/code&gt; 的殺手鐧。當你修改歷史中的某個提交時, 所有後續依賴於它的提交會&lt;strong&gt;自動且安全地&lt;/strong&gt;進行變基。
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;例如：&lt;/em&gt; 你使用 &lt;code&gt;jj edit &amp;lt;old-commit-id&amp;gt;&lt;/code&gt; 修改了一個底層提交, 你後續的 commits 會像「柔術」一般優雅地、自動地移到新修訂的提交之上。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;第三階段jujutsu-帶來的工作流程變革&#34;&gt;第三階段：Jujutsu 帶來的工作流程變革&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;jj&lt;/code&gt; 的指令設計更直覺、更以「變更」為中心, 極大地簡化了日常操作。&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;jj 操作&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;傳統 Git 工作流&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;優勢與變革&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;&lt;code&gt;jj undo&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;難以實現, 需要 &lt;code&gt;git reflog&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;一鍵撤銷&lt;/strong&gt;：所有操作（包括變基、修訂）都是可撤銷的, &lt;strong&gt;提供了無損的工作安全網&lt;/strong&gt;。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;&lt;code&gt;jj squash&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;git rebase -i&lt;/code&gt; 或 &lt;code&gt;git commit --amend&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;輕鬆合併：&lt;/strong&gt; 快速將當前工作區的變更併入父提交。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;&lt;code&gt;jj split&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;git rebase -i&lt;/code&gt; + 手動操作&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;輕鬆拆分：&lt;/strong&gt; 在不修改原提交的前提下, 將其部分內容拆分為新提交。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;&lt;code&gt;jj log&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;git log --graph&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;strong&gt;清晰日誌：&lt;/strong&gt; 預設輸出更易讀的變更圖, 並顯示 Change ID。&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;結語版本控制的未來已來&#34;&gt;結語：版本控制的未來已來&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Jujutsu&lt;/strong&gt; 將版本控制的複雜性抽象化, 提供了更直覺、更安全、更符合人腦思考邏輯的操作介面。它將我們從 git-revise 和 git-branchstack 試圖解決的局部痛點中解放出來, 提供了一個更全面、優雅的解決方案。&lt;/p&gt;
&lt;p&gt;如果你厭倦了 Git 繁瑣的歷史修改流程, 渴望更流暢、更少出錯的開發體驗, 那麼是時候擁抱這門版本控制的「柔術」了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>建置 Jupyter Notebook 的 Rust 運作環境</title>
      <link>https://blog.simplypatrick.com/posts/2021/01-02-rust-jupyter-notebook/</link>
      <pubDate>Sat, 02 Jan 2021 18:42:35 -0800</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2021/01-02-rust-jupyter-notebook/</guid>
      <description>&lt;p&gt;最近重新安裝了 macOS Big Sur，想試試 Jupyter Notebook 的 Rust 環境，再加上這幾天放假比較有時間，就把安裝的過程記錄下來。&lt;/p&gt;
&lt;h3 id=&#34;安裝-miniconda&#34;&gt;安裝 Miniconda&lt;/h3&gt;
&lt;p&gt;過去一直覺得 Anaconda 有點肥大，所以這次決定先從安裝比較精簡的 miniconda 開始:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ brew install --cask miniconda&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;新增 &lt;code&gt;conda-forge&lt;/code&gt; channel 以便安裝需要的套件如 &lt;code&gt;jupyterlab&lt;/code&gt;:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ conda config --add channels conda-forge
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ conda config --set channel_priority strict&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然後需要初始化 conda 的 base 環境，一般都是跑 &lt;code&gt;conda init&lt;/code&gt;，但它會加一段不是很通用的設定到我個人的 &lt;code&gt;.zshrc&lt;/code&gt;，我不是很喜歡這種做法，所以就先只套用在目前的 shell 裡:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ eval &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;conda shell.zsh hook&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;創建新的-conda-環境&#34;&gt;創建新的 conda 環境&lt;/h3&gt;
&lt;p&gt;創建一個新的環境叫 &lt;code&gt;rust-notebook&lt;/code&gt;:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;base&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; $ conda create -n rust-notebook python&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;base&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; $ conda activate rust-notebook&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;安裝-jupyterlab&#34;&gt;安裝 JupyterLab&lt;/h3&gt;
&lt;p&gt;在新的環境指定安裝 jupyterlab 版本 2.2.9，因為最新的 3.0 似乎與最新的 &lt;code&gt;jupyterlab-plotly&lt;/code&gt; 不相容:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;rust-notebook&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; $ conda install jupyterlab&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;2.2.9&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然後安裝 &lt;code&gt;jupyterlab-plotly&lt;/code&gt;:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;rust-notebook&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; $ jupyter labextension install jupyterlab-plotly&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;安裝-evcxr_jupyter&#34;&gt;安裝 evcxr_jupyter&lt;/h3&gt;
&lt;p&gt;假設 Rust 已經安裝完成，直接用 Cargo 安裝 Rust 的 Jupyter kernel:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cargo install evcxr_jupyter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ evcxr_jupyter --install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;啟動 JupyterLab:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;rust-notebook&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; $ jupyter lab&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;如果可以看到下列 Rust 圖示應該就是成功了:&lt;/p&gt;


  
    &lt;img src=&#34;https://blog.simplypatrick.com/posts/2021/01-02-rust-jupyter-notebook/new-notebook.png&#34; alt=&#34;new-notebook.png&#34; width=&#34;504&#34; height=&#34;370&#34; class=&#34;img-responsive post-image&#34;&gt;
  

&lt;h3 id=&#34;範例執行結果&#34;&gt;範例執行結果&lt;/h3&gt;
&lt;p&gt;試一下:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-Rust&#34; data-lang=&#34;Rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;println!&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello, Jupyter!&amp;#34;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;Hello, Jupyter!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;來畫個圖:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-Rust&#34; data-lang=&#34;Rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:&lt;span style=&#34;color:#a6e22e&#34;&gt;dep&lt;/span&gt; plotters &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; { git &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://github.com/38/plotters&amp;#34;&lt;/span&gt;, default_features &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, features &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;evcxr&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;line_series&amp;#34;&lt;/span&gt;] }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;crate&lt;/span&gt; plotters;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; plotters::prelude::&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; plotters::series::&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; figure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; evcxr_figure((&lt;span style=&#34;color:#ae81ff&#34;&gt;640&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;480&lt;/span&gt;), &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;root&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    root.fill(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;WHITE&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;mut&lt;/span&gt; chart &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ChartBuilder::on(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;root)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .caption(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y=x^2&amp;#34;&lt;/span&gt;, (&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Arial&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;).into_font())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .margin(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .x_label_area_size(&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .y_label_area_size(&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .build_ranged(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    chart.configure_mesh().draw()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    chart.draw_series(LineSeries::new(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;).map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; x &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;f32&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50.0&lt;/span&gt;).map(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (x, x &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; x)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RED&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )).unwrap()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .label(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y = x^2&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .legend(&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;(x,y)&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PathElement::new(&lt;span style=&#34;color:#a6e22e&#34;&gt;vec!&lt;/span&gt;[(x,y), (x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;,y)], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RED&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    chart.configure_series_labels()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .background_style(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;WHITE&lt;/span&gt;.mix(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .border_style(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;BLACK&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .draw()&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok(())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;figure&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div style=&#34;&#34;&gt;&lt;svg width=&#34;640&#34; height=&#34;480&#34; viewBox=&#34;0 0 640 480&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
&lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;639&#34; height=&#34;479&#34; opacity=&#34;1&#34; fill=&#34;#FFFFFF&#34; stroke=&#34;none&#34;/&gt;
&lt;text x=&#34;320&#34; y=&#34;10&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;Arial&#34; font-size=&#34;40.32258064516129&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
y=x^2
&lt;/text&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;41&#34; y1=&#34;444&#34; x2=&#34;41&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;47&#34; y1=&#34;444&#34; x2=&#34;47&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;53&#34; y1=&#34;444&#34; x2=&#34;53&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;59&#34; y1=&#34;444&#34; x2=&#34;59&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;65&#34; y1=&#34;444&#34; x2=&#34;65&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;71&#34; y1=&#34;444&#34; x2=&#34;71&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;77&#34; y1=&#34;444&#34; x2=&#34;77&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;83&#34; y1=&#34;444&#34; x2=&#34;83&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;89&#34; y1=&#34;444&#34; x2=&#34;89&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;95&#34; y1=&#34;444&#34; x2=&#34;95&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;101&#34; y1=&#34;444&#34; x2=&#34;101&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;107&#34; y1=&#34;444&#34; x2=&#34;107&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;113&#34; y1=&#34;444&#34; x2=&#34;113&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;119&#34; y1=&#34;444&#34; x2=&#34;119&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;125&#34; y1=&#34;444&#34; x2=&#34;125&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;131&#34; y1=&#34;444&#34; x2=&#34;131&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;137&#34; y1=&#34;444&#34; x2=&#34;137&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;143&#34; y1=&#34;444&#34; x2=&#34;143&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;149&#34; y1=&#34;444&#34; x2=&#34;149&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;155&#34; y1=&#34;444&#34; x2=&#34;155&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;161&#34; y1=&#34;444&#34; x2=&#34;161&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;167&#34; y1=&#34;444&#34; x2=&#34;167&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;173&#34; y1=&#34;444&#34; x2=&#34;173&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;179&#34; y1=&#34;444&#34; x2=&#34;179&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;185&#34; y1=&#34;444&#34; x2=&#34;185&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;191&#34; y1=&#34;444&#34; x2=&#34;191&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;197&#34; y1=&#34;444&#34; x2=&#34;197&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;203&#34; y1=&#34;444&#34; x2=&#34;203&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;209&#34; y1=&#34;444&#34; x2=&#34;209&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;215&#34; y1=&#34;444&#34; x2=&#34;215&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;221&#34; y1=&#34;444&#34; x2=&#34;221&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;227&#34; y1=&#34;444&#34; x2=&#34;227&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;233&#34; y1=&#34;444&#34; x2=&#34;233&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;239&#34; y1=&#34;444&#34; x2=&#34;239&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;245&#34; y1=&#34;444&#34; x2=&#34;245&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;251&#34; y1=&#34;444&#34; x2=&#34;251&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;257&#34; y1=&#34;444&#34; x2=&#34;257&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;263&#34; y1=&#34;444&#34; x2=&#34;263&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;269&#34; y1=&#34;444&#34; x2=&#34;269&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;275&#34; y1=&#34;444&#34; x2=&#34;275&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;281&#34; y1=&#34;444&#34; x2=&#34;281&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;287&#34; y1=&#34;444&#34; x2=&#34;287&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;293&#34; y1=&#34;444&#34; x2=&#34;293&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;299&#34; y1=&#34;444&#34; x2=&#34;299&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;305&#34; y1=&#34;444&#34; x2=&#34;305&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;311&#34; y1=&#34;444&#34; x2=&#34;311&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;317&#34; y1=&#34;444&#34; x2=&#34;317&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;323&#34; y1=&#34;444&#34; x2=&#34;323&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;329&#34; y1=&#34;444&#34; x2=&#34;329&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;335&#34; y1=&#34;444&#34; x2=&#34;335&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;341&#34; y1=&#34;444&#34; x2=&#34;341&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;347&#34; y1=&#34;444&#34; x2=&#34;347&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;353&#34; y1=&#34;444&#34; x2=&#34;353&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;359&#34; y1=&#34;444&#34; x2=&#34;359&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;365&#34; y1=&#34;444&#34; x2=&#34;365&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;371&#34; y1=&#34;444&#34; x2=&#34;371&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;377&#34; y1=&#34;444&#34; x2=&#34;377&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;383&#34; y1=&#34;444&#34; x2=&#34;383&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;389&#34; y1=&#34;444&#34; x2=&#34;389&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;395&#34; y1=&#34;444&#34; x2=&#34;395&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;401&#34; y1=&#34;444&#34; x2=&#34;401&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;407&#34; y1=&#34;444&#34; x2=&#34;407&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;413&#34; y1=&#34;444&#34; x2=&#34;413&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;419&#34; y1=&#34;444&#34; x2=&#34;419&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;425&#34; y1=&#34;444&#34; x2=&#34;425&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;431&#34; y1=&#34;444&#34; x2=&#34;431&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;437&#34; y1=&#34;444&#34; x2=&#34;437&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;443&#34; y1=&#34;444&#34; x2=&#34;443&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;449&#34; y1=&#34;444&#34; x2=&#34;449&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;455&#34; y1=&#34;444&#34; x2=&#34;455&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;461&#34; y1=&#34;444&#34; x2=&#34;461&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;467&#34; y1=&#34;444&#34; x2=&#34;467&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;473&#34; y1=&#34;444&#34; x2=&#34;473&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;479&#34; y1=&#34;444&#34; x2=&#34;479&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;485&#34; y1=&#34;444&#34; x2=&#34;485&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;491&#34; y1=&#34;444&#34; x2=&#34;491&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;497&#34; y1=&#34;444&#34; x2=&#34;497&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;503&#34; y1=&#34;444&#34; x2=&#34;503&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;509&#34; y1=&#34;444&#34; x2=&#34;509&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;515&#34; y1=&#34;444&#34; x2=&#34;515&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;521&#34; y1=&#34;444&#34; x2=&#34;521&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;527&#34; y1=&#34;444&#34; x2=&#34;527&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;533&#34; y1=&#34;444&#34; x2=&#34;533&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;539&#34; y1=&#34;444&#34; x2=&#34;539&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;545&#34; y1=&#34;444&#34; x2=&#34;545&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;551&#34; y1=&#34;444&#34; x2=&#34;551&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;557&#34; y1=&#34;444&#34; x2=&#34;557&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;563&#34; y1=&#34;444&#34; x2=&#34;563&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;569&#34; y1=&#34;444&#34; x2=&#34;569&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;575&#34; y1=&#34;444&#34; x2=&#34;575&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;581&#34; y1=&#34;444&#34; x2=&#34;581&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;587&#34; y1=&#34;444&#34; x2=&#34;587&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;593&#34; y1=&#34;444&#34; x2=&#34;593&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;599&#34; y1=&#34;444&#34; x2=&#34;599&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;605&#34; y1=&#34;444&#34; x2=&#34;605&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;611&#34; y1=&#34;444&#34; x2=&#34;611&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;617&#34; y1=&#34;444&#34; x2=&#34;617&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;623&#34; y1=&#34;444&#34; x2=&#34;623&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;629&#34; y1=&#34;444&#34; x2=&#34;629&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;635&#34; y1=&#34;444&#34; x2=&#34;635&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;444&#34; x2=&#34;635&#34; y2=&#34;444&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;436&#34; x2=&#34;635&#34; y2=&#34;436&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;429&#34; x2=&#34;635&#34; y2=&#34;429&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;422&#34; x2=&#34;635&#34; y2=&#34;422&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;415&#34; x2=&#34;635&#34; y2=&#34;415&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;408&#34; x2=&#34;635&#34; y2=&#34;408&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;401&#34; x2=&#34;635&#34; y2=&#34;401&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;394&#34; x2=&#34;635&#34; y2=&#34;394&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;387&#34; x2=&#34;635&#34; y2=&#34;387&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;380&#34; x2=&#34;635&#34; y2=&#34;380&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;373&#34; x2=&#34;635&#34; y2=&#34;373&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;366&#34; x2=&#34;635&#34; y2=&#34;366&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;359&#34; x2=&#34;635&#34; y2=&#34;359&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;352&#34; x2=&#34;635&#34; y2=&#34;352&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;344&#34; x2=&#34;635&#34; y2=&#34;344&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;337&#34; x2=&#34;635&#34; y2=&#34;337&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;330&#34; x2=&#34;635&#34; y2=&#34;330&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;323&#34; x2=&#34;635&#34; y2=&#34;323&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;316&#34; x2=&#34;635&#34; y2=&#34;316&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;309&#34; x2=&#34;635&#34; y2=&#34;309&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;302&#34; x2=&#34;635&#34; y2=&#34;302&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;295&#34; x2=&#34;635&#34; y2=&#34;295&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;288&#34; x2=&#34;635&#34; y2=&#34;288&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;281&#34; x2=&#34;635&#34; y2=&#34;281&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;274&#34; x2=&#34;635&#34; y2=&#34;274&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;267&#34; x2=&#34;635&#34; y2=&#34;267&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;260&#34; x2=&#34;635&#34; y2=&#34;260&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;253&#34; x2=&#34;635&#34; y2=&#34;253&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;245&#34; x2=&#34;635&#34; y2=&#34;245&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;238&#34; x2=&#34;635&#34; y2=&#34;238&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;231&#34; x2=&#34;635&#34; y2=&#34;231&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;224&#34; x2=&#34;635&#34; y2=&#34;224&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;217&#34; x2=&#34;635&#34; y2=&#34;217&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;210&#34; x2=&#34;635&#34; y2=&#34;210&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;203&#34; x2=&#34;635&#34; y2=&#34;203&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;196&#34; x2=&#34;635&#34; y2=&#34;196&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;189&#34; x2=&#34;635&#34; y2=&#34;189&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;182&#34; x2=&#34;635&#34; y2=&#34;182&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;175&#34; x2=&#34;635&#34; y2=&#34;175&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;168&#34; x2=&#34;635&#34; y2=&#34;168&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;161&#34; x2=&#34;635&#34; y2=&#34;161&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;154&#34; x2=&#34;635&#34; y2=&#34;154&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;146&#34; x2=&#34;635&#34; y2=&#34;146&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;139&#34; x2=&#34;635&#34; y2=&#34;139&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;132&#34; x2=&#34;635&#34; y2=&#34;132&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;125&#34; x2=&#34;635&#34; y2=&#34;125&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;118&#34; x2=&#34;635&#34; y2=&#34;118&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;111&#34; x2=&#34;635&#34; y2=&#34;111&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;104&#34; x2=&#34;635&#34; y2=&#34;104&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;97&#34; x2=&#34;635&#34; y2=&#34;97&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;90&#34; x2=&#34;635&#34; y2=&#34;90&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;83&#34; x2=&#34;635&#34; y2=&#34;83&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;76&#34; x2=&#34;635&#34; y2=&#34;76&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;69&#34; x2=&#34;635&#34; y2=&#34;69&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;62&#34; x2=&#34;635&#34; y2=&#34;62&#34;/&gt;
&lt;line opacity=&#34;0.1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;55&#34; x2=&#34;635&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;95&#34; y1=&#34;444&#34; x2=&#34;95&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;155&#34; y1=&#34;444&#34; x2=&#34;155&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;215&#34; y1=&#34;444&#34; x2=&#34;215&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;275&#34; y1=&#34;444&#34; x2=&#34;275&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;335&#34; y1=&#34;444&#34; x2=&#34;335&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;395&#34; y1=&#34;444&#34; x2=&#34;395&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;455&#34; y1=&#34;444&#34; x2=&#34;455&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;515&#34; y1=&#34;444&#34; x2=&#34;515&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;575&#34; y1=&#34;444&#34; x2=&#34;575&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;635&#34; y1=&#34;444&#34; x2=&#34;635&#34; y2=&#34;55&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;408&#34; x2=&#34;635&#34; y2=&#34;408&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;337&#34; x2=&#34;635&#34; y2=&#34;337&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;267&#34; x2=&#34;635&#34; y2=&#34;267&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;196&#34; x2=&#34;635&#34; y2=&#34;196&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;125&#34; x2=&#34;635&#34; y2=&#34;125&#34;/&gt;
&lt;line opacity=&#34;0.2&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; x1=&#34;35&#34; y1=&#34;55&#34; x2=&#34;635&#34; y2=&#34;55&#34;/&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;34,56 34,445 &#34;/&gt;
&lt;text x=&#34;25&#34; y=&#34;408&#34; dy=&#34;0.5ex&#34; text-anchor=&#34;end&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.0
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;29,408 34,408 &#34;/&gt;
&lt;text x=&#34;25&#34; y=&#34;337&#34; dy=&#34;0.5ex&#34; text-anchor=&#34;end&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.2
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;29,337 34,337 &#34;/&gt;
&lt;text x=&#34;25&#34; y=&#34;267&#34; dy=&#34;0.5ex&#34; text-anchor=&#34;end&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.4
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;29,267 34,267 &#34;/&gt;
&lt;text x=&#34;25&#34; y=&#34;196&#34; dy=&#34;0.5ex&#34; text-anchor=&#34;end&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.6
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;29,196 34,196 &#34;/&gt;
&lt;text x=&#34;25&#34; y=&#34;125&#34; dy=&#34;0.5ex&#34; text-anchor=&#34;end&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.8
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;29,125 34,125 &#34;/&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;35,445 635,445 &#34;/&gt;
&lt;text x=&#34;95&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
-0.8
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;95,445 95,450 &#34;/&gt;
&lt;text x=&#34;155&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
-0.6
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;155,445 155,450 &#34;/&gt;
&lt;text x=&#34;215&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
-0.4
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;215,445 215,450 &#34;/&gt;
&lt;text x=&#34;275&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
-0.2
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;275,445 275,450 &#34;/&gt;
&lt;text x=&#34;335&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.0
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;335,445 335,450 &#34;/&gt;
&lt;text x=&#34;395&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.2
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;395,445 395,450 &#34;/&gt;
&lt;text x=&#34;455&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.4
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;455,445 455,450 &#34;/&gt;
&lt;text x=&#34;515&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.6
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;515,445 515,450 &#34;/&gt;
&lt;text x=&#34;575&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
0.8
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;575,445 575,450 &#34;/&gt;
&lt;text x=&#34;635&#34; y=&#34;455&#34; dy=&#34;0.76em&#34; text-anchor=&#34;middle&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
1.0
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#000000&#34; stroke-width=&#34;1&#34; points=&#34;635,445 635,450 &#34;/&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#FF0000&#34; stroke-width=&#34;1&#34; points=&#34;35,56 41,69 47,82 53,96 59,109 65,122 71,134 77,147 83,159 89,170 95,182 101,193 107,204 113,214 119,225 125,235 131,245 137,254 143,263 149,272 155,281 161,289 167,297 173,305 179,313 185,320 191,327 197,333 203,340 209,346 215,352 221,357 227,362 233,367 239,372 245,376 251,380 257,384 263,388 269,391 275,394 281,397 287,399 293,401 299,403 305,405 311,406 317,407 323,408 329,408 335,408 341,408 347,408 353,407 359,406 365,405 371,403 377,401 383,399 389,397 395,394 401,391 407,388 413,384 419,380 425,376 431,372 437,367 443,362 449,357 455,352 461,346 467,340 473,333 479,327 485,320 491,313 497,305 503,297 509,289 515,281 521,272 527,263 533,254 539,245 545,235 551,225 557,214 563,204 569,193 575,182 581,170 587,159 593,147 599,134 605,122 611,109 617,96 623,82 629,69 635,56 &#34;/&gt;
&lt;rect x=&#34;542&#34; y=&#34;235&#34; width=&#34;88&#34; height=&#34;30&#34; opacity=&#34;0.8&#34; fill=&#34;#FFFFFF&#34; stroke=&#34;none&#34;/&gt;
&lt;rect x=&#34;542&#34; y=&#34;235&#34; width=&#34;88&#34; height=&#34;30&#34; opacity=&#34;1&#34; fill=&#34;none&#34; stroke=&#34;#000000&#34;/&gt;
&lt;text x=&#34;582&#34; y=&#34;245&#34; dy=&#34;0.76em&#34; text-anchor=&#34;start&#34; font-family=&#34;sans-serif&#34; font-size=&#34;9.67741935483871&#34; opacity=&#34;1&#34; fill=&#34;#000000&#34;&gt;
y = x^2
&lt;/text&gt;
&lt;polyline fill=&#34;none&#34; opacity=&#34;1&#34; stroke=&#34;#FF0000&#34; stroke-width=&#34;1&#34; points=&#34;552,250 572,250 &#34;/&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;h3 id=&#34;參考&#34;&gt;參考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://datacrayon.com/posts/programming/rust-notebooks/setup-anaconda-jupyter-and-rust/&#34;&gt;Setup Anaconda, Jupyter, and Rust | Data Crayon&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>看 log 的好工具: klogg</title>
      <link>https://blog.simplypatrick.com/posts/2019/12-25-klogg/</link>
      <pubDate>Wed, 25 Dec 2019 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2019/12-25-klogg/</guid>
      <description>&lt;p&gt;工作上常需要看 log 解決問題，推薦一個好用的工具 &lt;a href=&#34;https://github.com/variar/klogg&#34;&gt;klogg&lt;/a&gt;，它是一個開源、跨平台、速度飛快的 log 檢視器。&lt;/p&gt;
&lt;p&gt;klogg 是 glogg 的分支，它有以下這些特色：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;開源、跨平台的 GUI 應用程式&lt;/li&gt;
&lt;li&gt;速度快，可以處理大型 log 檔案&lt;/li&gt;
&lt;li&gt;使用正規表示式進行搜尋&lt;/li&gt;
&lt;li&gt;支援 Windows, macOS and Linux 三大作業系統&lt;/li&gt;
&lt;li&gt;支援 Perl 相容的正規表示式&lt;/li&gt;
&lt;li&gt;log 和搜尋結果都有語法高亮&lt;/li&gt;
&lt;li&gt;即時監控檔案變化&lt;/li&gt;
&lt;li&gt;為現代 CPU 進行了最佳化&lt;/li&gt;
&lt;li&gt;提供可攜式版本&lt;/li&gt;
&lt;li&gt;自動偵測文字編碼&lt;/li&gt;
&lt;li&gt;進階的文字高亮規則&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#39;https://blog.simplypatrick.com/posts/2019/12-25-klogg/klogg.png&#39; width=&#34;100%&#34;&gt;</description>
    </item>
    
    <item>
      <title>Setup Fuchsia Rust Development on macOS</title>
      <link>https://blog.simplypatrick.com/posts/2019/06-06-setup-fuchsia-rust-dev/</link>
      <pubDate>Thu, 06 Jun 2019 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2019/06-06-setup-fuchsia-rust-dev/</guid>
      <description>&lt;p&gt;基本上照著官方的指引 &lt;a href=&#34;https://fuchsia.googlesource.com/fuchsia/+/refs/heads/master/docs/development/languages/rust/editors.md&#34;&gt;Rust Editor Configuration&lt;/a&gt;，設置 Fuchsia OS 開發的 Rust 開發環境主要就兩個步驟:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;產生 &lt;code&gt;Cargo.toml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;設定編輯器使用 Rust 的 Language Server (&lt;code&gt;RLS&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;產生-cargotoml&#34;&gt;產生 &lt;code&gt;Cargo.toml&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;很簡單，就是用 &lt;code&gt;fx gen-cargo //garnet/foo/path/to/target:label&lt;/code&gt; 產生對應的 &lt;code&gt;Cargo.toml&lt;/code&gt;。例如 &lt;code&gt;fx gen-cargo //garnet/bin/log_listener:bin&lt;/code&gt; 會產生 &lt;code&gt;/garnet/bin/log_listener/Cargo.toml&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;設定-rls&#34;&gt;設定 RLS&lt;/h3&gt;
&lt;p&gt;官方文檔提到要先把 Fuchsia 自帶的 Rust 連結到 rustup，並且設成預設的 toolchain:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ rustup toolchain link fuchsia /&amp;lt;your Fuchsia root&amp;gt;/buildtools/&amp;lt;platform&amp;gt;/rust
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ rustup default fuchsia&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;我是有做第一步，但第二步我比較持保留態度，之後試過似乎不做也沒影響，我會建議跳過這一步。&lt;/p&gt;
&lt;h4 id=&#34;vim&#34;&gt;Vim&lt;/h4&gt;
&lt;p&gt;跟 C++ 類似，只是 Language Server 我們必須從 &lt;code&gt;clangd&lt;/code&gt; 換成 &lt;code&gt;RLS&lt;/code&gt;，所以可以在 Vim 裡用 &lt;code&gt;:CocInstall coc-rls&lt;/code&gt; 來安裝 &lt;a href=&#34;https://github.com/neoclide/coc-rls&#34;&gt;coc-rls&lt;/a&gt; extension，如果你系統之前就有裝過 RLS 的話，在 Vim 裡打開對應的目錄就會有 code completion 的功能了。&lt;/p&gt;
&lt;p&gt;如果你的系統沒有 RLS 或你覺得用 Fuchsia 自帶的 Rust toolchain 比較保險，可以用 &lt;code&gt;:CocConfig&lt;/code&gt; 把下列設定加進去:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.target&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x86_64-fuchsia&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.target_dir&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;lt;your Fuchsia root&amp;gt;/out/cargo_target&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.unstable_features&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.rlsPath&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;lt;your Fuchsia root&amp;gt;/buildtools/&amp;lt;platform&amp;gt;/rust/bin/rls&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.disableRustup&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Some optional settings that may help:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.goto_def_racer_fallback&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.logToFile&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;visual-studio-code&#34;&gt;Visual Studio Code&lt;/h4&gt;
&lt;p&gt;VSCode 則是需要安裝 &lt;a href=&#34;https://marketplace.visualstudio.com/items?itemName=rust-lang.rust&#34;&gt;Rust (rls)&lt;/a&gt; 這個 plugin。同樣如果你的系統沒有 RLS 或你覺得用 Fuchsia 自帶的 Rust toolchain 比較保險，加入下列的設定到 VS Code 裡：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.target&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x86_64-fuchsia&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.target_dir&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;lt;your Fuchsia root&amp;gt;/out/cargo_target&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.unstable_features&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.rlsPath&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;lt;your Fuchsia root&amp;gt;/buildtools/&amp;lt;platform&amp;gt;/rust/bin/rls&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.disableRustup&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Some optional settings that may help:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust.goto_def_racer_fallback&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rust-client.logToFile&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>Setup Fuchsia C&#43;&#43; Development on macOS</title>
      <link>https://blog.simplypatrick.com/posts/2019/06-05-setup-fuchsia-c&#43;&#43;-dev/</link>
      <pubDate>Wed, 05 Jun 2019 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2019/06-05-setup-fuchsia-c&#43;&#43;-dev/</guid>
      <description>&lt;h2 id=&#34;關於-fuchsia&#34;&gt;關於 Fuchsia&lt;/h2&gt;
&lt;p&gt;Fuchsia 是 Google 開發中的新作業系統，它的底層原始碼可以到 &lt;a href=&#34;https://fuchsia.googlesource.com&#34;&gt;https://fuchsia.googlesource.com&lt;/a&gt; 公開下載。雖然 Google 對外宣稱 Fuchsia 是個實驗性質的專案，但蠻多人認為它有潛力成為 Google 的大一統 OS，慢慢取代掉 Android 或 Chrome OS，姑且不論這是否會發生，對於喜歡研究系統軟體或嵌入式軟體技術的開發人員，Fuchsia 可以讓你一窺如何打造一個現代化的 OS。&lt;/p&gt;
&lt;h2 id=&#34;fuchsia-的開發環境&#34;&gt;Fuchsia 的開發環境&lt;/h2&gt;
&lt;p&gt;目前 Fuchsia OS 可以在 Linux 或 macOS 上編譯，這篇主要是分享在 macOS 上建置 C++ 的 OS 開發環境的經驗，包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基本的編輯器 (Vim 及 Visual Studio Code) 設置&lt;/li&gt;
&lt;li&gt;Code completion 的設置&lt;/li&gt;
&lt;li&gt;使用 &lt;a href=&#34;https://direnv.net/&#34;&gt;direnv&lt;/a&gt; 來實現設置自動化&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;編輯器選擇&#34;&gt;編輯器選擇&lt;/h2&gt;
&lt;p&gt;我的環境建置基本是根據這份官方提供的 &lt;a href=&#34;https://fuchsia.googlesource.com/fuchsia/+/refs/heads/master/docs/development/languages/c-cpp/editors.md&#34;&gt;C++ Editor/IDE Setup&lt;/a&gt; 指南，裡面有提到 CLion, Vim, 以及 Visual Studio Code，試用過後個人推薦 &lt;strong&gt;Vim &amp;gt; VS Code &amp;raquo; CLion&lt;/strong&gt;，主要還是因為個人開發時通常只會需要修改全部 code base 的極小一部份，小巧的編輯器使用體驗會比較流暢，也不會耗用太多的機器資源去處理不會修改的部份。&lt;/p&gt;
&lt;p&gt;而開發必備的 code completion 功能，個人推薦使用 &lt;strong&gt;compilation database + &lt;code&gt;clangd&lt;/code&gt;&lt;/strong&gt; 的設置。&lt;/p&gt;
&lt;h2 id=&#34;vim-設置&#34;&gt;Vim 設置&lt;/h2&gt;
&lt;h3 id=&#34;vim-版本&#34;&gt;Vim 版本&lt;/h3&gt;
&lt;p&gt;推薦使用 Vim &amp;gt;= 8.1 或是最新的 Neovim (我目前用 v0.3.7)。&lt;/p&gt;
&lt;h3 id=&#34;fuchsia_dir-及-fuchsiavim&#34;&gt;&lt;code&gt;FUCHSIA_DIR&lt;/code&gt; 及 &lt;code&gt;fuchsia.vim&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Fuchsia 預設提供了&lt;a href=&#34;https://fuchsia.googlesource.com/fuchsia/+/refs/heads/master/scripts/vim/README.md&#34;&gt;一些 Vim 專用的設定&lt;/a&gt;，在 &lt;code&gt;~/.vimrc&lt;/code&gt; 裡套用這些設定的修改如下:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; $FUCHSIA_DIR !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  source $FUCHSIA_DIR/scripts/vim/fuchsia.vim
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;我不喜歡每次手動設置 &lt;code&gt;export FUCHSIA_DIR=/path/to/fuchsia-dir&lt;/code&gt;，也不喜歡直接修改 &lt;code&gt;~/.bashrc&lt;/code&gt;，所以用 &lt;a href=&#34;https://direnv.net/&#34;&gt;direnv&lt;/a&gt; (直接用 Homebrew 安裝) 在進目錄時自動套用設定。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;path/to/fuchsia-dir/.envrc&lt;/code&gt; 加入:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# For VIM to find fuchsia.vim&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export FUCHSIA_DIR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;pwd&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;之後 &lt;code&gt;cd&lt;/code&gt; 進去就會幫你把 &lt;code&gt;FUCHSIA_DIR&lt;/code&gt; 的環境變量設定好了。&lt;/p&gt;
&lt;h3 id=&#34;code-completion-設置&#34;&gt;Code Completion 設置&lt;/h3&gt;
&lt;h4 id=&#34;前置準備&#34;&gt;前置準備&lt;/h4&gt;
&lt;p&gt;確認 &lt;code&gt;fx build&lt;/code&gt; 是成功的，然後使用 &lt;code&gt;fx compdb&lt;/code&gt; 產生 &lt;code&gt;compile_commands.json&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&#34;language-server-clangd&#34;&gt;Language Server &lt;code&gt;clangd&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;同樣利用 direnv 來套用 &lt;code&gt;PATH&lt;/code&gt; 的修改，因此新增這一行到 &lt;code&gt;path/to/fuchsia-dir/.envrc&lt;/code&gt; :&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$FUCHSIA_DIR/buildtools/mac-x64/clang/bin:$PATH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;目的是讓 Vim 優先使用 Fuchsia 自帶的 &lt;code&gt;clangd&lt;/code&gt;，否則使用其他版本的 &lt;code&gt;clangd&lt;/code&gt; 可能會有 C++ 編譯的問題產生。&lt;/p&gt;
&lt;h4 id=&#34;conquer-of-completion-coc&#34;&gt;Conquer of Completion (CoC)&lt;/h4&gt;
&lt;p&gt;因為 &lt;a href=&#34;https://github.com/Valloric/YouCompleteMe&#34;&gt;YCM&lt;/a&gt; 其實有點肥大，安裝上也比較麻煩，我現在比較喜歡用 &lt;a href=&#34;https://github.com/neoclide/coc.nvim&#34;&gt;Coc&lt;/a&gt;，Coc 的詳細配置可以參考 &lt;a href=&#34;https://medium.com/@rohmanhakim/how-to-set-up-code-completion-for-vim-in-macos-9766dd459385&#34;&gt;How to Set Up Code-Completion for Vim in macOS&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;基本上在 Vim 裡執行 &lt;code&gt;:CocConfig&lt;/code&gt; 把以下配置填上應該就行了。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;languageserver&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;clangd&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;clangd&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rootPatterns&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;compile_flags.txt&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;compile_commands.json&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.vim/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.git/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.hg/&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;filetypes&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;c&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cpp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;objc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;objcpp&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;visual-studio-code-設置&#34;&gt;Visual Studio Code 設置&lt;/h2&gt;
&lt;p&gt;VS Code 設置上比較簡單，基本上只要把 &lt;a href=&#34;https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-clangd&#34;&gt;vscode-clangd&lt;/a&gt; 安裝起來並確保 Fuchsia 自帶的 &lt;code&gt;clangd&lt;/code&gt; 可以在 &lt;code&gt;PATH&lt;/code&gt; 裡找到就可以用了。使用速度上雖然比起 Vim 遲鈍了一些，但整體流暢度還是可是在我可以接受的範圍。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Learning Rust</title>
      <link>https://blog.simplypatrick.com/posts/2019/04-08-learning-rust/</link>
      <pubDate>Mon, 08 Apr 2019 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2019/04-08-learning-rust/</guid>
      <description>&lt;h2 id=&#34;關於-rust&#34;&gt;關於 Rust&lt;/h2&gt;
&lt;p&gt;會知道 Rust 是因為之前公司團隊的工作是跟瀏覽器引擎 (Webkit/Blink) 的優化有關，那時只知道 Mozilla 正在用 Rust 這個新的程式語言實驗性地開發 Servo 引擎。同時間 Go 已經到達 1.0 的里程碑，同時有著優異的編譯及執行效能，很快地 Go 就變成我個人主要使用的程式語言，工作上需要的一些小工具也都是用 Go 來實現。&lt;/p&gt;
&lt;p&gt;開始對 Rust 重新關注大概是它在 2015 年釋放 1.0 版本後，那時只稍微了解一下語法及主要的語言特性，當時覺得這程式語言的學習曲線蠻陡峭的，必須全面地對所有的語言特性有一定了解後才能駕馭它。那時 Go 用的正是順手，所以就沒什麼動力把 Rust 完整學起來。&lt;/p&gt;
&lt;p&gt;去年開始工作上需要了解 Fuchsia OS 的實作，赫然發現裡面蠻多系統服務都是用 Rust 開發的，數量上甚至比 Google 自家的 Go 還多，這也是我決定多投入時間學習 Rust 的轉捩點。&lt;/p&gt;
&lt;h2 id=&#34;學習資源&#34;&gt;學習資源&lt;/h2&gt;
&lt;p&gt;我主要使用下列幾本書來學習 Rust：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.amazon.cn/dp/B07GSRFG28&#34;&gt;深入浅出 Rust&lt;/a&gt; 這本書的電子版: 它的特色是側重於解釋 Rust 主要概念的設計思想，而不只是單純語法或用法的說明；且因為是中文的緣故，讀起來速度還是比較快，比較像是 Rust 的內功心法入門。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ithelp.ithome.com.tw/users/20111802/ironman/1742&#34;&gt;30 天深入淺出 Rust 系列&lt;/a&gt; 則是以淺顯易懂的範例把 Rust 主要的特色講解了一遍，內容適合對於想要快速地對 Rust 有個全面性的概觀的人。&lt;/li&gt;
&lt;li&gt;對 Rust 有了基本的了解後，&lt;a href=&#34;https://stevedonovan.github.io/rust-gentle-intro/readme.html#a-gentle-introduction-to-rust&#34;&gt;A Gentle Introduction to Rust&lt;/a&gt; 則是適合有 C/C++ 經驗的開發者來學習如何寫 idiomatic Rust。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;至於最經典的 &lt;a href=&#34;https://doc.rust-lang.org/book/&#34;&gt;The Rust Programming Language&lt;/a&gt; 呢? 我只把了一些我覺得重要的章節看完，其他剩下的就直接動手實作，遇到有細節不清楚或是已經忘記時再花時間來看。&lt;/p&gt;
&lt;h2 id=&#34;其他資源&#34;&gt;其他資源&lt;/h2&gt;
&lt;p&gt;上面主要是比較完整的 Rust 學習資源，下一篇再分享一些我覺得不錯的 blog post，通常是針對某個特定主題或進階功能的解釋或教學。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Revisiting GN</title>
      <link>https://blog.simplypatrick.com/posts/2017/12-24-revisit-gn/</link>
      <pubDate>Wed, 31 Oct 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2017/12-24-revisit-gn/</guid>
      <description>&lt;h3 id=&#34;安裝&#34;&gt;安裝&lt;/h3&gt;
&lt;p&gt;GN 本來只是 Chromium 自己在用 (&lt;a href=&#34;https://blog.simplypatrick.com/posts/2016/01-23-gn/&#34;&gt;很久之前介紹過&lt;/a&gt;)，隨著另一個大專案 Fuchsia 也開始採用了，Google 終於決定要給它個名份，所以它有自己的網址了: &lt;a href=&#34;https://gn.googlesource.com&#34;&gt;https://gn.googlesource.com&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Google 也直接提供 binary 讓你下載使用了，雖然自己編譯安裝也是很簡單。&lt;/p&gt;
&lt;p&gt;從源碼編譯的步驟:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://gn.googlesource.com/gn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd gn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python build/gen.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja -C out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 編譯完成後，binary 會在 out/gn&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;怎麼用&#34;&gt;怎麼用?&lt;/h3&gt;
&lt;p&gt;Brett Wilson 的 &lt;a href=&#34;https://docs.google.com/presentation/d/15Zwb53JcncHfEwHpnG_PoIbbzQ3GQi_cpujYwbpcbZo/edit?usp=sharing&#34;&gt;Using GN build&lt;/a&gt; 是我看過最好的入門介紹。&lt;/p&gt;
&lt;h4 id=&#34;基本流程&#34;&gt;基本流程&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;建立專案根目錄的 &lt;code&gt;.gn&lt;/code&gt; 檔案，指定 buildconfig:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# .gn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;buildconfig &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//build/BUILDCONFIG.gn&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;建立 &lt;code&gt;BUILD.gn&lt;/code&gt; 定義 targets:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# BUILD.gn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;executable(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my_app&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main.cc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;app.cc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;app.h&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//base&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//third_party/foo&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;生成 ninja 建置檔:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn gen out/Default&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;執行建置:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja -C out/Default&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;優點&#34;&gt;優點&lt;/h3&gt;
&lt;h4 id=&#34;簡單易用的-dependency-tree-管理能力&#34;&gt;簡單易用的 dependency tree 管理能力&lt;/h4&gt;
&lt;p&gt;GN 會根據 &lt;code&gt;BUILD.gn&lt;/code&gt; 建立所謂的 dependency tree，確保建置的正確性與效率:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 範例：建立 library 與其依賴關係&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;static_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my_lib&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib.cc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib.h&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  public_deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//base&amp;#34;&lt;/span&gt; ]  &lt;span style=&#34;color:#75715e&#34;&gt;# 會傳遞給依賴此 library 的 target&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//internal/util&amp;#34;&lt;/span&gt; ]  &lt;span style=&#34;color:#75715e&#34;&gt;# 只有自己會用到&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;executable(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my_app&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:my_lib&amp;#34;&lt;/span&gt; ]  &lt;span style=&#34;color:#75715e&#34;&gt;# 會自動繼承 my_lib 的 public_deps&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;gn check&lt;/code&gt; 可以檢查 code (經由 #include 形成的)的相依關係是否符合 build structure:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 檢查所有 targets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn check out/Default
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 只檢查特定 target&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn check out/Default //my/target:name&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;如果你在 code 中 include 了某個 header，但沒有在 BUILD.gn 中宣告對應的 dependency，&lt;code&gt;gn check&lt;/code&gt; 就會報錯。&lt;/p&gt;
&lt;h4 id=&#34;豐富的文檔&#34;&gt;豐富的文檔&lt;/h4&gt;
&lt;p&gt;GN 內建完整的文檔系統，可以直接在命令列查詢:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 查看所有可用命令&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 查看特定命令的說明&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help gen
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help check
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 查看特定函數或變數的說明&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help executable
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help sources
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn help deps&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;所有的 BUILD.gn 語法、內建函數、變數都可以透過 &lt;code&gt;gn help&lt;/code&gt; 查到，非常方便。&lt;/p&gt;
&lt;h4 id=&#34;內建分析及除錯功能&#34;&gt;內建分析及除錯功能&lt;/h4&gt;
&lt;p&gt;GN 提供強大的分析工具，幫助你理解和除錯複雜的建置結構:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;gn desc&lt;/code&gt; - 查看 target 的詳細資訊:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 顯示 target 的所有屬性&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn desc out/Default //my/target:name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 只顯示特定屬性&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn desc out/Default //my/target:name sources
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn desc out/Default //my/target:name deps --tree&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;gn path&lt;/code&gt; - 找出兩個 targets 之間的依賴路徑:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 為什麼 target_a 會依賴到 target_b?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn path out/Default //target_a //target_b&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;gn refs&lt;/code&gt; - 查看誰依賴了這個 target:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 列出所有依賴 //base 的 targets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn refs out/Default //base
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 以樹狀結構顯示&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn refs out/Default //base --tree&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;gn analyze&lt;/code&gt; - 分析哪些 targets 需要重新建置:&lt;/strong&gt;&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 當某些檔案改變時，哪些 targets 會受影響&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn analyze out/Default input.json output.json&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;可客製化的彈性&#34;&gt;可客製化的彈性&lt;/h4&gt;
&lt;p&gt;GN 的 &lt;code&gt;template&lt;/code&gt; 功能讓你可以建立可重複使用的建置模式:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 定義一個 template&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;template(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my_custom_library&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  static_library(target_name) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    forward_variables_from(invoker, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 自動加入一些共通設定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    configs &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//build:common_config&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;!&lt;/span&gt;defined(invoker&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sources)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sources &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//build/version.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 使用 template&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;my_custom_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//base&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這樣可以將專案中重複的建置邏輯抽象化，讓 BUILD.gn 檔案更簡潔易讀。&lt;/p&gt;
&lt;h3 id=&#34;可能的坑&#34;&gt;可能的坑&lt;/h3&gt;
&lt;h4 id=&#34;1-includes-vs-include_dirs&#34;&gt;1. &lt;code&gt;includes&lt;/code&gt; vs &lt;code&gt;include_dirs&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;如果你從其他建置系統(如 CMake 或 Make)轉過來，可能會習慣性地寫 &lt;code&gt;includes&lt;/code&gt;，但在 GN 中正確的變數名稱是 &lt;code&gt;include_dirs&lt;/code&gt;:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ❌ 錯誤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;static_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  includes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;include&amp;#34;&lt;/span&gt; ]  &lt;span style=&#34;color:#75715e&#34;&gt;# 這不會生效！&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ✅ 正確&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;static_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  include_dirs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;include&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;2-public_deps-vs-deps&#34;&gt;2. &lt;code&gt;public_deps&lt;/code&gt; vs &lt;code&gt;deps&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;混淆這兩者會導致建置時找不到 header 或 linking 錯誤:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;deps&lt;/code&gt;: 只有當前 target 自己會用到的依賴&lt;/li&gt;
&lt;li&gt;&lt;code&gt;public_deps&lt;/code&gt;: 會傳遞給依賴此 target 的其他 targets&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 如果你的 header 檔會 include 另一個 library 的 header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 就要用 public_deps，否則使用你 library 的人會找不到 header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;static_library(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;my_lib&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sources &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib.h&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib.cc&amp;#34;&lt;/span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  public_deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//base&amp;#34;&lt;/span&gt; ]  &lt;span style=&#34;color:#75715e&#34;&gt;# lib.h 有 #include &amp;#34;base/base.h&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;3-路徑表示法&#34;&gt;3. 路徑表示法&lt;/h4&gt;
&lt;p&gt;GN 使用特殊的路徑表示法，需要注意:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;//&lt;/code&gt; 代表專案根目錄(有 &lt;code&gt;.gn&lt;/code&gt; 檔案的地方)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:&lt;/code&gt; 用來指定同一個 BUILD.gn 內的 target&lt;/li&gt;
&lt;li&gt;相對路徑要用 &lt;code&gt;./&lt;/code&gt; 或直接寫檔名&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deps &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//base&amp;#34;&lt;/span&gt;,           &lt;span style=&#34;color:#75715e&#34;&gt;# 根目錄下的 base 目錄&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;//third_party/foo&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# 根目錄下的 third_party/foo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:my_lib&amp;#34;&lt;/span&gt;,          &lt;span style=&#34;color:#75715e&#34;&gt;# 同一個 BUILD.gn 內的 my_lib target&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;4-gn-format-自動格式化&#34;&gt;4. &lt;code&gt;gn format&lt;/code&gt; 自動格式化&lt;/h4&gt;
&lt;p&gt;養成使用 &lt;code&gt;gn format&lt;/code&gt; 的習慣，可以避免很多格式上的問題:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 格式化單一檔案&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn format BUILD.gn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 格式化整個目錄&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gn format --all&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>C&#43;&#43; 套件管理: 使用 Conan</title>
      <link>https://blog.simplypatrick.com/posts/2018/03-12-c&#43;&#43;-conan/</link>
      <pubDate>Mon, 12 Mar 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2018/03-12-c&#43;&#43;-conan/</guid>
      <description>&lt;h3 id=&#34;手動管理-cc-套件&#34;&gt;手動管理 C/C++ 套件&lt;/h3&gt;
&lt;p&gt;想像你需要使用 &lt;a href=&#34;https://llvm.org/&#34;&gt;LLVM&lt;/a&gt; 開發一個程式，如果在 macOS 上，最簡單的安裝方法是用 Homebrew，一行就搞定: &lt;code&gt;brew install llvm&lt;/code&gt;。但 Homebrew 上的版本不一定是最新的而且也無法同時安裝不同的版本 (例如 LLVM 5.0/6.0 共存) 或同版本但不同設置（例如 LLVM 6.0 的 debug/release 版本)；而在 Linux 及 Windows 上也有各自不同的安裝問題。&lt;/p&gt;
&lt;p&gt;安裝完畢後，麻煩才剛開始：通常第一步是設置編譯環境的 CPPFLAGS 及 LDFLAGS:&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;For compilers to find this software you may need to set:
    LDFLAGS:  -L/usr/local/opt/llvm/lib
    CPPFLAGS: -I/usr/local/opt/llvm/include&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;根據不同的開發環境或編譯器，設置的方法也都不同。最後設置完後編譯及連結也不一定能成功，因為 LLVM 本身可能又依賴其他套件，還需要把它的 dependencies 一一安裝及設置。&lt;/p&gt;
&lt;h3 id=&#34;conan-介紹&#34;&gt;Conan 介紹&lt;/h3&gt;
&lt;p&gt;Conan 企圖幫助 C/C++ 脫離這個窘境：沒有一個像樣的套件管理 (package management) 工具。&lt;/p&gt;
&lt;p&gt;我建議先讀一下 Conan 的文檔來了解如何&lt;a href=&#34;http://docs.conan.io/en/latest/installation.html&#34;&gt;安裝 Conan&lt;/a&gt; 以及&lt;a href=&#34;http://docs.conan.io/en/latest/getting_started.html&#34;&gt;利用 Conan 來使用現成的程式庫&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;如果你是使用 CMake，事情會簡單一些，因為 Conan 提供的 CMake 整合還算好用，使用範例可以參考這個基於 LLVM 的小程式: &lt;a href=&#34;https://github.com/p47r1ck7541/clike&#34;&gt;clike&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;下載套件&#34;&gt;下載套件&lt;/h3&gt;
&lt;p&gt;除了預設的 &lt;code&gt;conan-center&lt;/code&gt;，Conan 官網建議也可以到 &lt;a href=&#34;https://bintray.com/bincrafters/public-conan&#34;&gt;&lt;code&gt;bincrafters&lt;/code&gt;&lt;/a&gt; 及 &lt;a href=&#34;https://bintray.com/conan-community/conan&#34;&gt;&lt;code&gt;conan-community&lt;/code&gt;&lt;/a&gt; 裡尋找，可以用下列指令新增這兩個 remote:&lt;/p&gt;
&lt;pre class=&#34;command-line&#34; data-user=&#34;pat&#34; data-host=&#34;host&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;$ &lt;span class=&#34;token function&#34;&gt;conan&lt;/span&gt; remote add conan-community https://api.bintray.com/conan/conan-community/conan
$ &lt;span class=&#34;token function&#34;&gt;conan&lt;/span&gt; remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;之後就可以指定 remote 搜尋 package:&lt;/p&gt;
&lt;pre class=&#34;command-line&#34; data-user=&#34;pat&#34; data-host=&#34;host&#34; data-output=&#34;2-4&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;$ &lt;span class=&#34;token function&#34;&gt;conan&lt;/span&gt; search ffmpeg -r=bincrafters
Existing package recipes:

ffmpeg/3.4@bincrafters/stable&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;目前 server 上面的套件數量不算多，有可能你會找不到你想要的，因此你不能期待很快地有人會幫你做出來，相反地你&lt;strong&gt;必須學會自己創建套件&lt;/strong&gt;才能充分得到使用 Conan 的好處。&lt;/p&gt;
&lt;h3 id=&#34;創建-package&#34;&gt;創建 package&lt;/h3&gt;
&lt;p&gt;自己創建一個套件其實也不難，基本的概念如下:&lt;/p&gt;
&lt;img src=&#39;https://blog.simplypatrick.com/posts/2018/03-12-c&amp;#43;&amp;#43;-conan/package_create_flow.png&#39; width=&#34;100%&#34;&gt;
&lt;p&gt;整個建置過程需要的目錄結構及流程會是由 Conan 來控制，但你需要提供一個 &lt;a href=&#34;http://docs.conan.io/en/latest/reference/conanfile/methods.html&#34;&gt;conanfile.py&lt;/a&gt; 描述每個步驟裡的需要執行的動作。Conan 會把打包的套件放在一個 local cache 裡讓其他的程式來使用。&lt;/p&gt;
&lt;p&gt;以下示範如何下載 LLVM 6.0 的原始碼, 編譯，最後把它包裝成套件：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; conans &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; ConanFile, CMake
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; glob
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; os
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LlvmConan&lt;/span&gt;(ConanFile):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;LLVM&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    version &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;release_60&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    license &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;LLVM Release License&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    url &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://github.com/p47r1ck7541/llvm-60&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    description &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; (name, version)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    settings &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;compiler&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;build_type&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;arch&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    generators &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cmake&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;source&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;run(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;git clone https://github.com/llvm-mirror/llvm -b &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; --depth 1 src&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;version)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;build&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cmake &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CMake(self)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cmake&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;configure(source_folder&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;src&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cmake&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;install()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;package&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# nothing to do here now because we reuse &amp;#39;cmake install&amp;#39; to package files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;pass&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;package_info&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cpp\_info&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;libs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; \[os&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;basename(a) &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; glob&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;glob(os&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;join(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;package\_folder, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lib&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*.a&amp;#34;&lt;/span&gt;))\]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cpp_info&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cppflags &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; \[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-std=c++11&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-fno-rtti&amp;#34;&lt;/span&gt;\]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cpp_info&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exelinkflags &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; \[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-lcurses&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-lz&amp;#34;&lt;/span&gt;\]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;幾個關鍵步驟：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.conan.io/en/latest/reference/conanfile/methods.html#source&#34;&gt;&lt;code&gt;source()&lt;/code&gt;&lt;/a&gt;: 利用 &lt;code&gt;git clone&lt;/code&gt; 下載原始碼&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.conan.io/en/latest/reference/conanfile/methods.html#build&#34;&gt;&lt;code&gt;build()&lt;/code&gt;&lt;/a&gt;: 負責編譯，這裏我們直接使用 Conan 提供的 CMake class 來控制 cmake 的執行，值得注意的是我們直接利用 &lt;code&gt;cmake.install()&lt;/code&gt; 來取代實際打包套件的工作。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.conan.io/en/latest/reference/conanfile/methods.html#package&#34;&gt;&lt;code&gt;package()&lt;/code&gt;&lt;/a&gt;: 如上解釋，不需做任何事。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.conan.io/en/latest/reference/conanfile/methods.html#package-info&#34;&gt;&lt;code&gt;package_info()&lt;/code&gt;&lt;/a&gt;: 提供套件的相關使用資訊。例如 &lt;code&gt;cppflags&lt;/code&gt; 及 &lt;code&gt;exelinkflags&lt;/code&gt; 是寫死的，但 &lt;code&gt;libs&lt;/code&gt; 則是運行 Python script 搜尋編譯結果找出來的。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;完整範例可以參考這個 GitHub project: &lt;a href=&#34;https://github.com/p47r1ck7541/conan-llvm-60&#34;&gt;conan-llvm-60&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;實際運作過程如下(中間請自行快轉):&lt;/p&gt;
&lt;script src=&#34;https://asciinema.org/a/9yi010lhV4Bvjk321P8h151aB.js&#34; id=&#34;asciicast-9yi010lhV4Bvjk321P8h151aB&#34; async&gt;&lt;/script&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;就簡化自己手動管理 C/C++ 套件的工作來看，我認為 Conan 提供的好處值得你花時間去學它，至於它是否能成為主流的 C/C++ 套件管理工具，那就等待時間來驗證了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>C&#43;&#43; 單元測試: 使用 Catch2</title>
      <link>https://blog.simplypatrick.com/posts/2018/03-10-catch2/</link>
      <pubDate>Sat, 10 Mar 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2018/03-10-catch2/</guid>
      <description>&lt;h3 id=&#34;catch2-介紹&#34;&gt;Catch2 介紹&lt;/h3&gt;
&lt;p&gt;介紹一下最近有在使用的一個 C++ test framework, &lt;a href=&#34;https://github.com/catchorg/Catch2&#34;&gt;Catch2&lt;/a&gt;，它對自己的描述是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A modern, C++-native, header-only, test framework for unit-tests, TDD and BDD - using C++11, C++14, C++17 and later (or C++03 on the Catch1.x branch)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我主要的用途是做一些 C++ 小程式的簡單驗證，因此&lt;strong&gt;簡單易用&lt;/strong&gt;是我首要的選擇條件，而 Catch2 應該是目前找的到最好的選擇，例如這是個 &lt;a href=&#34;https://en.wikipedia.org/wiki/Huffman_coding&#34;&gt;Huffman coding&lt;/a&gt; 的測試代碼:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TEST_CASE(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HuffmanEncoding&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Symbol&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; symbols{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8.17&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.49&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.78&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;d&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4.25&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;e&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;12.7&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;f&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.23&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;g&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.02&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;h&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6.09&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;i&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6.97&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;j&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;k&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.77&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4.03&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;m&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.41&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6.75&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;7.51&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;p&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.93&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.10&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;r&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5.99&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6.33&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;9.06&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;u&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.76&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;v&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.98&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;w&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.36&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1.97&lt;/span&gt;}, {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;z&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.07&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    HuffmanEncoding(symbols);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    REQUIRE(symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;].code &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1110&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    REQUIRE(symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;e&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;].code &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    REQUIRE(symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;].code &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;000&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    REQUIRE(symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;z&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;].code &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;001001000&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;可以看到代碼非常地簡潔而易懂，你只要學怎麼用 &lt;code&gt;TEST_CASE&lt;/code&gt; 及 &lt;code&gt;REQUIRE&lt;/code&gt; 就好了。&lt;/p&gt;
&lt;h3 id=&#34;如何使用-catch&#34;&gt;如何使用 Catch&lt;/h3&gt;
&lt;p&gt;中文的介紹可以參考 &lt;a href=&#34;http://blog.guorongfei.com/2016/08/22/cpp-unit-test-catch/&#34;&gt;“C++ 的单元测试工具 —— Catch | 时习之”&lt;/a&gt;，只是關於如何 &lt;code&gt;#include &amp;quot;catch.hpp&amp;quot;&lt;/code&gt; 的部分我覺得描述的不是很精確，建議可以讀一下 &lt;a href=&#34;https://github.com/catchorg/Catch2/blob/master/docs/slow-compiles.md&#34;&gt;&amp;ldquo;Why do my tests take so long to compile?&amp;rdquo;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;真的很介意 compile time 受到影響的人，可以考慮關掉一些沒用到的功能來加速編譯: &lt;a href=&#34;https://github.com/catchorg/Catch2/blob/master/docs/configuration.md#other-toggles&#34;&gt;Catch2/configuration&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;catch2-的原理&#34;&gt;Catch2 的原理&lt;/h3&gt;
&lt;h3 id=&#34;神奇的-require&#34;&gt;神奇的 REQUIRE&lt;/h3&gt;
&lt;p&gt;有用過其他的 C++ test framework 例如 &lt;a href=&#34;https://github.com/google/googletest&#34;&gt;googletest&lt;/a&gt; 的人，應該會對 Catch 的 &lt;code&gt;REQUIRE&lt;/code&gt; 感到好奇:&lt;/p&gt;
&lt;p&gt;為什麼 googletest 需要使用較不自然的 &lt;code&gt;ASSERT_EQ(a, b)&lt;/code&gt;, &lt;code&gt;ASSERT_NE(a, b)&lt;/code&gt; 而 Catch 只需要寫 &lt;code&gt;REQUIRE(a == b)&lt;/code&gt; 及 &lt;code&gt;REQUIRE(a != b)&lt;/code&gt;？&lt;/p&gt;
&lt;h4 id=&#34;拆解表達式-decomposing-an-expression&#34;&gt;拆解表達式 (Decomposing an expression)&lt;/h4&gt;
&lt;p&gt;考慮下列這個有問題的 &lt;code&gt;Factorial&lt;/code&gt; 實作及它的測試代碼:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Factorial&lt;/span&gt;( &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; number ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; number &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; number : Factorial( number &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; ) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; number;  &lt;span style=&#34;color:#75715e&#34;&gt;// fail
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TEST_CASE( &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Factorial of 0 is 1 (fail)&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[single-file]&amp;#34;&lt;/span&gt; ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    REQUIRE( Factorial(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;REQUIRE(Factorial(0) == 1);&lt;/code&gt; 會輸出下列的結果:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;010&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;TestCase.cpp:&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; failed: &lt;span style=&#34;color:#a6e22e&#34;&gt;Factorial&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這表示 &lt;code&gt;REQUIRE&lt;/code&gt; 需要從 &lt;code&gt;Factorial(1) == 1&lt;/code&gt; 拆解出下列五個資訊：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;整個表達式 &amp;ldquo;Factorial(0) == 1&amp;rdquo; 的字串值&lt;/li&gt;
&lt;li&gt;表達式左邊 Factorial(0) 的結果，也就是 0&lt;/li&gt;
&lt;li&gt;使用的 operator, 也就是 &amp;ldquo;==&amp;rdquo;&lt;/li&gt;
&lt;li&gt;表達式右邊 1 的值，也就是常量 1&lt;/li&gt;
&lt;li&gt;表達式的結果，在這個例子是 false&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;也就是說 Catch2 必須在 compile time 拆解這個表達式，這裡需要用到一些 &lt;a href=&#34;https://en.wikipedia.org/wiki/Template_metaprogramming&#34;&gt;template metaprogramming&lt;/a&gt; 的技巧。&lt;/p&gt;
&lt;h4 id=&#34;require&#34;&gt;REQUIRE&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;REQUIRE&lt;/code&gt; 是用 macro 來定義的，所以整個表達式的字串值可以簡單用 &lt;a href=&#34;http://gcc.gnu.org/onlinedocs/gcc-3.4.3/cpp/Stringification.html&#34;&gt;stringification&lt;/a&gt; 拿到。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define REQUIRE( ... ) INTERNAL_CATCH_TEST( &amp;#34;REQUIRE&amp;#34;, Catch::ResultDisposition::Normal, __VA_ARGS__  )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define INTERNAL_CATCH_TEST( macroName, resultDisposition, ... ) \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    do { \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;        Catch::AssertionHandler catchAssertionHandler( macroName, CATCH_INTERNAL_LINEINFO, CATCH_INTERNAL_STRINGIFY(__VA_ARGS__), resultDisposition ); \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;        INTERNAL_CATCH_TRY { \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;            CATCH_INTERNAL_SUPPRESS_PARENTHESES_WARNINGS \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;            catchAssertionHandler.handleExpr( Catch::Decomposer() &amp;lt;= __VA_ARGS__ ); \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;            CATCH_INTERNAL_UNSUPPRESS_PARENTHESES_WARNINGS \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;        } INTERNAL_CATCH_CATCH( catchAssertionHandler ) \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;        INTERNAL_CATCH_REACT( catchAssertionHandler ) \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    } while( (void)0, false &amp;amp;&amp;amp; static_cast&amp;lt;bool&amp;gt;( !!(__VA_ARGS__) ) ) &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the expression here is never evaluated at runtime but it forces the compiler to give it a look
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// The double negation silences MSVC&amp;#39;s C4800 warning, the static_cast forces short-circuit evaluation if the type has overloaded &amp;amp;&amp;amp;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;catchdecomposer&#34;&gt;Catch::Decomposer&lt;/h4&gt;
&lt;p&gt;而 2, 3, 4 的部分就要靠 &lt;code&gt;Catch::Decomposer&lt;/code&gt;，這裡用的
template metaprogramming 技巧叫作 &lt;a href=&#34;https://en.wikipedia.org/wiki/Expression_templates&#34;&gt;expression template&lt;/a&gt;。&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Decomposer&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; ( T &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; lhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; ExprLhs&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ExprLhs&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt;{ lhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; ( &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; value ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; ExprLhs&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ExprLhs&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;{ value };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;Decomposer&lt;/code&gt; 用 &lt;code&gt;&amp;lt;=&lt;/code&gt; 跟表達式的左邊結合變成 &lt;code&gt;ExprLhs&amp;lt;T const &amp;amp;&amp;gt;&lt;/code&gt;，&lt;code&gt;ExprLhs&lt;/code&gt; 是個 C++ template:&lt;/p&gt;
&lt;h4 id=&#34;exprlhs&#34;&gt;ExprLhs&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; LhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExprLhs&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    LhsT m_lhs;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;explicit&lt;/span&gt; ExprLhs( LhsT lhs ) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; m_lhs( lhs ) {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { compareEqual( m_lhs, rhs ), m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;==&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; ( &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;==&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { compareNotEqual( m_lhs, rhs ), m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;!=&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; ( &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;!=&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;gt;&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;lt;&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;gt;=&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; ( RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; rhs ) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; BinaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT, RhsT &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { m_lhs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; rhs, m_lhs, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;lt;=&amp;#34;&lt;/span&gt;, rhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;makeUnaryExpr&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; UnaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; UnaryExpr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;{ m_lhs };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ExprLhr&lt;/code&gt; 利用 operator overloading 來知道是用那個 operator 跟表達式的右邊做運算，最後把整個表達式轉換成一個 &lt;code&gt;BinaryExpr&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&#34;binaryexpr&#34;&gt;BinaryExpr&lt;/h4&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; LhsT, &lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RhsT&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;BinaryExpr&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; ITransientExpression {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    LhsT m_lhs;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    StringRef m_op;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RhsT m_rhs;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    BinaryExpr( &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; comparisonResult, LhsT lhs, StringRef op, RhsT rhs )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;   ITransientExpression{ true, comparisonResult },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m_lhs( lhs ),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m_op( op ),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m_rhs( rhs )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;之前我們提到的 2, 3, 4, 5 的資訊就存在 &lt;code&gt;BinaryExpr&lt;/code&gt; 的 &lt;code&gt;m_lhs&lt;/code&gt;, &lt;code&gt;m_op&lt;/code&gt;, &lt;code&gt;m_rhs&lt;/code&gt;, 及 &lt;code&gt;ITransientExpression&lt;/code&gt; 裡面。&lt;/p&gt;
&lt;h3 id=&#34;搭配-clion-使用&#34;&gt;搭配 CLion 使用&lt;/h3&gt;
&lt;p&gt;另外我還蠻推薦使用 JetBrains 的 C++ IDE: &lt;a href=&#34;https://www.jetbrains.com/clion/&#34;&gt;CLion&lt;/a&gt;，它目前有&lt;a href=&#34;https://blog.jetbrains.com/clion/2017/03/to-catch-a-clion/&#34;&gt;內建 Catch2 的支援&lt;/a&gt;，用它執行測試非常地簡單方便:&lt;/p&gt;
&lt;img width=&#34;100%&#34; src=&#39;https://blog.simplypatrick.com/posts/2018/03-10-catch2/failing-test.png&#39;&gt;
</description>
    </item>
    
    <item>
      <title>Kotlin Coroutines and Threads</title>
      <link>https://blog.simplypatrick.com/posts/2018/02-14-kotlin-coroutines-and-threads/</link>
      <pubDate>Wed, 14 Feb 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2018/02-14-kotlin-coroutines-and-threads/</guid>
      <description>&lt;h3 id=&#34;coroutine-跟-thread-的關係&#34;&gt;Coroutine 跟 thread 的關係&lt;/h3&gt;
&lt;p&gt;Coroutine 通常可以理解成輕量化的 thread，但實際運作還是需要被排程到作業系統層級的 thread，然後再被排程到某個 CPU來執行：&lt;/p&gt;
&lt;img src=&#34;https://docs.google.com/drawings/d/e/2PACX-1vR6ZVOirpUEhDxVjbJJgJiSzTdXsvn5IXRjTh8oqZ4JoHg04JhqsU6vTjjCK_BVvwdbIky5oYDzjMWI/pub?w=398&amp;amp;h=284&#34;&gt;
&lt;p&gt;相對於 thread，使用 coroutine 的好處是， coroutine 之間的切換快速，需要耗用的系統資源也比較小。&lt;/p&gt;
&lt;h3 id=&#34;coroutine-如何排程&#34;&gt;Coroutine 如何排程？&lt;/h3&gt;
&lt;p&gt;Kotlin 的 coroutine 會被分派到那個 thread 是由呼叫 coroutine builder 時提供的 &lt;code&gt;CoroutineContext&lt;/code&gt; 參數來決定。&lt;/p&gt;
&lt;p&gt;透過觀察這個&lt;a href=&#34;https://github.com/yinghau76/kotlin-playground/blob/29bb2f7a5385047bcd1a9b0303d2cb70f1f2dd7e/app/src/main/java/com/simplypatrick/android/coroutines/CoroutineContextActivity.kt#L7&#34;&gt;範例&lt;/a&gt;的輸出，我們可以了解不同 &lt;code&gt;CoroutineContext&lt;/code&gt; 的行為：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CoroutineContextActivity&lt;/span&gt; : ConsoleActivity() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;(savedInstanceState: Bundle?) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;.onCreate(savedInstanceState)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Begin onCreate&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        launch(UI) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Begin launch(UI)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;10_000&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End launch(UI)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        launch(CommonPool) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Begin launch(CommonPool)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;10_000&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End launch(CommonPool)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        launch(Unconfined) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Begin launch(Unconfined)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;10_000&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End launch(Unconfined)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        launch(newSingleThreadContext(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;MyOwnThread&amp;#34;&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Begin launch(newSingleThreadContext)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;10_000&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End launch(newSingleThreadContext)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        logThread(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;End onCreate&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;logThread&lt;/span&gt;(msg: String) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        println(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$msg&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${Thread.currentThread().name}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;結果：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1:48:50:866 (   1) Begin onCreate: main
1:48:50:937 (   1) Begin launch(Unconfined): main
1:48:50:938 (1719) Begin launch(CommonPool): ForkJoinPool.commonPool-worker-2
1:48:50:967 (   1) End onCreate: main
1:48:50:968 (1721) Begin launch(newSingleThreadContext): MyOwnThread
1:48:51:015 (   1) Begin launch(UI): main
1:49:00:971 (1721) End launch(newSingleThreadContext): MyOwnThread
1:49:00:973 (1720) End launch(Unconfined): kotlinx.coroutines.DefaultExecutor
1:49:00:980 (1724) End launch(CommonPool): ForkJoinPool.commonPool-worker-1
1:49:01:016 (   1) End launch(UI): main&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;心得：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Unconfined&lt;/code&gt; 在 suspend 之前會是由 calling thread 直接執行，suspend 之後則是用 DefaultExecutor thread 來執行。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CommonPool&lt;/code&gt; 會是由 common thread pool 裡面的 thread 來執行，suspend 前後被分配的 thread 有可能不同。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UI&lt;/code&gt; 只能在 main thread 上執行，並且因為是依賴 Android Looper 來實現的，coroutine 會在 onCreate 結束後才被執行到。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;newSingleThreadContext&lt;/code&gt; 會由新產生的 thread 來執行，因爲創建新的 thread 需要一點時間，coroutine 是在 onCreate 結束後才被呼叫到。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這樣的設計主要有兩個優點：一來提供彈性讓使用者根據使用情境決定要使用那些 thread，二來提供擴充性讓使用者可以設計不一樣的 thread dispatching strategy。&lt;/p&gt;
&lt;p&gt;如果想要掌握更進階的 coroutine 用法，&lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md#coroutine-context-and-dispatchers&#34;&gt;Coroutine context and dispatchers&lt;/a&gt; 是很不錯的使用指南。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kotlin Coroutine API</title>
      <link>https://blog.simplypatrick.com/posts/2018/02-13-kotlin-coroutines-api/</link>
      <pubDate>Tue, 13 Feb 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2018/02-13-kotlin-coroutines-api/</guid>
      <description>&lt;h3 id=&#34;kotlin-coroutine-的架構&#34;&gt;Kotlin Coroutine 的架構&lt;/h3&gt;
&lt;p&gt;Kotlin 從 1.1 版開始實驗性地支援 coroutine，主要的目標是簡化非同步編程的複雜度。&lt;a href=&#34;https://www.kotlindevelopment.com/deep-dive-coroutines/&#34;&gt;Diving deep into Kotlin Coroutines&lt;/a&gt; 解釋了 coroutine 跟一般常用的 callback 及目前蠻多人在用的 reactive 模式有何不同。&lt;/p&gt;
&lt;p&gt;由於目前 &lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines&#34;&gt;kotlinx-coroutines-core&lt;/a&gt; 的實現包含了不同抽象程度的 API，初學者建議可以用下面這張圖來學習如何使用 Kotlin coroutine：&lt;/p&gt;
&lt;img src=&#34;https://docs.google.com/drawings/d/e/2PACX-1vR70Re48nVLUrBy7crWv4oBTGeDsWKAYmYz2zFCb0NZCnUwd7vmh2LZFsJs9bgeBrLjs7oRrwV_rDQD/pub?w=360&amp;amp;h=284&#34;&gt;
&lt;h3 id=&#34;範例分析&#34;&gt;範例分析&lt;/h3&gt;
&lt;p&gt;套用下面這個&lt;a href=&#34;https://proandroiddev.com/approaching-kotlin-coroutines-an-extensive-feature-concurrent-programming-in-kotlin-eaaa19b003d2&#34;&gt;範例&lt;/a&gt;來理解:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;suspend&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sendEmail&lt;/span&gt;(r: String, msg: String): Boolean { &lt;span style=&#34;color:#75715e&#34;&gt;// 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;2000&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Sent &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$msg&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; to &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;suspend&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;getReceiverAddressFromDatabase&lt;/span&gt;(): String { &lt;span style=&#34;color:#75715e&#34;&gt;// 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;coroutine@kotlin.org&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;suspend&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sendEmailSuspending&lt;/span&gt;(): Boolean { &lt;span style=&#34;color:#75715e&#34;&gt;// 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; msg = &lt;span style=&#34;color:#75715e&#34;&gt;/* 1 */&lt;/span&gt; async(CommonPool) { &lt;span style=&#34;color:#75715e&#34;&gt;// 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        delay(&lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The message content&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; recipient = &lt;span style=&#34;color:#75715e&#34;&gt;/* 1 */&lt;/span&gt; async(CommonPool) { &lt;span style=&#34;color:#75715e&#34;&gt;// 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        getReceiverAddressFromDatabase()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Waiting for email data&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; sendStatus = &lt;span style=&#34;color:#75715e&#34;&gt;/* 1 */&lt;/span&gt; async(CommonPool) { &lt;span style=&#34;color:#75715e&#34;&gt;// 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sendEmail(recipient.await(), msg.await()) &lt;span style=&#34;color:#75715e&#34;&gt;// 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; sendStatus.await()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(args: Array&amp;lt;String&amp;gt;) = &lt;span style=&#34;color:#75715e&#34;&gt;/* 1 */&lt;/span&gt; runBlocking(CommonPool) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; job = &lt;span style=&#34;color:#75715e&#34;&gt;/* 1 */&lt;/span&gt; launch(CommonPool) { &lt;span style=&#34;color:#75715e&#34;&gt;// 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sendEmailSuspending()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        println(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Email sent successfully.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    job.join() &lt;span style=&#34;color:#75715e&#34;&gt;// 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Finished&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其中：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;runBlocking&lt;/code&gt;, &lt;code&gt;launch&lt;/code&gt;, 及 &lt;code&gt;async&lt;/code&gt; 是最常被使用的 coroutine builder。&lt;/li&gt;
&lt;li&gt;coroutine builder 後面跟著的就是我們撰寫的 suspending lambda，可以視為 coroutine 的進入點。&lt;/li&gt;
&lt;li&gt;通常在 suspending lambda 裡會再呼叫其他 suspending function，例如 &lt;code&gt;sendEmailSuspending&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delay&lt;/code&gt;, &lt;code&gt;Job.join&lt;/code&gt;, &lt;code&gt;Deferred.await&lt;/code&gt; 則是用來&lt;strong&gt;等待&lt;/strong&gt;的 high-level API。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;high-level-api&#34;&gt;High-level API&lt;/h3&gt;
&lt;p&gt;範例中的 &lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md#concurrent-using-async&#34;&gt;async/await&lt;/a&gt; 並不是目前唯一支援的 concurrency pattern，目前看到正在開發中的還有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Golang 的 &lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md#channels&#34;&gt;channel/select&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Python 的 &lt;a href=&#34;https://kotlinlang.org/docs/reference/coroutines.html#generators-api-in-kotlincoroutines&#34;&gt;generator/yield&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Erlang 或 Scala 的 &lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md#actors&#34;&gt;Actor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Java 的 &lt;a href=&#34;https://github.com/Kotlin/kotlinx.coroutines/tree/master/reactive/kotlinx-coroutines-reactor&#34;&gt;Reactor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;low-level-api&#34;&gt;Low-level API&lt;/h3&gt;
&lt;p&gt;所有的 coroutine 機制都是基於底層的 &lt;a href=&#34;https://kotlinlang.org/docs/reference/coroutines.html#low-level-api-kotlincoroutines&#34;&gt;low-level API&lt;/a&gt; 來實現的。之後有時間的話會再研究並分享 high-level API 是如何用 low-level API 來實現的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Devdocs Desktop</title>
      <link>https://blog.simplypatrick.com/posts/2018/01-22-devdocs-desktop/</link>
      <pubDate>Mon, 22 Jan 2018 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2018/01-22-devdocs-desktop/</guid>
      <description>&lt;h3 id=&#34;寫code之前先讀api&#34;&gt;寫(code)之前先讀(API)&lt;/h3&gt;
&lt;p&gt;當一個軟體開發者，需要花蠻多時間來閱讀文檔以便了解如何使用某個 API 以及各種情況下它會表現的行為，因此學習如何有效率地查詢及閱讀了解 API 是蠻重要的能力。基本上如果某個 library 是你工作上常用到的，我會建議你從頭到尾把所有文件至少讀一遍，而不是需要用到時才去查。&lt;/p&gt;
&lt;h3 id=&#34;dash-好用但是&#34;&gt;Dash 好用，但是&amp;hellip;&lt;/h3&gt;
&lt;p&gt;在 macOS 上，我過去是習慣使用 &lt;a href=&#34;https://kapeli.com/dash&#34;&gt;Dash&lt;/a&gt; 這工具來查詢 API，一是它整合了蠻多常用的 API 文檔，二來它查詢的速度還不錯，就個人使用上算是很好的投資，所以當時就在 App Store 買了正式版。然而好景不常，當 Dash 3 出來後，2.x 版本就常發生文件顯示不出來的問題，讓我有點惱火:angry:，這樣的品質再加上發生 &lt;a href=&#34;https://www.imore.com/whats-happening-dash-and-app-store&#34;&gt;被 App Store 下架&lt;/a&gt; 的事件，要我再付錢買 3.x 版本是不可能的事。&lt;/p&gt;
&lt;h3 id=&#34;zeal-是-linux-或-windows-上不錯的選擇&#34;&gt;Zeal 是 Linux 或 Windows 上不錯的選擇&lt;/h3&gt;
&lt;p&gt;之前找到比較好的替代方案是 &lt;a href=&#34;https://zealdocs.org/&#34;&gt;Zeal&lt;/a&gt;, 但是 Zeal 的 docset 是 Dash 提供的，道義上不能跟 Dash 打對台，因此官方並不提供 macOS 的版本。建議的解決方案是用 Wine 在 macOS 上執行 Windows 版本的 Zeal，我試過是可行的，搞定一些小問題後運作上還算正常。&lt;/p&gt;
&lt;h3 id=&#34;devdocsio-更棒&#34;&gt;devdocs.io 更棒&lt;/h3&gt;
&lt;p&gt;另一個更好的選擇是 &lt;a href=&#34;https://devdocs.io/&#34;&gt;devdocs.io&lt;/a&gt;，無須安裝直接網頁打開就可查詢。想要 desktop 版本? 沒問題! 這種網站最適合用 Electron 來包了: &lt;a href=&#34;https://devdocs.egoist.moe/&#34;&gt;DevDocs Desktop&lt;/a&gt;。這是我目前最推薦的 API 文檔工具，跨 macOS, Linux, Windows 都可以使用且免費，太佛心了。&lt;/p&gt;
&lt;img src=&#34;https://user-images.githubusercontent.com/8784712/27121730-11676ba8-511b-11e7-8c01-00444ee8501a.png&#34; width=&#34;100%&#34;/&gt;
</description>
    </item>
    
    <item>
      <title>Better Way to Request Runtime Permissions</title>
      <link>https://blog.simplypatrick.com/posts/2016/05-30-requesting-runtime-permission/</link>
      <pubDate>Mon, 30 May 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/05-30-requesting-runtime-permission/</guid>
      <description>&lt;p&gt;If you are an Android developer, you definitely know an important change beginning in Android 6.0 (API 23) is run time permission: users grant permissions to apps while the app is running, not when they install the app. &lt;a href=&#34;https://developer.android.com/training/permissions/requesting.html&#34;&gt;This official training guide&lt;/a&gt; explains clearly how you can
check for permission and request them at runtime.&lt;/p&gt;
&lt;p&gt;Let me list the sample code in the training guide so that you can understand what improvements I would like to do with them:&lt;/p&gt;
&lt;h3 id=&#34;check-for-permissions&#34;&gt;Check for Permissions&lt;/h3&gt;
&lt;pre data-line=&#34;7, 12, 17&#34;&gt;&lt;code class=&#34;language-java&#34;&gt;// Here, thisActivity is the current activity
if (ContextCompat.checkSelfPermission(thisActivity, Manifest.permission.READ_CONTACTS)
        != PackageManager.PERMISSION_GRANTED) {
    // Should we show an explanation?
    if (ActivityCompat.shouldShowRequestPermissionRationale(thisActivity,
            Manifest.permission.READ_CONTACTS)) {
        // Show an expanation to the user *asynchronously* -- don&#39;t block
        // this thread waiting for the user&#39;s response! After the user
        // sees the explanation, try again to request the permission.
    } else {
        // No explanation needed, we can request the permission.
        ActivityCompat.requestPermissions(thisActivity,
                new String[]{Manifest.permission.READ_CONTACTS},
                MY_PERMISSIONS_REQUEST_READ_CONTACTS);
    }
} else {
  // permission was granted, yay! Do the task you need to do.
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;request-permissions&#34;&gt;Request Permissions&lt;/h3&gt;
&lt;pre data-line=&#34;8&#34;&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void onRequestPermissionsResult(int requestCode, String permissions[], int[] grantResults) {
    switch (requestCode) {
        case MY_PERMISSIONS_REQUEST_READ_CONTACTS: {
            // If request is cancelled, the result arrays are empty.
            if (grantResults.length &gt; 0
                &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                // permission was granted, yay! Do the task you need to do.
            } else {
                // permission denied, boo! Disable the
                // functionality that depends on this permission.
            }
            return;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The sample code looks nice but it does not work so well in real-world projects for several reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The sample structure encourages you to write duplicated code:
&lt;ul&gt;
&lt;li&gt;There are two places your app have to perform the real task:
&lt;ul&gt;
&lt;li&gt;while permission is already granted - line 17&lt;/li&gt;
&lt;li&gt;while permission is granted after user interaction - line 8&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;There are two places your app have to request the permission:
&lt;ul&gt;
&lt;li&gt;after user see the explanation and decide to request permission again - line 7&lt;/li&gt;
&lt;li&gt;while no explanation is needed - line 12&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;When permission is finally granted from user, the original context has lost. For example, when my app tries to make a phone call, the context is the phone number. A typical solution is to store the context in class field, such as a &lt;code&gt;mPhoneNumberToCall&lt;/code&gt;. It is bad and something I would like to avoid.&lt;/li&gt;
&lt;li&gt;The sample code does not suggest how to show an explanation asynchronously.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;more-elegant-solution&#34;&gt;More Elegant Solution&lt;/h3&gt;
&lt;p&gt;My basic idea is using &lt;code&gt;Runnable&lt;/code&gt; (with help of Java8 lambda) to capture the context and prevent duplication. Here is my way to :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The original task is wrapped as a &lt;code&gt;Runnable&lt;/code&gt; that can be stored in &lt;code&gt;HashMap&lt;/code&gt; and retrieved later for execution without repeating its logic. All necessary information can be captured when the lambda is created.&lt;/li&gt;
&lt;li&gt;The runnable task is wrapped again by a permission checker which is also an &lt;code&gt;Runnable&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;Snackbar&lt;/code&gt; to show an explanation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here is revised version of original sample code:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; HashMap&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String, Runnable&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; mPendingPermissionRequests &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; HashMap&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; PENDING_PERMISSION_REQUESTS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; Runnable &lt;span style=&#34;color:#a6e22e&#34;&gt;newPermissionRequester&lt;/span&gt;(Activity activity, String permission, String explanation, Runnable task) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; () &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ContextCompat.&lt;span style=&#34;color:#a6e22e&#34;&gt;checkSelfPermission&lt;/span&gt;(activity, permission) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; PackageManager.&lt;span style=&#34;color:#a6e22e&#34;&gt;PERMISSION_GRANTED&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            task.&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Runnable requestPermission &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; () &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ActivityCompat.&lt;span style=&#34;color:#a6e22e&#34;&gt;requestPermissions&lt;/span&gt;(getActivity(), &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; String&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; {permission}, PENDING_PERMISSION_REQUESTS);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            mPendingPermissionRequests.&lt;span style=&#34;color:#a6e22e&#34;&gt;put&lt;/span&gt;(permission, task);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// Should we show an explanation?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ActivityCompat.&lt;span style=&#34;color:#a6e22e&#34;&gt;shouldShowRequestPermissionRationale&lt;/span&gt;(activity, permission)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Show an explanation to the user *asynchronously* -- don&amp;#39;t block this thread waiting for the user&amp;#39;s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// response! After the user sees the explanation, try again to request the permission.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Snackbar.&lt;span style=&#34;color:#a6e22e&#34;&gt;make&lt;/span&gt;(getView(), explanation, Snackbar.&lt;span style=&#34;color:#a6e22e&#34;&gt;LENGTH_LONG&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    .&lt;span style=&#34;color:#a6e22e&#34;&gt;setAction&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;string&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;, v &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        requestPermission.&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    .&lt;span style=&#34;color:#a6e22e&#34;&gt;show&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// No explanation needed, we can request the permission.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            requestPermission.&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onRequestPermissionsResult&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; requestCode, &lt;span style=&#34;color:#a6e22e&#34;&gt;@NonNull&lt;/span&gt; String&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; permissions, &lt;span style=&#34;color:#a6e22e&#34;&gt;@NonNull&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; grantResults) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (requestCode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; PENDING_PERMISSION_REQUESTS) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; permissions.&lt;span style=&#34;color:#a6e22e&#34;&gt;length&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            String permission &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; permissions&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (grantResults&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; PackageManager.&lt;span style=&#34;color:#a6e22e&#34;&gt;PERMISSION_GRANTED&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; mPendingPermissionRequests.&lt;span style=&#34;color:#a6e22e&#34;&gt;containsKey&lt;/span&gt;(permission)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#75715e&#34;&gt;// permission was granted, yay! Do the task you need to do.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                mPendingPermissionRequests.&lt;span style=&#34;color:#a6e22e&#34;&gt;remove&lt;/span&gt;(permission).&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is an example to make a phone call:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newPermissionRequester(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getActivity(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Manifest.&lt;span style=&#34;color:#a6e22e&#34;&gt;permission&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CALL_PHONE&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;// permission to request&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getString(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;string&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;call_phone_permission&lt;/span&gt;),  &lt;span style=&#34;color:#75715e&#34;&gt;// explanation to user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    () &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; startActivity(&lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Intent(Intent.&lt;span style=&#34;color:#a6e22e&#34;&gt;ACTION_CALL&lt;/span&gt;, Uri.&lt;span style=&#34;color:#a6e22e&#34;&gt;fromParts&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tel&amp;#34;&lt;/span&gt;, phone.&lt;span style=&#34;color:#a6e22e&#34;&gt;number&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;))))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Of course you can try extracting a more reusable &lt;code&gt;PermissionRequester&lt;/code&gt; class but this is good enough for me.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Elements of Good Commit Messages</title>
      <link>https://blog.simplypatrick.com/posts/2016/05-12-the-elements-of-good-commit-messages/</link>
      <pubDate>Thu, 12 May 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/05-12-the-elements-of-good-commit-messages/</guid>
      <description>&lt;p&gt;通常從 commit messages 就可以看出一個軟體開發團隊是否有紀律、注重品質、並且彼此溝通良好。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://wildbit.com/blog/2008/11/11/the-importance-of-commit-messages&#34;&gt;The importance of commit messages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bryanwrit.es/here/2014/crafting-commits-and-the-importance-of-commit-messages/&#34;&gt;Crafting Commits and the Importance of Commit Messages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.spearce.org/2010/02/why-commit-messages-matter.html&#34;&gt;Why commit messages matter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;如何寫好-commit-message&#34;&gt;如何寫好 commit message&lt;/h4&gt;
&lt;p&gt;這是我去年在公司內部做的一個 presentation，目的是讓大家知道要在 commit message 寫那些東西:&lt;/p&gt;
&lt;script async class=&#34;speakerdeck-embed&#34; data-id=&#34;242af003662c4ed6bfcd77c6bf50b65e&#34; data-ratio=&#34;1.77777777777778&#34; src=&#34;//speakerdeck.com/assets/embed.js&#34;&gt;&lt;/script&gt;
&lt;h4 id=&#34;負面範例&#34;&gt;負面範例&lt;/h4&gt;
&lt;p&gt;請至少避免寫這些&lt;a href=&#34;http://www.codelord.net/2015/03/16/bad-commit-messages-hall-of-shame/&#34;&gt;沒有意義的 commit message&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在 Android 上使用 OpenCV 的臉部偵測及辨識</title>
      <link>https://blog.simplypatrick.com/posts/2016/03-05-face-detection-with-opencv-on-android/</link>
      <pubDate>Sat, 05 Mar 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/03-05-face-detection-with-opencv-on-android/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://docs.google.com/document/d/1QcD_bUKW8wNb8tYZpFJ-NbwgTAjkgAWFc-gz23cBUUI/edit?usp=sharing&#34;&gt;兩年多前研究了一下在 Android 上如何用 OpenCV 做臉部偵測及辨識&lt;/a&gt;。主要的使用情境如下圖:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;client-architecture.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;因為輸入來源是攝影機的視訊，當時的想法是初步的偵測及辨識還是由裝置執行，比較複雜的計算再上傳到 server 執行：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;components.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;這幾年許多大廠例如 Google, Facebook, 及 Microsoft 都積極投入發展人工智慧及臉部辨識技術，現在臉部辨識已經是 Mobile OS 上的必備功能:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.projectoxford.ai/face&#34;&gt;Face API of Microsoft Project Oxford&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developers.google.com/vision/face-detection-concepts&#34;&gt;Face API of Mobile Video from Google&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_detect_faces/ci_detect_faces.html&#34;&gt;Detecting Faces in an Image on Apple iOS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;當時只是簡單弄了一個 prototype，現在回頭看，大致上設計沒有差太多，倒是 &lt;a href=&#34;https://developers.google.com/android/reference/com/google/android/gms/vision/package-summary&#34;&gt;API 設計上&lt;/a&gt;可以多跟人家學習學習:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Tracker&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Tracker&lt;/span&gt;() {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onNewItem&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; id, T item) {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onUpdate&lt;/span&gt;(Detections&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; detections, T item) {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onMissing&lt;/span&gt;(Detections&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; detections) {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onDone&lt;/span&gt;() {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>Redesign Listener with RxJava on Android</title>
      <link>https://blog.simplypatrick.com/posts/2016/03-04-using-rxjava-on-android/</link>
      <pubDate>Fri, 04 Mar 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/03-04-using-rxjava-on-android/</guid>
      <description>&lt;h3 id=&#34;background&#34;&gt;Background&lt;/h3&gt;
&lt;p&gt;In my Android app, I used the following typical Listener pattern to monitor updates from models:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Listener&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onUpdate&lt;/span&gt;(List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Item&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; list);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Model&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;addListener&lt;/span&gt;(Listener l);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;removeListener&lt;/span&gt;(Listener l);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Listeners are implemented by several &lt;a href=&#34;http://developer.android.com/guide/components/fragments.html&#34;&gt;Fragments&lt;/a&gt; that expect update notifications coming from a global model object. The updating may be triggered manually by user or periodically by a scheduler.&lt;/p&gt;
&lt;p&gt;After learning RxJava, I would like to simplify the model interface and at the same time remove the boilerplate of maintaining listener list in model implementation:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Model&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Observable&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Item&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;getItems&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;dealing-with-different-life-cycles&#34;&gt;Dealing with Different Life Cycles&lt;/h3&gt;
&lt;p&gt;Note that Listeners (i.e. Fragments) are registered to model during &lt;a href=&#34;http://developer.android.com/reference/android/app/Fragment.html#onResume()&#34;&gt;&lt;code&gt;Fragment.onResume&lt;/code&gt;&lt;/a&gt; and unregistered during &lt;a href=&#34;http://developer.android.com/reference/android/app/Fragment.html#onPause()&#34;&gt;&lt;code&gt;Fragment.onPause&lt;/code&gt;&lt;/a&gt; but &lt;code&gt;Observable&lt;/code&gt; are typically designed to be created for each update. That means I need a middleman that can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Subscribe to new Observable for each update&lt;/li&gt;
&lt;li&gt;Manage listener list&lt;/li&gt;
&lt;li&gt;Notify listener when source Observable has completed its emission&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;subject-to-rescue-us&#34;&gt;Subject to Rescue Us&lt;/h3&gt;
&lt;p&gt;The middleman can be implemented by deriving from &lt;a href=&#34;https://github.com/ReactiveX/RxJava/wiki/Subject&#34;&gt;&lt;code&gt;Subject&lt;/code&gt;&lt;/a&gt; in RxJava:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A Subject is a sort of bridge or proxy that acts both as an Subscriber and as an Observable. Because it is a Subscriber, it can subscribe to one or more Observables, and because it is an Observable, it can pass through the items it observes by reemitting them, and it can also emit new items.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;What I need is a &lt;code&gt;Subject&lt;/code&gt; that can consume &lt;code&gt;T&lt;/code&gt; and emit &lt;code&gt;List&amp;lt;T&amp;gt;&lt;/code&gt;. Therefore Fragments can subscribe to this Subject once and this Subject subscribes to newly created source Observable for each update.&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Subject&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T, List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;createAggregateSubject&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Subscriber&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt; List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; observers &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; LinkedList&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; Observable.&lt;span style=&#34;color:#a6e22e&#34;&gt;OnSubscribe&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; onSubscribe &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; o &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        o.&lt;span style=&#34;color:#a6e22e&#34;&gt;onStart&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        observers.&lt;span style=&#34;color:#a6e22e&#34;&gt;add&lt;/span&gt;(o);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Subject&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T, List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;(onSubscribe) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; list &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; LinkedList&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;boolean&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;hasObservers&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;observers.&lt;span style=&#34;color:#a6e22e&#34;&gt;isEmpty&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onCompleted&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Iterables.&lt;span style=&#34;color:#a6e22e&#34;&gt;removeIf&lt;/span&gt;(observers, Subscriber::isUnsubscribed);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Subscriber&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt; List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; o: observers) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                o.&lt;span style=&#34;color:#a6e22e&#34;&gt;onNext&lt;/span&gt;(list);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            list.&lt;span style=&#34;color:#a6e22e&#34;&gt;clear&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onError&lt;/span&gt;(Throwable e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Subscriber&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt; List&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; o: observers) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                o.&lt;span style=&#34;color:#a6e22e&#34;&gt;onError&lt;/span&gt;(e);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onNext&lt;/span&gt;(T t) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            list.&lt;span style=&#34;color:#a6e22e&#34;&gt;add&lt;/span&gt;(t);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;reference&#34;&gt;Reference&lt;/h3&gt;
&lt;p&gt;To know more about how to use RxJava on Android, you can refer to &lt;a href=&#34;https://github.com/kaushikgopal/RxJava-Android-Samples&#34;&gt;Learning RxJava for Android by example&lt;/a&gt; for more creative usage.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Running Android Studio with Custom JDK</title>
      <link>https://blog.simplypatrick.com/posts/2016/02-28-running-android-studio-with-custom-jdk/</link>
      <pubDate>Sun, 28 Feb 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/02-28-running-android-studio-with-custom-jdk/</guid>
      <description>&lt;p&gt;IntelliJ is certainly the best Java IDE ever. However, IntelliJ-based Android Studio really bothers me much because it fails to render font antialiasing correctly compared with older version on OS X:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;as-font-bad.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://tools.android.com/tech-docs/configuration/osx-jdk&#34;&gt;Google&amp;rsquo;s suggestion to this issue&lt;/a&gt; is to use Oracle JDK 1.6 but I don&amp;rsquo;t like the idea to stick with out-of-dated JDK.&lt;/p&gt;
&lt;p&gt;Recently IntelliJ 15 fixed this issue by bundling custom JDK. After realizing the same fix is probably not on the priority list of Android Studio 2.0 release, I decided to look for a solution that applies the same change for IntelliJ 15 to Android Studio. Luckily, &lt;a href=&#34;https://www.reddit.com/r/androiddev/comments/3ve3z1/android_studio_subpixel_antialiasing_on_os_x_with/&#34;&gt;Someone had the same idea and provided a non-intrusive way to fix it&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I chose to modify &lt;code&gt;~/Library/Preferences/AndroidStudioPreview2.0/studio.jdk&lt;/code&gt; and point the JDK location to the custom one provided by IntelliJ 15 CE (in my case: &lt;code&gt;/Applications/IntelliJ IDEA 15 CE.app/Contents/jre/jdk&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Wow! The nice-looking Android Studio is back:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;as-font-good.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GN (Generate Ninja) 使用入門</title>
      <link>https://blog.simplypatrick.com/posts/2016/01-23-gn/</link>
      <pubDate>Sat, 23 Jan 2016 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2016/01-23-gn/</guid>
      <description>&lt;p&gt;2018/06/30 補充: Brett Wilson 的 &lt;a href=&#34;https://docs.google.com/presentation/d/15Zwb53JcncHfEwHpnG_PoIbbzQ3GQi_cpujYwbpcbZo/edit?usp=sharing&#34;&gt;Using GN build&lt;/a&gt; 是我目前看過對 GN 最棒的介紹，強力推薦!&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.simplypatrick.com/2012/08/18/ninja-a-small-build-system&#34;&gt;好久之前介紹過 Ninja&lt;/a&gt;, 當時有提到 Ninja 通常是搭配 meta-build system (例如 CMake 或是 GYP) 來使用，這次要介紹的 &lt;a href=&#34;https://chromium.googlesource.com/chromium/src/tools/gn/&#34;&gt;GN&lt;/a&gt; 則是 Chromium project 用來取代 GYP 的新工具。&lt;/p&gt;
&lt;p&gt;由於 GN 是用 C++ 撰寫，比起用 Python 寫的 GYP 快了將近 20 倍，GN 新的 DSL 的語法也被認為是比較好讀及維護的。&lt;/p&gt;
&lt;h3 id=&#34;安裝-gn&#34;&gt;安裝 GN&lt;/h3&gt;
&lt;p&gt;由於 gn 目前還依賴 Chromium 裡的一些函式庫，目前比較方便的方式還是從 source 編譯，Linux/Mac 上可以依照下列步驟：&lt;/p&gt;
&lt;script src=&#34;//gist.github.com/mohamed/4fa7eb75807463d4dfa3.js&#34;&gt;&lt;/script&gt;
&lt;h3 id=&#34;基本範例&#34;&gt;基本範例&lt;/h3&gt;
&lt;h4 id=&#34;建立-gn&#34;&gt;建立 .gn&lt;/h4&gt;
&lt;p&gt;在 source project 的根目錄新增一個 &lt;code&gt;.gn&lt;/code&gt; 檔，內容如下：&lt;/p&gt;
&lt;script src=&#34;//gist-it.appspot.com/https://github.com/yinghau76/GN-demo/blob/master/.gn&#34;&gt;&lt;/script&gt;
&lt;p&gt;&lt;code&gt;.gn&lt;/code&gt; 檔所在的目錄會被 GN 工具認定是 project 的 &lt;strong&gt;source root&lt;/strong&gt;，&lt;code&gt;.gn&lt;/code&gt; 的內容最基本就是用 &lt;code&gt;buildconfig&lt;/code&gt; 來指定 build config 檔的位置，其中 &lt;code&gt;//&lt;/code&gt; 開頭的字串就是用來指定相對於 source root 的路徑。&lt;/p&gt;
&lt;h4 id=&#34;建立-buildbuildconfiggn&#34;&gt;建立 build/BUILDCONFIG.gn&lt;/h4&gt;
&lt;p&gt;根據前面的設定，我們需要在 &lt;code&gt;build/&lt;/code&gt; 下再新增加一個 &lt;code&gt;BUILDCONFIG.gn&lt;/code&gt;，內容如下:&lt;/p&gt;
&lt;script src=&#34;//gist-it.appspot.com/https://github.com/yinghau76/GN-demo/blob/master/build/BUILDCONFIG.gn&#34;&gt;&lt;/script&gt;
&lt;p&gt;第一行指定要使用的 toolchain，參數給的是一個 label，&lt;code&gt;//build/toolchains:gcc&lt;/code&gt; 指的是 &lt;code&gt;build/toolchains/BUILD.gn&lt;/code&gt; 裡面定義的 &lt;code&gt;gcc&lt;/code&gt; toolchain。第三行則是設定編譯 C++ 時會用到的命令列參數。&lt;/p&gt;
&lt;h4 id=&#34;建立-buildtoolchainsbuildgn&#34;&gt;建立 build/toolchains/BUILD.gn&lt;/h4&gt;
&lt;p&gt;因爲 GN 沒有內建的 toolchain 規則，&lt;code&gt;toolchain&lt;/code&gt; 裡的各種 &lt;code&gt;tool&lt;/code&gt; 例如 &lt;code&gt;cc&lt;/code&gt;, &lt;code&gt;cxx&lt;/code&gt;, &lt;code&gt;link&lt;/code&gt; 等必須自己指定：&lt;/p&gt;
&lt;script src=&#34;//gist-it.appspot.com/https://github.com/yinghau76/GN-demo/blob/master/build/toolchains/BUILD.gn&#34;&gt;&lt;/script&gt;
&lt;p&gt;可以注意一下之前提到的 &lt;code&gt;cflags_cc&lt;/code&gt; 是怎麼被 tool &lt;code&gt;cxx&lt;/code&gt; 使用的。&lt;/p&gt;
&lt;p&gt;詳細的 toolchain 設定方式可以參考 &lt;a href=&#34;https://chromium.googlesource.com/chromium/src/build/toolchain/+/master&#34;&gt;Chromium 的做法&lt;/a&gt;。&lt;/p&gt;
&lt;h4 id=&#34;建立-buildgn&#34;&gt;建立 BUILD.gn&lt;/h4&gt;
&lt;p&gt;最後在 source root 新增一個 &lt;code&gt;BUILD.gn&lt;/code&gt;，內容如下:&lt;/p&gt;
&lt;script src=&#34;//gist-it.appspot.com/https://github.com/yinghau76/GN-demo/blob/master/BUILD.gn&#34;&gt;&lt;/script&gt;
&lt;p&gt;設定 &lt;code&gt;hello&lt;/code&gt; 執行檔應該由 &lt;code&gt;main.cpp&lt;/code&gt; 編譯。&lt;/p&gt;
&lt;h4 id=&#34;完整的範例&#34;&gt;完整的範例&lt;/h4&gt;
&lt;p&gt;請參考 &lt;a href=&#34;https://github.com/p47r1ck7541/GN-demo&#34;&gt;GitHub 上的這個 project&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;建置&#34;&gt;建置&lt;/h3&gt;
&lt;p&gt;先用 &lt;code&gt;gn gen&lt;/code&gt; 指定在 &lt;code&gt;out/&lt;/code&gt; 目錄裡產生 ninja 檔:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ gn gen out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Done. Wrote &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; targets from &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; files in 1ms&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;再執行 ninja 來 build code:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ninja -C out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja: Entering directory &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;out&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2/2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; LINK hello&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;以後有修改 gn 設定的話也不用重新執行 gn，ninja 會自動更新設定：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ninja -C out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja: Entering directory &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;out&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;1/1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Regenerating ninja files
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2/2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; LINK hello&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;更了解-gn&#34;&gt;更了解 GN&lt;/h3&gt;
&lt;p&gt;萬事起頭難，如果你能把最基本的 GN 使用範例搞懂就是成功的第一步了。&lt;/p&gt;
&lt;p&gt;如果想更深入了解 GN 的用法，以下是相關資訊的連結:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;練習 GN 文檔裡的 &lt;a href=&#34;https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/quick_start.md&#34;&gt;Quick Start 範例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;細讀 &lt;a href=&#34;https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/language.md&#34;&gt;GN Language and Operation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;參考 &lt;a href=&#34;https://chromium.googlesource.com/chromium/src/build/+/master&#34;&gt;Chromium 的 build 設定&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>CMake 筆記</title>
      <link>https://blog.simplypatrick.com/posts/2015/06-19-cmake-notes/</link>
      <pubDate>Fri, 19 Jun 2015 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2015/06-19-cmake-notes/</guid>
      <description>&lt;h3 id=&#34;動機&#34;&gt;動機&lt;/h3&gt;
&lt;p&gt;&lt;del&gt;因爲某種原因，&lt;/del&gt;我最近又開始寫起 C++ 程式，除了要熟悉 C++ 11/14 的新特性外，比較頭疼的是 Makefile 的撰寫。&lt;/p&gt;
&lt;p&gt;C/C++ 開發者了解基本的 Makefile 寫法是有必要的，但是大多數情況下，我認為使用 autotools 或是 CMake 這類 Makefile generator 是比較合理的選擇，因爲這些工具可以幫你產生出專家等級的 Makefile 並且處理可能的跨平台問題。至於 &lt;a href=&#34;http://stackoverflow.com/questions/4071880/autotools-vs-cmake-vs-scons&#34;&gt;autotools 或是 CMake 的選擇&lt;/a&gt;，對我來說是很明顯的：autotools 是出了名的難用，而 CMake 是相對容易的。&lt;/p&gt;
&lt;p&gt;本文嘗試整理一些網路上的 CMake 教學資源，並且加上自己的一些心得。&lt;/p&gt;
&lt;h3 id=&#34;cmake-入門&#34;&gt;CMake 入門&lt;/h3&gt;
&lt;p&gt;我會建議先看 Eric Noulard 的 &lt;a href=&#34;https://github.com/TheErk/CMake-tutorial&#34;&gt;CMake tutorial presentation&lt;/a&gt;，相當地棒：&lt;/p&gt;
&lt;iframe src=&#34;https://drive.google.com/file/d/0B4aSYmPhMYqxTnppLTBzS0EzSzA/preview&#34; width=&#34;640&#34; height=&#34;480&#34;&gt;&lt;/iframe&gt;
&lt;p&gt;然後你會需要實際動手演練一下，有下面幾個選擇：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cmake.org/examples/&#34;&gt;CMake 官網上的基本範例&lt;/a&gt;：文字說明比較少，但可以讓你先感覺一下 CMake 的運作方式。我自己根據這個範例建了&lt;a href=&#34;https://github.com/yinghau76/CMakeDemo&#34;&gt;這個 GitHub  project&lt;/a&gt; 來練習。&lt;/li&gt;
&lt;li&gt;維基教科書上的 &lt;a href=&#34;https://zh.wikibooks.org/wiki/CMake_%E5%85%A5%E9%96%80&#34;&gt;CMake 入門&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;John Lamp 的 &lt;a href=&#34;https://www.johnlamp.net/cmake-tutorial.html&#34;&gt;CMake Tutorial&lt;/a&gt; 提供了一個更實際的範例讓你練習，並且詳細解釋了每一行用到的 CMake 指令。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cmake-基礎知識&#34;&gt;CMake 基礎知識&lt;/h3&gt;
&lt;p&gt;再來就是要花時間把官網的這篇 &lt;a href=&#34;http://www.cmake.org/cmake/help/v3.3/manual/cmake-buildsystem.7.html&#34;&gt;cmake-buildsystem(7)&lt;/a&gt; 讀一讀，有幾個重點要搞懂：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如何使用 &lt;code&gt;add_library&lt;/code&gt; 及 &lt;code&gt;add_executable&lt;/code&gt; 來新增 build target
－ 了解 &lt;code&gt;STATIC&lt;/code&gt;, &lt;code&gt;SHARED&lt;/code&gt;, &lt;code&gt;MODULE&lt;/code&gt;, 以及 &lt;code&gt;OBJECT&lt;/code&gt; library 的差異&lt;/li&gt;
&lt;li&gt;了解 build specification:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;INCLUDE_DIRECTORIES&lt;/code&gt;, &lt;code&gt;COMPILE_DEFINITIONS&lt;/code&gt; 以及 &lt;code&gt;COMPILE_OPTIONS&lt;/code&gt; 的意義&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;了解 usage requirement:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;INTERFACE_INCLUDE_DIRECTORIES&lt;/code&gt;, &lt;code&gt;INTERFACE_COMPILE_DEFINITIONS&lt;/code&gt; 及 &lt;code&gt;INTERFACE_COMPILE_OPTIONS&lt;/code&gt; 的意義&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如何使用 &lt;code&gt;target_include_directories()&lt;/code&gt;, &lt;code&gt;target_compile_definitions()&lt;/code&gt; 及 &lt;code&gt;target_compile_options()&lt;/code&gt; 來修改 build specification 及 usage requirement
&lt;ul&gt;
&lt;li&gt;了解 &lt;code&gt;PRIVATE&lt;/code&gt;, &lt;code&gt;PUBLIC&lt;/code&gt; 及 &lt;code&gt;INTERFACE&lt;/code&gt; mode 的差異&lt;/li&gt;
&lt;li&gt;跟 directory-scoped 命令的差異: &lt;code&gt;include_directories()&lt;/code&gt;, &lt;code&gt;add_definitions()&lt;/code&gt;, 及 &lt;code&gt;add_compile_options()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;常用的內建變數
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CMAKE_CURRENT_SOURCE_DIR&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CMAKE_CURRENT_BINARY_DIR&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如何使用 &lt;code&gt;set_target_properties&lt;/code&gt; 來修改 target property&lt;/li&gt;
&lt;li&gt;了解 generator expression 的用法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面提到的這些重要觀念可以參考 &lt;a href=&#34;https://www.slideshare.net/oliora/introduction-to-cmake-in-30-minutes&#34;&gt;Introduction to CMake in 30 Minutes&lt;/a&gt; 的說明。&lt;/p&gt;
&lt;iframe src=&#34;//www.slideshare.net/slideshow/embed_code/key/xsB8nCp1Qs72tb&#34; width=&#34;595&#34; height=&#34;485&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34; style=&#34;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&#34; allowfullscreen&gt; &lt;/iframe&gt; &lt;div style=&#34;margin-bottom:5px&#34;&gt; &lt;strong&gt; &lt;a href=&#34;//www.slideshare.net/oliora/introduction-to-cmake-in-30-minutes&#34; title=&#34;Introduction to CMake in 30 Minutes&#34; target=&#34;_blank&#34;&gt;Introduction to CMake in 30 Minutes&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&#34;https://www.slideshare.net/oliora&#34; target=&#34;_blank&#34;&gt;Andrey Upadyshev&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;
&lt;h3 id=&#34;結論&#34;&gt;結論&lt;/h3&gt;
&lt;p&gt;CMake 熟悉了它的基本概念及內建命令語法後其實不難懂，我唯一的抱怨就是 &lt;code&gt;CMakeLists.txt&lt;/code&gt; 這個預設檔名的風格有點奇怪。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About Code Review</title>
      <link>https://blog.simplypatrick.com/posts/2015/06-12-about-code-review/</link>
      <pubDate>Fri, 12 Jun 2015 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2015/06-12-about-code-review/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;friendly-code-review.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;著重品質及效率的軟體開發團隊一定會做 code review，因為它是開發流程裡唯一讓開發人員有機會針對代碼進行深入討論的關鍵活動。&lt;/p&gt;
&lt;p&gt;因爲不同的團隊會用不同的方式執行 code review，並沒有一套固定的方法可以適用所有情況，所以我試著根據過去的經驗，整理我心中認為理想的 code review 運作方式。&lt;/p&gt;
&lt;h3 id=&#34;要用什麼工具&#34;&gt;要用什麼工具？&lt;/h3&gt;
&lt;p&gt;我認為使用 code review system 這類的工具是必須的，否則管理版本修改 (patches) 或是追蹤 reviewer 給的建議 (comments) 就會太過費力，反而削減了 code review 帶來的好處。&lt;/p&gt;
&lt;p&gt;免費的選擇我會推薦 &lt;a href=&#34;https://www.gerritcodereview.com/&#34;&gt;Gerrit&lt;/a&gt; 或是 &lt;a href=&#34;http://phabricator.org/&#34;&gt;Phabricator&lt;/a&gt; ，架設其實都蠻簡單的。&lt;/p&gt;
&lt;p&gt;Gerrit 的使用建議可以參考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.simplypatrick.com/html/gerrit-best-practices.html&#34;&gt;Gerrit and Code Review Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://wincent.github.io/gerrit-best-practices-tech-talk/assets/fallback/index.html&#34;&gt;Gerrit Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;review-那些東西&#34;&gt;Review 那些東西？&lt;/h3&gt;
&lt;p&gt;以下是我認為除了 bug 以外需要檢查的部分，依照重要程度列舉如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;符合原始架構設計&lt;/li&gt;
&lt;li&gt;API 設計&lt;/li&gt;
&lt;li&gt;易讀性及可維護性&lt;/li&gt;
&lt;li&gt;安全性&lt;/li&gt;
&lt;li&gt;代碼風格&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;有幾個原則可以遵循：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;團隊應該有一致的代碼標準 (coding standards)，這樣比較不會有爭議。&lt;/li&gt;
&lt;li&gt;盡量使用代碼檢查工具 (static analysis) 來代替人工的檢查。&lt;/li&gt;
&lt;li&gt;善用 &lt;a href=&#34;http://astyle.sourceforge.net/&#34;&gt;astyle&lt;/a&gt; 或是 &lt;a href=&#34;http://uncrustify.sourceforge.net/&#34;&gt;uncrustify&lt;/a&gt; 這類的 code formatting 工具來維持代碼風格的一致性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;如何有效溝通&#34;&gt;如何有效溝通？&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://chris.beams.io/posts/git-commit/&#34;&gt;Commit message&lt;/a&gt; 很重要，好的 commit message 可以讓 review 快速理解為什麼這個改動是必要的。&lt;/li&gt;
&lt;li&gt;Review 的改動不應該太大，一次改個上千行是很難仔細檢查的，所以 reviewer 有權利退回太大的改動。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Ask a programmer to review 10 lines of code, he&amp;rsquo;ll find 10 issues. Ask him to do 500 lines and he&amp;rsquo;ll say it looks good&amp;quot;.&lt;/p&gt;
&lt;p&gt;&amp;mdash; The harsh truth about code reviews.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;如何加快-review&#34;&gt;如何加快 review?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Review 的建議可以大致分成兩類：
&lt;ul&gt;
&lt;li&gt;must fix: 一定要修正的問題。&lt;/li&gt;
&lt;li&gt;nice to have: 建議要修正的問題，但如果需要花太多時間來修改，可以另外開 task 來追蹤。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如果 must fix 類的問題都處理了，reviewer 應該就要 ＋2 放行了。&lt;/li&gt;
&lt;li&gt;nice to have 的問題則是以互相信任尊重的態度來處理。&lt;/li&gt;
&lt;li&gt;Reviewer 如果拖延太久沒有開始 review，作者應該主動提醒。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;正確的心態&#34;&gt;正確的心態&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;把代碼寫好是作者的責任，reviewer 有責任把關，但不應該要求 reviewer 要抓出所有的 bug。&lt;/li&gt;
&lt;li&gt;reviewer 不一定能完全了解實作的細節，所以給的建議不見得是完全正確的，作者不應盲目遵守而是要有自己的判斷。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;參考&#34;&gt;參考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://kevinlondon.com/2015/05/05/code-review-best-practices.html&#34;&gt;Code Review Best Practices&lt;/a&gt; by Kevin London&lt;/li&gt;
&lt;li&gt;Loose Cannon 有&lt;a href=&#34;http://scottbilas.com/blog/peer-code-reviews-at-loose-cannon/&#34;&gt;一系列的文章&lt;/a&gt;提供了蠻多施行 code review 的 best practice。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.codinghorror.com/blog/2006/01/code-reviews-just-do-it.html&#34;&gt;Code Reviews: Just do it!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>像專業人士一樣撰寫 Git Commit Message</title>
      <link>https://blog.simplypatrick.com/posts/2015/06-12-git-commit-message/</link>
      <pubDate>Fri, 12 Jun 2015 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2015/06-12-git-commit-message/</guid>
      <description>&lt;h3 id=&#34;為什麼好的-commit-message-這麼重要&#34;&gt;為什麼好的 Commit Message 這麼重要？&lt;/h3&gt;
&lt;p&gt;每次看到亂七八糟的 git commit message，我都會覺得渾身不對勁。所謂的「亂七八糟」，我指的是這幾種情況：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;格式毫無章法，東一筆西一筆&lt;/li&gt;
&lt;li&gt;寫得太含糊，讓人看了也不知道改了什麼&lt;/li&gt;
&lt;li&gt;組織混亂，難以理解&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;好的 commit message 應該要簡潔、有條理、格式一致。寫好它當然要花點心力，但有幾個理由值得我們這樣做：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;就像程式碼一樣，commit message 寫一次但會被讀很多次。花時間寫好它是值得的。&lt;/li&gt;
&lt;li&gt;如果容許爛 commit message 存在，等於在傳達一個訊息：你不在乎程式碼的可維護性。這對建立良好的工程文化很不利。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Chris Beams 寫的 &lt;a href=&#34;http://chris.beams.io/posts/git-commit/&#34;&gt;How to Write a Git Commit Message&lt;/a&gt; 是我讀過關於這個主題最好的文章。Chris 很清楚地解釋了為什麼好的 commit message 很重要，以及該怎麼寫。你可以從這個範例看看好的 commit message 長什麼樣子：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;Summarize changes in around 50 characters or less

More detailed explanatory text, if necessary. Wrap it to about 72
characters or so. In some contexts, the first line is treated as the
subject of the commit and the rest of the text as the body. The
blank line separating the summary from the body is critical (unless
you omit the body entirely); various tools like `log`, `shortlog`
and `rebase` can get confused if you run the two together.

Explain the problem that this commit is solving. Focus on why you
are making this change as opposed to how (the code explains that).
Are there side effects or other unintuitive consequenses of this
change? Here&amp;#39;s the place to explain them.

Further paragraphs come after blank lines.

 - Bullet points are okay, too

 - Typically a hyphen or asterisk is used for the bullet, preceded
   by a single space, with blank lines in between, but conventions
   vary here

If you use an issue tracker, put references to them at the bottom,
like this:

Resolves: #123
See also: #456, #789&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;這個範本是基於著名的 &lt;a href=&#34;http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html&#34;&gt;Tim Pope&amp;rsquo;s Note About Git Commit Messages&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;大家都怎麼寫-commit-message&#34;&gt;大家都怎麼寫 Commit Message？&lt;/h3&gt;
&lt;p&gt;我不打算重複別人已經說過的東西。我想做的是蒐集一些真實世界的範例，看看可以從中學到什麼。&lt;/p&gt;
&lt;h4 id=&#34;linux&#34;&gt;&lt;a href=&#34;https://www.kernel.org/doc/Documentation/SubmittingPatches&#34;&gt;Linux&lt;/a&gt;&lt;/h4&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;subsurface&#34;&gt;&lt;a href=&#34;https://github.com/torvalds/subsurface/blob/master/README#L272&#34;&gt;Subsurface&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/torvalds/subsurface&#34;&gt;Subsurface&lt;/a&gt; 是 Linus Torvalds 開發的專案，他當然也是 Git 的創造者。以下是 Subsurface 開發者使用的格式：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;Header line: explain the commit in one line (use the imperative)

Body of commit message is a few lines of text, explaining things
in more detail, possibly giving some background about the issue
being fixed, etc etc.

The body of the commit message can be several paragraphs, and
please do proper word-wrap and keep columns shorter than about
74 characters or so. That way &amp;#34;git log&amp;#34; will show things
nicely even when it&amp;#39;s indented.

Make sure you explain your solution and why you&amp;#39;re doing what you&amp;#39;re
doing, as opposed to describing what you&amp;#39;re doing. Reviewers and your
future self can read the patch, but might not understand why a
particular solution was implemented.

Reported-by: whoever-reported-it
Signed-off-by: Your Name &amp;lt;youremail@yourhost.com&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果改動本身很簡單，好的 commit message 可以非常簡潔：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;Set proper mode for file open dialog

Fixes #913&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果有需要，也可以寫得很詳細：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;Planner: Count the minimum stop time towards o2time

When doing backgas breaks, count the minimum stop time towards o2time.
Previously, the initial minimum stop wasn&amp;#39;t counted, so the time of the first
segment on oxygen was min_switch_duration + 12 minutes.

E.g. with 1 minute minimum switch duration.

Previously:
depth   duration        runtime gas
40m     1min    1min    air
40m     34min   35min
21m     2min    37min
21m     1min    38min   EAN50
18m     1min    39min
15m     3min    42min
12m     4min    46min
9m      5min    51min
6m      13min   64min   oxygen      &amp;lt;--13 minutes on O2
6m      6min    70min   air
6m      2min    72min   oxygen
0m      1min    73min

Now:
depth       duration        runtime gas
40m 1min    1min    air
40m 34min   35min
21m 2min    37min
21m 1min    38min   EAN50
18m 1min    39min
15m 3min    42min
12m 4min    46min
9m  5min    51min
6m  12min   63min   oxygen
6m  6min    69min   air
6m  2min    71min   oxygen
0m  1min    72min

Signed-off-by: Rick Walsh &amp;lt;rickmwalsh@gmail.com&amp;gt;
Signed-off-by: Dirk Hohndel &amp;lt;dirk@hohndel.org&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;go&#34;&gt;&lt;a href=&#34;https://golang.org/doc/contribute.html&#34;&gt;Go&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;貢獻指南中給出了以下範例：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;math: improved Sin, Cos and Tan precision for very large arguments

The existing implementation has poor numerical properties for
large arguments, so use the McGillicutty algorithm to improve
accuracy above 1e10.

The algorithm is described at http://wikipedia.org/wiki/McGillicutty_Algorithm

Fixes #159&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我其實很喜歡 Go 開發者使用的簡潔風格：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;fmt: don&amp;#39;t unread eof scanning %x

When scanning a hex byte at EOF, the code was ungetting the eof,
which backed up the input and caused double-scanning of a byte.

Delete the call to UnreadRune.

This line appeared in 1.5 for some reason; it was not in 1.4 and
should be removed again for 1.5

Fixes #12090.

Change-Id: Iad1ce8e7db8ec26615c5271310f4b0228cca7d78
Reviewed-on: https://go-review.googlesource.com/13461
Reviewed-by: Andrew Gerrand &amp;lt;adg@golang.org&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;這是另一個寫得很好的 &lt;a href=&#34;https://github.com/golang/go/commit/3ae17043f7f29f0d745aa35b340f8cab80219068&#34;&gt;commit message&lt;/a&gt;：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;runtime: make sure heapBitsBulkBarrier cannot be preempted

Changes the torture test in #12068 from failing about 1/10 times
to not failing in almost 2,000 runs.

This was only happening in -race mode because functions are
bigger in -race mode, so a few of the helpers for heapBitsBulkBarrier
were not being inlined, and they were not marked nosplit,
so (only in -race mode) the write barrier was being preempted by GC,
causing missed pointer updates.

Filed issue #12069 for diagnosis of any other similar errors.

Fixes #12068.

Change-Id: Ic174d9b050ba278b18b08ab0d85a73c33bd5b175
Reviewed-on: https://go-review.googlesource.com/13364
Reviewed-by: Austin Clements &amp;lt;austin@google.com&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;llvm&#34;&gt;&lt;a href=&#34;http://llvm.org/docs/DeveloperPolicy.html#commit-messages&#34;&gt;LLVM&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;LLVM 開發者並不強制要求 commit message 的格式，但有提供一些指引。顯然他們沒有遵循 Git commit message 的風格，因為 LLVM 的主要版本庫還在用 Subversion。不過你還是可以在那裡找到很多寫得很好的 commit message。&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-gitcommit&#34; data-lang=&#34;gitcommit&#34;&gt;x86: Emit LAHF/SAHF instead of PUSHF/POPF
NaCl&amp;#39;s sandbox doesn&amp;#39;t allow PUSHF/POPF out of security concerns (priviledged emulators have forgotten to mask system bits in the past, and EFLAGS&amp;#39;s DF bit is a constant source of hilarity). Commit r220529 fixed PR20376 by saving cmpxchg&amp;#39;s flags result using EFLAGS, this commit now generated LAHF/SAHF instead, for all of x86 (not just NaCl) because it leads to an overall performance gain over PUSHF/POPF.

As with the previous patch this code generation is pretty bad because it occurs very later, after register allocation, and in many cases it rematerializes flags which were already available (e.g. already in a register through SETE). Fortunately it&amp;#39;s somewhat rare that this code needs to fire.

I did [[ https://github.com/jfbastien/benchmark-x86-flags | a bit of benchmarking ]], the results on an Intel Haswell E5-2690 CPU at 2.9GHz are:

| Time per call (ms)  | Runtime (ms) | Benchmark                      |
| 0.000012514         |      6257    | sete.i386                      |
| 0.000012810         |      6405    | sete.i386-fast                 |
| 0.000010456         |      5228    | sete.x86-64                    |
| 0.000010496         |      5248    | sete.x86-64-fast               |
| 0.000012906         |      6453    | lahf-sahf.i386                 |
| 0.000013236         |      6618    | lahf-sahf.i386-fast            |
| 0.000010580         |      5290    | lahf-sahf.x86-64               |
| 0.000010304         |      5152    | lahf-sahf.x86-64-fast          |
| 0.000028056         |     14028    | pushf-popf.i386                |
| 0.000027160         |     13580    | pushf-popf.i386-fast           |
| 0.000023810         |     11905    | pushf-popf.x86-64              |
| 0.000026468         |     13234    | pushf-popf.x86-64-fast         |

Clearly `PUSHF`/`POPF` are suboptimal. It doesn&amp;#39;t really seems to be worth teaching LLVM about individual flags, at least not for this purpose.

Reviewers: rnk, jvoung, t.p.northover

Subscribers: llvm-commits

Differential revision: http://reviews.llvm.org/D6629

git-svn-id: https://llvm.org/svn/llvm-project/llvm/trunk@244503 91177308-0d34-0410-b5e6-96231b3b80d8&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;更多參考資料&#34;&gt;更多參考資料&lt;/h4&gt;
&lt;p&gt;以下是一些有提供 commit message 指引的專案列表：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#&#34;&gt;AngularJS&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/sparkbox/how_to/tree/master/style/git&#34;&gt;SparkBox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://karma-runner.github.io/0.8/dev/git-commit-msg.html&#34;&gt;KARMA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gist.github.com/Linell/bd8100c4e04348c7966d&#34;&gt;Linell&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.typo3.org/CommitMessage_Format_(Git)&#34;&gt;Typo3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://netty.io/wiki/writing-a-commit-message.html&#34;&gt;Netty&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mediawiki.org/wiki/Gerrit/Commit_message_guidelines&#34;&gt;MediaWiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://secure.phabricator.com/book/phabflavor/article/writing_reviewable_code/&#34;&gt;Phabricator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.openstack.org/wiki/GitCommitMessages&#34;&gt;OpenStack&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/erlang/otp/wiki/Writing-good-commit-messages&#34;&gt;Erlang&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/spring-projects/spring-framework/blob/30bce7/CONTRIBUTING.md?utm_campaign=CodeBaku&amp;amp;utm_medium=web&amp;amp;utm_source=CodeBaku_2#format-commit-messages&#34;&gt;Spring&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Using OpenGrok on Mac OS X</title>
      <link>https://blog.simplypatrick.com/posts/2015/01-16-opengrok-on-mac-osx/</link>
      <pubDate>Fri, 16 Jan 2015 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2015/01-16-opengrok-on-mac-osx/</guid>
      <description>&lt;h3 id=&#34;opengrok-is-awesome&#34;&gt;OpenGrok is Awesome&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://opengrok.github.io/OpenGrok/&#34;&gt;OpenGrok&lt;/a&gt; is an awesome and handy tool for analyzing complex software system. As it claims, it is a fast source code search and cross reference engine using famous &lt;a href=&#34;http://lucene.apache.org/core/&#34;&gt;Lucene&lt;/a&gt;. For Android developers, you may have known &lt;a href=&#34;http://androidxref.com/&#34;&gt;AndroidXref&lt;/a&gt; which is built using OpenGrok.&lt;/p&gt;
&lt;p&gt;This short guide shows a minimized steps to get OpenGrok up and running on Mac OS X. I prefers this kind of quick-and-dirty way for browsing source code on my desktop or laptop. Refer to &lt;a href=&#34;https://github.com/OpenGrok/OpenGrok/wiki/How-to-install-OpenGrok&#34;&gt;official OpenGrok installation guide&lt;/a&gt; if you intent to setup a server instead.&lt;/p&gt;
&lt;img src=&#34;opengrok.png&#34; width=&#34;80%&#34;&gt;
&lt;h3 id=&#34;installation&#34;&gt;Installation&lt;/h3&gt;
&lt;p&gt;The most effortless way to install Tomcat is using &lt;a href=&#34;http://brew.sh&#34;&gt;Homebrew&lt;/a&gt;:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ brew install tomcat&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you have not installed Exuberant Ctags before, you can do so now:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ brew install ctags&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then you have to download OpenGrok from its official site (I am using 0.12.1):&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ wget -O - http://java.net/projects/opengrok/downloads/download/opengrok-0.12.1.tar.gz | tar xvz&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have to deploy OpenGrok to Tomcat which is installed under &lt;code&gt;/usr/local/Cellar/tomcat&lt;/code&gt; (you may need to change the 8.0.17 part depending on the exact Tomcat version you installed):&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ OPENGROK_TOMCAT_BASE&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/usr/local/Cellar/tomcat/8.0.17/libexec opengrok-0.12.1/bin/OpenGrok deploy&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With default configuration, you should be able to see OpenGrok after starting Tomcat:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ catalina start
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ open http://localhost:8080/source&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should see OpenGrok page with no source to search.&lt;/p&gt;
&lt;h3 id=&#34;indexing-source&#34;&gt;Indexing Source&lt;/h3&gt;
&lt;p&gt;Now it&amp;rsquo;s time to index your source:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ OPENGROK_INSTANCE_BASE&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;opengrok-0.12.1 opengrok-0.12.1/bin/OpenGrok index /path/to/your/source&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that &lt;code&gt;OPENGROK_INSTANCE_BASE&lt;/code&gt; specifies where to store index data. After you have done with it, stop Tomcat by:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ catalina stop&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That&amp;rsquo;s it. Enjoy your code reading.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Useful Go Channel Types</title>
      <link>https://blog.simplypatrick.com/posts/2014/05-05-golang-channels/</link>
      <pubDate>Mon, 05 May 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/05-05-golang-channels/</guid>
      <description>&lt;p&gt;CloudFlare 的 John Graham-Cumming 在 GopherCon 2014 給了一個 &lt;a href=&#34;https://www.slideshare.net/cloudflare/a-channel-compendium&#34;&gt;A Channel Compendium&lt;/a&gt; 的演講，其中介紹了:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;利用 channel 來通知事件 (Signalling)&lt;/li&gt;
&lt;li&gt;利用 channel 來隱藏狀態 (Hide state)&lt;/li&gt;
&lt;li&gt;Nil channels 及 closed channels 的特性&lt;/li&gt;
&lt;li&gt;利用 channel 來實現 timer&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;整個 talk 的結尾下的非常好：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Go Way: &amp;ldquo;small sequential pieces joined by channels&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以說 Go 的重點特色就是 concurrency programming 的支援，而善用 channel 則是實現 concurrency 的重要能力。&lt;/p&gt;
&lt;p&gt;對於剛接觸 go concurrency programming 的開發者，分享一下兩個簡單但好用的 channel 類型: channel of error 及 channel of function。&lt;/p&gt;
&lt;h3 id=&#34;channel-of-error&#34;&gt;channel of error&lt;/h3&gt;
&lt;p&gt;類型爲 chan error 這算是 response channel 的一種，通常用來處理單一非同步操作。應用的場景通常是一個 goroutine 執行工作，另一個 goroutine 等待工作完成後做善後清理的工作。&lt;/p&gt;
&lt;p&gt;範例可以看 &lt;a href=&#34;http://blog.golang.org/pipelines&#34;&gt;Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt; 裡的例子。&lt;/p&gt;
&lt;h3 id=&#34;channel-of-function&#34;&gt;channel of function&lt;/h3&gt;
&lt;p&gt;先看一個我覺的寫得太複雜的例子：Programming in Go 書中的 SafeMap 範例，把所有對 map 的操作都透過 channel 送到同一個 goroutine 內來進行，操作結果也是透過 channel 再送回來：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;safeMap&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;action&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;insert&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;remove&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      delete(&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;findResult&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;length&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;updater&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;end&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      close(&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(完整的程式請參考 &lt;a href=&#34;http://play.golang.org/p/I4Rqbguhud&#34;&gt;http://play.golang.org/p/I4Rqbguhud&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Find() 的操作如下：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;safeMap&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Find&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;commandData&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;action&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;).(&lt;span style=&#34;color:#a6e22e&#34;&gt;findResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;程式的邏輯被分成兩個部份，一部份在 Find() 裡，一部份在 run() 裡，然後兩邊要溝通還要建立相對應的 struct 做爲傳輸用，
爲了共用同一個 commandData 還需要做 type assertion，基本上我不喜歡這樣的寫法。&lt;/p&gt;
&lt;p&gt;此時 channel of function 就派上用場了，基本步驟就是將要共享的資料宣告成 chan func() 或其他 func 類型：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Store&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;safeMap&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Store&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(完整的程式請參考 &lt;a href=&#34;http://play.golang.org/p/rDrA6CfCZn&#34;&gt;http://play.golang.org/p/rDrA6CfCZn&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;goroutine 很簡單就是接收 func 然後執行它們：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;safeMap&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#a6e22e&#34;&gt;Store&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;想對於之前的 Find() 更簡潔及易讀：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;safeMap&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Find&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Store&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;found&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;store&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{}{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>RubyMotion v.s. Xcode &#43; Objective-C</title>
      <link>https://blog.simplypatrick.com/posts/2014/03-27-rubymotion-vs-xcode-objective-c/</link>
      <pubDate>Thu, 27 Mar 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/03-27-rubymotion-vs-xcode-objective-c/</guid>
      <description>&lt;h3 id=&#34;優點&#34;&gt;優點&lt;/h3&gt;
&lt;p&gt;RubyMotion 的優點說穿了就是儘量讓你不會碰到 Objective-C, Xcode, 及 iOS API 的摧殘：&lt;/p&gt;
&lt;h4 id=&#34;使用-ruby-語法&#34;&gt;使用 Ruby 語法&lt;/h4&gt;
&lt;p&gt;應該不是只有我覺得 Objective-C 的語法&lt;a href=&#34;http://amplicate.com/hate/objective-c&#34;&gt;很醜&lt;/a&gt;，Cocoa/iOS 的 API 也都是囉嗦的長，
但相對地 Ruby 就有漂亮易讀的語法及好用的內建 library。&lt;/p&gt;
&lt;p&gt;與其要寫：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-objectivec&#34; data-lang=&#34;objectivec&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NSMutableArray &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;array &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [NSMutableArray arrayWithObjects: &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;one&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;two&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;three&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;four&amp;#34;&lt;/span&gt;, nil];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NSArray &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;newAdditions &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [NSArray arrayWithObjects: &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;a&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;@&amp;#34;b&amp;#34;&lt;/span&gt;, nil];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NSIndexSet &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;indexes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [NSIndexSet indexSetWithIndexesInRange:NSMakeRange(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,newAdditions.count)];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[array insertObjects:newAdditions atIndexes:indexes];&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;我更喜歡寫：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;array &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%w{one two three four}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newAdditions &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%w{a b}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;array&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;insert(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;newAdditions)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;可利用-rubymotion-gems&#34;&gt;可利用 RubyMotion gems&lt;/h4&gt;
&lt;p&gt;在 &lt;a href=&#34;http://rubymotion-wrappers.com/&#34;&gt;RubyMotion Wrappers&lt;/a&gt; 可以找到許多專爲 RubyMotion 設計的 gem，通常是把 iOS API 或是有名
的 library (例如 AFNetworking 或 Cocos2D) 包裝成 Ruby 的慣用方式，例如 &lt;a href=&#34;https://github.com/rubymotion/sugarcube&#34;&gt;SugarCube&lt;/a&gt;
可以把：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;UIApplication&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sharedApplication&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;openURL(&lt;span style=&#34;color:#66d9ef&#34;&gt;NSURL&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;URLWithString(url))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;簡化成：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;url&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;nsurl&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;open&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;簡潔好維護的-dsl&#34;&gt;簡潔好維護的 DSL&lt;/h4&gt;
&lt;p&gt;例如 &lt;a href=&#34;https://github.com/rubymotion/teacup&#34;&gt;Teacup&lt;/a&gt; 可以取代用 XIB 來拉 UI：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Teacup&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Stylesheet&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#e6db74&#34;&gt;:menu&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  style &lt;span style=&#34;color:#e6db74&#34;&gt;:root&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;gradient&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;colors&lt;/span&gt;: &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#7a7a7a&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;uicolor, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#414141&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;uicolor&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  style &lt;span style=&#34;color:#e6db74&#34;&gt;:header&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;backgroundColor&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;background-menu-header.png&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;uiimage&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;uicolor,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;constraints&lt;/span&gt;: &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;:top_left&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;:full_width&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            constrain_height(&lt;span style=&#34;color:#ae81ff&#34;&gt;59&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  style &lt;span style=&#34;color:#e6db74&#34;&gt;:title&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;backgroundColor&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UIColor&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;clearColor,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;frame&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;CGRectMake&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;190&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UIColor&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;whiteColor,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;font&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UIFont&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;boldSystemFontOfSize(&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;baselineAdjustment&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UIBaselineAdjustmentAlignCenters&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;rakefile&#34;&gt;Rakefile&lt;/h4&gt;
&lt;p&gt;採用 Rakefile 比起用 xcodeproject 更有彈性且好維護，例如我一個 app 有分付費及免費兩個版本，建置時可以用環境變數來切換，Rakefile 可以加入程式邏輯來判斷處理：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Motion&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Project&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;App&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;setup &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;app&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;APP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;when&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;taoyuan&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;TaoyuanAirport&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;identifier &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;com.simplypatrick.taoyuanairport.paid&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;when&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;taoyuan-free&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;TaoyuanAirport-Free&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;identifier &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;com.simplypatrick.taoyuanairport&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;deployment_target &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;6.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;version &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;info_plist&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;CFBundleShortVersionString&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;1.5.7&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;files &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Dir&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;glob(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./config/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;APP&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/*.rb&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;resources_dirs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./config/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;APP&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/resources&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;缺點&#34;&gt;缺點&lt;/h3&gt;
&lt;p&gt;反面列一些我覺得是缺點的地方：&lt;/p&gt;
&lt;h4 id=&#34;額外的-ruby-學習成本&#34;&gt;額外的 Ruby 學習成本&lt;/h4&gt;
&lt;p&gt;之前說過，只懂 Ruby 是無法用 RubyMotion 開發 iOS App 的，必須先懂 Objective-C 及 Xcode 後再捨棄它們，對於非 Ruby 愛好者這是比較難接受的。&lt;/p&gt;
&lt;h4 id=&#34;價格&#34;&gt;價格&lt;/h4&gt;
&lt;p&gt;RubyMotion 並不是免費軟體，第一次購買要 $199 USD，之後每年需要再付 $99 USD 的更新及支持費用，對於只是想嘗試用 Ruby 寫 iOS app 的開發者是個門檻。&lt;/p&gt;
&lt;h4 id=&#34;app-的大小&#34;&gt;App 的大小&lt;/h4&gt;
&lt;p&gt;RubyMotion 雖然是編譯成 native code，比起用純 Objective-C 開發，層層包裝後產生的 IPA 檔還是大了不少，但我覺得還可以是還可以接受的程度。&lt;/p&gt;
&lt;h3 id=&#34;結論&#34;&gt;結論&lt;/h3&gt;
&lt;p&gt;如果是熟悉 Ruby 或是想學習 Ruby 的開發者我會蠻推薦 RubyMotion。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Book for Golang Learning</title>
      <link>https://blog.simplypatrick.com/posts/2014/03-19-go-book/</link>
      <pubDate>Wed, 19 Mar 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/03-19-go-book/</guid>
      <description>&lt;p&gt;學習一個新的程式語言我習慣先看網路上的 tutorial 或 get started guide 入門，然後用看官方文件或是搜索網路資源的方式來學習，等到有了手感後，就會找本好的書來進一步提昇自己的程度，用畫的來表示大概是這樣：&lt;/p&gt;
&lt;img src=&#34;learning-effectiveness.png&#34; alt=&#34;&#34; class=&#34;center-block&#34;&gt;
&lt;p&gt;就學習 Go 而言，我認爲那本書就是 Mark Summerfield 的 &lt;a href=&#34;http://www.amazon.com/Programming-Go-Creating-Applications-Developers/dp/0321774639&#34;&gt;Programming in Go: Creating Applications for the 21st Century&lt;/a&gt;:&lt;/p&gt;
&lt;img src=&#34;//lh5.googleusercontent.com/-OC2VHgTFmKI/UymTlmCrFtI/AAAAAAAAGJ8/i0la49Teypk/w293-h375-no/programming-in-go.jpg&#34; alt=&#34;&#34; class=&#34;center-block&#34;&gt;
&lt;p&gt;這本書不適合程式設計的初學者，而是適合已經精通其它程式語言的開發者。例如一般的 if 及 for 的用法直到第五章才有詳細介紹，但對有經驗的開發者絕對是 OK 的。&lt;/p&gt;
&lt;p&gt;我推薦的原因是書中的範例程式都很高水準，看得出來是作者精心設計過的，示範如何用 Go 來解決實際會遇到的問題，解法都很漂亮並符合 Go 的風格。這種採用最佳示範的方法可以讓你快速學會 Go 的精華而不是一直停留在初學者階段。&lt;/p&gt;
&lt;p&gt;另外書中也有提供了不少有用的建議做法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;實現可選參數的推薦做法&lt;/li&gt;
&lt;li&gt;實現泛型的替代做法&lt;/li&gt;
&lt;li&gt;常用的並發模式&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這本書也有&lt;a href=&#34;http://book.douban.com/subject/24869910/&#34;&gt;簡中翻譯版本&lt;/a&gt;可以買，有一些翻譯、排版、拼字錯誤，但整體來說翻譯品質還不錯，不會影響你對 Go 的學習。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>第一次在淘寶上買書</title>
      <link>https://blog.simplypatrick.com/posts/2014/03-18-buying-books-in-taobao/</link>
      <pubDate>Tue, 18 Mar 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/03-18-buying-books-in-taobao/</guid>
      <description>&lt;p&gt;分享一下在淘寶買書寄回臺灣的經驗。&lt;/p&gt;
&lt;p&gt;之前到大陸出差就有到當當網買書的經驗，都是用貨到付款的方式。這次想寄回台灣，但當當網只有大陸當地的支付方式，所以就想試試看淘寶，因爲淘寶使用的支付寶是支援海外信用卡交易的，只是好像會被銀行收取海外交易手續費。&lt;/p&gt;
&lt;p&gt;我想買的書主要是軟體開發相關技術書籍的中譯本，一來是比原文便宜，二來現在簡中翻譯的質量也都不錯，缺點就是書的用紙都是比較差的。&lt;/p&gt;
&lt;p&gt;怎麼買呢？先上淘寶旗下的&lt;a href=&#34;http://www.tmall.com/&#34;&gt;天貓&lt;/a&gt;直接搜尋你想買的書，我是選有包郵然後價格最低的：&lt;/p&gt;
&lt;img src=&#34;step-1.png&#34; alt=&#34;&#34; class=&#34;img-thumbnail&#34;&gt;
&lt;p&gt;這次我選了六本書，有一家因爲只剩一本但是破損了，經過用阿里旺旺聯繫後就取消交易：&lt;/p&gt;
&lt;img src=&#34;step-2.png&#34; alt=&#34;&#34; class=&#34;img-thumbnail&#34;&gt;
&lt;p&gt;選完書後結帳時，淘寶有個很貼心的功能就是合併快遞，貨物可以通通寄到轉運商那裡再一起轉運回臺灣。
我選擇的轉運商全家 PRoute，算算平均一本書運回台灣的成本是台幣 50 元：&lt;/p&gt;
&lt;img src=&#34;step-3.png&#34; alt=&#34;&#34; class=&#34;img-thumbnail&#34;&gt;
&lt;p&gt;所以這些包裹就會從大陸各地寄到深圳：&lt;/p&gt;
&lt;img src=&#34;step-4.png&#34; alt=&#34;&#34; class=&#34;img-thumbnail&#34;&gt;
&lt;p&gt;然後坐船到台灣，整個過程看起來可以在一到兩周內完成。：&lt;/p&gt;
&lt;img src=&#34;step-5.png&#34; alt=&#34;&#34; class=&#34;img-thumbnail&#34;&gt;
&lt;img src=&#34;package.jpg&#34; width=&#34;640&#34; height=&#34;480&#34; alt=&#34;&#34;&gt;
&lt;p&gt;收貨時全家送了一杯咖啡：&lt;/p&gt;
&lt;img src=&#34;coffee.jpg&#34; width=&#34;640&#34; height=&#34;480&#34; alt=&#34;&#34;&gt;</description>
    </item>
    
    <item>
      <title>RubyMotion</title>
      <link>https://blog.simplypatrick.com/posts/2014/03-16-rubymotion/</link>
      <pubDate>Sun, 16 Mar 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/03-16-rubymotion/</guid>
      <description>&lt;p&gt;使用 RubyMotion 來撰寫 iOS app 已經有一年多的時間，&lt;del&gt;踩了不少坑後&lt;/del&gt;有了一些小心得可以分享，目前想到的題目有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;相較於用 Xcode 開發的優缺點&lt;/li&gt;
&lt;li&gt;RubyMotion Rakefile 的使用&lt;/li&gt;
&lt;li&gt;與 Xcode 搭配的方法&lt;/li&gt;
&lt;li&gt;開發環境的設定&lt;/li&gt;
&lt;li&gt;推薦閱讀的書&lt;/li&gt;
&lt;li&gt;用 Ruby 風格來架構 app&lt;/li&gt;
&lt;li&gt;Crash report 的機制&lt;/li&gt;
&lt;li&gt;推薦使用的 gem&lt;/li&gt;
&lt;li&gt;其他推薦閱讀&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有一個需要先釐清的是：使用 RubyMotion 不表示你可以不用懂 Objective-C 及 Cocoa Touch，
相反地，學習原生 iOS 開發的方法對於有效駕馭 RubyMotion 是必要的。&lt;/p&gt;
&lt;p&gt;有興趣的人可以先聽聽 &lt;a href=&#34;http://www.techtalk.tw/2013/01/episode-14-rubymotion.html&#34;&gt;Joseph Ku 在 TechTalk@TW&lt;/a&gt; 的專訪。另外也可以看 &lt;a href=&#34;http://en.wikipedia.org/wiki/Jim_Weirich&#34;&gt;Jim Weirich&lt;/a&gt; 在 CincyCocoaDev 對 RubyMotion 的介紹：&lt;/p&gt;
&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;//www.youtube.com/embed/z7E1zx9j31M&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;</description>
    </item>
    
    <item>
      <title>Page Scrapping By Go</title>
      <link>https://blog.simplypatrick.com/posts/2014/01-07-page-scrapping-by-go/</link>
      <pubDate>Tue, 07 Jan 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/01-07-page-scrapping-by-go/</guid>
      <description>&lt;p&gt;分享一下怎麼用 Go 爬網頁：&lt;/p&gt;
&lt;p&gt;先 import 之後步驟會用到的 package:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;code.google.com/p/cascadia&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;code.google.com/p/go.net/html&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;code.google.com/p/go.text/encoding/traditionalchinese&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;code.google.com/p/go.text/transform&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第一步當然是用 &lt;code&gt;http.Get&lt;/code&gt; 把網頁抓回來：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;url&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to download:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Body&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第二步: 如果網頁內容不是 UTF-8 encoding 要做一下轉換，&lt;code&gt;go.text&lt;/code&gt; 包有提供編碼轉換及 Big 的支援，然後用 &lt;code&gt;go.net/html&lt;/code&gt; 包提供的 HTML parser 來輸出(非標準) DOM tree：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;big5Reader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;transform&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewReader&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Body&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;traditionalchinese&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Big5&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewDecoder&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;doc&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;html&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Parse&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;big5Reader&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to parse:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;再來要從 doc 中撈出資訊則可以使用 &lt;code&gt;cascadia&lt;/code&gt; 包提供的 CSS selector 來做：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rowSel&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cascadia&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MustCompile&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;table table tr&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;colSel&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cascadia&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MustCompile&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;td&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rowSel&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MatchAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;doc&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;col&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;colSel&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MatchAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;花費的時間比我想像中的少，本來以為找不到好的 package 可以幫忙處理這些事，沒想到三兩下就搞定了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Using Native Libraries in Android</title>
      <link>https://blog.simplypatrick.com/posts/2014/01-04-using-native-libraries-in-android/</link>
      <pubDate>Sat, 04 Jan 2014 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2014/01-04-using-native-libraries-in-android/</guid>
      <description>&lt;h3 id=&#34;基本概念&#34;&gt;基本概念&lt;/h3&gt;
&lt;p&gt;開發 Android app 如果需要使用 native library，簡單地說其實不複雜，就是把 .so 檔放到 &lt;code&gt;lib/&amp;lt;abi&amp;gt;&lt;/code&gt; 目錄，然後不管你是用 Eclipse ADT, Ant, 或是 Gradle 來產生 APK, 這些工具都會把這些 &lt;code&gt;.so&lt;/code&gt; 包到 &lt;code&gt;.apk&lt;/code&gt; 裡面，然後這些 &lt;code&gt;.so&lt;/code&gt; 就可以在運作時期用 &lt;a href=&#34;http://developer.android.com/reference/java/lang/System.html#loadLibrary(java.lang.String)&#34;&gt;System.loadLibrary&lt;/a&gt; 或是 &lt;a href=&#34;http://developer.android.com/reference/java/lang/System.html#load(java.lang.String)&#34;&gt;System.load&lt;/a&gt; 來載入。&lt;/p&gt;
&lt;p&gt;接下來說明幾個常見的 &lt;code&gt;.so&lt;/code&gt; 產生及載入方式：&lt;/p&gt;
&lt;h3 id=&#34;使用-ndk&#34;&gt;使用 NDK&lt;/h3&gt;
&lt;p&gt;如果是自己開發自己使用，通常建議用 Android NDK，只要一個 &lt;code&gt;ndk-build&lt;/code&gt; 命令就可以將 &lt;code&gt;jni/&lt;/code&gt; 目錄裡的 C/C++ code 編譯成 &lt;code&gt;libs/&amp;lt;abi&amp;gt;/&lt;/code&gt; 裡的 &lt;code&gt;lib&amp;lt;name&amp;gt;.so&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;載入方式就是直接使用 &lt;code&gt;System.loadLibrary&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;third-party-library&#34;&gt;Third-party library&lt;/h3&gt;
&lt;p&gt;但如果角色換成是要提供 library 給 App 開發者使用，方法就比較多樣一點：&lt;/p&gt;
&lt;h4 id=&#34;jni--src&#34;&gt;&lt;code&gt;jni/&lt;/code&gt; + &lt;code&gt;src/&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;也就是直接給 JNI 及 Java code 由 App 開發自己整合。&lt;/p&gt;
&lt;h4 id=&#34;library-project&#34;&gt;Library Project&lt;/h4&gt;
&lt;p&gt;如果你要提供的 library 有自帶的 resource，這是目前唯一可以用的方式。把 .so 放在 library project 的 &lt;code&gt;libs/&amp;lt;abi&amp;gt;&lt;/code&gt; 就可以讓 app project 使用了。據說 Google 以後會提供工具可以把 library project 輸出成單一檔案來使用，期待中。&lt;/p&gt;
&lt;h4 id=&#34;一個-jar--數個-so-檔&#34;&gt;一個 &lt;code&gt;.jar&lt;/code&gt; + 數個 &lt;code&gt;.so&lt;/code&gt; 檔&lt;/h4&gt;
&lt;p&gt;如果不帶 resource 的話，給編譯好的 &lt;code&gt;.jar&lt;/code&gt; 跟 &lt;code&gt;.so&lt;/code&gt; 讓 App 開發者直接放到 &lt;code&gt;libs/&lt;/code&gt; 也是種簡單的方法。&lt;/p&gt;
&lt;h4 id=&#34;一個-jar-內嵌-so-檔&#34;&gt;一個 &lt;code&gt;.jar&lt;/code&gt; 內嵌 &lt;code&gt;.so&lt;/code&gt; 檔&lt;/h4&gt;
&lt;p&gt;有些 library 提供者為了降低開發者的使用門檻，使用了把 &lt;code&gt;.so&lt;/code&gt; 放在 &lt;code&gt;.jar&lt;/code&gt; 檔的 &lt;code&gt;assets/&lt;/code&gt; 目錄中然後運作時再從 assets 中取出 &lt;code&gt;.so&lt;/code&gt; 來載入的技巧，細節可以參考 &lt;a href=&#34;https://www.crittercism.com/packaging-android-libraries-with-native-code/&#34;&gt;Crittercism SDK 用的方式&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;獨立的-library-apk&#34;&gt;獨立的 library APK&lt;/h3&gt;
&lt;p&gt;上述的所有方法都有個缺點(或者也是優點): app 都自帶 &lt;code&gt;.so&lt;/code&gt;，不同 app 間無法共享占用空間多，也無法獨立更新。所以就有人想了把 &lt;code&gt;.so&lt;/code&gt; 放在獨立的 APK 裡，只要能找到 &lt;code&gt;.so&lt;/code&gt; 的絕對安裝路徑就能用 &lt;code&gt;System.load&lt;/code&gt; 來載入使用。例如 &lt;a href=&#34;http://opencv.org/platforms/android.html&#34;&gt;OpenCV&lt;/a&gt; 就是使用這樣的技巧：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;AndroidAppUsageModel.png&#34; alt=&#34;Android App Usage Model&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;由 library APK 提供一個 service。&lt;/li&gt;
&lt;li&gt;App 透過 service 獲取 lib 的絕對路徑。&lt;/li&gt;
&lt;li&gt;但如果 service 不存在可以由 App 透過 Play store 來安裝。&lt;/li&gt;
&lt;li&gt;App 使用 &lt;code&gt;System.load(libpath)&lt;/code&gt; 來載入 &lt;code&gt;.so&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;但這樣相對地 library 要做的事情就蠻多的，細節可以參考 &lt;a href=&#34;https://github.com/Itseez/opencv/tree/master/platforms/android/service&#34;&gt;OpenCV 的做法&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;總結&#34;&gt;總結&lt;/h3&gt;
&lt;p&gt;上面的方法各有其適用的時機，該用那一種就是大家自己去思考及評估囉。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Go on Heroku</title>
      <link>https://blog.simplypatrick.com/posts/2013/12-15-go-on-heroku/</link>
      <pubDate>Sun, 15 Dec 2013 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2013/12-15-go-on-heroku/</guid>
      <description>&lt;p&gt;要將 Go app 放到 Heroku 上執行基本上並不複雜，只要依照這篇 &lt;a href=&#34;http://mmcgrana.github.io/2012/09/getting-started-with-go-on-heroku.html&#34;&gt;Getting Started With Go on Heroku&lt;/a&gt; 一步一步照著做就行了，如果出了問題可以查一下是否是下列幾個原因造成的：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;.godir&lt;/code&gt; 要設定成你的 package 路徑，例如你的程式是放在 &lt;code&gt;$GOPATH/src/simplypatrick/flights&lt;/code&gt;，那 package 路徑就是 &lt;code&gt;simplypatrick/flights&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Procfile&lt;/code&gt; 裡的 &lt;code&gt;web: &lt;/code&gt; 後面是接執行檔的路徑，我目前試驗的結果是放在 &lt;code&gt;bin/&lt;/code&gt; 裡面，所以以我的例子要設定成 &lt;code&gt;web: bin/flights&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Heroku 目前預設好像都不會把 web process 跑起來，所以需要執行 &lt;code&gt;heroku ps:scale web=1&lt;/code&gt; 來啟動 web process。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;話說回來，目前 Heroku 目前並沒有正式支援 Go，目前能夠放 Go app 上去跑其實是透過 &lt;a href=&#34;https://devcenter.heroku.com/articles/buildpacks#using-a-custom-buildpack&#34;&gt;custom buildpack&lt;/a&gt; 完成的。要怎麼創建自己的 buildpack 可以參考 &lt;a href=&#34;http://www.petekeen.net/introduction-to-heroku-buildpacks&#34;&gt;Run Anything on Heroku with Custom Buildpacks&lt;/a&gt;，例如前面例子的 Go buildpack 是用 Go 1.1.2，如果你想改成用 Go 1.2 可以自己 fork 一份 buildpack 來改。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My Go Development Environment</title>
      <link>https://blog.simplypatrick.com/posts/2013/12-14-my-go-development-environment/</link>
      <pubDate>Sat, 14 Dec 2013 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2013/12-14-my-go-development-environment/</guid>
      <description>&lt;p&gt;分享一下我的 &lt;a href=&#34;http://golang.org/&#34;&gt;Go&lt;/a&gt; 開發環境。&lt;/p&gt;
&lt;h3 id=&#34;作業系統-mac-os-x-109&#34;&gt;作業系統: Mac OS X 10.9&lt;/h3&gt;
&lt;p&gt;在 Mac 上要使用 Go 的最簡單方式是用 Homebrew 來安裝:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ brew install go&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;安裝成功後，查看一下注意事項：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ brew info go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go: stable 1.2 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;bottled&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, HEAD
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http://golang.org
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/usr/local/Cellar/go/1.2 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3980&lt;/span&gt; files, 115M&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Poured from bottle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;From: https://github.com/mxcl/homebrew/commits/master/Library/Formula/go.rb
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&amp;gt; Options
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--cross-compile-all
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Build the cross-compilers and runtime support &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; all supported platforms
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--cross-compile-common
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Build the cross-compilers and runtime support &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; darwin, linux and windows
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--without-cgo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Build without cgo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&amp;gt; Caveats
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;As of go 1.2, a valid GOPATH is required to use the &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go get&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; command:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  http://golang.org/doc/code.html#GOPATH
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go vet&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; and &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go doc&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; are now part of the go.tools sub repo:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  http://golang.org/doc/go1.2#go_tools_godoc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;To get &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go vet&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; and &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go doc&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt; run:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  go get code.google.com/p/go.tools/cmd/godoc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  go get code.google.com/p/go.tools/cmd/vet
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Bash completion has been installed to:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  /usr/local/etc/bash_completion.d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;zsh completion has been installed to:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  /usr/local/share/zsh/site-functions&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;接下來編輯 &lt;code&gt;~/.profile&lt;/code&gt; 設定 GOROOT 及 GOPATH 環境變數：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ export GOROOT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;go env GOROOT&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ export GOPATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$HOME/src/go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$PATH:$GOROOT/bin:$GOPATH/bin&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;GOROOT&lt;/code&gt; 指定系統上的 Go 的安裝位置; &lt;code&gt;GOPATH&lt;/code&gt; 則指定開發時使用的&lt;a href=&#34;http://golang.org/doc/code.html#Workspaces&#34;&gt;工作區&lt;/a&gt;; 另外把 &lt;code&gt;$GOROOT/bin&lt;/code&gt; 及 &lt;code&gt;$GOPATH/bin&lt;/code&gt; 放到 &lt;code&gt;PATH&lt;/code&gt; 裡方便取用 Go 相關工具。&lt;/p&gt;
&lt;h4 id=&#34;code-completion-gocode&#34;&gt;Code Completion: gocode&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/nsf/gocode&#34;&gt;gocode&lt;/a&gt; 主要提供 code completion 的功能，通常會跟程式編輯器例如 Vim, Emacs, 或是等下提到的 Sublime Text 整合在一起。gocode 本身就是用 Go 寫的，所以安裝就是透過 &lt;code&gt;go get&lt;/code&gt; 來做:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go get -u github.com/nsf/gocode&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;編輯器-sublime-text&#34;&gt;編輯器: Sublime Text&lt;/h3&gt;
&lt;p&gt;Sublime Text 是新一代的程式編輯神器，大家應該都知道，我目前是用 3 beta 版，搭配 Monokai theme + Consolas 17pt 實在是非常的美。&lt;/p&gt;
&lt;p&gt;字型設定：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;color_scheme&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Packages/Color Scheme - Default/Monokai.tmTheme&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;font_face&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Consolas&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;font_size&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;畫面顯示效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;monokai-consolas.png&#34; alt=&#34;Monokai + Consolas&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;gosublime&#34;&gt;GoSublime&lt;/h4&gt;
&lt;p&gt;目前我使用 Sublime Text 3 搭配 &lt;a href=&#34;https://github.com/DisposaBoy/GoSublime&#34;&gt;GoSublime&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;不過由於 GoSublime 似乎讀不到 GOPATH 的值，需要在 &lt;code&gt;GoSublime.sublime-settings&lt;/code&gt; 裡再設定一次：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;env&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GOPATH&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/Users/patrick/src/go&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;按 &lt;code&gt;⌘+.&lt;/code&gt; 兩次可以呼叫出 GoSublime 的功能表，支援相當多的功能:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;gosublime-menu.png&#34; alt=&#34;GoSublime Menu&#34;&gt;&lt;/p&gt;
&lt;p&gt;兩個我覺得還不錯用的功能:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;⌘+., ⌘+g&lt;/code&gt; 跳到變數或函數的定義處&lt;/li&gt;
&lt;li&gt;&lt;code&gt;⌘+., ⌘+d&lt;/code&gt; 列出程式的結構&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;api-參考-dash&#34;&gt;API 參考: Dash&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://kapeli.com/dash&#34;&gt;Dash&lt;/a&gt; 是我最喜歡用的參考文件工具，安裝了 &lt;a href=&#34;https://github.com/farcaller/DashDoc&#34;&gt;DashDoc&lt;/a&gt; 候就可以直接在 Sublime Text 裡按 &lt;code&gt;ctrl-h&lt;/code&gt; 查閱 API 的用法了。&lt;/p&gt;
&lt;h3 id=&#34;happy-go-coding&#34;&gt;Happy Go Coding&lt;/h3&gt;
&lt;p&gt;這樣設定完基本上就是蠻不錯的 Go 開發環境了，接下來當然就是動手多寫程式了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>用 Scala 來開發 Android App 入門</title>
      <link>https://blog.simplypatrick.com/posts/2013/11-11-develop-android-app-with-scala/</link>
      <pubDate>Mon, 11 Nov 2013 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2013/11-11-develop-android-app-with-scala/</guid>
      <description>&lt;p&gt;最近想寫些 Android 的小程式，但是用 Java 實在是太無趣了，於是就想嘗試用 Scala 來做，分享一下怎麼入門的心得。&lt;/p&gt;
&lt;h2 id=&#34;基本工具&#34;&gt;基本工具&lt;/h2&gt;
&lt;p&gt;我假設你已經安裝好下列工具 (標上我目前使用的版本):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scala (2.10.3) 及 SBT (0.13.0)&lt;/li&gt;
&lt;li&gt;IntelliJ 12
&lt;ul&gt;
&lt;li&gt;Scala plugin (0.22.302)&lt;/li&gt;
&lt;li&gt;SBT plugin (1.5.1)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;產生一個基本的-scala-android-app&#34;&gt;產生一個基本的 Scala Android App&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;執行 &lt;code&gt;android create project --target android-19 --path ./MyProject --package com.example.myproject --activity Main&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在 project 目錄下新建 &lt;code&gt;project/plugins.sbt&lt;/code&gt;，內容如下 (注意中間的空白行不可省略):&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;addSbtPlugin&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;com.hanhuy.sbt&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;android-sdk-plugin&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.2.2&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;addSbtPlugin&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;com.hanhuy.sbt&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sbt-idea&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.6.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;在 project 目錄下新建 build.sbt，同樣中間空白行不可省略:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;android&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Plugin&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;androidBuild
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;name &lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;MyProject&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;執行 &lt;code&gt;sbt android:package-debug&lt;/code&gt;，到這一步應該就能把 APK 建立出來了&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;把-java-轉成-scala&#34;&gt;把 Java 轉成 Scala&lt;/h2&gt;
&lt;p&gt;然後你可以試著把 android 幫你產生的 Java 手動改寫成 Scala (副檔名也要改 .scala):&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; com.example.myproject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; android.app.Activity;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; android.os.Bundle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Main&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;extends&lt;/span&gt; Activity
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/** Called when the activity is first created. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;(Bundle savedInstanceState)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;(savedInstanceState);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        setContentView(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;layout&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;變成:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;package&lt;/span&gt; com.example.myproject
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; android.app.Activity
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; android.os.Bundle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Main&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Activity&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; onCreate&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;savedInstanceState&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Bundle&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;onCreate&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;savedInstanceState&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        setContentView&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;R&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;layout&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;main&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;可以再跑一次 &lt;code&gt;sbt android:package-debug&lt;/code&gt; 確認沒問題。&lt;/p&gt;
&lt;h2 id=&#34;產生-intellij-idea-的專案&#34;&gt;產生 IntelliJ Idea 的專案&lt;/h2&gt;
&lt;p&gt;因為我還是比較喜歡用 IntelliJ 來寫 Java/Scala，所以讓我們產生需要的 project 檔:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;執行 &lt;code&gt;sbt gen-idea&lt;/code&gt; 產生專案&lt;/li&gt;
&lt;li&gt;用 IntelliJ 開啟專案&lt;/li&gt;
&lt;li&gt;新增一個 Run/Debug Configuration，類型是 &lt;code&gt;Android Application&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Module 記得要設定成 MyProject&lt;/li&gt;
&lt;li&gt;把 &lt;code&gt;Before Launch&lt;/code&gt; 的設定改成 Run SBT Action &lt;code&gt;android:package-debug&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;執行 Run 或是 Debug 沒問題就大功告成了&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;intellij.png&#34; alt=&#34;IntelliJ&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;進階&#34;&gt;進階&lt;/h2&gt;
&lt;p&gt;如果想要寫 Scala 風格的 Android 程式，可以參考 &lt;a href=&#34;https://github.com/pocorall/scaloid&#34;&gt;pocorall/scaloid&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;參考&#34;&gt;參考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/pfn/android-sdk-plugin&#34;&gt;pfn / android-sdk-plugin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.madeye.me/2013/05/09/scala-in-android/&#34;&gt;使用 Scala 编写 Android 应用 - MADEYE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Scala: Under the Hood #1</title>
      <link>https://blog.simplypatrick.com/posts/2012/12-10-scala-under-the-hood-number-1/</link>
      <pubDate>Mon, 10 Dec 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/12-10-scala-under-the-hood-number-1/</guid>
      <description>&lt;p&gt;我學一個東西向來喜歡盡量深入去瞭解它的運作原理，這兩天看了 Scala 覺得蠻有趣的，也會去想像如果翻譯成 Java 會是怎麼樣的做法。
如果想知道自己的想法跟 Scala 實作的差距，可以直接做些實驗來比對。例如下面就是個求解最大公因數的實驗，我寫了四個版本 (gcd1 .. gcd4)：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCD&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; main&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;args&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;])&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; gcd1&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; gcd1&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; gcd2&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gcd2&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; gcd3&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; m &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; gcd3&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; gcd4&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Int&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    gcd4 &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#66d9ef&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; m &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; gcd4&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; args&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;toInt&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;gcd1&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;gcd2&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;gcd3&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;gcd4&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;執行結果如下：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ scala GCD &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;768&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;用 JD 反編譯出來的實作：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Array.;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Function2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.MatchError;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Option;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Predef.;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.ScalaObject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Serializable;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Tuple2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.Tuple2.mcII.sp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.collection.IndexedSeq;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.collection.SeqLike;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.collection.TraversableLike;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.collection.immutable.StringLike;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.reflect.Manifest.;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.runtime.AbstractFunction1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.runtime.AbstractFunction2.mcIII.sp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.runtime.BoxesRunTime;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; scala.runtime.ObjectRef;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCD$&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;implements&lt;/span&gt; ScalaObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt;  MODULE$;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(String&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; args) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;; ObjectRef gcd4$1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ObjectRef(&lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gcd4$1.&lt;span style=&#34;color:#a6e22e&#34;&gt;elem&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; AbstractFunction2.&lt;span style=&#34;color:#a6e22e&#34;&gt;mcIII&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sp&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; serialVersionUID &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0L;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; ObjectRef gcd4$1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; m, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; n) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; apply$mcIII$sp(m, n); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply$mcIII$sp&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; v1, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; v2) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; v2 &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; 0 &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; v1 : ((Function2)&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcd4$1&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;elem&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;apply$mcIII$sp&lt;/span&gt;(v2, v1 &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; v2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; arrayOfInt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;)Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;refArrayOps&lt;/span&gt;((Object&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;)args).&lt;span style=&#34;color:#a6e22e&#34;&gt;map&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; AbstractFunction1() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; serialVersionUID &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0L;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(String paramString) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;augmentString&lt;/span&gt;(paramString).&lt;span style=&#34;color:#a6e22e&#34;&gt;toInt&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        , Array..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;canBuildFrom&lt;/span&gt;(Manifest..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Int&lt;/span&gt;()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Option localOption &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Array..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;unapplySeq&lt;/span&gt;(arrayOfInt);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (localOption.&lt;span style=&#34;color:#a6e22e&#34;&gt;isEmpty&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; MatchError(arrayOfInt);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        IndexedSeq localIndexedSeq &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (IndexedSeq)localOption.&lt;span style=&#34;color:#a6e22e&#34;&gt;get&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((localIndexedSeq.&lt;span style=&#34;color:#a6e22e&#34;&gt;lengthCompare&lt;/span&gt;(2) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; 0 &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; 1 : localIndexedSeq &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; 0 : 0) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; 0) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Tuple2.&lt;span style=&#34;color:#a6e22e&#34;&gt;mcII&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sp&lt;/span&gt; localsp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Tuple2.&lt;span style=&#34;color:#a6e22e&#34;&gt;mcII&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sp&lt;/span&gt;(BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;unboxToInt&lt;/span&gt;(localIndexedSeq.&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(0)), BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;unboxToInt&lt;/span&gt;(localIndexedSeq.&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(1)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; localsp.&lt;span style=&#34;color:#a6e22e&#34;&gt;_1$mcI$sp&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; localsp.&lt;span style=&#34;color:#a6e22e&#34;&gt;_2$mcI$sp&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;println&lt;/span&gt;(BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;boxToInteger&lt;/span&gt;(gcd1$1(m, n)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;println&lt;/span&gt;(BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;boxToInteger&lt;/span&gt;(gcd2$1(m, n)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;println&lt;/span&gt;(BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;boxToInteger&lt;/span&gt;(gcd3$1(m, n)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Predef..&lt;span style=&#34;color:#a6e22e&#34;&gt;MODULE$&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;println&lt;/span&gt;(BoxesRunTime.&lt;span style=&#34;color:#a6e22e&#34;&gt;boxToInteger&lt;/span&gt;(((Function2)gcd4$1.&lt;span style=&#34;color:#a6e22e&#34;&gt;elem&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;apply$mcIII$sp&lt;/span&gt;(m, n)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ObjectRef gcd4$1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; MatchError(arrayOfInt);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gcd1$1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; m, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; n) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; 0) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n; m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gcd2$1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; m, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; n) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; 0) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n; m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gcd3$1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; m, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; n) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (n &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; 0) &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; n; m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCD$&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        MODULE$ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;觀察到的幾點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCD$ 會從 ScalaObject 繼承下來&lt;/li&gt;
&lt;li&gt;區域函數都變成了 private final method&lt;/li&gt;
&lt;li&gt;前三個 gcd 函數基本上是一樣的&lt;/li&gt;
&lt;li&gt;var gcd4 會被翻譯成一個 local ObjectRef object&lt;/li&gt;
&lt;li&gt;gcd4 這個 function literal 會用 Java anonymous function 來實現&lt;/li&gt;
&lt;li&gt;_.toInt 會翻譯成一個 AbstractFunction1 的實現&lt;/li&gt;
&lt;li&gt;augmentString 用來實現從 String 到 StringOps 的 implicit conversion&lt;/li&gt;
&lt;li&gt;unapplySeq 可以對命令列參數提取一個 Option，從其中又可拿到一個 IndexedSeq&lt;/li&gt;
&lt;li&gt;BoxesRunTime 用來負責 boxing/unboxing 的處理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;之後有時間的話會再持續挖些東西出來看。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Ruby&#39;s Object Model</title>
      <link>https://blog.simplypatrick.com/posts/2012/12-08-rubys-object-model/</link>
      <pubDate>Sat, 08 Dec 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/12-08-rubys-object-model/</guid>
      <description>&lt;p&gt;Ruby 強大的 metaprogramming 能力就是來自於它簡單又優雅的 &lt;a href=&#34;https://speakerdeck.com/burkelibbey/rubys-object-model-metaprogramming-and-other-magic&#34;&gt;object model&lt;/a&gt;。&lt;/p&gt;
&lt;script async class=&#34;speakerdeck-embed&#34; data-id=&#34;4f7bbdc35c2f8f0022000872&#34; data-ratio=&#34;1.77777777777778&#34; src=&#34;//speakerdeck.com/assets/embed.js&#34;&gt;&lt;/script&gt;
</description>
    </item>
    
    <item>
      <title>Trying Scala on Android</title>
      <link>https://blog.simplypatrick.com/posts/2012/12-08-trying-scala-on-android/</link>
      <pubDate>Sat, 08 Dec 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/12-08-trying-scala-on-android/</guid>
      <description>&lt;p&gt;Scala 是基於 Java 平台的多範式程式語言，最著名的使用者就是原本從 Ruby 起家的 Twitter。由於 Java 平台賦予的可攜性，除了應用於各式各樣的後端程式，Scala 也能用來撰寫 Android 的 app。&lt;/p&gt;
&lt;p&gt;我嘗試的環境如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mac OS X 10.8.2&lt;/li&gt;
&lt;li&gt;Android 4.2 SDK&lt;/li&gt;
&lt;li&gt;Scala 2.9.2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;由於我習慣用 ant 來建置，需要先做的就是&lt;a href=&#34;https://github.com/yinghau76/android-examples/blob/803229f597b3095f5e03bd85785599d54c0466c3/android-sdk/HelloActivity/build.xml&#34;&gt;修改 build.xml&lt;/a&gt; 加入以下步驟：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-markup&#34; data-lang=&#34;markup&#34;&gt;&amp;lt;import file=&amp;#34;mac-shim.xml&amp;#34; /&amp;gt;
&amp;lt;import file=&amp;#34;build-scala.xml&amp;#34; /&amp;gt;
&amp;lt;target name=&amp;#34;-post-compile&amp;#34; depends=&amp;#34;-post-compile-scala&amp;#34; /&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;重點在於加入 -post-compile-scala 這個步驟來編譯 src/ 下的 .scala 檔案。&lt;a href=&#34;https://github.com/yinghau76/android-examples/blob/803229f597b3095f5e03bd85785599d54c0466c3/android-sdk/HelloActivity/mac-shim.xml&#34;&gt;mac-shim.xml&lt;/a&gt; 是為了解決 Android SDK 的 ant script 在 Linux/MacOS 下的差異；&lt;a href=&#34;https://github.com/yinghau76/android-examples/blob/803229f597b3095f5e03bd85785599d54c0466c3/android-sdk/HelloActivity/build-scala.xml&#34;&gt;build-scala.xml&lt;/a&gt; 則是包含可重複使用的 Scala 建置規則。&lt;/p&gt;
&lt;p&gt;另外執行 ant 前要先用 android update project 把 local.properties 產生出來，並把 scala.dir 指向 Scala 的安裝位置：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ android update project -p . -t android-17
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ echo scala.dir&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/usr/local/share/scala-2.9.2 &amp;gt;&amp;gt; local.properties
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ant&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;完整的範例可以到我 GitHub 裡面抓 &lt;a href=&#34;https://github.com/yinghau76/android-examples/tree/803229f597b3095f5e03bd85785599d54c0466c3/android-sdk/HelloActivity&#34;&gt;HelloActivity&lt;/a&gt; 這個目錄，一個這樣空的 activity 產生出來的 APK 大小是 5,686 bytes，還不錯：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; com.example.android.helloactivity
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; android.app.Activity
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; android.os.Bundle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; android.widget.TextView
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HelloActivity&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;extends&lt;/span&gt; Activity {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/** Called when the activity is first created. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    override def &lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;(savedInstanceState: Bundle) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;(savedInstanceState)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        setContentView(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;layout&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;接下來嘗試比較龐大的範例如 ApiDemos，如果不幸地在 proguard 過程會有 OOM error:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;-post-compile-scala:
...
[proguard] Reading library jar [/usr/local/share/android-sdk-mac_x86/platforms/android-17/android.jar]

BUILD FAILED
/Users/patrick/src/android/scala-android-examples/android-sdk/ApiDemos/build-scala.xml:186: java.lang.OutOfMemoryError: Java heap space
        at proguard.classfile.constant.Utf8Constant.getStringRepresentation(Utf8Constant.java:251)
        ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可以適當地加大 ant 的記憶體配置：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ export ANT_OPTS&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;-Xmx512m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ant&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;應該這樣就會順利成功建出 APK 在手機上執行。更進階的用法可以參考的 Stéphane Micheloud 的 &lt;a href=&#34;http://lampwww.epfl.ch/~michelou/android/&#34;&gt;Exploring Android&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>rb-appscript and iTunes</title>
      <link>https://blog.simplypatrick.com/posts/2012/12-02-rb-appscript-and-itunes/</link>
      <pubDate>Sun, 02 Dec 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/12-02-rb-appscript-and-itunes/</guid>
      <description>&lt;p&gt;iTunes 11 出來了，界面變簡潔漂亮了，所以就比較有把音樂資料庫整理一下的動力。手上有很久以前下載的 Rolling Stone Magazine&amp;rsquo;s Top 500 Songs，可惜的是加入 iTunes 資料庫後由於沒有音軌數字的資訊，整個次序都不大對：&lt;/p&gt;
&lt;img class=&#34;img-thumbnail&#34; src=&#34;rb-appscript-1.png&#34;/&gt;
&lt;p&gt;手動一個一個改對我來說是不可能的，於是想到了 iTunes 似乎是有提供 AppleScript API 界面的，但第一個問題就是我跟 AppleScript 不熟，於是在網路上搜尋發現有個 Ruby gem 叫 &lt;a href=&#34;http://appscript.sourceforge.net/rb-appscript/index.html&#34;&gt;rb-appscript&lt;/a&gt; 可以用 Ruby 來做類似的功能，二話不說就 gem install rb-appscript 下來用了。&lt;/p&gt;
&lt;p&gt;但接著第二個問題是我跟 iTunes 的 AppleScript API 也不熟，但也很快地發現可以從 AppleScript editor 裡面查到：&lt;/p&gt;
&lt;img class=&#34;img-thumbnail&#34; src=&#34;rb-appscript-2.png&#34;/&gt;
&lt;p&gt;於是在 irb 裡小試了一下發現可以成功運作後，就直接動手寫了：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;require &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;appscript&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Appscript&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;by_name(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;iTunes&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;selection&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;t&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  t&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;track_number&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;set $1 &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; t&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;name&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get &lt;span style=&#34;color:#f92672&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/^(\d+)/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;哈，大功告成。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Inconsolata and Source Code Pro</title>
      <link>https://blog.simplypatrick.com/posts/2012/09-27-inconsolata-and-source-code-pro/</link>
      <pubDate>Thu, 27 Sep 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/09-27-inconsolata-and-source-code-pro/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://blogs.adobe.com/typblography/2012/09/source-code-pro.html&#34;&gt;Source Code Pro&lt;/a&gt; 是 Adobe 近日釋出的 open-source font:&lt;/p&gt;
&lt;img class=&#34;img-thumbnail&#34; alt=&#34;SourceCodePro&#34; src=&#34;//lh6.googleusercontent.com/-yodBOdc-oH0/UGMnDkRg9dI/AAAAAAAAEqk/sNnxhRShIDU/s800/Source%2520Code%2520Pro.png&#34;/&gt;
&lt;p&gt;跟我目前的最愛 &lt;a href=&#34;http://levien.com/type/myfonts/inconsolata.html&#34;&gt;Inconsolata&lt;/a&gt;：&lt;/p&gt;
&lt;img class=&#34;img-thumbnail&#34; alt=&#34;Inconsolata&#34; src=&#34;//lh4.googleusercontent.com/-2zjawsZ702U/UGMnDp2mU-I/AAAAAAAAEqo/p60CoZDr98w/s800/Incosolata.png&#34;/&gt;
&lt;p&gt;比較一下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://lh5.googleusercontent.com/-2D1EORSh3gY/UGMuWrUDprI/AAAAAAAAErA/92EbdvXZTw0/s800/%25E8%259E%25A2%25E5%25B9%2595%25E5%25BF%25AB%25E7%2585%25A7%25202012-09-27%2520%25E4%25B8%258A%25E5%258D%258812.32.24.png&#34; alt=&#34;Compare Source Code Pro with Inconsolata&#34;&gt;&lt;/p&gt;
&lt;p&gt;兩個的設計其實很接近，但基於以下幾個原因我還是比較喜歡 Inconsolata：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Source Code Pro 比例上比較寬，實際顯示字有點太胖&lt;/li&gt;
&lt;li&gt;我比較喜歡加斜線的 0&lt;/li&gt;
&lt;li&gt;Inconsolata 的符號稍微大了一點&lt;/li&gt;
&lt;li&gt;不喜歡 Source Code Pro 的小寫 i 及 k&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Ruby Singleton Class</title>
      <link>https://blog.simplypatrick.com/posts/2012/09-16-ruby-singleton-class/</link>
      <pubDate>Sun, 16 Sep 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/09-16-ruby-singleton-class/</guid>
      <description>&lt;p&gt;今天花了點時間試著了解 Ruby Class/Object 的內部實現：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;ruby-object-class.png&#34; alt=&#34;Ruby RObject and RClass&#34;&gt;&lt;/p&gt;
&lt;p&gt;以及 singleton class 的創建機制：&lt;/p&gt;
&lt;pre&gt;
eval.c -&gt; eval.c: rb_extend_object
activate eval.c
    eval.c -&gt; class.c: rb_singleton_class
    activate class.c
        class.c -&gt; class.c: singleton_class_of
        activate class.c
            class.c -&gt; class.c: rb_make_metaclass
            activate class.c
                class.c -&gt; class.c: make_singleton_class
                activate class.c
                    class.c -&gt; class.c: rb_class_boot
                    activate class.c
                        class.c -&gt; class.c: rb_class_alloc
                        activate class.c
                        deactivate class.c
                    deactivate class.c
                    class.c -&gt; class.c: rb_singleton_class_attached
                    activate class.c
                    deactivate class.c
                deactivate class.c
            deactivate class.c
        deactivate class.c
    deactivate class.c
    class.c --&gt; eval.c
eval.c -&gt; class.c: rb_include_module
&lt;/pre&gt;
&lt;p&gt;借用 &lt;a href=&#34;http://rhg.rubyforge.org/&#34;&gt;RHG&lt;/a&gt; 裡面的一張圖來說明 singleton class 跟 obj 及 original class 的關係：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;ch_class_addsclass.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;從短短的 make_singleton_class 就可以看出 code 寫得很簡潔易懂，果然是裡外都很漂亮:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;inline&lt;/span&gt; VALUE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;make_singleton_class&lt;/span&gt;(VALUE obj)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    VALUE orig_class &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RBASIC&lt;/span&gt;(obj)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;klass;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    VALUE klass &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rb_class_boot&lt;/span&gt;(orig_class);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;FL_SET&lt;/span&gt;(klass, FL_SINGLETON);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;RBASIC&lt;/span&gt;(obj)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;klass &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; klass;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rb_singleton_class_attached&lt;/span&gt;(klass, obj);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;METACLASS_OF&lt;/span&gt;(klass) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;METACLASS_OF&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rb_class_real&lt;/span&gt;(orig_class));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; klass;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;更詳細的 Ruby 內部實現介紹可以參考這兩份簡報：&lt;/p&gt;
&lt;iframe src=&#34;//www.slideshare.net/slideshow/embed_code/12592243&#34; width=&#34;427&#34; height=&#34;356&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34; style=&#34;border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px&#34; allowfullscreen&gt; &lt;/iframe&gt;
&lt;iframe src=&#34;//www.slideshare.net/slideshow/embed_code/12158471&#34; width=&#34;427&#34; height=&#34;356&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34; style=&#34;border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px&#34; allowfullscreen&gt; &lt;/iframe&gt;
</description>
    </item>
    
    <item>
      <title>ACRA and BugSense</title>
      <link>https://blog.simplypatrick.com/posts/2012/08-19-acra-and-bugsense/</link>
      <pubDate>Sun, 19 Aug 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/08-19-acra-and-bugsense/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://code.google.com/p/acra/&#34;&gt;ACRA&lt;/a&gt; (Application Crash Report for Android) 是個&lt;a href=&#34;http://www.appbrain.com/stats/libraries/details/acra/acra&#34;&gt;很受歡迎&lt;/a&gt;的 Android library，因為當你的 app 掛點時，它可以送一份驗屍報告 (crash report) 到 server 保存，以便開發者能做事後分析並修正問題。&lt;/p&gt;
&lt;p&gt;你需要做的只是下面簡短幾行設定：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@ReportsCrashes&lt;/span&gt;(formKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dGp6WmNqdXNMM2lkTkJiUmhHRlM014615&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// Add this line&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Globals&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;extends&lt;/span&gt; Application {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; Airport sAirport;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; Airport &lt;span style=&#34;color:#a6e22e&#34;&gt;getAirport&lt;/span&gt;(Context context) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (sAirport &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            sAirport &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; TaoyuanAirport(context.&lt;span style=&#34;color:#a6e22e&#34;&gt;getApplicationContext&lt;/span&gt;());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; sAirport;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ACRA.&lt;span style=&#34;color:#a6e22e&#34;&gt;init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;// Add this line&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;super&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;onCreate&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然後 manifest 裡面加上以下設定：&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-markup&#34; data-lang=&#34;markup&#34;&gt;&amp;lt;uses-permission android:name=&amp;#34;android.permission.INTERNET&amp;#34;/&amp;gt;

&amp;lt;application
        android:name=&amp;#34;.Globals&amp;#34;
        android:icon=&amp;#34;@drawable/ic_app&amp;#34;&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後記得去連結 arca-x.y.z.jar 就行了。&lt;/p&gt;
&lt;p&gt;細節可以參考網站上的&lt;a href=&#34;http://code.google.com/p/acra/wiki/BasicSetup?tm=6&#34;&gt;教學&lt;/a&gt;。目前網站上教的方式是把 crash report 發到你指定的 Google Docs 文件裡，是可以用但實用度非常低，因為用 spreadsheet 來看 crash report 非常地不方便。&lt;/p&gt;
&lt;p&gt;這種有普遍需求但做起來不方便的事，在今天這個世界，一定有人已經想到並且設法解決你的問題(並且從中賺到你的錢），&lt;a href=&#34;https://www.bugsense.com/&#34;&gt;BugSense&lt;/a&gt; 是目前看起來還不錯的一家，據說每天處理超過一千萬條程式錯誤。目前 BugSense 支援 Android, iOS, Windows Phone 7, HTML5, 及 Google App Engine。使用量不大的話，可以先試看看它的免費版本。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;bugsense.png&#34; alt=&#34;Why use BugSense?&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AQuery - JQuery-like library for Android App</title>
      <link>https://blog.simplypatrick.com/posts/2012/08-19-aquery-jquery-like-library-for-android-app/</link>
      <pubDate>Sun, 19 Aug 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/08-19-aquery-jquery-like-library-for-android-app/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://code.google.com/p/android-query/&#34;&gt;Android Query&lt;/a&gt; 是個頗酷的 Android library，顧名思義就是給 Android 用但用法很像 jQuery 的東西。&lt;/p&gt;
&lt;p&gt;跟 jQuery 一樣，AQuery 的目標是讓 Android developer 可以 write less and do more：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;renderContent&lt;/span&gt;(Content content, View view) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    AQuery aq &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; AQuery(view);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aq.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;icon&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;image&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;drawable&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;icon&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;visible&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;clicked&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;someMethod&amp;#34;&lt;/span&gt;);  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aq.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;text&lt;/span&gt;(content.&lt;span style=&#34;color:#a6e22e&#34;&gt;getPname&lt;/span&gt;());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aq.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;text&lt;/span&gt;(FormatUtility.&lt;span style=&#34;color:#a6e22e&#34;&gt;relativeTime&lt;/span&gt;(System.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTimeMillis&lt;/span&gt;(), content.&lt;span style=&#34;color:#a6e22e&#34;&gt;getCreate&lt;/span&gt;())).&lt;span style=&#34;color:#a6e22e&#34;&gt;visible&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aq.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;(R.&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;desc&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;text&lt;/span&gt;(content.&lt;span style=&#34;color:#a6e22e&#34;&gt;getDesc&lt;/span&gt;()).&lt;span style=&#34;color:#a6e22e&#34;&gt;visible&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;也可以輕鬆地執行 AJAX:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;asyncJson&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// perform a Google search in just a few lines of code&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    String url &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://www.google.com/uds/GnewsSearch?q=Obama&amp;amp;v=1.0&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aq.&lt;span style=&#34;color:#a6e22e&#34;&gt;ajax&lt;/span&gt;(url, JSONObject.&lt;span style=&#34;color:#a6e22e&#34;&gt;class&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;jsonCallback&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;jsonCallback&lt;/span&gt;(String url, JSONObject json, AjaxStatus status) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (json &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// successful ajax call&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ajax error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;另外兩個蠻實用的功能是 getCachedImage 及 shouldDelay，直接參考它們的說明吧：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * Return bitmap cached by image requests. Returns null if url is not cached.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param url
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param targetWidth The desired downsampled width.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @return Bitmap
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; Bitmap &lt;span style=&#34;color:#a6e22e&#34;&gt;getCachedImage&lt;/span&gt;(String url, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; targetWidth){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Bitmap result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; BitmapAjaxCallback.&lt;span style=&#34;color:#a6e22e&#34;&gt;getMemoryCached&lt;/span&gt;(url, targetWidth);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(result &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                File file &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getCachedFile(url);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(file &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; BitmapAjaxCallback.&lt;span style=&#34;color:#a6e22e&#34;&gt;getResizedImage&lt;/span&gt;(file.&lt;span style=&#34;color:#a6e22e&#34;&gt;getAbsolutePath&lt;/span&gt;(), &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;, targetWidth, &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;, 0);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; result;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * Determines if a list or gallery view item should delay loading a url resource because the view is scrolling very fast.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * The primary purpose of this method is to skip loading remote resources (such as images) over the internet
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * until the list stop flinging and the user is focusing on the displaying items.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * If the scrolling stops and there are delayed items displaying, the getView method will be called again to force
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * the delayed items to be redrawn. During redraw, this method will always return false, thus allowing a particular
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * resource to be loaded.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * Designed to be used inside getView(int position, View convertView, ViewGroup parent) of an adapter.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * Example usage:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;pre&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *              public View getView(int position, View convertView, ViewGroup parent) {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                      ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                      if(aq.shouldDelay(position, convertView, parent, tbUrl)){
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                              aq.id(R.id.tb).image(placeholder);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                      }else{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                              aq.id(R.id.tb).image(tbUrl, true, true, 0, 0, placeholder, 0, 0);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                      }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *                      ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *              }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;/pre&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * NOTE:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * This method uses the setOnScrollListener() method and will override any previously non-aquery assigned scroll listener.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * If a scrolled listener is required, use the aquery method scrolled(OnScrollListener listener) to set the listener
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * instead of directly calling setOnScrollListener().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param position the position of the item
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param convertView the list item view
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param parent the parent input of getView
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @param url the content url to be checked if cached and is available immediately
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    * @return delay should delay loading a particular resource
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;    */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;boolean&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shouldDelay&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; position, View convertView, ViewGroup parent, String url){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(parent &lt;span style=&#34;color:#66d9ef&#34;&gt;instanceof&lt;/span&gt; ExpandableListView){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Please use the other shouldDelay methods for expandable list.&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Common.&lt;span style=&#34;color:#a6e22e&#34;&gt;shouldDelay&lt;/span&gt;(position, convertView, parent, url);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這個 library 應該會成為我開發 Android app 的標準配備。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>PlantUML - Keep Knowledge in Plain Text</title>
      <link>https://blog.simplypatrick.com/posts/2012/08-19-plantuml-keep-knowledge-in-plain-text/</link>
      <pubDate>Sun, 19 Aug 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/08-19-plantuml-keep-knowledge-in-plain-text/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://plantuml.sourceforge.net/&#34;&gt;PlantUML&lt;/a&gt; 是個有趣的工具，因為它可以讓你用純文字的方式來表達視覺化的 UML，如以下的例子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;@startuml

abstract class AbstractList
abstract AbstractCollection
interface List
interface Collection

List &amp;lt;|-- AbstractList
Collection &amp;lt;|-- AbstractCollection

Collection &amp;lt;|- List
AbstractCollection &amp;lt;|- AbstractList
AbstractList &amp;lt;|-- ArrayList

class ArrayList {
    Object[] elementData
    size()
}

@enduml
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;能用來產生這張圖：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.plantuml.com:80/plantuml/png/IqmgBYbAJ2vHICv9B2vMS8HoVJABIxWION8mKUVyd9pKv9BC_3okpBoIrAAqnEHK1R1I11T93HT8Ii6cHbSNrLo44bH9PAseQY2MOAe3ow6OZSo1cbvKb5W9bkE2-X4ce53DfG04_abPGDEYOnLISr9pK_DAN19B4i4InPbLgHgQNBLS0000&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;這樣的概念並不是新的，像 &lt;a href=&#34;http://en.wikipedia.org/wiki/Graphviz&#34;&gt;Graphvis&lt;/a&gt; 這套工具就是用 &lt;a href=&#34;http://en.wikipedia.org/wiki/DOT_language&#34;&gt;DOT language&lt;/a&gt; 來描述「圖」，PlantUML 只是將這概念套用在 UML 上。對 programmer 來說，這種表示方法是再自然不過了，因為這樣能將內容與呈現方式分離，而當要修改內容時你所需要的只是你最愛的文字編輯器。&lt;/p&gt;
&lt;p&gt;有許多種方式來使用 PlantUML：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;手動撰寫內容，然後單純使用它來產生 UML 圖檔 (JPG, PNG, or SVG)&lt;/li&gt;
&lt;li&gt;用程式自動產生內容，再經由 PlantUML 產生圖檔&lt;/li&gt;
&lt;li&gt;將它嵌入其他文件 (程式碼、Word 文件、網頁) 裡，當呈現時再動態產生圖檔&lt;/li&gt;
&lt;li&gt;因為是純文字，所以很容易可以在&lt;a href=&#34;http://www.codeuml.com&#34;&gt;網站上直接編輯內容&lt;/a&gt;，產生唯一的 image URL，需要呈現時再從網站下載&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;非常地有彈性及符合 &lt;a href=&#34;http://en.wikipedia.org/wiki/Don&#39;t_repeat_yourself&#34;&gt;DRY&lt;/a&gt; 原則，這也是為什麼 Pragmatic Programmer 告訴你要用純文字來保存你的知識。&lt;/p&gt;
&lt;p&gt;所以如果你想在 Octopress 裡面直接內嵌 PlantUML 可以打下面這個 patch：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;diff --git a/plugins/backtick_code_block.rb b/plugins/backtick_code_block.rb
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;index 40e7900..2023c25 100644
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;--- a/plugins/backtick_code_block.rb
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+++ b/plugins/backtick_code_block.rb
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;@@ -28,6 +28,14 @@ module BacktickCodeBlock
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    if @lang.nil? || @lang == &amp;#39;plain&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        code = tableize_code(str.gsub(&amp;#39;&amp;lt;&amp;#39;,&amp;#39;&amp;amp;lt;&amp;#39;).gsub(&amp;#39;&amp;gt;&amp;#39;,&amp;#39;&amp;amp;gt;&amp;#39;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &amp;#34;&amp;lt;figure class=&amp;#39;code&amp;#39;&amp;gt;#{@caption}#{code}&amp;lt;/figure&amp;gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+      elsif @lang == &amp;#39;plantuml&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+        svg = &amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+        IO.popen(&amp;#39;plantuml -pipe -tsvg&amp;#39;, &amp;#39;r+t&amp;#39;) do |f|
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+          f.write &amp;#34;@startuml\n#{str}\n@enduml&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+          f.close_write
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+          svg = f.read
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+        end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;+        &amp;#34;&amp;lt;figure&amp;gt;#{svg}&amp;lt;/figure&amp;gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    else
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        if @lang.include? &amp;#34;-raw&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        raw = &amp;#34;``` #{@options.sub(&amp;#39;-raw&amp;#39;, &amp;#39;&amp;#39;)}\n&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>Reference Counting in Android libutils</title>
      <link>https://blog.simplypatrick.com/posts/2012/08-12-reference-counting-in-android-libutils/</link>
      <pubDate>Sun, 12 Aug 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/08-12-reference-counting-in-android-libutils/</guid>
      <description>&lt;p&gt;從事 Android native framework 層的開發一定會接觸到兩個 C++ template class: sp 及 wp，分別是 strong pointer 及 weak pointer 的簡稱，是兩個看似簡單但卻有著魔鬼細節的 utility class。&lt;/p&gt;
&lt;p&gt;一個比較典型使用 weak pointer 的狀況就是 Listener pattern，例如:&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TimedTextPlayer&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    wp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MediaPlayerBase&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; mListener;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; TimedTextPlayer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;postTextEvent(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; sp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;ParcelEvent&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;amp;&lt;/span&gt; parcel, &lt;span style=&#34;color:#66d9ef&#34;&gt;int64_t&lt;/span&gt; timeUs) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MediaPlayerBase&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; listener &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mListener.promote();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (listener &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; NULL) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        listener&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;getCurrentPosition(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;positionMs);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這個例子如果使用 sp 來記錄 listener 很容易因為忘了移除 listener 而造成 memory leak。用了 wp 也就沒有這個困擾，不過額外的開銷就是 wp 必須先呼叫 promote() 拿到一個 sp 才能使用。&lt;/p&gt;
&lt;p&gt;如果要了解 sp 及 wp 的原理，必定要先了解 RefBase，因為這兩個 class 都必須搭配繼承自 RefBase 的 class 才能運作，以下是他們之間的大致關係：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.plantuml.com:80/plantuml/png/VLB1IiD04BtdAuOMIXhjGRr9BQXO43o85iHJMPD93IRPPNVQ8bg_tPriqcPZwcd3l3Tlthn9d0jZu0dJ6s4GlWA0autC4iZA-9cqB5TXbeptrGJxggdKCTvt6xAIBiwN12ia1zpATKdXE61mY-93OxgaJuKHn1e5uOkjDSq-RYKOj2wDwn_MXaCc3pUPfhN8uQUtMbcKvJpJXYoX5tmGfZR93EUXozalU4s4XI9CmZGNAtCA_NpMh5rNYhiWQ6AUVayci7Xzl0k2kCg_lQv_X7OepGdQjJSfSn3EqNydu9xc0BlksAnGkHlRT1HEo2kn11VgBI8e-F4eSmw4zRs5gdNRimv93Cu645cKNy_D9HHyxhrJDUMyPfNBoSBENYhI_Et_AONc9cl9s8OPA2qBIUw7SF75EGhjCjWg64I7yQpFOolX3kQjmnpTycQEURCcHY0LQa5INuKMaVIEUlmNYcLfg1AQZHgITMYEE_m5&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;!--
class RefBase {
  +void incStrong(id)
  +void decStrong(id)
  +void forceIncStrong(id)
  +int32_t getStrongCount()

  +weakref_type* createWeak(id)
  +weakref_type* getWeakRefs()

  #RefBase()
  #virtual ~RefBase()
  #virtual void onFirstRef()
  #virtual void onLastStrongRef(id)
  #virtual void onIncStrongAttempted(flags, id)
  #virtual void onLastWeakRef(id)
}

RefBase &lt;|-- TYPE

class weakref_type {
  +void incWeak(id)
  +void decWeak(id)
  +bool attemptIncStrong(id)
  +int32_t getWeakCount()
}

class weakref_impl {
  +int32_t mStrong
  +int32_t mWeak
  +RefBase* mBase
  +int32_t mFlags
}

weakref_type &lt;|-- weakref_impl

RefBase &#34;1&#34; *-- &#34;1&#34; weakref_impl : mRefs

class wp&lt;TYPE&gt; {
  -T* m_ptr
  -weakref_type* mrefs
  +sp&lt;T&gt; promote()
  +void clear()
}

wp &#34;*&#34; *-- &#34;1&#34; TYPE : m_ptr
wp &#34;*&#34; *-- &#34;1&#34; weakref_type : m_refs

class sp&lt;TYPE&gt; {
  -T* m_ptr
  +sp&amp; operator=(T* other)
  +sp&amp; operator=(const sp&lt;T&gt;&amp; other)
}

sp &#34;*&#34; *-- &#34;1&#34; TYPE : m_ptr
```

其中 strong pointer 的實現相當簡單：

```cpp
template&lt;typename T&gt; sp&lt;T&gt;::sp(T* other) : m_ptr(other) {
    if (other) other-&gt;incStrong(this);
}

template&lt;typename T&gt; sp&lt;T&gt;::sp(const sp&lt;T&gt;&amp; other) : m_ptr(other.m_ptr) {
    if (m_ptr) m_ptr-&gt;incStrong(this);
}

template&lt;typename T&gt; template&lt;typename U&gt; sp&lt;T&gt;::sp(U* other) : m_ptr(other) {
    if (other) ((T*)other)-&gt;incStrong(this);
}

template&lt;typename T&gt; template&lt;typename U&gt; sp&lt;T&gt;::sp(const sp&lt;U&gt;&amp; other) : m_ptr(other.m_ptr) {
    if (m_ptr) m_ptr-&gt;incStrong(this);
}

template&lt;typename T&gt; sp&lt;T&gt;::~sp() {
    if (m_ptr) m_ptr-&gt;decStrong(this);
}
```

而 weak pointer 則是需要經由 `RefBase::createWeak` 或是 `weakref_type::incWeak` 來增加 weak reference：

```cpp
template&lt;typename T&gt; wp&lt;T&gt;::wp(T* other) : m_ptr(other) {
    if (other) m_refs = other-&gt;createWeak(this);
}

template&lt;typename T&gt; wp&lt;T&gt;::wp(const wp&lt;T&gt;&amp; other) : m_ptr(other.m_ptr), m_refs(other.m_refs) {
    if (m_ptr) m_refs-&gt;incWeak(this);
}

template&lt;typename T&gt; wp&lt;T&gt;::wp(const sp&lt;T&gt;&amp; other) : m_ptr(other.m_ptr) {
    if (m_ptr) {
        m_refs = m_ptr-&gt;createWeak(this);
    }
}

template&lt;typename T&gt; template&lt;typename U&gt; wp&lt;T&gt;::wp(U* other) : m_ptr(other) {
    if (other) m_refs = other-&gt;createWeak(this);
}

template&lt;typename T&gt; template&lt;typename U&gt; wp&lt;T&gt;::wp(const wp&lt;U&gt;&amp; other) : m_ptr(other.m_ptr) {
    if (m_ptr) {
        m_refs = other.m_refs;
        m_refs-&gt;incWeak(this);
    }
}

template&lt;typename T&gt; template&lt;typename U&gt; wp&lt;T&gt;::wp(const sp&lt;U&gt;&amp; other) : m_ptr(other.m_ptr) {
    if (m_ptr) {
        m_refs = m_ptr-&gt;createWeak(this);
    }
}

template&lt;typename T&gt; wp&lt;T&gt;::~wp() {
    if (m_ptr) m_refs-&gt;decWeak(this);
}
--&gt;
&lt;p&gt;其中的 promote() 實現如下：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; sp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; wp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;promote() &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; result;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (m_ptr &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; m_refs&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;attemptIncStrong(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;result)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        result.set_pointer(m_ptr);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; result;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; RefBase&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;weakref_type&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;attemptIncStrong(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    incWeak(id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    weakref_impl&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; impl &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;weakref_impl&lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt; curCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mStrong;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ALOG_ASSERT(curCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;attemptIncStrong called on %p after underflow&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (curCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; curCount &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; INITIAL_STRONG_VALUE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (android_atomic_cmpxchg(curCount, curCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mStrong) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        curCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mStrong;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (curCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; curCount &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; INITIAL_STRONG_VALUE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; allow;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (curCount &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; INITIAL_STRONG_VALUE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Attempting to acquire first strong reference...  this is allowed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// if the object does NOT have a longer lifetime (meaning the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// implementation doesn&amp;#39;t need to see this), or if the implementation
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// allows it to happen.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            allow &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mFlags&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;OBJECT_LIFETIME_WEAK) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; OBJECT_LIFETIME_WEAK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mBase&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;onIncStrongAttempted(FIRST_INC_STRONG, id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Attempting to revive the object...  this is allowed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// if the object DOES have a longer lifetime (so we can safely
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// call the object with only a weak ref) and the implementation
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// allows it to happen.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            allow &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mFlags&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;OBJECT_LIFETIME_WEAK) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; OBJECT_LIFETIME_WEAK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mBase&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;onIncStrongAttempted(FIRST_INC_STRONG, id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;allow) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            decWeak(id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        curCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; android_atomic_inc(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mStrong);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// If the strong reference count has already been incremented by
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// someone else, the implementor of onIncStrongAttempted() is holding
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// an unneeded reference.  So call onLastStrongRef() here to remove it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// (No, this is not pretty.)  Note that we MUST NOT do this if we
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// are in fact acquiring the first reference.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (curCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; curCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; INITIAL_STRONG_VALUE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mBase&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;onLastStrongRef(id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;addStrongRef(id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#if PRINT_REFS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ALOGD(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;attemptIncStrong of %p from %p: cnt=%d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;, id, curCount);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (curCount &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; INITIAL_STRONG_VALUE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        android_atomic_add(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;INITIAL_STRONG_VALUE, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mStrong);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        impl&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;mBase&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;onFirstRef();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;有幾個重點：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reference count 其實是存在 weakref_impl 裡面的，跟被參考物件 T 的生命週期是獨立的。&lt;/li&gt;
&lt;li&gt;RefBase 有宣告virtual function，比較 heavy weight 一點，在一些比較簡單的狀況可以考慮使用 &lt;code&gt;LightRefBase&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;目前的實現是 thread-safe 的，所以對於 strong/weak ref count 的操作都用使用 atomic operation 例如 &lt;code&gt;android_atomic_inc&lt;/code&gt; 或 &lt;code&gt;android_atomic_dec&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;從目前實現看來，原本的設計是希望在第一個 strong ref 被加上前，也就是 constructor 裡面不應該做太 heavy weight 的事。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RefBase::onFirstRef()&lt;/code&gt; 是當第一次被 strong ref 時會被呼叫，通常是 override 它來做資源配置或是準備工作，算是一種 lazy initialization。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RefBase::OnLastStrongRef()&lt;/code&gt; 是當最後一個 strong ref 被釋放時會被呼叫，跟 &lt;code&gt;OnFirstRef&lt;/code&gt; 相反是用來做資源釋放或是收尾工作。&lt;/li&gt;
&lt;li&gt;預設是最後一個 strong ref 時，實際的物件就會被摧毀；但是也可以透過 &lt;code&gt;extendObjectLifeTime(OBJECT_LIFETIME_WEAK)&lt;/code&gt; 讓物件只有要 weak ref 還在時便存活著，目前的唯一的應用實例是 Binder proxy (繼承自 &lt;code&gt;BpRefBase&lt;/code&gt;)。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有了這些認知，來看 &lt;code&gt;BpRefBase&lt;/code&gt; 的實現便會比較容易了解其意義：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BpRefBase&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;BpRefBase(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; sp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;IBinder&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;amp;&lt;/span&gt; o)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; mRemote(o.get()), mRefs(NULL), mState(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    extendObjectLifetime(OBJECT_LIFETIME_WEAK);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (mRemote) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        mRemote&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;incStrong(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);           &lt;span style=&#34;color:#75715e&#34;&gt;// Removed on first IncStrong().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        mRefs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mRemote&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;createWeak(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// Held for our entire lifetime.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BpRefBase&lt;span style=&#34;color:#f92672&#34;&gt;::~&lt;/span&gt;BpRefBase()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (mRemote) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(mState&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kRemoteAcquired)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            mRemote&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;decStrong(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        mRefs&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;decWeak(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; BpRefBase&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;onFirstRef()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    android_atomic_or(kRemoteAcquired, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;mState);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; BpRefBase&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;onLastStrongRef(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (mRemote) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        mRemote&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;decStrong(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; BpRefBase&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;onIncStrongAttempted(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; flags, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; mRemote &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; mRefs&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;attemptIncStrong(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>Smart Pointers in WebKit</title>
      <link>https://blog.simplypatrick.com/posts/2012/04-29-smart-pointers-in-webkit/</link>
      <pubDate>Sun, 29 Apr 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/04-29-smart-pointers-in-webkit/</guid>
      <description>&lt;p&gt;上一篇講了 RefCounted，也講一下我看 RefPtr, PassRefPtr, OwnPtr, 及 PassOwnPtr 的心得：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RefPtr 定義了一個轉換至 &lt;a href=&#34;http://stackoverflow.com/questions/670734/c-pointer-to-class-data-member&#34;&gt;pointer to data member&lt;/a&gt; 的 conversion operator:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// This conversion operator allows implicit conversion to bool but not to other integer types.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; T&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (RefPtr&lt;span style=&#34;color:#f92672&#34;&gt;::*&lt;/span&gt;UnspecifiedBoolType);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;operator&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;UnspecifiedBoolType&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m_ptr &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;RefPtr&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;m_ptr : &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; }&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;這個轉換運算子回傳的值可以被 compiler 自動轉換成 bool (非空時為 true)，但不能被轉換成數值來被使用，主要是用來避免一些可能的誤用狀況，有興趣的人可以參考 &lt;a href=&#34;http://www.artima.com/cppsource/safebool.html&#34;&gt;&amp;ldquo;The Safe Bool Idiom&amp;rdquo;&lt;/a&gt; 這篇文章。&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;OwnPtr 運用了 type traits 的技巧來達到 OwnPtr&lt;T&gt; 及 OwnPtr&amp;lt;T*&amp;gt; 都是宣告一個內含 T* 的 smart pointer：&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; RemovePointer&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;Type ValueType;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; ValueType&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; PtrType;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>Reference Counting in WebKit</title>
      <link>https://blog.simplypatrick.com/posts/2012/04-28-reference-counting-in-webkit/</link>
      <pubDate>Sat, 28 Apr 2012 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2012/04-28-reference-counting-in-webkit/</guid>
      <description>&lt;p&gt;WebKit 裡物件的生命週期很多都是由引用計數 (reference count) 控制的，今天有空看了一下，發現幾個巧妙之處：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RefCounted 是個 template class，並且繼承自 RefCountedBase:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typename&lt;/span&gt; T&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RefCounted&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; RefCountedBase {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    WTF_MAKE_NONCOPYABLE(RefCounted); WTF_MAKE_FAST_ALLOCATED;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; deref()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (derefBase())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;delete&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;T&lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;protected&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RefCounted() { }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;RefCounted()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;繼承 RefCountedBase 的技巧 (template hoisting) 是為了避免 template 實例化產生的 code bloating；而 destructor 裡的 delete static_cast&amp;lt;T*&amp;gt;(this); 則是為了避免不必要的 virtual table 產生，觀察 ~RefCountBase() 是個 non-virtual function 可以印證：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;RefCountedBase()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ASSERT(m_deletionHasBegun);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ASSERT(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;m_adoptionIsRequired);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;RefCountedBase 的設計相當輕量化， release 版本裡實際只會佔用一個 integer 的空間，而 debug 版裡則多了幾個輔助除錯的欄位:&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ifndef NDEBUG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; m_deletionHasBegun;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; m_adoptionIsRequired;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ThreadRestrictionVerifier m_verifier;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;m_deletionHasBegun 是用來確保當物件當參考計數已經小於 1 之後是不能再做 ref/deref 的動作的；m_adoptionIsRequired 是用來確保 adoptRef() 一定要被呼叫到，也就是 new 出來的物件一定要先用 PassRefPtr 來管理；而 m_verifier 則是用來確認物件不會同時被兩個以上的 thread 引用。&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Reference counting 一般的做法都是把計數初始值設定成 0，而 WebKit 為了避免每次創建都需要做的 0 -&amp;gt; 1 以及銷毀時要做的 1 -&amp;gt; 0 的記憶體存取，則是把計數值初始值設定成 1 的，然後強迫要用 PassRefPtr 來管理新產生的物件。&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;protected&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RefCountedBase() &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; m_refCount(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;為了效能，引用計數的增加及減少是預設不保證 thread-safe。&lt;/li&gt;
&lt;/ol&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ref&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ifndef NDEBUG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Start thread verification as soon as the ref count gets to 2. This
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// heuristic reflects the fact that items are often created on one thread
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// and then given to another thread to be used.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// FIXME: Make this restriction tigher. Especially as we move to more
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// common methods for sharing items across threads like CrossThreadCopier.h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// We should be able to add a &amp;#34;detachFromThread&amp;#34; method to make this explicit.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (m_refCount &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m_verifier.setShared(true);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// If this assert fires, it either indicates a thread safety issue or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// that the verification needs to change. See ThreadRestrictionVerifier for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// the different modes.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ASSERT(m_verifier.isSafeToUse());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ASSERT(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;m_deletionHasBegun);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ASSERT(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;m_adoptionIsRequired);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;m_refCount;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;所以 RefCounted 的機制要能運作正常，正確地使用 RefPtr 及 PassRefPtr 是很重要的，也就是如果你需要對 WebKit 做一定程度的修改的話，&lt;a href=&#34;http://www.webkit.org/coding/RefPtr.html&#34;&gt;&amp;ldquo;RefPtr and PassRefPtr Basics&amp;rdquo;&lt;/a&gt; 這篇文章是必備的知識。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ARM Architecture for Mobile Developers</title>
      <link>https://blog.simplypatrick.com/posts/2011/12-24-arm-architecture-for-mobile-developers/</link>
      <pubDate>Sat, 24 Dec 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/12-24-arm-architecture-for-mobile-developers/</guid>
      <description>&lt;p&gt;目前幾乎市場上所有的 mobile device 用的 processor 都是基於 &lt;a href=&#34;http://en.wikipedia.org/wiki/ARM_architecture&#34;&gt;ARM Architecture&lt;/a&gt; 的，而做為一位 Android 或是 iOS 平台的應用程序開發人員對於 ARM 有一定的認識雖非必要，但多了解一點對優化程序及偵錯問題是有很大幫助的。關於 ARM 的基本介紹，可以參考 Pierre Lebeaupin 的 &lt;a href=&#34;http://wanderingcoder.net/2010/07/19/ought-arm/&#34;&gt;A few things iOS developers ought to know about the ARM architecture&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;最基本要知道的是 ARM Architecture 是有分版本的:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;ARM-Architecture-Evolution.png&#34; alt=&#34;ARM Revision History&#34;&gt;&lt;/p&gt;
&lt;p&gt;目前主流的 Smartphone 都是採用 ARMv7a 的架構。&lt;/p&gt;
&lt;p&gt;而另一個需要了解的觀念是 &lt;a href=&#34;http://en.wikipedia.org/wiki/Application_binary_interface&#34;&gt;ABI&lt;/a&gt; (Application Binary Interface)，要了解 ARM 的 ABI 最快的就是參考 &lt;a href=&#34;http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.subset.swdev.abi/index.html&#34;&gt;Application Binary Interface for the ARM Architecture&lt;/a&gt; 裡的這張圖：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;2011-12-25-8.49.34.png&#34; alt=&#34;ABI 地圖&#34;&gt;&lt;/p&gt;
&lt;p&gt;從圖上可以看到在 ABI for the ARM Architecure 實際涵蓋了許多範圍，各個平台的 ABI 通常就是參考標準的 ARM ABI 然後把不明確的地方或是有差異的部份定義清楚。&lt;/p&gt;
&lt;p&gt;Android 開發人員可以參考 &lt;a href=&#34;http://www.google.com.tw/codesearch#cZwlSNS7aEw/ndk/docs/CPU-ARCH-ABIS.html&amp;amp;q=CPU-ARCH-ABIS.html&amp;amp;type=cs&#34;&gt;docs/CPU-ARCH-ABIS.html&lt;/a&gt;，使用 Android NDK 開發的話，目前就有分 armeabi 及 armeabi-v7a。iOS 的話除了第一代 iPhone 外目前都是 ARMv7 架構，但目前似乎只找的到這份 &lt;a href=&#34;http://developer.apple.com/library/ios/#documentation/Xcode/Conceptual/iPhoneOSABIReference/Introduction/Introduction.html&#34;&gt;iOS ABI Function Call Guide&lt;/a&gt; 可以一窺 iOS上的一些實作細節。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Build iOS App with rake</title>
      <link>https://blog.simplypatrick.com/posts/2011/12-24-build-ios-app-with-rake/</link>
      <pubDate>Sat, 24 Dec 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/12-24-build-ios-app-with-rake/</guid>
      <description>&lt;p&gt;上次說到 rake 是幫忙 iOS App 本地化的好用工具，但其實幾乎所有要自動化的事情都能請它幫忙，
例如寫 game 的人需要做的 sprite sheet 也能請 rake &lt;a href=&#34;http://whatupdave.com/post/5729378739/automate-your-ios-projects-with-rake&#34;&gt;自動產生&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;除此之外，準備各種不同的 build 也是頗煩人的事，如果你也用 rake 的話就可以用 &lt;a href=&#34;http://rubygems.org/gems/wox&#34;&gt;wox&lt;/a&gt; 這個 gem
來幫忙，下面的範例是 &lt;a href=&#34;http://rubydoc.info/gems/wox/0.0.8/frames&#34;&gt;wox 文檔&lt;/a&gt;建議的方式：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Rakefile&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Wox&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Tasks&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;create &lt;span style=&#34;color:#e6db74&#34;&gt;:info_plist&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Resources/Info.plist&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:sdk&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iphoneos&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:configuration&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Release&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  build &lt;span style=&#34;color:#e6db74&#34;&gt;:debug&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:configuration&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Debug&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  build &lt;span style=&#34;color:#e6db74&#34;&gt;:release&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:developer_certificate&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iPhone Developer: Dangerous Dave (9GZ84DL0DZ)&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipa &lt;span style=&#34;color:#e6db74&#34;&gt;:app_store&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:provisioning_profile&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;App Store&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipa &lt;span style=&#34;color:#e6db74&#34;&gt;:adhoc&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:provisioning_profile&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Team Provisioning Profile&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      testflight &lt;span style=&#34;color:#e6db74&#34;&gt;:publish&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:api_token&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;nphsZ6nVXMl0brDEsevLY0wRfU6iP0NLaQH3nqoh8jG&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#e6db74&#34;&gt;:team_token&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Qfom2HnGGJnXrUVnOKAxKAmpNO3wdQ9panhtqcA&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#e6db74&#34;&gt;:notes&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; proc { &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CHANGELOG&amp;#34;&lt;/span&gt;) },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#e6db74&#34;&gt;:distribution_lists&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%w[Internal QA]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#e6db74&#34;&gt;:notify&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;使用 wox 的優點是不同 task 的 configuration 是可以繼承的，例如 ipa:app_store 套用的就是上一層
build:release 的設定，但用的是上傳 App Store 用的 provisioning profile。同樣道理 ipa:adhoc 用的是
Team Provisioning Profile。而如果你有用 &lt;a href=&#34;http://testflightapp.com&#34;&gt;TestFlight&lt;/a&gt; 的話，就可以繼承 ipa:adhoc 把做出來
的 ipa 檔直接上傳到 TestFlight。&lt;/p&gt;
&lt;p&gt;關於 TestFlight，可以參考 &lt;a href=&#34;http://thepolydice.com/2011/01/27/%E4%BD%BF%E7%94%A8testflight%E6%8F%90%E4%BE%9B%E6%9C%80%E5%A5%BD%E7%9A%84%E6%B8%AC%E8%A9%A6%E9%AB%94%E9%A9%97/&#34;&gt;Polydice 的介紹&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>iOS App Localization using rake</title>
      <link>https://blog.simplypatrick.com/posts/2011/12-24-ios-app-localization-using-rake/</link>
      <pubDate>Sat, 24 Dec 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/12-24-ios-app-localization-using-rake/</guid>
      <description>&lt;p&gt;一般要幫 iOS App 本地化，其中比較繁瑣的就是翻譯 xib 檔案中的字串，通常是需要下面三個步驟
(可參考 &lt;a href=&#34;http://www.icanlocalize.com/site/tutorials/iphone-applications-localization-guide/&#34;&gt;ICanLocalize 的教學&lt;/a&gt;)：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 ibtool 把字串從 xib 中抓出來&lt;/li&gt;
&lt;li&gt;找人翻譯字串&lt;/li&gt;
&lt;li&gt;使用 ibtool 再把翻譯好的字串放到 xib 中&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不過我是不能忍受這些工作要手動進行的，所以最好的方式是用 rake 來自動化這些事情：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;DEF_LPROJ&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;en.lproj&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;REGIONS&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Dir&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*.lproj&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;delete_if {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; p &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DEF_LPROJ&lt;/span&gt;}&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;map {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;basename(p, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;.lproj&amp;#39;&lt;/span&gt;)}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;XIBS&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Dir&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;DEF_LPROJ&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/*.xib&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;map {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;basename(x)}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;namespace &lt;span style=&#34;color:#e6db74&#34;&gt;:l10n&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  task &lt;span style=&#34;color:#e6db74&#34;&gt;:regions&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;REGIONS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;region&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; puts region}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  task &lt;span style=&#34;color:#e6db74&#34;&gt;:xibs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;XIBS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;xib&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; puts xib}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  desc &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Generate strings file for XIB&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  task &lt;span style=&#34;color:#e6db74&#34;&gt;:genstrings&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;REGIONS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;r&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;XIBS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;xib&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sh &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ibtool --generate-strings-file &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;r&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;.lproj/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;xib&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;.strings &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;DEF_LPROJ&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;xib&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  desc &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Apply strings files to XIB&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  task &lt;span style=&#34;color:#e6db74&#34;&gt;:usestrings&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;REGIONS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;r&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;XIBS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;xib&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sh &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ibtool --strings-file &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;r&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;.lproj/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;xib&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;.strings &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;DEF_LPROJ&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;xib&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; --write &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;r&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;.lproj/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;xib&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;首先請 rake 幫忙把字串檔都產生出來：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ rake l10n:genstrings&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;翻譯完這些字串檔後，再請 rake 幫你放進去：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ rake l10n:usestings&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;不管你有幾個語言或是幾個 xib 檔都是一樣的步驟。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>LiveReload and Octopress</title>
      <link>https://blog.simplypatrick.com/posts/2011/12-03-livereload/</link>
      <pubDate>Sat, 03 Dec 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/12-03-livereload/</guid>
      <description>&lt;p&gt;雖然平常沒什麼時間寫 blog，但總是希望寫的時候能夠專注在所寫的內容，而不必被發佈 blog 的一些瑣事而干擾，例如現在雖然已經習慣用 &lt;a href=&#34;http://pow.cx/&#34;&gt;Pow&lt;/a&gt; 了，然後把 &lt;code&gt;rake watch&lt;/code&gt; 開著，但要預覽時還是要回 Chrome 按一下 Reload 才能預覽目前的內容，有點小煩，所以看到有 &lt;a href=&#34;https://github.com/mockko/livereload&#34;&gt;LiveReload&lt;/a&gt; 這種好東西當然要拿來用啊。&lt;/p&gt;
&lt;p&gt;簡單描述一下安裝的步驟:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安裝 &lt;code&gt;guard-livereload&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ gem install guard-livereload&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;修改 &lt;code&gt;Gemfile&lt;/code&gt; 把下列這一行加進去 &amp;lsquo;guard-livereload&amp;rsquo;:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ gem &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;guard-livereload&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;再來是改完 &lt;code&gt;Gemfile&lt;/code&gt; 後的標準步驟:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ bundle install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;產生一份基本的 &lt;code&gt;Guardfile&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ guard init livereload&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;再來要修改 &lt;code&gt;Rakefile&lt;/code&gt; 把啟動 guard 的動作放到 &lt;code&gt;rake watch&lt;/code&gt; 裡面:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;desc &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Watch the site and regenerate when it changes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;task &lt;span style=&#34;color:#e6db74&#34;&gt;:watch&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;### You haven&amp;#39;t set anything up yet. First run `rake install` to set up an Octopress theme.&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;directory?(source_dir)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  puts &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Starting to watch source with Jekyll and Compass.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  system &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;compass compile --css-dir &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;source_dir&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/stylesheets&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exist?(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;source_dir&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;/stylesheets/screen.css&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  jekyllPid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Process&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;spawn(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;jekyll --auto&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  compassPid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Process&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;spawn(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;compass watch&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  guardPid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Process&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;spawn(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;guard&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trap(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;INT&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;jekyllPid, compassPid, guardPid&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;each { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;pid&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Process&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;kill(&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;, pid) &lt;span style=&#34;color:#66d9ef&#34;&gt;rescue&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Errno&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;ESRCH&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    exit &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;jekyllPid, compassPid, guardPid&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;each { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;pid&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Process&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;wait(pid) }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;然後執行 &lt;code&gt;rake watch&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ rake watch
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Starting to watch source with Jekyll and Compass.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please install growl_notify or growl gem &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; Mac OS X notification support and add it to your Gemfile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Guard is now watching at &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/Users/patrick/src/simplypatrick.heroku.com&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LiveReload 1.6 is waiting &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; a browser to connect.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Configuration from /Users/patrick/src/simplypatrick.heroku.com/_config.yml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Auto-regenerating enabled: source -&amp;gt; public
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2011-12-03 22:53:07&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; regeneration: &lt;span style=&#34;color:#ae81ff&#34;&gt;118&lt;/span&gt; files changed
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; Compass is watching &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes. Press Ctrl-C to Stop.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;安裝 LiveReload extension (Chrome &lt;a href=&#34;https://chrome.google.com/webstore/detail/jnihajbhpnppcggbcgedagnkighmdlei&#34;&gt;請按這&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;最後打開會修改的網頁，如果是使用 Chrome 要記得把網址列旁的 LR 按鍵按下才會生效喔，我在這裡卡了有點小久。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 27&amp;quot; 螢幕上，左半邊寫文章，右半邊瀏覽器即時預覽，這樣的感覺太好了！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AppCode: Make you a happier iOS developer</title>
      <link>https://blog.simplypatrick.com/posts/2011/10-29-appcode-make-you-a-happier-ios-developer/</link>
      <pubDate>Sat, 29 Oct 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/10-29-appcode-make-you-a-happier-ios-developer/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;XCode doesn&amp;rsquo;t look like a software tool that&amp;rsquo;s developed by Apple at all. It is clear Steve Jobs was not involved creating this tool.&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我完全同意這句話，從 XCode 3.2 用到現在 4.2 版還是覺得不順手。寫程式最怕的就是被其他事干擾而分心，IDE 如果有什麼地方讓我工作效率不彰，我通常很快就會受不了然後分心去解決效率問題先，因為不能馬上解決會一直困擾我，而 XCode 就是個會讓我一直要傷腦筋的工具，但是為了要在相對精美的 iOS 及 iPhone 上開發程式，XCode 是唯一的選擇。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://blog.dutchworks.nl/author/tom/&#34;&gt;Tom van Zummeren&lt;/a&gt; 在 &lt;a href=&#34;http://blog.dutchworks.nl/2011/07/06/appcode-intellij-for-objective-c/&#34;&gt;AppCode: IntelliJ for Objective C!&lt;/a&gt; 裡把 &lt;a href=&#34;http://www.jetbrains.com/objc/&#34;&gt;AppCode&lt;/a&gt; 比 XCode 還好的地方都整理出來了。我自己試用 AppCode 後也覺得 JetBrains 是有備而來的，用起來跟 &lt;a href=&#34;http://www.jetbrains.com/idea/&#34;&gt;IntelliJ IDEA&lt;/a&gt; 一樣地流暢，讓寫 Objective C 也能是個愉快的過程。&lt;/p&gt;
&lt;p&gt;AppCode 主要贏在程式編輯功能，但偵錯功能感覺弱了一點，例如:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;我找不到 NSLog 輸出的訊息會跑到那裡&lt;/li&gt;
&lt;li&gt;Debug 時輸出的訊息沒有 XCode 完整&lt;/li&gt;
&lt;li&gt;不會自動停在 first-chance exception&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以實際開發時還是要 AppCode 及 XCode 同時開啟，買個大螢幕會比較好：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;appcode-and-xcode-together.png&#34; alt=&#34;AppCode and XCode together&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Git and SourceTree</title>
      <link>https://blog.simplypatrick.com/posts/2011/10-23-git-and-sourcetree/</link>
      <pubDate>Sun, 23 Oct 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/10-23-git-and-sourcetree/</guid>
      <description>&lt;p&gt;由於 Git 在 Linux/Windows 上都沒有比較好用的 GUI client，我向來是習慣直接在命令列敲指令，好處是簡單而且快，比較大的缺點就是瀏覽歷史記錄時比較麻煩，陽春又醜的 gitk 我通常是不得已才會去開它，所以換到 Mac OS X 上後，簡單好用而且開源的 &lt;a href=&#34;http://gitx.frim.nl/&#34;&gt;GitX&lt;/a&gt; 自然就成為我的最愛，但 GitX 的更新實在有點慢，愛嘗鮮的我便一直注意著是否有更好的選擇。&lt;/p&gt;
&lt;p&gt;後來有試用過 &lt;a href=&#34;http://www.git-tower.com/&#34;&gt;Tower&lt;/a&gt;，整個 UI 比 GitX 漂亮許多，使用設計上也相當不錯，正想說可以&amp;rsquo;定居&amp;rsquo;下來，沒想到中間殺出個 &lt;a href=&#34;http://www.sourcetreeapp.com/&#34;&gt;SourceTree&lt;/a&gt;，而且因為這個產品被 Atlassian 收購了，在 Mac App Store 正免費大放送中，估計之後會有跟 BitBucket 更緊密的功能整合。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;sourcetree.png&#34; alt=&#34;SourceTree App&#34;&gt;&lt;/p&gt;
&lt;p&gt;本來 Mac OS X 就是讓 programmer 感覺很舒服的開發環境，有了 SourceTree 之後變更棒了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>C and Dennis Ritchie</title>
      <link>https://blog.simplypatrick.com/posts/2011/10-14-c-and-dennis-ritchie/</link>
      <pubDate>Fri, 14 Oct 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/10-14-c-and-dennis-ritchie/</guid>
      <description>&lt;p&gt;我第一次接觸 &lt;a href=&#34;http://en.wikipedia.org/wiki/C_(programming_language)&#34;&gt;C 語言&lt;/a&gt;應該是國二吧，那時在倚天雜誌上看到有人用 C 寫了一個程式獲得了程式比賽冠軍，當時看到這個用了各種括號 { ( [ ] ) } 來寫的語言實在是比 BASIC 酷太多了，馬上就被迷上了。剛開始，不記得去那裡拷貝到一個 C compiler 就開始自學起 C programming 了，但那個 compiler 實在是太陽春到一些正確的語法也會有編譯錯誤，一直等到 &lt;a href=&#34;http://en.wikipedia.org/wiki/Borland_Turbo_C&#34;&gt;Borland Turbo C&lt;/a&gt; 2.0 這個產品出現後，自己才算真正地學起 C 語言:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;tc20.png&#34; alt=&#34;Turbo C 2.0&#34;&gt;&lt;/p&gt;
&lt;p&gt;C 從此成為我一窺 computer programming 奧妙的鑰匙，也是之後我會從事資訊業的主要原因，所以說 C 這個程式語言很大地影響了我人生也不為過。&lt;/p&gt;
&lt;p&gt;眾所皆知，C 語言之父就是 Bell Labs K&amp;amp;R 的 R (&lt;a href=&#34;http://en.wikipedia.org/wiki/Dennis_Ritchie&#34;&gt;Dennis Ritchie&lt;/a&gt;)，而他於很令人遺憾地於 10/8 過世了。Dennis 的主要貢獻 C 及 UNIX 幾乎是全面性地影響了整個資訊產業，你手上用的 iPhone 或是 Android 手機也是站在這個巨人的肩膀上才有可能被發明出來。&lt;/p&gt;
&lt;p&gt;Dennis 曾經說過:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;UNIX is very simple, it just needs a genius to understand its simplicity.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;你的確是個天才，謝謝你 Dennis。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Git and Jun</title>
      <link>https://blog.simplypatrick.com/posts/2011/06-17-git-and-jun/</link>
      <pubDate>Fri, 17 Jun 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/06-17-git-and-jun/</guid>
      <description>&lt;p&gt;大家一般知道 &lt;a href=&#34;http://en.wikipedia.org/wiki/Git_(software)&#34;&gt;Git&lt;/a&gt; 的發明者是 Linus Torvalds，但是實際上假如你常查閱 git help 的話，你會發現 Junio C Hamano 這個名字出現的次數實在比 Linus 多很多。如果說 Linus 是 Git 之父，Jun 應該就是 Git 之母了。&lt;/p&gt;
&lt;p&gt;Jun 目前在 Google 工作，Android 或是 Chrome OS 都選擇用 Git 也算是支持自家人了。下面是他的在 &lt;a href=&#34;http://google-opensource.blogspot.com/&#34;&gt;Open Source At Google&lt;/a&gt; &lt;a href=&#34;http://google-opensource.blogspot.com/2011/03/geek-time-with-junio-c-hamano.html&#34;&gt;接受訪談&lt;/a&gt;的影片：&lt;/p&gt;
&lt;iframe width=&#34;854&#34; height=&#34;485&#34; src=&#34;//www.youtube.com/embed/qs_xS1Y6nGc&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;附記：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Google 內部用的 VCS 應該不是秘密吧，聽說是修改過的 Perforce。&lt;/li&gt;
&lt;li&gt;訪問者啕侃了一下 Jun 為什麼 Git 這麼&lt;del datetime=&#34;2011-06-16T16:57:32+00:00&#34;&gt;難用&lt;/del&gt;不好學。 XD&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>好久沒碰的 Buildbot 改的還不錯</title>
      <link>https://blog.simplypatrick.com/posts/2011/05-30-buildbot/</link>
      <pubDate>Mon, 30 May 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/05-30-buildbot/</guid>
      <description>&lt;p&gt;蠻久沒有碰 Buildbot 了，今天看到 Chromium project 在用，新增的這個 Console 界面還不錯，對於 Chromium 這種需要支援許多平台並且要執行許多測試項目的 project 是蠻適合的，整個狀況可以一目了然：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://lh3.googleusercontent.com/-JV_-WuVP598/TsF_N7MqItI/AAAAAAAAEaA/Cu4Tqq7dmSI/s800/e89ea2e5b995e5bfabe785a7-2011-05-30-e4b88ae58d881-32-42.png&#34;&gt;&lt;img src=&#34;https://lh3.googleusercontent.com/-JV_-WuVP598/TsF_N7MqItI/AAAAAAAAEaA/Cu4Tqq7dmSI/s800/e89ea2e5b995e5bfabe785a7-2011-05-30-e4b88ae58d881-32-42.png&#34; alt=&#34;&#34; title=&#34;Buildbot - Chromium&#34;&gt;&lt;/a&gt; 有問題的部份也很明顯可以直接點進去看，比起之前要去拉長長的 waterfall 圖方便許多：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://lh4.googleusercontent.com/-PTP2rVjFbwo/TsF_M4pLC9I/AAAAAAAAEaA/EAYlP4SPRrI/s800/e89ea2e5b995e5bfabe785a7-2011-05-30-e4b88ae58d881-44-40.png&#34;&gt;&lt;img src=&#34;https://lh4.googleusercontent.com/-PTP2rVjFbwo/TsF_M4pLC9I/AAAAAAAAEaA/EAYlP4SPRrI/s800/e89ea2e5b995e5bfabe785a7-2011-05-30-e4b88ae58d881-44-40.png&#34; alt=&#34;&#34; title=&#34;Buildbot - Chromium Console&#34;&gt;&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>多平台手機遊戲開發</title>
      <link>https://blog.simplypatrick.com/posts/2011/05-28-portable-mobile-game-development/</link>
      <pubDate>Sat, 28 May 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/05-28-portable-mobile-game-development/</guid>
      <description>&lt;p&gt;昨天發現一個 Flash 遊戲: Jelly Cannon，相當地好玩，類型也是流行的物理益智遊戲：&lt;/p&gt;
&lt;iframe width=&#34;854&#34; height=&#34;485&#34; src=&#34;//www.youtube.com/embed/st1wePi_uv0&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;玩的過程發現他果凍的質感做得很好，看起來用的物理引擎還挺不錯的，不輸給 &lt;a href=&#34;http://www.box2d.org/&#34;&gt;Box2D&lt;/a&gt; 或是 &lt;a href=&#34;http://code.google.com/p/chipmunk-physics/&#34;&gt;Chipmunk&lt;/a&gt;，查了一下是個叫 &lt;a href=&#34;http://code.google.com/p/nape/&#34;&gt;Nape&lt;/a&gt; 的物理引擎。&lt;/p&gt;
&lt;p&gt;自從接觸 iOS programming 以來，一直都對這種小遊戲的設計還蠻有興趣的，仔細看了一下發現它是用 &lt;a href=&#34;http://haxe.org/&#34;&gt;haXe&lt;/a&gt; (啥? 聽都沒聽過) 這個 programming language 寫的，而 haXe 的 compiler 是用 &lt;a href=&#34;http://caml.inria.fr/&#34;&gt;OCaml&lt;/a&gt; 寫的，一整個非主流 (法國風?) 實在是讓人很感興趣。&lt;/p&gt;
&lt;p&gt;特別的是，haXe 是個 multiplatform language，目前可以把 code 編譯成 &lt;a href=&#34;http://haxe.org/doc/targets/flash&#34;&gt;Flash&lt;/a&gt;, &lt;a href=&#34;http://haxe.org/doc/targets/js&#34;&gt;JavaScript&lt;/a&gt; (用來支援 HTML5?!), &lt;a href=&#34;http://haxe.org/doc/targets/cpp&#34;&gt;C++&lt;/a&gt; (&lt;a href=&#34;http://haxe.org/doc/start/iphone&#34;&gt;iOS 上看起來沒問題&lt;/a&gt;), 之後還會支援 &lt;a href=&#34;http://prezi.com/xzvht0y2e-c6/haxe-java-c/&#34;&gt;C#&lt;/a&gt; (跑在 Windows Phone / Xbox360 上) 及 &lt;a href=&#34;http://prezi.com/xzvht0y2e-c6/haxe-java-c/&#34;&gt;Java&lt;/a&gt; (Android 也行)，看起來相當有潛力用來開發支援多種平台 (看起來大家都這樣做吧) 的 mobile
game。值得持續關注&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My preferred programming fonts on Mac OS X</title>
      <link>https://blog.simplypatrick.com/posts/2011/02-19-programming-fonts-on-mac-osx/</link>
      <pubDate>Sat, 19 Feb 2011 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2011/02-19-programming-fonts-on-mac-osx/</guid>
      <description>&lt;p&gt;Mac OS X 是非常棒的程式開發平台，有非常強的 CLI，也有非常漂亮的 GUI。&lt;/p&gt;
&lt;p&gt;我個人對於程式字型的選擇頗為堅持，例如在使用較暗的背景下，我偏好使用 Menlo：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://lh5.googleusercontent.com/-XzWG06K_v4I/TsF_M-iI-DI/AAAAAAAAEaA/4o_Grt21va8/s800/menlo-in-xcode.png&#34;&gt;&lt;img src=&#34;https://lh5.googleusercontent.com/-XzWG06K_v4I/TsF_M-iI-DI/AAAAAAAAEaA/4o_Grt21va8/s800/menlo-in-xcode.png&#34; alt=&#34;&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;但如果是在白色的背景下，我覺得 Consolas 比較好看些：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://lh4.googleusercontent.com/-Wg5BWzWfFpo/TsF_M3x3ToI/AAAAAAAAEaA/31sP_1PGgTc/s800/consolas-in-idea2.png&#34;&gt;&lt;img src=&#34;https://lh4.googleusercontent.com/-Wg5BWzWfFpo/TsF_M3x3ToI/AAAAAAAAEaA/31sP_1PGgTc/s800/consolas-in-idea2.png&#34; alt=&#34;&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;關於怎麼在 Mac OS X 下安裝 Consolas 字型，&lt;a href=&#34;http://www.google.com/#hl=en&amp;amp;sugexp=ldymls&amp;amp;xhr=t&amp;amp;q=consolas+mac+os+x&amp;amp;cp=3&amp;amp;qe=Y29u&amp;amp;qesig=_UG4YnZG8jtin3ipK8s2mQ&amp;amp;pkc=AFgZ2tk-vUgs9LPi2PmisIFz6HAm_Pq-fDmvPi4L-yYRFNQS4tBOO0IK7W3m8jfvVvC7zJy5XIZDhRB7kpNi2-uwNKt8GT6sgg&amp;amp;pf=p&amp;amp;sclient=psy&amp;amp;newwindow=1&amp;amp;aq=0p&amp;amp;aqi=&amp;amp;aql=&amp;amp;oq=con&amp;amp;pbx=1&amp;amp;bav=on.1,or.&amp;amp;fp=6310ac461fb3c07d&#34;&gt;Google 就能找到一堆&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Software Simian</title>
      <link>https://blog.simplypatrick.com/posts/2008/2008-07-19-405/</link>
      <pubDate>Sat, 19 Jul 2008 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2008/2008-07-19-405/</guid>
      <description>&lt;p&gt;呆伯特漫畫裡頗為經典的一篇：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;dilbert_codemonkey_strip.gif&#34; alt=&#34;Software Simian&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果現實裡能單純當個 &lt;a href=&#34;http://en.wikipedia.org/wiki/Code_monkey&#34;&gt;Code Monkey&lt;/a&gt; 其實也不錯&amp;hellip; 呵&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Michael Barr </title>
      <link>https://blog.simplypatrick.com/posts/2007/2007-09-03-399/</link>
      <pubDate>Mon, 03 Sep 2007 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2007/2007-09-03-399/</guid>
      <description>&lt;p&gt;初次知道 &lt;a href=&#34;http://en.wikipedia.org/wiki/Michael_Barr_%28software_engineer%29&#34;&gt;Michael Barr&lt;/a&gt; 是因為讀了他寫的 &lt;a href=&#34;http://books.google.com.tw/books?id=eYU9xcWktRoC&amp;amp;dq=&amp;amp;pg=PP1&amp;amp;ots=zbMg6dMd9D&amp;amp;sig=Yx6S4spi5V6FFuiZR84RlpeVUPA&amp;amp;prev=http://www.google.com.tw/search%3Fsourceid%3Dnavclient%26ie%3DUTF-8%26rls%3DGGLJ,GGLJ:2006-38,GGLJ:en%26q%3D%2522Programming%2BEmbedded%2BSystems%2Bin%2BC%2Band%2BC%252B%252B%2522&amp;amp;sa=X&amp;amp;oi=print&amp;amp;ct=title&#34;&gt;Programming Embedded Systems in C and C++&lt;/a&gt; 這本關於 embedded system programming 的書。後來陸陸續續在網路上找到蠻多他寫的技術文章，才發現他是 &lt;a href=&#34;http://www.embedded.com/mag.htm&#34;&gt;Embedded Systems Programming magazine&lt;/a&gt; (現已改名叫 Embedded Systems Design) 的前總編輯，難怪文筆相當不錯。我還蠻喜歡看他寫的東西，主要是他的文章都有假設讀者的程度，因此不會有一堆太基本的內容，或是過於複雜難懂的技術細節。&lt;/p&gt;
&lt;p&gt;現在任職於顧問公司的 Michael 將他以前的一些文章&lt;a href=&#34;http://www.netrino.com/Articles/index.php&#34;&gt;集結整理起來在這裡&lt;/a&gt;，裡面內容對於從事 embedded system programming 的技術人員應該都頗有幫助。尤其是今天看完這篇 &lt;a href=&#34;http://www.netrino.com/Articles/RTOSAlternatives/index.php&#34;&gt;The Perils of Preemption&lt;/a&gt;配合下面這張圖，雖然內容都是已經熟悉的東西，經由 Michael 這樣的整理與講解，還是讓整個人有打通任督二脈的感覺：&lt;/p&gt;
&lt;img border=&#34;0&#34; width=&#34;425&#34; src=&#34;preemption-figure1.jpg&#34; height=&#34;284&#34; /&gt;
</description>
    </item>
    
    <item>
      <title>Beautiful Code</title>
      <link>https://blog.simplypatrick.com/posts/2007/2007-08-18-394/</link>
      <pubDate>Sat, 18 Aug 2007 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2007/2007-08-18-394/</guid>
      <description>&lt;p&gt;我想我最近這幾個月遇到人，大概第一件想做的事就是問他：『喂，你看了&lt;a href=&#34;http://www.amazon.com/Beautiful-Code-Leading-Programmers-Practice/dp/0596510047/ref=pd_bbs_sr_1/102-7620593-9812130?ie=UTF8&amp;amp;s=books&amp;amp;qid=1187421985&amp;amp;sr=8-1&#34; target=&#34;_blank&#34;&gt;那本書&lt;/a&gt;了嗎？』 (路人：關我什麼事啊？)&lt;/p&gt;
&lt;p&gt;看起來這本書在 Amazon.com 上蠻熱銷的，目前在 Software Development 類別的銷售排行榜上是第一名的，或許跟它的書名有些關係，這本書叫 &amp;ldquo;Beautiful Code&amp;rdquo;，畢竟 programmers 都忍不住會幻想讀了這本書後，功力大進，被人家稱讚 &amp;ldquo;Oh! Your code is beautiful.&amp;quot;。話說回來，這當然是不可能的事，programming 這件事雖然稱不上是藝術，但要達到一定的境界也需要一些天份、知識、經驗、與技巧，做的好的人當然夠資格被稱為大師或是達人。這本書基本上就是這些達人們描述他們遇到的問題，以及如何構思 beautiful code來解決這些問題。&lt;/p&gt;
&lt;p&gt;另外一個吸引我的地方就是本書的作者群實力堅強，例如有大家熟悉的老牌技術作家如 Brian Kernighan, Jon Bentley, 及 Charles Petzold，也有 XML 的專家 Time Bray，Ruby 的作者 Yukihiro  Matsumoto, Perforce 的 Laura Wingerd 及 Christopher Seiwald, Subversion 的 Karl Fogel, 推廣 JSON 的 Douglas Crockford, Greg Kroah-Hartman 是著名的 Linux kernel hacker，以及其他在不同領域有名的技術人員。&lt;/p&gt;
&lt;p&gt;這本書雖然講的都是 coding，但是涵蓋的主體很廣，也是我這覺得這本書最獨特的地方，因為唯有從不同的角度來印證，你才能真正地了解什麼是 beautiful code。學校不會教你怎麼去欣賞好的 code，但是要成為一個好的 programmer，我認為這是必要的能力，畢竟我們不是天才，我們都是站在巨人的肩膀上看這世界。&lt;/p&gt;
&lt;p&gt;不過別期待能很快看完這本書，每篇文章都需要蠻多時間去細讀及思考的 (我也只讀完幾篇而已)。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>與所有的開發人員共勉之</title>
      <link>https://blog.simplypatrick.com/posts/2007/2007-08-05-390/</link>
      <pubDate>Sun, 05 Aug 2007 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2007/2007-08-05-390/</guid>
      <description>&lt;p&gt;引述自 Adam Barr 在 MSDN 的&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/07/06/EndBracket/default.aspx?loc=zx&#34;&gt;專欄文章&lt;/a&gt;：&lt;/p&gt;
&lt;p class=&#34;clsNoIndent&#34;&gt;&lt;span class=&#34;clsGloss&#34;&gt;我還是大四的學生時，&lt;/span&gt;  我記得有一位即將到投顧銀行上班的電腦科學系同學所說的話。他表示他只會參與軟體的設計，但是不會實際加入程式碼的撰寫工作，因為那太無趣。如此的工作應 該要交給程式撰寫人員 -- 顯然他認為程式撰寫人員是身分比較低等。當初那指的當然就是我囉。如此的談話發生在一所破解程式碼是最高榮耀的大學而言，讓我感到被羞辱的情緒。&lt;/p&gt;
然而，他也沒說錯。當初我只是一名程式撰寫人員 (雖然他的程式撰寫能力不見得比我好)。如今，就像 Mike Gunderloy 的書 &lt;em&gt;Coder to Developer&lt;/em&gt; 所示，我已經從一般的程式撰寫人員晉升到開發人員。我不但知道如何撰寫可以順利編譯的程式碼；我創造的軟體產品還可以有：執行速度敏捷、可靠、通過完善測 試、安全、可維護性佳且易於全球化…以及其他高品質程式碼應有的特點。一般而言，整個軟體產業的龐大程式編寫人員組織，正在成長與演進為龐大的開發人員組 織。
&lt;p&gt;但是，如果您詢問開發人員專業生涯的下一步，他們的答案 可能會是想要成為「架構設計人員 (Architect)」。所謂的「架構/結構設計」會令人聯想到鈦合金骨架和毛玻璃，而且相對的會把開發人員的身分影射成營建工人的角色。那麼我是否也 想要躍升到下一個理論性的階層，讓自己成為架構設計人員呢？答案是否定的。&lt;/p&gt;
&lt;p&gt;這並非因為我瞧不起架構設計人員的職責：在軟體開發過程中協調所有系統元件的互動，同時考慮到整體目標 &amp;ndash; 這的確需要有人擔任。然而，身為開發人員我深感榮耀，而且我也誠懇地希望每一位開發人員都能感受到這樣的榮耀。&lt;/p&gt;
&lt;p&gt;但是萬一有人仰慕實體架構設計師 Frank Gehry 或 Rem Koolhaas 在設計上享有的知名氣和自由度呢？我的回應會是，軟體工程設計的領域目前還不夠成熟，無法以這麼概念性的方式運作。架構設計人員可以設計如 Bilbao Guggenheim Museum 以及 Seattle Public Library 等的之名建築物，因為土木工程的領域已經累積有數百年的知識和經驗做為基礎和後盾。但是軟體產業無法一下子讓所有人都晉升到這個層次；畢竟我們大多數都還 在建構一棟不會在用力甩門既倒塌的平房。&lt;/p&gt;
&lt;p&gt;當Microsoft 檢查程式的錯誤 (Bug) 時，發現設計性的錯誤 (亦即，架構設計人員審閱設計文件時會發現的錯誤) 佔據的比率很低，而且程式編寫錯誤 (亦即，程式碼無法根據程式設計人員的用意執行) 的比率也不高。會產生居中的類別，是因為雖然來源程式碼可以根據程式設計人員的用意執行，&lt;strike&gt;但是用意在進行當地語系化時發生錯誤&lt;/strike&gt; (&lt;font color=&#34;#ff6600&#34;&gt;應譯為：但是這些用意有些區域性的錯誤&lt;/font&gt;)：問題包括傳遞給方法的旗標有誤，或是曲解了組態參數的意思。而這些都不屬於架構設計人員可以處理的領域。這都是開發人員必須自行修正的事項。&lt;/p&gt;
&lt;p&gt;Fred Brooks 在他的著名文章 &amp;ldquo;No Silver Bullet&amp;rdquo; 中有間接提到這項重點：「軟體的本質涉及連鎖概念的結構：資料集、資料項目的關係、演算法，以及函數的呼叫」，其中還包括：「&lt;strong&gt;我相信建構軟體最困難的部 分，在於擬定這些連鎖概念的詳細規格、設計以及測試，而非結構的呈現或精確度的測試。&lt;/strong&gt;」由此可見，他認為關鍵並非在於結構設計人員，而是開發人員的工作。 換句話說，他認為程式編寫人員的工作不是很困難，但是開發人員的工作就有許多挑戰。因此，我們應該要肯定我們的價值。&lt;/p&gt;
&lt;p&gt;我知道或許我們的工作不是整體程式設計的最高層次。能夠設計完美的結構，以精簡地封裝所有變數並因應未來的擴充需求，的確是一件令人振奮的成就。畢竟程式設 計人員都講求精確度，所以能夠讓所有組件順暢合併就是理想。&lt;strong&gt;但是軟體的創造其時有很多部分需要我們向熟練的工匠看齊：例如程式碼的審閱、撰寫單元的測試， 以及註解的清理&lt;/strong&gt;。客戶或許無法直接認定是我們的辛勞，才能確保他們的隱私以及系統的防禦，但是我們都知道我們所提供的價值和重要性十足。此外，若要最佳化系統效能和電源管理，更需要黑手藝術的真材實料：&lt;strong&gt;這需要近距離接觸、以技能和經驗解決問題的實力，而非高階概念性的結構設計所能&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我要大聲說：身為開發人員而非結構設計人員是我的榮幸。或許在未來的某一天，所有的軟體工程問題都將獲得解決，讓我們都可以成為結構設計人員。在此之前，我們還是專注於如何持續加強軟體開發吧。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>XNA Game Studio Express</title>
      <link>https://blog.simplypatrick.com/posts/2007/2007-05-20-388/</link>
      <pubDate>Sun, 20 May 2007 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2007/2007-05-20-388/</guid>
      <description>&lt;p&gt;今天下載了 XNA Game Studio Express 來玩玩，不過微軟還是有點不乾脆啊，開發出來的遊戲要下載到 XBox 360 上還要繳 $99 的年費。 :-(&lt;/p&gt;
&lt;p&gt;目前 Game Studio Express 只支援用 C# 搭配 &lt;a href=&#34;http://blogs.msdn.com/xna/archive/2006/08/25/724607.aspx&#34;&gt;XNA Framework&lt;/a&gt; 來開發遊戲 (或者其他應用程式)。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Best Programming Language</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-12-06-384/</link>
      <pubDate>Wed, 06 Dec 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-12-06-384/</guid>
      <description>&lt;p&gt;&lt;a title=&#34;Best Programming Language&#34; href=&#34;http://unspun.amazon.com/list/show/1045?referrer=popular&#34;&gt;UnSpun by Amazon: Best Programming Language&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ruby 遙遙領先第二名 Java，不過現在會去 UnSpun 逛的人大概都是 Ruby 迷吧，所以這樣的投票實在是不太公平了，就像是在德國投票選誰是史上最偉大賽車手一樣。 :-)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Recursive Descent Parser in Ruby</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-11-08-368/</link>
      <pubDate>Wed, 08 Nov 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-11-08-368/</guid>
      <description>&lt;p&gt;嗯嗯嗯&amp;hellip; 用 Ruby 來寫 &lt;a href=&#34;http://en.wikipedia.org/wiki/Recursive_descent_parser&#34;&gt;recursive descent parser&lt;/a&gt; 真是妙，因為所有的 grammar 都可以用 Ruby 的語法來寫，換句話說，就是把 code 當成 data 來使用，例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;start &lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  match(&lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;+&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  match(&lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  match(&lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要增刪一條 rule 非常地直覺與簡單，同樣的方式要用 C 來寫就麻煩多了。本來是想自己寫一份新的，但是看了 &lt;a href=&#34;http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/174842&#34;&gt;Dennis Ranke 的方法&lt;/a&gt;後，不知不覺就跟著他的方法一直抄了，我覺得不太可能寫得比他的版本更好了。下面是我的版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Parser&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Lexer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;TokenMatch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Struct&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#e6db74&#34;&gt;:name&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:pattern&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:eval&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;attr_accessor&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;:pos&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;attr_reader&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;:matches&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;initialize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @matches &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;add_match&lt;/span&gt;(name, pattern, eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @matches &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TokenMatch&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(name, pattern, eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;next_token&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @pos &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; @tokens&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;@pos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lex&lt;/span&gt;(code)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @tokens &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      code &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; code&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;gsub(&lt;span style=&#34;color:#e6db74&#34;&gt;/\s/&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; extract_token(code) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;token, remaining&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          @tokens &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          code &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; remaining
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @pos &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;extract_token&lt;/span&gt;(code)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @matches&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;match&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; match&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pattern &lt;span style=&#34;color:#f92672&#34;&gt;=~&lt;/span&gt; code
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          token &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; match&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eval&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;call($~&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;yield&lt;/span&gt;(token, $~&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;post_match) &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; block_given?
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Production&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;DerivationMatch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Struct&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#e6db74&#34;&gt;:pattern&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:eval&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;initialize&lt;/span&gt;(name, parser)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @parser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; parser
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @matches &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      @lrmatches &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;match&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pattern, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      match &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DerivationMatch&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(pattern, eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; pattern&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; @name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pattern&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;shift
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        @lrmatches &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; match
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        @matches &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; match
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;parse&lt;/span&gt;(indent &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# print &amp;#34; &amp;#34; * indent, &amp;#34;parse #{@name}\n&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      match_result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; try_matches(@matches, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, indent &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; match_result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; try_matches(@lrmatches, match_result, indent &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;# print &amp;#34; &amp;#34; * indent, &amp;#34;result is #{match_result}\n&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; match_result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match_result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; match_result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;try_matches&lt;/span&gt;(matches, pre_result, indent)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      start &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;lexer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pos
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      matches&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;match&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        results &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pre_result ? &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;pre_result&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; : &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# print &amp;#34; &amp;#34; * indent, &amp;#34;try #{match.pattern.inspect}\n&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pattern&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;expected&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Symbol&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; expected
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;productions&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;expected&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;parse(indent &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            results &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; results&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;last
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              results&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;clear
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;lexer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;next_token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; expected &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;# print &amp;#34; &amp;#34; * (indent + 1), &amp;#34;&amp;#39;#{expected}&amp;#39; rather than &amp;#39;#{result}&amp;#39; is expected. backtrack!\n&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              results &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              results &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; results&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;empty?
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;lexer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pos &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; start
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;elsif&lt;/span&gt; match&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eval&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;nil?
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; results&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;first
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;# print &amp;#34; &amp;#34; * indent, &amp;#34;eval #{results.inspect}\n&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; match&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eval&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;call(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;results)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;attr_reader&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;:lexer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;attr_reader&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;:productions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;initialize&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @lexer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Lexer&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @productions &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    instance_eval(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;token&lt;/span&gt;(name, pattern, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @lexer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;add_match(name, pattern, eval)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;production&lt;/span&gt;(name, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    prod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Production&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(name, self)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    prod&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;instance_eval(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @productions&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;name&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; prod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;start&lt;/span&gt;(name, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @start &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; production(name, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;block)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;parse&lt;/span&gt;(code)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @lexer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;lex(code)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @start&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這邊是測試碼：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TestCompiler&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Test&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Unit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;TestCase&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;setup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @parser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Parser&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# lexer here&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      token(&lt;span style=&#34;color:#e6db74&#34;&gt;:literal&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;/^\d+/&lt;/span&gt;) { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;l&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; l&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to_i }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      token(&lt;span style=&#34;color:#e6db74&#34;&gt;:op&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;/^(\*\*|[\+\-\*\/\%\(|)])/&lt;/span&gt;) { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;op&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; op }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# grammar here&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      start &lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;+&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      production &lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:term&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      production &lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:pow&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;**&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:primary&lt;/span&gt;)  {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;a, op, b&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt; b}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;:primary&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      production &lt;span style=&#34;color:#e6db74&#34;&gt;:primary&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(Integer)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;, Integer) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;minus, i&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; i}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        match(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;:expr&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;)&amp;#39;&lt;/span&gt;) {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;lp, expr, rp&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; expr}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2-2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2*2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2**2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2/2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2%2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3%2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_02&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2-2-2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2*2*2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2**2**2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;4/2/2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;7%2%1&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_03&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+2-2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2-2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2*2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2**2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;4/2+2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;7%2+1&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_04&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+(2-2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2-(2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+(2*2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2*(2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2**(2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;4/(2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%(2+1)&lt;/span&gt;, @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;7%(2+1)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_05&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-2+(2-2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2-(-2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2+(2*-2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_06&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal (&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(3/3)+(8-2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(1+3)/(2/2)*(10-8)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(1*3)*4*(5*6)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal (&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(10%3)*(2+2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2**(2+(3/2)**2)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal (&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;(10/(2+3)*4)&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert_equal &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;((&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)&lt;span style=&#34;color:#e6db74&#34;&gt;%(2+1)&lt;/span&gt;), @parser&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parse(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;5+((5*4)%(2+1))&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;A language that doesn’t affect the way you think about programming is not worth knowing&amp;rdquo; — Alan Perlis&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ruby 正在改變我對 programming 的想法。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Ruby Quiz</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-11-06-364/</link>
      <pubDate>Mon, 06 Nov 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-11-06-364/</guid>
      <description>&lt;p&gt;今天才發現原來有個 &lt;a href=&#34;http://rubyquiz.com/&#34;&gt;Ruby Quiz&lt;/a&gt; 網站，在上面每週會提供一個題目讓你思考及練習 Ruby programming 的技巧，對於有    programming language 的經驗但是沒有接觸過 Ruby 的人應該是不錯的學習方式。正如同網站所述：We use the Ruby Quiz to learn more about the Ruby programming language, not as a race. 就把它當作遊戲來玩玩吧。&lt;/p&gt;
&lt;p&gt;這是我對 &lt;a href=&#34;http://rubyquiz.com/quiz28.html&#34;&gt;Quiz #28: Mad Libs&lt;/a&gt; 的解答：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MadLibs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ask&lt;/span&gt;(word)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    print &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Give me &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;word&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    $stdin&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;gets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;chomp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;play&lt;/span&gt;(file)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    keywords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    story &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; file&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;gsub(&lt;span style=&#34;color:#e6db74&#34;&gt;/\(\((.+?)\)\)/&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      word &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; $1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; word &lt;span style=&#34;color:#f92672&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/(.+):(.+)/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        keywords&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;$1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ask($2)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;elsif&lt;/span&gt; keywords&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;include?(word)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        keywords&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;word&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ask(word)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    puts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    print story
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No template is given!&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ARGV&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;open(&lt;span style=&#34;color:#66d9ef&#34;&gt;ARGV&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;file&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;MadLibs&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;play(file)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>My Second Ruby Program</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-11-05-363/</link>
      <pubDate>Sun, 05 Nov 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-11-05-363/</guid>
      <description>&lt;p&gt;今天寫的一個 Ruby 程式，解 &lt;a href=&#34;http://acm.uva.es/p/v100/10033.html&#34;&gt;Interpreter&lt;/a&gt; 這個問題：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# PC/UVa IDs: 110106/10033&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Computer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;initialize&lt;/span&gt;(file)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @regs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Array&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @ram &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Array&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    load_inst(file)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;load_inst&lt;/span&gt;(file)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    file&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each_line &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;line&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      line&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;chomp!
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      line&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;strip!
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; line&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        @ram&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;pc&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; line
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pc &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;elsif&lt;/span&gt; pc &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;MAX_INST&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;execute&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    executed &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opcodes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; executed },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,n&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;3&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,n&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; n; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;4&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,n&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*=&lt;/span&gt; n; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;5&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;6&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;7&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*=&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;%= MAX_INST },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      &amp;#39;8&amp;#39; =&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,a&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @ram&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;@regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;9&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;s,a&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @ram&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;@regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Proc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new { &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;d,s&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; pc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;d&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; @regs&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/(\d)(\d)(\d)/&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=~&lt;/span&gt; @ram&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;pc&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      pc &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      executed &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      opcodes&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;$1&lt;span style=&#34;color:#f92672&#34;&gt;][&lt;/span&gt;$2&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to_i, $3&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to_i&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fail &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No input is given&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ARGV&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cases &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;file &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;File&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#66d9ef&#34;&gt;ARGV&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;r&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;file&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each_line &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;line&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cases &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; line&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;chomp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;strip&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to_i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; cases &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# puts &amp;#34;There are #{cases} cases&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cases&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;times &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  puts &lt;span style=&#34;color:#66d9ef&#34;&gt;Computer&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(file)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;execute
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;file&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;close&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;本來是用 case 平鋪直述地去執行所有指令，後來想了一下發覺用 hash 來做 opcode 的實作也蠻酷的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My First Ruby Program</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-11-03-361/</link>
      <pubDate>Fri, 03 Nov 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-11-03-361/</guid>
      <description>&lt;p&gt;最近在學 Ruby，而要學一個 programming language 最快的方法就是動手去寫，可是工作之餘我又沒太多時間可以寫大一點的程式，因此我通常會找 &lt;a href=&#34;http://www.programming-challenges.com/pg.php?page=index&#34;&gt;Programming Challenges&lt;/a&gt; 裡面的題目來自娛。&lt;/p&gt;
&lt;p&gt;下面的程式就是我的第一個 Ruby 程式： 解 &lt;a href=&#34;http://acm.uva.es/p/v101/10196.html&#34;&gt;Check The Check&lt;/a&gt; 這個問題：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Chess&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  @@capture &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;p&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;P&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;r&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;k&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  @@capture&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;each_key {&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; @@capture&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upcase&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @@capture&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unless&lt;/span&gt; @@capture&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;has_key?(p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upcase)}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;initialize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @board &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Array&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;) { &lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; { line &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;chomp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;strip; &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; line &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; line&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; } }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;is_empty&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @board&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;select{&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;row&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; row &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;}&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;in_check&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upto(&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;y&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upto(&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        piece &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; @board&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;y&lt;span style=&#34;color:#f92672&#34;&gt;][&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; @@capture&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;piece&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          cap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; check_capture(piece, x, y)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; cap&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; cap&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;length &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;check_capture&lt;/span&gt;(piece, col, row)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    @@capture&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;piece&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;collect{&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;dir&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; check_dir(piece, col, row, dir)}&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;compact
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;check_dir&lt;/span&gt;(piece, x, y, dir)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dir&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;].&lt;/span&gt;times &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      x &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; dir&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      y &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; dir&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;include?(x) &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;include?(y)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; @board&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;y&lt;span style=&#34;color:#f92672&#34;&gt;][&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;when&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;k&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;include?(piece)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;when&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;K&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;z&amp;#39;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;include?(piece)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;when&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;next&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Chess&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;new
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; c&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;is_empty
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  print &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Game &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\#&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;i&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;#{&lt;/span&gt;c&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;in_check&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; king is in check&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  i &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;結論是：code block 實在是太好用了，會讓你走火入魔每個地方都想用一下&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Goodbye XAML</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-10-30-357/</link>
      <pubDate>Mon, 30 Oct 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-10-30-357/</guid>
      <description>&lt;p&gt;&lt;a title=&#34;Goodbye XAML, Hello AvalonBuilder&#34; href=&#34;http://www.iunknown.com/articles/2006/08/01/goodbye-xaml-hello-avalonbuilder&#34;&gt;Goodbye XAML, Hello AvalonBuilder&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用 &lt;a href=&#34;http://www.rubyclr.com&#34;&gt;RubyCLR&lt;/a&gt; 或是 &lt;a href=&#34;http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython&#34;&gt;IronPython&lt;/a&gt; 來跟 &lt;a href=&#34;http://en.wikipedia.org/wiki/Windows_Presentation_Foundation&#34;&gt;WPF&lt;/a&gt; 搭配應該是蠻有趣的，或許以後有人會為 WPF 搞個類似 Rails 的 framework 喔。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Green Thread</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-10-29-356/</link>
      <pubDate>Sun, 29 Oct 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-10-29-356/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.jguru.com/faq/view.jsp?EID=143462&#34; title=&#34;What is the difference between green threads and native threads?&#34;&gt;jGuru: What is the difference between green threads and native threads?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;突然看到 green thread 這個詞愣了一下，想說那時候有這種東西的。說穿了，就是 Sun JVM 裡的 user-level thread。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Bad Comments in Code</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-10-16-349/</link>
      <pubDate>Mon, 16 Oct 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-10-16-349/</guid>
      <description>&lt;p&gt;推薦讀一下我學弟的這篇文章《&lt;a href=&#34;http://www.cmlab.csie.ntu.edu.tw/~chenhsiu/blog/archives/2006/10/use_svn_as_loca.html&#34;&gt;Use SVN as local repository&lt;/a&gt;》，強調是我學弟當然是我想沾一點光，不過文中的 Patrick 不是我啦。 :-)&lt;/p&gt;
&lt;p&gt;我個人是對於在程式裡留下一堆被註解掉的 code 是相當感冒的，原因是這些 code 根據個人經驗有 99.9% 的機率不會再被用到，那幹嘛放在那裡混淆後來讀這份 code 的人？尤其是用了版本控制系統後，這種作法更是沒有必要。&lt;/p&gt;
&lt;p&gt;另外一種類似的問題就是有人特別喜歡在程式碼裡面簽名，例如 /* 06-01-01 modified by XXX */ 這類的，尤其是在那種有很多人可能會一起改到的或是歷史悠久的檔案，這些人名比程式碼還顯目刺眼，尤其當每個人的簽名格式都不一樣，甚至個人的簽名風格還會隨時間改變時 (暈&amp;hellip;)。背後的原因不外是能夠在發生問題的時候能找到原作者來解決，問題是這種類似 &lt;a href=&#34;http://www.google.com/search?q=%22cvs+blame%22&#34;&gt;CVS blame&lt;/a&gt; 的功能絕大多數的版本控制系統都有提供 (你可以丟了這個系統，假如它沒有這個功能的話) ，加上這些註解只是妨礙程式閱讀的流暢度罷了。&lt;/p&gt;
&lt;p&gt;所以老實說，讀起許多 open-source project 的程式碼實在是比工作時讀的舒服多了，因為至少大家都還有 &amp;ldquo;code should be written for readability.&amp;rdquo; 的觀念。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Josh Bloch on Design</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-09-25-342/</link>
      <pubDate>Mon, 25 Sep 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-09-25-342/</guid>
      <description>&lt;p&gt;不是什麼新的技術，Joshua Bloch 談的是更基本但也更重要的 API Design：&lt;a href=&#34;http://lcsd05.cs.tamu.edu/slides/keynote.pdf#search=%22joshua%20bloch%20api%20design%22&#34;&gt;How to Design a Good API and Why it Matters&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;其實軟體開發者的大部分工作就是和一大堆的 API 打交道，我是最討厭使用那種設計不良的 API，因為往往要用更多的 client code 來完成功能或者避過設計的缺陷。怎麼去設計“良好的 API”正是所有軟體開發者要必備的技巧，Joshua 所提出的這些設計準則，都是相當值得參考學習的。&lt;/p&gt;
&lt;p&gt;另一篇 Joshua 的訪談：&lt;a title=&#34;Josh Bloch on Design&#34; href=&#34;http://www.artima.com/intv/bloch.html&#34;&gt;Josh Bloch on Design&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Embedded Programming with Eclipse</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-09-24-340/</link>
      <pubDate>Sun, 24 Sep 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-09-24-340/</guid>
      <description>&lt;p&gt;James P. Lynch 寫了一本圖文並茂、詳細到不行的 ARM 與 Eclipse 開發指南：&lt;a href=&#34;http://www.olimex.com/dev/pdf/ARM%20Cross%20Development%20with%20Eclipse%20version%203.pdf&#34;&gt;ARM Cross Development with Eclipse&lt;/a&gt;，主要著重在開發環境的安裝、設置、與使用。由於 Eclipse 具有免費、跨平台、開放的架構、強大的開發社群，embedded system 的開發環境慢慢移至 Eclipse 平台相信將會是大勢所趨。&lt;/p&gt;
&lt;p&gt;不管你是從事甚麼樣的軟體開發工作，精通手頭上的開發工具絕對是做好事情的必要條件，而 Eclipse 就是個值得投資時間去熟習的工具，強力推薦這篇文章給有興趣於 embedded programming 的初學者。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Programmer&#39;s Font</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-09-03-337/</link>
      <pubDate>Sun, 03 Sep 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-09-03-337/</guid>
      <description>&lt;p&gt;我一直是那種對於程式碼字型很挑剔的那種人，因此這幾年都是 Courier New 的愛用者，因為它在不開 ClearType 的情況下還是能顯示非常清晰的程式碼，雖然ㄧ直覺得它給人的感覺硬了一點：&lt;/p&gt;
&lt;p&gt;當然程式碼字型的美醜是有點見仁見智的問題，我甚至也看過用非固定寬度字型的 programmer，他說這樣同一行就可以顯示更多的程式碼。不過我還是喜歡傳統固定寬度的字型，程式排列起來比較有條理也容易看清楚。Courier New 好是好，但我總想找一個更漂亮的程式碼字型。直到有次到某家合作夥伴去討論一些技術細節，發現他用的程式碼字型非常好看，我也就跟著變心用起 &lt;a href=&#34;http://www.gnome.org/fonts/&#34;&gt;Bitstream Vera Sans Mono&lt;/a&gt; 這個字型了：&lt;/p&gt;
&lt;p&gt;但是 Bitstream Vera Sans Mono 唯一的缺點是必須在打開 ClearType 的狀況下才會漂亮。&lt;/p&gt;
&lt;p&gt;另外一個值得推薦的是 Microsoft 即將於 Vista 中提供的 &lt;a href=&#34;http://www.microsoft.com/downloads/details.aspx?familyid=22e69ae4-7e40-4807-8a86-b3d36fab68d3&amp;amp;displaylang=en&#34;&gt;Consolas&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Books on Embedding System Programming</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-04-01-329/</link>
      <pubDate>Sat, 01 Apr 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-04-01-329/</guid>
      <description>&lt;img class=&#34;photo&#34; src=&#34;//images.amazon.com/images/P/1578201039.01._BO2,204,203,200_PIsitb-dp-500-arrow,TopRight,45,-64_AA240_SH20_SCLZZZZZZZ_.jpg&#34; border=&#34;0&#34;/&gt;
&lt;p&gt;在辭掉工作短暫休息的這段時間，我讀完了這本《&lt;a href=&#34;http://www.amazon.com/gp/product/1578201039/ref=sr_11_1/103-2664401-8916640?%5Fencoding=UTF8&#34;&gt;MicroC OS II: The Real Time Kernel &lt;/a&gt;》。會想要去讀它的原因是因為既然要做嵌入式系統的開發，那就必須對 RTOS 的特性有相當程度的掌握，而最快的方式莫過於直接去深入了解一個 RTOS 的實作，而短小精幹的 MicroC/OS-II 因為有原作者的詳細解說，當然是最適合學習的目標。老實說，讀這本書前，自己對於即時系統的一些概念是似懂非懂，但是看完這本書之後卻是豁然開朗。我覺得這本書更適合作為一般學校基礎 OS 的教材，之前大學上的 OS 課程都太理論性了，有點後悔當時沒有去修即時系統的課。強力推薦這本給想要自修學習 RTOS 的人。&lt;/p&gt;
&lt;img class=&#34;photo&#34; src=&#34;//ec1.images-amazon.com/images/P/020161569X.01._BO2,204,203,200_PIlitb-dp-500-arrow,TopRight,32,-59_AA240_SH20_SCLZZZZZZZ_.jpg&#34; border=&#34;0&#34;/&gt;
&lt;p&gt;另外一本的入門好書則是 David E. Simon 寫的《&lt;a href=&#34;http://www.amazon.com/gp/product/020161569X/qid=1144321641/sr=11-1/ref=sr_11_1/103-2664401-8916640?n=283155&#34;&gt;An Embedded Software Primer&lt;/a&gt;》。這本書關於 RTOS 的部分我是覺得沒有前一本講的清楚，但是可讀性倒是高了些，畢竟這本書就是要給入門者看的。後面關於 embedded software design, development, 及 debugging 的觀念我覺得寫的相當不錯，一樣推薦給想要了解 embedded system programming 的人。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Andrew S. Tanenbaum on Teaching Computer Science</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-03-27-327/</link>
      <pubDate>Mon, 27 Mar 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-03-27-327/</guid>
      <description>&lt;p&gt;從 &lt;a href=&#34;http://my.opera.com/isee/blog/show.dml/121526&#34;&gt;iSee&amp;rsquo;s Blog!&lt;/a&gt; 看到的：在 1997 年的 SIGCSE，Andrew S. Tanenbaum 的演說 &lt;a href=&#34;http://www.cs.vu.nl/~ast/talks/cse-97/cse-97.pdf&#34;&gt;TEN GOLDEN RULES FOR TEACHING COMPUTER SCIENCE&lt;/a&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Think long term&lt;/li&gt;
&lt;li&gt;Emphasize principles, not facts&lt;/li&gt;
&lt;li&gt;Expect paradigm shifts&lt;/li&gt;
&lt;li&gt;Explain how things work inside&lt;/li&gt;
&lt;li&gt;Show students how to master complexity&lt;/li&gt;
&lt;li&gt;Computer science is not science&lt;/li&gt;
&lt;li&gt;Think in terms of systems&lt;/li&gt;
&lt;li&gt;Keep theory under control&lt;/li&gt;
&lt;li&gt;Ignore hype&lt;/li&gt;
&lt;li&gt;Don&amp;rsquo;t forget the past&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這是他近十年前講的東西了，到今天看起來還是很對，其中的道理更是每天可以用在工作上的。以前讀書的時候就很喜歡 Andrew 寫的書，例如《&lt;a href=&#34;http://www.amazon.com/gp/product/0130661023/sr=8-3/qid=1143391852/ref=pd_bbs_3/104-5257207-7443921?%5Fencoding=UTF8&#34;&gt;Computer Networks&lt;/a&gt;》及《&lt;a href=&#34;http://www.amazon.com/gp/product/0130313580/sr=8-4/qid=1143391852/ref=pd_bbs_4/104-5257207-7443921?%5Fencoding=UTF8&#34;&gt;Modern Operating Systems&lt;/a&gt;》都是我心目中的經典之作。&lt;/p&gt;
&lt;p&gt;聽說他最近又開始搞 &lt;a href=&#34;http://www.minix3.org&#34;&gt;Minix3&lt;/a&gt; 了，主要是作為開發手持行動設備及嵌入式環境的作業系統。或許有人說作業系統已經是老掉牙的題材了，因為我們已經有了 Windows 或 Linux，搞作業系統還有前途嗎？喔喔，至少在各式各樣嵌入式裝置盛行的今天，我不這樣認為。我並不是要你去發明一個新的作業系統 (那是需要一點天份的)，但是至少要搞清楚它的運作原理。Andrew 也告訴我們 &amp;ldquo;Don&amp;rsquo;t forget the past&amp;rdquo;，不是嗎？&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>kludge</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-03-24-325/</link>
      <pubDate>Fri, 24 Mar 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-03-24-325/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.cmlab.csie.ntu.edu.tw/~chenhsiu/blog/archives/2006/03/some_thoughts_a.html&#34;&gt;這種東西&lt;/a&gt;就叫 &lt;a href=&#34;http://en.wikipedia.org/wiki/Kludge&#34;&gt;kludge&lt;/a&gt;: &lt;strong&gt;k&lt;/strong&gt;lumsy, &lt;strong&gt;l&lt;/strong&gt;ame, &lt;strong&gt;u&lt;/strong&gt;gly, &lt;strong&gt;d&lt;/strong&gt;umb, but &lt;strong&gt;g&lt;/strong&gt;ood &lt;strong&gt;e&lt;/strong&gt;nough。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Catch-22</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-03-04-318/</link>
      <pubDate>Sat, 04 Mar 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-03-04-318/</guid>
      <description>&lt;p&gt;正如朋友所說的，最近的際遇好像陷入了 &lt;a href=&#34;http://en.wikipedia.org/wiki/Catch-22_%28logic%29&#34;&gt;Catch-22&lt;/a&gt; 循環了：『我找不到工作因為沒有相關經驗，但我沒有工作怎麼會有相關經驗』，用 programming 的術語說也就是遇到 deadlock 了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;catch-22.png&#34; alt=&#34;The Ultimate Catch 22&#34;&gt;&lt;/p&gt;
&lt;p&gt;不過實際狀況也沒那麼慘啦，履歷才投了一家公司，而且又是很多人想去的公司，因為沒經驗被拒絕是正常的。雖然如此，我還是要為自己辯解一下，引自從『A 到 A+』這本書：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在決定誰才是適合的人才時，從優秀到卓越的公司重視個性甚於教育背景、專業知識、技能、或工作經驗。這並不表示，專業知識和技能不重要，但是，他們認為專業知識與技能都是可以傳授的(或可以學習的)，然而個性、工作倫理、基本智商、能否堅守承諾，和價值觀等卻早已深植人心，很難改變。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;從我工作這幾年的經驗，我是相當認同這個理念。或許是自己太信心滿滿了，對於第一次求職被拒絕感到有點錯愕，不管如何，只好繼續努力囉。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>New Stuff for Programtic Programmers</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-02-26-313/</link>
      <pubDate>Sun, 26 Feb 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-02-26-313/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.pragmaticprogrammer.com/titles/index.html&#34;&gt;Pragmatic Bookshelf&lt;/a&gt; 又有一些新書了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0976694026%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Behind Closed Doors: Secrets of Great Management (Pragmatic Programmers)&lt;/a&gt; by Johanna Rothman, Esther Derby&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0974514047%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Ship it! A Practical Guide to Successful Software Projects&lt;/a&gt; by Jared Richardson, William Gwaltney&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0976694018%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;My Job Went to India: 52 Ways to Save Your Job (Pragmatic Programmers)&lt;/a&gt; by Chad Fowler&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這三本似乎蠻有趣的，評價也不錯。我應該會買下來，趁著最近離職的空檔讀一讀。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>C# 3.0</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-10-02-296/</link>
      <pubDate>Sun, 02 Oct 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-10-02-296/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/&#34;&gt;Ian Griffiths&lt;/a&gt; 對於 C# 3.0 新功能的介紹：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2005/09/23/varisntobject&#34;&gt;C# 3.0 and LINQ - Expression Trees
C# 3.0 - Extension Methods
C# 3.0 - Var Isn&amp;rsquo;t Object&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>.NET Performance Tuning</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-09-23-292/</link>
      <pubDate>Fri, 23 Sep 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-09-23-292/</guid>
      <description>&lt;p&gt;我向來相信 managed code 可以讓 programmer 把事情做的更快更好，但這一切美好事物的背後是要付出其他代價的，因此這次去 PDC 特別挑了 Rico Mariani 主講的兩個 session 來聽：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://216.55.183.63/pdc2005/slides/FUNL04_Mariani.ppt&#34;&gt;FUNL04 Tips &amp;amp; Tricks: Writing Performant Managed Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://216.55.183.63/pdc2005/slides/FUNL05_Mariani.ppt&#34;&gt;FUNL05 Tips &amp;amp; Tricks: Common Memory Management Pitfalls and Profiling for Managed Applications&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果你問 Rico &amp;ldquo;在開始 performance tuning 之前，最重要的三件準備工作是什麼？&amp;quot;，他的答案肯定是 &amp;ldquo;measure, measure, measure&amp;rdquo;。這幾乎是每個專家、每本書都會跟你強調的重點，但是很多 programmer 卻總是喜歡憑自己的直覺判斷來決定怎麼做，似乎他們就是刻意或者下意識地忘掉這件事，為什麼？因為 measure 實在是件麻煩事，有時甚至不可能做到。相反地，如果有一些工具程式的輔助，measure &amp;amp; performance tuning 可以是件頗有趣的事。除此之外，因為 managed code 有 metadata 可以輔助這些工具的分析，做起來其實比 native code 的 tuning 容易多了。&lt;/p&gt;
&lt;p&gt;這兩場 session 都蠻短的，Rico 並沒有足夠的時間能夠用實際的例子 demo 怎麼使用這些工具並分析其結果，所以我就拿自己寫的一些程式來練習使用 vadump 及 SOS，我向來認為花點時間熟悉這些基本的工具使用可以在將來幫你省下更多的時間。&lt;/p&gt;
&lt;p&gt;Rico 已經&lt;a href=&#34;http://channel9.msdn.com/wiki/default.aspx/Channel9.RicoM&#34;&gt;將他的文章整理在 Channel9&lt;/a&gt;。你也可以參考 Mike Taulty 的《&lt;a href=&#34;http://mtaulty.com/blog/(1eobxu45ssmiih55w5hu5qeu)/archive/2004/08/06/628.aspx&#34;&gt;More on debugging with SOS.DLL&lt;/a&gt;》或是 John Robbins 的《&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/05/03/Bugslayer/default.aspx&#34;&gt;Mini Dump Snapshots and the New SOS&lt;/a&gt;》。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在公牛身上擠奶</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-09-23-293/</link>
      <pubDate>Fri, 23 Sep 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-09-23-293/</guid>
      <description>&lt;p&gt;咦？獨孤木出書了？《&lt;a href=&#34;http://www.books.com.tw/exep/prod/booksfile.php?item=0010293221&#34;&gt;在公牛身上擠奶&lt;/a&gt;》？&lt;/p&gt;
&lt;p&gt;最近好像有點跟不上新消息，還是因為看到 CNET 的&lt;a href=&#34;http://taiwan.cnet.com/enterprise/technology/0,2000062852,20101449,00.htm&#34;&gt;這篇文章&lt;/a&gt;才知道這件事。不過聽說出版社編輯水準很差，請自行判斷是否值得購買。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>9/16 Anders Hejlsberg on C# 3.0</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-09-16-289/</link>
      <pubDate>Fri, 16 Sep 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-09-16-289/</guid>
      <description>&lt;p&gt;呵呵，今天去聽 &lt;a href=&#34;http://en.wikipedia.org/wiki/Anders_Hejlsberg&#34;&gt;Anders Hejlsberg&lt;/a&gt; 講 C# 3.0，內容真的是很精采啊。Anders 本人有一種說不上來的獨特魅力，不會讓你因為覺得他非常聰明而不敢接近他，感覺是個很有親和力的人。在這個 session 他很有條理、循序漸進地告訴你為什麼這些 C# 的新功能需要被加進來：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lambda expressions&lt;/li&gt;
&lt;li&gt;Extension methods&lt;/li&gt;
&lt;li&gt;Local variable type inference&lt;/li&gt;
&lt;li&gt;Object initializers&lt;/li&gt;
&lt;li&gt;Anonymous types&lt;/li&gt;
&lt;li&gt;Query expressions&lt;/li&gt;
&lt;li&gt;Expression trees&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本來我一直以為 C# 3.0 只是新增了 query language 的語法 (Microsoft 所謂的 Language Integrated Query, 簡稱 &lt;a href=&#34;http://msdn.microsoft.com/netframework/future/linq/&#34;&gt;LINQ&lt;/a&gt;)，今天才知道 C# 為了實現 LINQ 也新增了許多令人興奮的新功能。這段 code 真是越看越酷：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; contacts =
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; c &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; customers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; c.State == &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;WA&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; { c.Name, c.Phone };&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;有興趣的可以參考 &lt;a href=&#34;http://download.microsoft.com/download/9/5/0/9503e33e-fde6-4aed-b5d0-ffe749822f1b/csharp%203.0%20specification.doc&#34;&gt;Overview of C# 3.0 (Word)&lt;/a&gt; 及 &lt;a href=&#34;http://download.microsoft.com/download/9/5/0/9503e33e-fde6-4aed-b5d0-ffe749822f1b/csharp%203.0%20language%20enhancements%20hands%20on%20lab.doc&#34;&gt;PDC 2005 Hands-On Lab &amp;ldquo;C# 3.0 Language Enhancements&amp;rdquo; (Word)&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>9/12 The Sleepy Day</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-09-13-287/</link>
      <pubDate>Tue, 13 Sep 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-09-13-287/</guid>
      <description>&lt;p&gt;&amp;ldquo;C++ Internals&amp;rdquo;
Jim Hogg, Stan Lippman, Bob Davidson, Brandon Bray
This is the talk that only the C++ Product Unit could give, and they&amp;rsquo;re here to give it.  While understanding the internals of C++ is fascinating from a purely intellectual perspective, the Visual C++ team has found the set of internal knowledge that will also help you become the expert C++ developer.  This talk will cover issues such as the C++ object model (managed and unmanaged), the complexity of app domains when the whole world is not managed, performance internals, and much much more.&lt;/p&gt;
&lt;p&gt;今天改變主意去聽 C++ Internals 這個 session，但結果真是讓人失望。第一、主題太繁雜沒有重點，第二、主講人的表達技巧有待加強，第三、我的時差嚴重地發作，自從學校畢業後還是第一次要聽課又很想打瞌睡。&lt;/p&gt;
&lt;p&gt;結果呢，我只好跳槽去聽最後一段的 &amp;ldquo;Framework Design Guidelines&amp;rdquo;，內容還不錯，真是後悔選錯了課程，結束後當然就是直接衝回旅館睡大覺。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Counting Semaphore in .NET</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-19-254/</link>
      <pubDate>Sun, 19 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-19-254/</guid>
      <description>&lt;p&gt;另一篇在 CSDN &lt;a href=&#34;http://dev.csdn.net/article/71/71587.shtm&#34;&gt;也是有問題的程式&lt;/a&gt;，程式的目的是限制一定數量的 threads 同時執行某項工作。我的想法是用 System.Threading.Monitor 就可以很優雅地解決這問題：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Program&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Main(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;[] args)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Program p = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Program();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Thread[] threads = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Thread[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &amp;amp;lt; threads.Length; i++)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      threads[i] = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Thread(p.Run);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      threads[i].Name = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Thread(&amp;#34;&lt;/span&gt; + i.ToString() + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;)&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      threads[i].Start();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Thread.Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;foreach&lt;/span&gt; (Thread t &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; threads) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      t.Join();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Console.ReadLine();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; allowed = &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Run()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Thread t = Thread.CurrentThread;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;lock&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (allowed &amp;amp;lt;= &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Console.WriteLine(t.Name + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; is waiting.&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Monitor.Wait(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      --allowed;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Console.WriteLine(t.Name + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; started.&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Thread.Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;lock&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Console.WriteLine(t.Name + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; stopped.&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ++allowed;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Monitor.Pulse(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;說穿了其實這程式只是用 Monitor 來實作 &lt;a href=&#34;http://en.wikipedia.org/wiki/Semaphore_%28programming%29&#34;&gt;Semaphore&lt;/a&gt; 的一個特別例子。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Implement Singleton Pattern by Generic (in C#  2.0)</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-19-253/</link>
      <pubDate>Sun, 19 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-19-253/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://dev.csdn.net/article/71/71585.shtm&#34;&gt;在 CSDN 看到的這個範例&lt;/a&gt;有兩個問題：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.yoda.arachsys.com/csharp/singleton.html&#34;&gt;不是 thread-safe&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;假如 T 沒有公開無參數的建構函數，會在 runtime 時拋出異常。事實上，這個問題可以使用 generic constraint 在 compiler time 時避免。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以下面是改良過的版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Singleton&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; T : &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; T _instance = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; T();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// to disable beforefieldinit flag&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; Singleton()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; T Instance
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; _instance;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Cdecl Calling Convention for Delegates</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-15-248/</link>
      <pubDate>Wed, 15 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-15-248/</guid>
      <description>&lt;p&gt;如何使用 C# 建立 cdecl callback 給 unmanaged code 使用？&lt;/p&gt;
&lt;p&gt;SQLite.NET 所採用的方法如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用 ildasm 反組譯 DLL 產生 IL 碼&lt;/li&gt;
&lt;li&gt;用 Perl script 為 delegate 的 Invoke() 加上 modopt([mscorlib]System.Runtime.CompilerServices.CallConvCdecl)&lt;/li&gt;
&lt;li&gt;再用 ilasm 組譯出新的 DLL&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;參考下列詳細的方法 (摘自 SQLite.NET 的文件檔)：&lt;/p&gt;
&lt;pre&gt;
The C# does not allow you to specify the calling convention of the callback.
It is just one of the C# limitations. IL, managed C++ and the runtime itself
supports the cdecl calling convention for delegates through
modopt([mscorlib]System.Runtime.CompilerServices.CallConvCdecl) on the
internal Invoke method of the delegate. Run ildasm on a small example in
managed C++ if you want to know the exact syntax.

You can use the following trick if you want to write all your code in C#:

- Create a private placeholder attribute to mark your C# delegates that
needs cdecl calling convention
- Compile your C# to an assembly
- Use the ildasm dissasembler to store the resulting assembly as raw IL.
- Modify the IL to change the calling convention on the delegates marked
with the placeholder attribute
- Use ilasm to compile the modified raw IL again.

The whole process can be automated. You can find example of how to automate
the process in the Shared Source CLI samples. The Shared Source CLI (aka
Rotor) can be downloaded from http://msdn.microsoft.com/net/sscli . The
following files have the interesting stuff about the cdecl calling
convention for delegates:

sscli\docs\techinfo\native_managed_interop.html
sscli\samples\pigui\tk\makefile.inc
sscli\samples\pigui\tk\callconvattribute.cs
sscli\samples\pigui\tk\callconvhack.pl
sscli\samples\pigui\tk\tclnative.cs

You will need perl (e.g. from http://www.activestate.com) if you want to use
the script as is. It should be fairly easy to rewrite callconvhack.pl in any
other language though.

Here are the code snipets if you are on a slow link and don&#39;t have time to
download 10+MB Rotor tarball at the moment:

makefile.inc:
--------------------
....
csc /out:myassembly.dll callconvattribute.cs mydelegate.cs ...
ildasm myassembly.dll /out:myassembly.il1
perl callconvhack.pl myassembly.il2
ilasm /DLL /QUIET myassembly.il2
....
--------------------

mydelegate.cs:
--------------------
....
[CallConvCdecl] internal delegate int MyDelegate(int param);
....
--------------------

callconvattribute.cs:
--------------------
// cdecl calling convetion for delegates - the signature of delegates
// marked with this attribute is changed to cdecl in callconvhack.pl

using System;

[Serializable, AttributeUsage (AttributeTargets.Delegate)]
public sealed class CallConvCdeclAttribute : Attribute
{
    public CallConvCdeclAttribute()
    {
    }
}
--------------------

callconvhack.pl:
--------------------
# change references to CallConvAttribute into
modopt([mscorlib]System.Runtime.CompilerServices.*)

while() {
    if (m/\.class .* CallConv.*Attribute/) {
        $incallconvattributeimpl=1;
        next;
    }
    if (m/\/\/ end of class CallConv.*Attribute/) {
        $incallconvattributeimpl=0;
        next;
    }

    if (m/\.custom instance void CallConv(.*)Attribute/) {
        $pendingcallconv = $1;
        next;
    }

    if ($pendingcallconv) {
        if (m/.*Invoke\(.*/) {
            print &#34;modopt([mscorlib]System.Runtime.CompilerServices.CallConv&#34; . $pendingcallconv . &#34;)\n&#34;;
            $pendingcallconv = &#34;&#34;;
        }
    }

    print unless $incallconvattributeimpl;
}
--------------------

This posting is provided &#34;AS IS&#34; with no warranties, and confers no rights.
&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Cdecl Calling Convention for Delegates, Part II</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-15-249/</link>
      <pubDate>Wed, 15 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-15-249/</guid>
      <description>&lt;p&gt;想了一下，前一篇文章裡的方法似乎有點麻煩。雖然 C# 的實作有這樣的限制，但是我們應該可以用 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/cpref/html/frlrfsystemreflectionemittypebuilderclasstopic.asp&#34;&gt;System.Reflection.Emit.TypeBuilder&lt;/a&gt; 來動態產生一個使用 cdecl 的 delegate。理論上，透過 &lt;a href=&#34;http://wesnerm.blogs.com/net_undocumented/2005/06/lightweight_cod.html&#34;&gt;dynamic code generation&lt;/a&gt; 這種方式是可以突破任何語法上或是實作上的限制。因此參考下列的這兩篇文章，其實這問題是可以用更優雅的方式來解決：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blogs.msdn.com/joelpob/archive/2004/02/15/73239.aspx&#34;&gt;Creating delegate types via Reflection.Emit&lt;/a&gt;, Joel Pobar&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dncscol/html/csharp02172004.asp&#34;&gt;Calling Code Dynamically&lt;/a&gt;, Eric Gunnerson&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下列的程式列出了新的作法，產生出來的 delegate 跟用 ildasm/perl/ilasm 是一樣的效果 (注意 new Type[] { typeof(System.Runtime.CompilerServices.CallConvCdecl) } 的使用)，酷！&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System.Collections.Generic;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System.Text;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System.Reflection;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System.Reflection.Emit;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;namespace&lt;/span&gt; EmitCdeclDelegate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Program&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Main(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;[] args)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Program program = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Program();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            program.TestCdeclDelegate();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; TestCdeclDelegate()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            MethodInfo methodInfo = &lt;span style=&#34;color:#66d9ef&#34;&gt;typeof&lt;/span&gt;(Program).GetMethod(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CallBack&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Type delegateType = CreateCustomDelegate(methodInfo);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Delegate d = Delegate.CreateDelegate(delegateType, &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CallBack&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            d.DynamicInvoke(&lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt;[] {IntPtr.Zero, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unsafe&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; CallBack(IntPtr pArg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#66d9ef&#34;&gt;sbyte&lt;/span&gt;** argv, &lt;span style=&#34;color:#66d9ef&#34;&gt;sbyte&lt;/span&gt;** columnNames)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; Type CreateCustomDelegate(MethodInfo targetMethod)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            AssemblyName assembly;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            AssemblyBuilder assemblyBuilder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ModuleBuilder modbuilder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            TypeBuilder typeBuilder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            MethodBuilder methodBuilder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            assembly = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; AssemblyName();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            assembly.Version = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Version(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            assembly.Name = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SQLiteCallback&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            assemblyBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly(assembly, AssemblyBuilderAccess.RunAndSave);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            modbuilder = assemblyBuilder.DefineDynamicModule(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SQLiteCallbackModule&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SQLiteCallback.exe&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Create a delegate that has the same signature as the method we would like to hook up to&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            typeBuilder = modbuilder.DefineType(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SQLiteCallback&amp;#34;&lt;/span&gt;, TypeAttributes.Class | TypeAttributes.Public | TypeAttributes.Sealed | TypeAttributes.AnsiClass | TypeAttributes.AutoClass, &lt;span style=&#34;color:#66d9ef&#34;&gt;typeof&lt;/span&gt;(System.MulticastDelegate));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ConstructorBuilder constructorBuilder = typeBuilder.DefineConstructor(MethodAttributes.RTSpecialName | MethodAttributes.HideBySig | MethodAttributes.Public, CallingConventions.Standard, &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Type[] { &lt;span style=&#34;color:#66d9ef&#34;&gt;typeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt;), &lt;span style=&#34;color:#66d9ef&#34;&gt;typeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            constructorBuilder.SetImplementationFlags(MethodImplAttributes.Runtime | MethodImplAttributes.Managed);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Grab the parameters of the method&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ParameterInfo[] parameters = targetMethod.GetParameters();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Type[] paramTypes = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Type[parameters.Length];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &amp;amp;lt; parameters.Length; i++)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                paramTypes[i] = parameters[i].ParameterType;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Define the Invoke method for the delegate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            methodBuilder = typeBuilder.DefineMethod(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invoke&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                MethodAttributes.Public | MethodAttributes.HideBySig | MethodAttributes.NewSlot | MethodAttributes.Virtual,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                CallingConventions.Standard,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                targetMethod.ReturnType,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Type[] { &lt;span style=&#34;color:#66d9ef&#34;&gt;typeof&lt;/span&gt;(System.Runtime.CompilerServices.CallConvCdecl) },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                paramTypes,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            methodBuilder.SetImplementationFlags(MethodImplAttributes.Runtime | MethodImplAttributes.Managed);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// bake it!&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Type t = typeBuilder.CreateType();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; t;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Erich Gamma on Design Patterns</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-11-245/</link>
      <pubDate>Sat, 11 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-11-245/</guid>
      <description>&lt;p&gt;談到 Design Patterns，有興趣的人可以看看這一系列對 Erich Gamma 的訪談：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/lejava/articles/gammadp.html&#34;&gt;Part I: How to Use Design Patterns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/lejava/articles/reuse.html&#34;&gt;Part II: Erich Gamma on Flexibility and Reuse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/lejava/articles/designprinciples.html&#34;&gt;Part III: Design Principles from Design Patterns&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Erich Gamma 談到如何使用 DP 以及經過這十年他想法的一些改變。DP 固然是 programmer 設計程式時的一大利器，然而水可載舟亦可覆舟，誤用 DP 往往會造成過度的設計以及沒有必要的彈性。例如下面這個我很久以前看過的一個實際例子：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Toy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Barbie&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; Toy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Lego&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; Toy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ToyFactory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Instance();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; Toy&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CreateToy&lt;/span&gt;(LPCTSTR id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;protected&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ToyFactory();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;ToyFactory();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; m_pToyFactory;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ToyFactory &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;m_pToyFactory &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ToyFactory()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::~&lt;/span&gt;ToyFactory()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ToyFactory &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Instance()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;m_pToyFactory)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        m_pToyFactory &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ToyFactory;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m_pToyFactory;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Toy&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CreateToy(LPCTSTR id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (strcmp(id, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;barbie&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Barbie;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;if&lt;/span&gt; (strcmp(id, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lego&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Lego;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; NULL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ToyFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Instance()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;CreateToy(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;barbie&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;明明一個 global function 可以做到的事卻硬要用 Factory Method 及 Singleton 這兩個 pattern 來包裝，這已經是為了 DP 而 DP。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;To add flexibility, you really have to be able to justify it by a requirement. If you don&amp;rsquo;t have a requirement up front, then I wouldn&amp;rsquo;t put a hook for flexibility in my system up front.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在使用任何 Design Patterns 之前，你該想想 Erich Gamma 的這番建議。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Head First Design Patterns</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-06-09-241/</link>
      <pubDate>Thu, 09 Jun 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-06-09-241/</guid>
      <description>&lt;p&gt;蔡學鏞要翻譯《&lt;a href=&#34;http://www.oreilly.com.tw/product_java.php?id=a163&#34;&gt;Head First Design Patterns&lt;/a&gt;》這本近來熱賣到不行的書。&lt;/p&gt;
&lt;p&gt;翻譯這本書跟翻譯一般的技術書籍有點不一樣，相對地也比較難，就看蔡學鏞能否一戰成名或是砸了自己的招牌囉。目前網站上沒提供試讀的章節，所以不曉得翻譯的品質如何。但如果翻譯的品質不錯，我肯定會掏腰包去買。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Windows Internals Guru - Mark Russinovich</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-04-12-236/</link>
      <pubDate>Tue, 12 Apr 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-04-12-236/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.sysinternals.com/blog/&#34;&gt;Mark Russinovich 也開始 blog 了&lt;/a&gt;。對 Windows 內部運作有興趣的人可以持續關注他的文章。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The First Recorded Computer Bug</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-04-11-235/</link>
      <pubDate>Mon, 11 Apr 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-04-11-235/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.asktog.com/Bughouse/BugHallOfFame.html&#34;&gt;The First Recorded Computer Bug&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Ten Rules of Performance</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-03-31-229/</link>
      <pubDate>Thu, 31 Mar 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-03-31-229/</guid>
      <description>&lt;p&gt;Eric Gunnerson 的 &lt;a href=&#34;http://blogs.msdn.com/ericgu/archive/2005/03/23/401057.aspx&#34;&gt;Design for Performance vs. Tune for performance&lt;/a&gt;
讓我想起之前讀過 Paul Vick 的這篇文章 &lt;a href=&#34;http://www.panopticoncentral.net/archive/2004/02/10/270.aspx&#34;&gt;The Ten Rules of Performance&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我自己歸納了幾個了幾個重點:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Don&amp;rsquo;t guess, do profiling.&lt;/li&gt;
&lt;li&gt;Fix performance problem as early as possible.&lt;/li&gt;
&lt;li&gt;Performance should be designed in.&lt;/li&gt;
&lt;li&gt;Memory access is more expensive than CPU cycle.&lt;/li&gt;
&lt;li&gt;Develop a &amp;ldquo;performance culture&amp;rdquo; in the team/company.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Jolt Awards 2005</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-03-21-227/</link>
      <pubDate>Mon, 21 Mar 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-03-21-227/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://subversion.tigris.org/&#34;&gt;Subversion&lt;/a&gt; 拿下 Change and Configuration Management Tools 的首獎。毫無意外地，&lt;a href=&#34;http://www.eclipse.org/&#34;&gt;Eclipse&lt;/a&gt; 仍然蟬連 Languages and Development Environments 的寶座。&lt;/p&gt;
&lt;p&gt;新增的 Test – Defect Tracking Tools 獎項則是由 &lt;a href=&#34;http://www.fogcreek.com/FogBugz/&#34;&gt;FogBugz&lt;/a&gt; 3.1 獲得，&lt;a href=&#34;http://www.joelonsoftware.com/&#34;&gt;Joel Spolsky&lt;/a&gt; 應該感到驕傲，因為他的書《&lt;a href=&#34;http://www.amazon.com/exec/obidos/ASIN/1590593898/002-0135896-3209660&#34;&gt;Joel on Software&lt;/a&gt;》及產品 FogBugz 同時都得獎了。&lt;p&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>How to be a good programmer?</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-03-14-226/</link>
      <pubDate>Mon, 14 Mar 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-03-14-226/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://dturini.blogspot.com/2005/02/i-want-to-be-good-programmer-how.html&#34;&gt;I want to be a good programmer&amp;hellip; How???&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我多加一條:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Read a lot of code: for example, you can choose an open-source project you are interested in and try to understand how it works by reading its source code. You can always learn new things from that because every programmer thinks differently for the same thing and their solution may be better than yours.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Exception Handling Best Practices in .NET</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-03-12-225/</link>
      <pubDate>Sat, 12 Mar 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-03-12-225/</guid>
      <description>&lt;p&gt;Daniel Turini 寫的這篇《&lt;a href=&#34;http://dturini.blogspot.com/2005/02/exception-handling-best-practices-in.html&#34;&gt;Exception Handling Best Practices in .NET&lt;/a&gt;》相當不錯，內容正好跟 Brad Abrams 的《&lt;a href=&#34;http://blogs.msdn.com/brada/archive/2005/03/04/385531.aspx&#34;&gt;Exception handing and Memory Management&lt;/a&gt;》相呼應。&lt;/p&gt;
&lt;p&gt;我不明白的是，為什麼 Brad Abrams 會認為 &amp;ldquo;catch (Exception e) is your friend&amp;rdquo;？ 因為 catch {&amp;hellip;} 中我所能想到最好的處理方式就是 &amp;ldquo;log the Exception, rethrow it, and let the program terminate&amp;rdquo;；如果不這樣做而把這個 Exception 忽略掉，反而會造成以後偵錯的困難。&lt;/p&gt;
&lt;p&gt;有興趣的人可以參考 &lt;a href=&#34;http://groups-beta.google.com/group/microsoft.public.dotnet.framework/browse_thread/thread/85cdcd461d59e417/a07e9e93e09cbfa0#a07e9e93e09cbfa0&#34;&gt;Is &amp;ldquo;throw new Exception(&amp;hellip;)&amp;rdquo; a good practice&lt;/a&gt; 這個討論，我喜歡 David Levine 給我的答案。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Knuth &amp; TAOCP</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-02-15-220/</link>
      <pubDate>Tue, 15 Feb 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-02-15-220/</guid>
      <description>&lt;p&gt;唸過 computer science 的人大多對 &lt;a href=&#34;http://en.wikipedia.org/wiki/Knuth&#34;&gt;Knuth&lt;/a&gt; 有份莫名的崇敬，而大多數人的崇敬源自於 &lt;a href=&#34;http://en.wikipedia.org/wiki/The_Art_of_Computer_Programming&#34;&gt;The Art of Computer Programming&lt;/a&gt; 這部不知何時才能全部完成的巨著，而大家最常開的笑話就是『 Knuth 能在有生之年把七大冊全部寫完嗎？』。但對我而言，Knuth 這名字卻有著更不同的意義：他是我的師祖，也就是老師的老師的老師。&lt;/p&gt;
&lt;p&gt;我自己幾年前買下 &lt;a href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/0201485419/ref=pd_sbs_b_1/002-8831543-5119207?%5Fencoding=UTF8&amp;amp;v=glance&#34;&gt;vol.1-3&lt;/a&gt; 這一套供在書架上，卻從來沒能夠把這幾本書看完，畢竟自己的數學基礎不夠扎實，出來工作後也沒有時間及熱情來研讀了。有時候覺得愧對師祖時就會拿出來翻一翻再放回架上去。 XD&lt;/p&gt;
&lt;p&gt;師祖預計於 2007 年完成 vol.4，在這之前，將先出版一系列的 &lt;a href=&#34;http://www.bookpool.com/.x/dwtbcyv9d6/ct/163&#34;&gt;fascicle&lt;/a&gt; 為它鋪路：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.bookpool.com/sm/0201853922&#34;&gt;Volume 1, Fascicle 1: MMIX &amp;ndash; A RISC Computer for the New Millennium&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.bookpool.com/sm/0201853930&#34;&gt;Volume 4, Fascicle 2: Generating All Tuples and Permutations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.bookpool.com/sm/0201853949&#34;&gt;Volume 4, Fascicle 3: Generating All Combinations and Partitions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不熟悉 Knuth 的人可以看看這篇簡介《&lt;a href=&#34;http://www.cis.nctu.edu.tw/chinese/doc/research/doc/cismagazine/cis-magazine-84-4.html&#34;&gt;高德納的二十年計畫&lt;/a&gt;》。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Stallman, Torvalds, Knuth, and Dijkstra</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-02-14-219/</link>
      <pubDate>Mon, 14 Feb 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-02-14-219/</guid>
      <description>&lt;p&gt;取自 &lt;a href=&#34;http://developers.slashdot.org/article.pl?sid=05/02/04/0120216&amp;amp;from=rss&#34;&gt;Knuth&amp;rsquo;s Art of Computer Programming Vol. 4&lt;/a&gt; 這篇在 Slashdot 的消息：&lt;/p&gt;
&lt;blockquote&gt;
Richard M. Stallman, Linus Torvalds, and Donald E. Knuth engage in a discussion on whose impact on Computer Science was the greatest.&lt;br&gt;&lt;br&gt;
&lt;p&gt;&lt;strong&gt;Stallman&lt;/strong&gt;: &amp;ldquo;God told me I have programmed the best editor in the world!&amp;quot;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Torvalds&lt;/strong&gt;: &amp;ldquo;Well, God told &lt;em&gt;me&lt;/em&gt; that I have programmed the best operating system in the world!&amp;quot;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Knuth&lt;/strong&gt;: &amp;ldquo;Wait, wait - I never said that.&amp;quot;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;While Dijkstra was still trying to find the shortest path to the conference&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Yes, apparently he was told just to &lt;strong&gt;go to&lt;/strong&gt; the conference, but he considered that advice &lt;strong&gt;harmful&lt;/strong&gt;.&lt;br&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;最後面一句關於 &lt;a href=&#34;http://en.wikipedia.org/wiki/Dijkstra&#34;&gt;Dijkstra&lt;/a&gt; 的笑話真的很冷。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Acronym: IIRC</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-02-01-218/</link>
      <pubDate>Tue, 01 Feb 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-02-01-218/</guid>
      <description>&lt;p&gt;這是我今天第二次看到 IIRC 這縮寫了，&lt;a href=&#34;http://www.microsoft.com/taiwan/windowsxp/experiences/acronyms.htm&#34;&gt;就搜尋了一下&lt;/a&gt;，只是 YHGMTPOTG 或 BTDTGTTSAWIO 有點惡搞吧？&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>What is LLP64?</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-02-01-217/</link>
      <pubDate>Tue, 01 Feb 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-02-01-217/</guid>
      <description>&lt;p&gt;談到 64-bit programming，難免就會看到這幾個縮寫：LP64 ILP64 LLP64 ILP32 LP32，關於這些模式的差異可以參考《&lt;a href=&#34;http://www.unix.org/version2/whatsnew/lp64_wp.html&#34;&gt;64-Bit Programming Models: Why LP64?&lt;/a&gt;》。&lt;/p&gt;
&lt;p&gt;附帶一提：&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2005/01/31/363790.aspx&#34;&gt;Win64 採用 LLP64&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Async is hard</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-01-27-216/</link>
      <pubDate>Thu, 27 Jan 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-01-27-216/</guid>
      <description>&lt;p&gt;今天跟同事討論一個問題： &#34;Is asynchronous interface good?&#34;&lt;/p&gt;
&lt;p&gt;我的觀點是『server interface 應該採用 synchronous model，而由 client 來決定是否採用 asynchronous model 』。會有這樣的結論是因為我認為 &lt;a href=&#34;http://spaces.msn.com/members/mwadams/Blog/cns!1pAMOzaH98ZfHK1uhQS5Bd5g!133.entry&#34;&gt;&#34;async is hard&#34;&lt;/a&gt;。&lt;a href=&#34;http://www.javaworld.com.tw/jute/post/view?bid=19&amp;amp;id=15577&amp;amp;sty=3&amp;amp;age=0&amp;amp;tpg=1&amp;amp;ppg=1&#34;&gt;asynchronous model&lt;/a&gt; 強迫 client 去做許多不同於 synchronous model 的特別處理才能確保程式的正確性；但是根據我的觀察，大多數 programmer 的思考邏輯都習慣了 synchronous model，要他們突然換成 asynchronous model 來思考非得花一番時間嘗試及偵錯才能達到 100% 的正確性。換句話說，我認為一個容易讓 client 端出錯的 interface 並不是好的 interface。&lt;/p&gt;
&lt;p&gt;我向來是 &#34;Make simple things easy and hard things possible&#34; 這句話的信徒。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Writing Exception-Safe Code</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-01-17-214/</link>
      <pubDate>Mon, 17 Jan 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-01-17-214/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/&#34;&gt;The Old New Thing&lt;/a&gt; 中關於 exception-safe 的相關討論：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/04/22/118161.aspx&#34;&gt;Cleaner, more elegant, and wrong&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2005/01/17/354399.aspx&#34;&gt;How did MS-DOS report error codes?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2005/01/14/352949.aspx&#34;&gt;Cleaner, more elegant, and harder to recognize&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如同我以前在 Assertions and Error Handling 這篇文章中的觀點，我還是認為 exception 帶來的好處多於它帶來的問題。大家都知道 &amp;ldquo;writing error handling code is hard&amp;rdquo;，不表示我們就可以忽略這個議題而不做 error handling；正如同 &amp;ldquo;writing bug-free code is hard&amp;rdquo; 不是你程式裡有一堆臭蟲的好理由。&lt;/p&gt;
&lt;p&gt;關於 exception-safe 或是 failure atomicity 這個問題，常見的五個解決方法可以參考 &lt;a href=&#34;http://java.sun.com/docs/books/effective/toc.html&#34;&gt;Effective Java&lt;/a&gt; 中的 Item 46: Strive for failure atomicity：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;design immutable objects&lt;/li&gt;
&lt;li&gt;check parameters for validity before performing the operation&lt;/li&gt;
&lt;li&gt;order the computation so that any part that may fail takes place before any part that modifies the object&lt;/li&gt;
&lt;li&gt;write recovery code&lt;/li&gt;
&lt;li&gt;perform the operation on a temporary copy&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>CodeProject</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-01-06-211/</link>
      <pubDate>Thu, 06 Jan 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-01-06-211/</guid>
      <description>&lt;p&gt;我有訂閱 &lt;a href=&#34;http://www.codeproject.com&#34;&gt;CodeProject&lt;/a&gt; 的 newsletter，原因是在裡面總是可以發現一些新奇有趣的程式小品如 &lt;a href=&#34;ASCII art with C#&#34;&gt;ASCII art with C#&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>John Lam on CLI Metadata</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-12-08-207/</link>
      <pubDate>Wed, 08 Dec 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-12-08-207/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.iunknown.com/000261.html&#34;&gt;John Lam&lt;/a&gt; 的 &lt;a href=&#34;http://www.iunknown.com/Files/metadata_internals.pdf&#34;&gt;Metadata Internals&lt;/a&gt; 實在是太棒了，單單看這份簡報就可以對 CLI metadata 的結構有了清楚的認識，可以看出來 John 是個很會教導的老師。&lt;/p&gt;
&lt;p&gt;我想大部分的 .NET programmer 也只要了解到這個程度就夠了，如果想要更深入才需要去看 &lt;a href=&#34;http://download.microsoft.com/download/3/f/b/3fb318cb-f60c-4128-ada8-bbffb791046d/Partition_II_Metadata.zip&#34;&gt;CLI Partition II - Metadata and File Format&lt;/a&gt; 這份長達174頁的正式規格。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.iunknown.com&#34;&gt;John 的 iunknown.com blog&lt;/a&gt; 也很值得去看喔。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Stan Lippman on C&#43;&#43;/CLI</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-12-06-205/</link>
      <pubDate>Mon, 06 Dec 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-12-06-205/</guid>
      <description>&lt;p&gt;我一直很好奇為什麼在 C++ 領域赫赫有名的 Stan Lippman 及 Herb Sutter 會加入 Microsoft?&lt;/p&gt;
&lt;p&gt;從&lt;a href=&#34;http://blog.csdn.net/myan/archive/2004/10/13/134978.aspx&#34;&gt;孟岩對 Stan 的訪談&lt;/a&gt;或許可以一窺其究竟。從文中可以看出，透過 C++/CLI 一方面可以實現 Stan 個人對 C++ 改進的期許，一方面也大大增強了 C++ 在 .NET 平台上的實用性。或許有許多人認為 Stan 這樣的作法是叛離 C++ 的正統道路，我倒是很樂觀其成。如果今天 Microsoft 不做 C++ 與 .NET 的 Interop，一定會有其他的公司或開放原始碼的專案會去做，畢竟有需求就會有人想辦法供給。&lt;/p&gt;
&lt;p&gt;看看訪談文章的評論，發現有些人總是喜歡把別人當成笨蛋或是認為別人做任何事都是出於自私的目的，胸襟及眼光實在是小了些。人們所以為的往往是自己想法的反射。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Windows Forms Programming Tips</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-12-03-204/</link>
      <pubDate>Fri, 03 Dec 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-12-03-204/</guid>
      <description>&lt;p&gt;在 &lt;a href=&#34;http://blogs.msdn.com/jfoscoding/&#34;&gt;jfo&amp;rsquo;s coding&lt;/a&gt; 有一些 Windows Forms 的技術文章，內容頗為實用而且都是一般市面的 Windows Forms 書籍沒討論到的課題：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blogs.msdn.com/jfoscoding/archive/2004/12/03/274186.aspx&#34;&gt;Picking your base class wisely&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blogs.msdn.com/jfoscoding/archive/2004/11/24/269416.aspx&#34;&gt;All About Handles in Windows Forms&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.martnet.com/~jfosler/articles/UsingDispose.htm&#34;&gt;How When Where and Why to use Dispose&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.martnet.com/~jfosler/articles/WindowsFormsPainting.htm&#34;&gt;Painting Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.martnet.com/~jfosler/articles/UsingSplitter.htm&#34;&gt;Understanding DockLayout and Splitters&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://windowsforms.net/articles/notifyiconapplications.aspx&#34;&gt;Building NotifyIcon Applications/Understanding the Application class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.martnet.com/~jfosler/articles/OverridingControlCollection.htm&#34;&gt;How to make a readonly controls collection&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Don&#39;t throw System.Exception directly!</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-27-203/</link>
      <pubDate>Sat, 27 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-27-203/</guid>
      <description>&lt;p&gt;在寫下列這一段程式時，發現 System.Drawing.Graphics.FromImage 居然會直接拋出 System.Exception：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AddImageInfo&lt;/span&gt; : BaseImageOp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; Font _drawFont = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Font( &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Verdana&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; SolidBrush _drawBrush = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; SolidBrush(Color.White);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; AddImageInfo(ImageOp innerOp) : &lt;span style=&#34;color:#66d9ef&#34;&gt;base&lt;/span&gt;(innerOp)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; Image Execute(Image image)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; (Graphics g = Graphics.FromImage(_innerOp.Execute(image)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; info = String.Format( &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{0}x{1}&amp;#34;&lt;/span&gt;, image.Width, image.Height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            g.DrawString( info, _drawFont, _drawBrush, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; image;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用 Reflector 查了 System.Drawing.Graphics.FromImage() 的實作：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; Graphics FromImage(Image image)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (image == &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ArgumentNullException(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;image&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((image.PixelFormat &amp;amp;amp; PixelFormat.Indexed) != PixelFormat.Undefined)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Exception(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        SR.GetString(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GdiplusCannotCreateGraphicsFromIndexedPixelFormat&amp;#34;&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IntPtr ptr1 = IntPtr.Zero;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; num1 = SafeNativeMethods.GdipGetImageGraphicsContext(&lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; HandleRef(image, image.nativeImage), &lt;span style=&#34;color:#66d9ef&#34;&gt;out&lt;/span&gt; ptr1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (num1 != &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; SafeNativeMethods.StatusException(num1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Graphics(ptr1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這段程式碼的作者好歹也用個 ArgumentException 吧。只好暫時用下列方式避免：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; Image Execute(Image image)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((image.PixelFormat &amp;amp; PixelFormat.Indexed) != PixelFormat.Undefined)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; image; &lt;span style=&#34;color:#75715e&#34;&gt;// do nothing.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因為我不想寫這麼醜的code：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; Image Execute(Image image)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (Exception ex)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// We will ignore ALL EXCEPTIONS (synchronous or asynchronous).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; image;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>C&#43;&#43; Coding Standards</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-23-202/</link>
      <pubDate>Tue, 23 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-23-202/</guid>
      <description>&lt;p&gt;預覽 Herb Sutter 及 Andrei Alexandrescu 的新書《&lt;a href=&#34;http://www.artima.com/cppsource/codestandards.html&#34;&gt;C++ Coding Standards&lt;/a&gt;》。&lt;/p&gt;
&lt;p&gt;還沒有機會去書店買，但從 &lt;a href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/0321113586/002-8340650-8752853?v=glance&#34;&gt;Amazon.com 裡的評論&lt;/a&gt;看來，這本書與 Effective C++ 似乎頗有互補作用。&lt;/p&gt;
&lt;ol start=&#34;0&#34;&gt;
&lt;li&gt;Don’t sweat the small stuff. (Or: Know what not to standardize.) 2&lt;/li&gt;
&lt;li&gt;Compile cleanly at high warning levels. 4&lt;/li&gt;
&lt;li&gt;Use an automated build system. 7&lt;/li&gt;
&lt;li&gt;Use a version control system. 8&lt;/li&gt;
&lt;li&gt;Invest in code reviews. 9&lt;/li&gt;
&lt;li&gt;Give one entity one cohesive responsibility. 12&lt;/li&gt;
&lt;li&gt;Correctness, simplicity, and clarity come first. 13&lt;/li&gt;
&lt;li&gt;Know when and how to code for scalability. 14&lt;/li&gt;
&lt;li&gt;Don’t optimize prematurely. 16&lt;/li&gt;
&lt;li&gt;Don’t pessimize prematurely. 18&lt;/li&gt;
&lt;li&gt;Minimize global and shared data. 19&lt;/li&gt;
&lt;li&gt;Hide information. 20&lt;/li&gt;
&lt;li&gt;Know when and how to code for concurrency. 21&lt;/li&gt;
&lt;li&gt;Ensure resources are owned by objects. Use explicit RAII and smart pointers. 24&lt;/li&gt;
&lt;li&gt;Prefer compile- and link-time errors to run-time errors. 28&lt;/li&gt;
&lt;li&gt;Use const proactively. 30&lt;/li&gt;
&lt;li&gt;Avoid macros. 32&lt;/li&gt;
&lt;li&gt;Avoid magic numbers. 34&lt;/li&gt;
&lt;li&gt;Declare variables as locally as possible. 35&lt;/li&gt;
&lt;li&gt;Always initialize variables. 36&lt;/li&gt;
&lt;li&gt;Avoid long functions. Avoid deep nesting. 38&lt;/li&gt;
&lt;li&gt;Avoid initialization dependencies across compilation units. 39&lt;/li&gt;
&lt;li&gt;Minimize definitional dependencies. Avoid cyclic dependencies. 40&lt;/li&gt;
&lt;li&gt;Make header files self-sufficient. 42&lt;/li&gt;
&lt;li&gt;Always write internal #include guards. Never write external #include guards. 43&lt;/li&gt;
&lt;li&gt;Take parameters appropriately by value, (smart) pointer, or reference. 46&lt;/li&gt;
&lt;li&gt;Preserve natural semantics for overloaded operators. 47&lt;/li&gt;
&lt;li&gt;Prefer the canonical forms of arithmetic and assignment operators. 48&lt;/li&gt;
&lt;li&gt;Prefer the canonical form of ++ and &amp;ndash;. Prefer calling the prefix forms. 50&lt;/li&gt;
&lt;li&gt;Consider overloading to avoid implicit type conversions. 51&lt;/li&gt;
&lt;li&gt;Avoid overloading &amp;amp;&amp;amp;, ||, or , (comma). 52&lt;/li&gt;
&lt;li&gt;Don’t write code that depends on the order of evaluation of function arguments. 54&lt;/li&gt;
&lt;li&gt;Be clear what kind of class you’re writing. 56&lt;/li&gt;
&lt;li&gt;Prefer minimal classes to monolithic classes. 57&lt;/li&gt;
&lt;li&gt;Prefer composition to inheritance. 58&lt;/li&gt;
&lt;li&gt;Avoid inheriting from classes that were not designed to be base classes. 60&lt;/li&gt;
&lt;li&gt;Prefer providing abstract interfaces. 62&lt;/li&gt;
&lt;li&gt;Public inheritance is substitutability. Inherit, not to reuse, but to be reused. 64&lt;/li&gt;
&lt;li&gt;Practice safe overriding. 66&lt;/li&gt;
&lt;li&gt;Consider making virtual functions nonpublic, and public functions nonvirtual. 68&lt;/li&gt;
&lt;li&gt;Avoid providing implicit conversions. 70&lt;/li&gt;
&lt;li&gt;Make data members private, except in behaviorless aggregates (C-style structs). 72&lt;/li&gt;
&lt;li&gt;Don’t give away your internals. 74&lt;/li&gt;
&lt;li&gt;Pimpl judiciously. 76&lt;/li&gt;
&lt;li&gt;Prefer writing nonmember nonfriend functions. 79&lt;/li&gt;
&lt;li&gt;Always provide new and delete together. 80&lt;/li&gt;
&lt;li&gt;If you provide any class-specific new, provide all of the standard forms (plain, in-place, and nothrow). 82&lt;/li&gt;
&lt;li&gt;Define and initialize member variables in the same order. 86&lt;/li&gt;
&lt;li&gt;Prefer initialization to assignment in constructors. 87&lt;/li&gt;
&lt;li&gt;Avoid calling virtual functions in constructors and destructors. 88&lt;/li&gt;
&lt;li&gt;Make base class destructors public and virtual, or protected and nonvirtual. 90&lt;/li&gt;
&lt;li&gt;Destructors, deallocation, and swap never fail. 92&lt;/li&gt;
&lt;li&gt;Copy and destroy consistently. 94&lt;/li&gt;
&lt;li&gt;Explicitly enable or disable copying. 95&lt;/li&gt;
&lt;li&gt;Avoid slicing. Consider Clone instead of copying in base classes. 96&lt;/li&gt;
&lt;li&gt;Prefer the canonical form of assignment. 99&lt;/li&gt;
&lt;li&gt;Whenever it makes sense, provide a no-fail swap (and provide it correctly). 100&lt;/li&gt;
&lt;li&gt;Keep a type and its nonmember function interface in the same namespace. 104&lt;/li&gt;
&lt;li&gt;Keep types and functions in separate namespaces unless they’re specifically intended to work together. 106&lt;/li&gt;
&lt;li&gt;Don’t write namespace usings in a header file or before an #include. 108&lt;/li&gt;
&lt;li&gt;Avoid allocating and deallocating memory in different modules. 111&lt;/li&gt;
&lt;li&gt;Don’t define entities with linkage in a header file. 112&lt;/li&gt;
&lt;li&gt;Don’t allow exceptions to propagate across module boundaries. 114&lt;/li&gt;
&lt;li&gt;Use sufficiently portable types in a module’s interface. 116&lt;/li&gt;
&lt;li&gt;Blend static and dynamic polymorphism judiciously. 120&lt;/li&gt;
&lt;li&gt;Customize intentionally and explicitly. 122&lt;/li&gt;
&lt;li&gt;Don’t specialize function templates. 126&lt;/li&gt;
&lt;li&gt;Don’t write unintentionally nongeneric code. 128&lt;/li&gt;
&lt;li&gt;Assert liberally to document internal assumptions and invariants. 130&lt;/li&gt;
&lt;li&gt;Establish a rational error handling policy, and follow it strictly. 132&lt;/li&gt;
&lt;li&gt;Distinguish between errors and non-errors. 134&lt;/li&gt;
&lt;li&gt;Design and write error-safe code. 137&lt;/li&gt;
&lt;li&gt;Prefer to use exceptions to report errors. 140&lt;/li&gt;
&lt;li&gt;Throw by value, catch by reference. 144&lt;/li&gt;
&lt;li&gt;Report, handle, and translate errors appropriately. 145&lt;/li&gt;
&lt;li&gt;Avoid exception specifications. 146&lt;/li&gt;
&lt;li&gt;Use vector by default. Otherwise, choose an appropriate container. 150&lt;/li&gt;
&lt;li&gt;Use vector and string instead of arrays. 152&lt;/li&gt;
&lt;li&gt;Use vector (and string::c_str) to exchange data with non-C++ APIs. 153&lt;/li&gt;
&lt;li&gt;Store only values and smart pointers in containers. 154&lt;/li&gt;
&lt;li&gt;Prefer push_back to other ways of expanding a sequence. 155&lt;/li&gt;
&lt;li&gt;Prefer range operations to single-element operations. 156&lt;/li&gt;
&lt;li&gt;Use the accepted idioms to really shrink capacity and really erase elements. 157&lt;/li&gt;
&lt;li&gt;Use a checked STL implementation. 160&lt;/li&gt;
&lt;li&gt;Prefer algorithm calls to handwritten loops. 162&lt;/li&gt;
&lt;li&gt;Use the right STL search algorithm. 165&lt;/li&gt;
&lt;li&gt;Use the right STL sort algorithm. 166&lt;/li&gt;
&lt;li&gt;Make predicates pure functions. 168&lt;/li&gt;
&lt;li&gt;Prefer function objects over functions as algorithm and comparer arguments. 170&lt;/li&gt;
&lt;li&gt;Write function objects correctly. 172&lt;/li&gt;
&lt;li&gt;Avoid type switching; prefer polymorphism. 174&lt;/li&gt;
&lt;li&gt;Rely on types, not on representations. 176&lt;/li&gt;
&lt;li&gt;Avoid using reinterpret_cast. 177&lt;/li&gt;
&lt;li&gt;Avoid using static_cast on pointers. 178&lt;/li&gt;
&lt;li&gt;Avoid casting away const. 179&lt;/li&gt;
&lt;li&gt;Don’t use C-style casts. 180&lt;/li&gt;
&lt;li&gt;Don’t memcpy or memcmp non-PODs. 182&lt;/li&gt;
&lt;li&gt;Don’t use unions to reinterpret representation. 183&lt;/li&gt;
&lt;li&gt;Don’t use varargs (ellipsis). 184&lt;/li&gt;
&lt;li&gt;Don’t use invalid objects. Don’t use unsafe functions. 185&lt;/li&gt;
&lt;li&gt;Don’t treat arrays polymorphically. 186&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>beforefieldinit</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-16-200/</link>
      <pubDate>Tue, 16 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-16-200/</guid>
      <description>&lt;p&gt;兩篇文章讓你可以把 static initializer, static constructor, 及 beforefieldinit 的觀念搞清楚：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.yoda.arachsys.com/csharp/singleton.html&#34;&gt;Implementing the Singleton Pattern in C#&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.yoda.arachsys.com/csharp/beforefieldinit.html&#34;&gt;C# and beforefieldinit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;兩篇文章都是出自於 &lt;a href=&#34;http://www.yoda.arachsys.com/&#34;&gt;Jon Skeet&lt;/a&gt; 的網站，裡面還有一些很&lt;a href=&#34;http://www.yoda.arachsys.com/csharp/&#34;&gt;不錯的 .NET 技術文章&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>IanG on .NET Multi-thread Programming</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-14-199/</link>
      <pubDate>Sun, 14 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-14-199/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/&#34;&gt;Ian Griffiths&lt;/a&gt; 寫了不少關於 .NET multi-thread programming 的文章：&lt;/p&gt;
&lt;p&gt;《&lt;A href=&#34;http://www.interact-sw.co.uk/iangblog/2004/04/20/whatlocks&#34;&gt;What Locks Are You Holding Right Now?&lt;/A&gt;》 解釋了 deadlock 發生的時機，以及兩個常用的規則來避免之：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;avoid blocking the UI thread.&lt;/li&gt;
&lt;li&gt;avoid making other threads wait for the UI thread to do something.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/03/23/locking&#34;&gt;Monitor.TryEnter, lock, using, and Deadlock&lt;/a&gt;》解釋如何用 using 語法來實作限時的等待。類似的手法也可以應用在 ReaderWriterLock。(參考 &lt;a href=&#34;http://blog.joecheng.com/archives/000025.html&#34;&gt;Stupid &amp;ldquo;using&amp;rdquo; Tricks&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/04/26/rwlockvsmonitor&#34;&gt;ReaderWriterLock vs Monitor&lt;/a&gt;》解釋了為什麼使用 ReaderWriterLock 通常是一種過早的最佳化 (premature optimization)。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/08/17/anonirq&#34;&gt;Locking, Anonymous Delegates, and Interrupts&lt;/a&gt;》說明了一般同步機制所使用的 &amp;ldquo;acquire, do, release&amp;rdquo; 模式的缺點，也順帶點出 KeSynchronizeExecution 存在的原因。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/08/17/badsynclocking&#34;&gt;When Synchronous Locking Goes Bad&lt;/a&gt;》是前一篇的延續，點出另一個 &amp;ldquo;acquire, do, release&amp;rdquo; 不適用的時機，以及 ISynchronizeInvoke 模式如何弭補這缺陷。簡而言之，ISynchronizeInvoke 是個比 &amp;ldquo;acquire, do, release&amp;rdquo; 更抽象、適用範圍更廣的同步模式。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/11/12/cancellation&#34;&gt;How To Stop a Thread in .NET&lt;/a&gt;》解釋了如何正確地停止一個 thread 以及為何 Thread.Abort 是邪惡的。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/09/23/threadless&#34;&gt;Doing Work Without Threads &lt;/a&gt;》解釋了如何應用一些非同步呼叫來避免不必要的 thread 創建。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/06/21/dotnetthreadid&#34;&gt;Thread IDs and .NET&lt;/a&gt;》解釋 logic thread 跟 physical thread 的不同，並說明如何識別某一個特定的 thread。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Knowing x86 machine code</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-13-198/</link>
      <pubDate>Sat, 13 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-13-198/</guid>
      <description>&lt;p&gt;有 crack 過一些軟體的人應該都知道這樣的技巧吧：&lt;A href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/11/11/255800.aspx&#34;&gt;Advantages of knowing your x86 machine code&lt;/A&gt;。Comment 中提到的 Ctrl-F11 切換 source code 與 disassembly code 的技巧還蠻方便的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Java theory and practice</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-02-193/</link>
      <pubDate>Tue, 02 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-02-193/</guid>
      <description>&lt;p&gt;想要對 Effective Java 裡面的課題有更多探討的人，可以參考 Brian Goetz 在 developerWorks 的專欄 &lt;A href=&#34;http://www-106.ibm.com/developerworks/views/java/articles.jsp?sort_order=desc&amp;amp;expand=&amp;amp;sort_by=Date&amp;amp;show_abstract=true&amp;amp;view_by=Search&amp;amp;search_by=practice%3A&#34;&gt;Java theory and practice&lt;/A&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Effective Java</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-11-01-192/</link>
      <pubDate>Mon, 01 Nov 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-11-01-192/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://www.cmlab.csie.ntu.edu.tw/cml/db/ssb.htm&#34;&gt;我的上一次 Java programming 經驗&lt;/A&gt;已經是將近六年前的事了，JDK 那時才剛從 1.0 版升級至 1.1，後來因為工作內容的關係，C++ 才變成是我最常使用的程式語言。&lt;/p&gt;
&lt;p&gt;前一陣子逛書店時瞄到了 Joshua Bloch 的《&lt;A href=&#34;http://www.amazon.com/exec/obidos/ASIN/0201310058/ref%3Dase%5FjavasoftsunmicroA/104-6121513-6909566&#34;&gt;Effective Java Programming Language Guide&lt;/A&gt;》居然有&lt;A href=&#34;http://www.jjhou.com/jjtbooks-effective-java.htm&#34;&gt;中文版&lt;/A&gt;，原文的版本我是聞名已久卻沒空拜讀。我一看是&lt;A href=&#34;http://www.jjhou.com&#34;&gt;侯捷&lt;/A&gt;翻譯的作品，二話不說便掏錢買下這本書，直到最近，我一時興起才把它讀完。&lt;/p&gt;
&lt;p&gt;就內容而言，這本書絕對有資格跟《Effective C++》享有一樣的經典地位，不僅 Java programmer 要看，.NET programmer 也應該人手一本，因為其中的許多物件導向編程的道理是同時適用於 Java 與 .NET。中文版裡不通順或是有錯誤的地方倒是比我期待的數目多了一點，不過我想侯捷應該是不介意別人用高標準來檢驗他的作品。&lt;/p&gt;
&lt;p&gt;下面是我發現的一些翻譯問題：&lt;/p&gt;
&lt;TABLE class=&#34;table&#34;&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: Not only can the class of an object returned by a public static factory method be nonpublic, but the class can vary from invocation to invocation depending on the values of the parameters to the static factory.&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p7: public static factory method 傳回的物件不僅可以是個 nonpublic class 物件，而且視 static factory 函式參數的不同，還可以涉及不同的 nonpublic class ...&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;這一句翻得有點繞口，不是讓人一看就明白，我自己試著翻譯為 &#34;public static factory method&amp;nbsp; 返回物件的 class 不僅可以是 nonpublic，而且視函式參數的不同，還可以返回不同的 class ...&#34;&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: In particular, the hash function may, in practice, be confronted with a large collection of instances that differ largely in the regions that you&#39;ve chosen to ignore.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p40: 更具體地說，實際應用時 hash 函式可能會面臨大量「在你刻意忽略的&lt;FONT color=&#34;#ff0000&#34;&gt;領域&lt;/FONT&gt;中仍有很大差異」的物件實體。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;我想「領域」直接翻成「部份」會比較容易懂。&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: Note that string names are used only by the toString method; they are not used for equality comparisons, as the equals implementation, which is inherited from Object, performs a reference identity&lt;BR&gt;comparison.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p106: 注意:字串名稱只由 toString() 使用，並不用於「相等比較」，也就是說並不用於繼承自 Object 的 equals() (該函式執行的是 reference 的比較)。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;譯文似乎有點誤導，我認為應該譯為 &#34;字串名稱只由 toString() 使用，並不用於「相等比較」，因為繼承自 Object 的 equals() 執行的正是預期的 reference 比較。&#34;&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: Second, it is possible to return the same zero-length array from every invocation that returns no items ...&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p134: 第二，對於「不傳回任何 array 元素」的呼叫，傳回同一個「長度為 0 的array」是可能的&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;正確的翻譯為: 對於數次「沒有任何 array 元素可傳回」的呼叫，傳回同一個「長度為 0 的array」是適切的&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: By convention, the word “this”always refers to the object on which the method is invoked when it is used in the doc comment for an instance method.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p138: 習慣上當 &#34;this&#34; 出現於一個 instance 函式的 doc comment 時，總是用來表示&lt;FONT color=&#34;#ff0000&#34;&gt;該函式的呼叫者(某物件)&lt;/FONT&gt;。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;正確的翻譯為: &#34;習慣上當 this 出現於一個 instance 函式的 doc comment 時，總是用來表示該函式所屬的 instance。&#34;&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: This could be construed as an IllegalArgumentException (the handSize parameter value is too high) or an IllegalStateException (the deck object contains too few cards for the request). In this case the IllegalArgumentException feels right, but there are no hard-and-fast rules.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p177: 這種情形可被解釋為 IllegalArgumentException (...) 或被解釋為 IllegalStateException (...)，或者使用 IllegalArgumentException 也適當；是的，這其中並沒有嚴格的規定。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;我覺得比較容易懂的翻譯為: 這種情形可被解釋為 IllegalArgumentException 或 IllegalStateException。在這個例子，似乎使用 IllegalArgumentException 是比較適當的，但這並不是唯一的標準答案。&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: It makes it easy for the programmer throwing an exception to capture the failure. In fact, it makes it hard for the programmer not to capture the failure!&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p184: 這種作法使得程式員可輕易「藉由拋出異常來&lt;FONT color=&#34;#ff0000&#34;&gt;捕獲失敗&lt;/FONT&gt;」。事實上這種手法使得程式員不&lt;FONT color=&#34;#ff0000&#34;&gt;捕捉失敗&lt;/FONT&gt;都很困難。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;我想原文的 capture the failure 指的是「記錄失敗情況下的資訊」，比較正確的翻譯應該是:&amp;nbsp; &#34;這種作法使得程式員可輕易「藉由拋出異常來記錄失敗情況下的資訊」。換句話說，這種手法也使得程式員不得不記錄失敗情況下的資訊。&#34;&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: A closely related approach to achieving failure atomicity is to order the computation&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p185: 另一個實現 failure atomocity 的辦法是「對運算&lt;FONT color=&#34;#ff0000&#34;&gt;排序&lt;/FONT&gt;」&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;排序一般指的是 sort，這句譯成「更動運算的次序」比較符合原義。&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: The newly created thread might then try to acquire the same lock held by the original thread, which would cause the newly created thread to block.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p196: 新建執行緒&lt;FONT color=&#34;#ff0000&#34;&gt;可能獲得&lt;/FONT&gt;原執行緒持有的鎖件，這便造成新建執行緒被阻塞。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;正確的翻譯為: &#34;新建執行緒可能嘗試獲得已被原執行緒持有的鎖件，這便造成新建執行緒被阻塞。&#34;&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: Because locks in the Java programming language are recursive, such calls won&#39;t deadlock as they would if they were made by another thread.&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p199: 由於 Java 編程中的鎖件是遞迴的，如果這些呼叫由其他執行緒產生，並不會造成死結。&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;正確的翻譯為: 由於 Java 編程中的鎖件是遞迴的，這些呼叫並不像「由其他執行緒產生的呼叫」會產生死結。&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P&gt;&lt;FONT color=&#34;#0000ff&#34;&gt;原文: A second approach, suitable for classes that are not designed to be extended or reimplemented ...&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;&lt;FONT color=&#34;#666666&#34;&gt;譯文 p200: 第二種辦法適用於那些&lt;FONT color=&#34;#ff0000&#34;&gt;不是並非&lt;/FONT&gt;為了擴展或重新實作而設計的class&lt;/FONT&gt;&lt;/P&gt;
&lt;P&gt;正確的翻譯為: &#34;第二種辦法適用於那些非設計為可擴展或可重新實作的class&#34;。&lt;/P&gt;
&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;
</description>
    </item>
    
    <item>
      <title>Dilbert on Extreme Programming</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-10-12-185/</link>
      <pubDate>Tue, 12 Oct 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-10-12-185/</guid>
      <description>&lt;p&gt;註：原圖來自於 &lt;A href=&#34;http://dilbert.com &#34;&gt;dilbert.com&lt;/A&gt; 於 2003/01/09 及 2003/01/10 刊載的漫畫，但原網站已經移除原圖的鏈結。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Grady Booch&#39;s Blog</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-10-11-184/</link>
      <pubDate>Mon, 11 Oct 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-10-11-184/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://www.booch.com/architecture/blog.jsp&#34;&gt;Grady Booch 的 blog &lt;/A&gt;有一些精采的簡報：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;A href=&#34;http://www.booch.com/architecture/blog/artifacts/Software%20Architecture.ppt&#34;&gt;General Software Architecture&lt;/A&gt;&lt;/li&gt;
&lt;li&gt;&lt;A href=&#34;http://www.booch.com/architecture/blog/artifacts/Software%20Archeology.ppt&#34;&gt;Software Archeology&lt;/A&gt;&lt;/li&gt;
&lt;li&gt;&lt;A href=&#34;http://www.booch.com/architecture/blog/artifacts/Strachey%20Lecture%20(egb).ppt&#34;&gt;The Limits of Software&lt;/A&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Applied .NET Attributes</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-10-04-183/</link>
      <pubDate>Mon, 04 Oct 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-10-04-183/</guid>
      <description>&lt;p&gt;《&lt;A href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/1590591364/102-8373197-5394511?v=glance&#34;&gt;Applied .NET Attributes&lt;/A&gt;》是本有趣的書：精簡而專注。精簡是因為它只有短短的 232 頁；專注則是因為 custom attributes 是它的唯一主題。一開始我蠻訝異會有這樣主題的書籍出現，但仔細想了一下，custom attributes 的確是 .NET 中最值得討論的一個技術，因為它帶來了許多創新的可能性。&lt;/p&gt;
&lt;p&gt;這本書在第一二三章首先解釋 attribute 的基本精神以及它在 compile-time, design-time, 及 runtime 所能發揮的功用。我尤其喜歡第四章中關於 &lt;A href=&#34;http://www.google.com/search?hl=en&amp;amp;q=ContextBoundObject&amp;amp;btnG=Search&amp;amp;lr=&#34;&gt;ContextBoundObject&lt;/A&gt; 以及 AOP 的討論，這一章釐清了我以前不甚明白的一些概念。對於如何在 .NET 的環境實現 AOP 的人可以也參考下面這兩篇在 MSDN Magazine 的文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;A href=&#34;http://msdn.microsoft.com/msdnmag/issues/02/03/AOP/default.aspx&#34;&gt;Aspect-Oriented Programming Enables Better Code Encapsulation and Reuse&lt;/A&gt;&lt;/li&gt;
&lt;li&gt;&lt;A href=&#34;http://msdn.microsoft.com/msdnmag/issues/03/03/contextsinnet/&#34;&gt;Decouple Components by Injecting Custom Services into Your Object&amp;rsquo;s Interception Chain&lt;/A&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>.NET is better than COM</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-09-04-181/</link>
      <pubDate>Sat, 04 Sep 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-09-04-181/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://www.theserverside.net/cartoons/TalesFromTheServerSide.tss&#34;&gt;Top 10 Reasons .NET is better than COM&lt;/A&gt; 很幽默地消遣了 Don Box&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Data Binding in Avalon</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-31-180/</link>
      <pubDate>Tue, 31 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-31-180/</guid>
      <description>&lt;p&gt;A good introduction to the &lt;A href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnintlong/html/longhornintrotoc.asp&#34;&gt;data binding&lt;/A&gt; mechanism in Avalon.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>&#34;,hr&#34;</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-30-179/</link>
      <pubDate>Mon, 30 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-30-179/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://weblogs.asp.net/matt_pietrek/archive/2004/07/14/183084.aspx&#34;&gt;Matt Pietrek 居然不知道 &amp;ldquo;,hr&amp;rdquo; 的用法!&lt;/A&gt; 如同這個 blog entry 的第一篇評論，我感到蠻驚訝的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Coroutine implementation in C# 2.0</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-30-178/</link>
      <pubDate>Mon, 30 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-30-178/</guid>
      <description>&lt;p&gt;Matt Pietrek 的《&lt;A href=&#34;http://blogs.msdn.com/matt_pietrek/archive/2004/07/26/197242.aspx&#34;&gt;Fun
with Iterators and state machines&lt;/A&gt;》解釋了 C# 2.0 如何使用 state machine 來實現 coroutine。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Dependency properties</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-30-177/</link>
      <pubDate>Mon, 30 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-30-177/</guid>
      <description>&lt;p&gt;剛接觸 Avalon 的人可能會對所謂的 Dependency properties 感到困惑 ，在《&lt;A href=&#34;http://weblogs.asp.net/dmarsh/archive/2003/12/01/40588.aspx&#34;&gt;Three Extensibility Models: A Bad Thing?&lt;/A&gt;》裡，Drew 清楚地解釋 Attached properties (一種特別的 &lt;A href=&#34;http://longhorn.msdn.microsoft.com/lhsdk/core/overviews/dp_tutorial.aspx&#34;&gt;Dependency properties&lt;/A&gt;) 的用法及原理。&lt;/p&gt;
&lt;p&gt;懂了 Attached properties 後可以再參考 Wesner Moise 的《&lt;A href=&#34;http://wesnerm.blogs.com/net_undocumented/2004/08/dynamic_propert.html&#34;&gt;Dynamic Properties and Code Generation&lt;/A&gt;》來了解 Dynamic properties 的概念。&lt;/p&gt;
&lt;p&gt;最後《&lt;A href=&#34;http://longhorn.msdn.microsoft.com/?//longhorn.msdn.microsoft.com/lhsdk/port_tech_xaml.aspx&#34;&gt;Core Concepts of the Presentation Subsystem (code-named &amp;ldquo;Avalon&amp;rdquo;)&lt;/A&gt;》可以讓你透視 Dependency properties 的目的，也就是實現下列這些機制： styling, databinding, animation, default values, value expressions, property invalidations, and inherence。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My Shopping Cart for Technical Books</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-30-176/</link>
      <pubDate>Mon, 30 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-30-176/</guid>
      <description>&lt;p&gt;下面是這次美國行要採購的書籍清單:&lt;/p&gt;
&lt;table class=&#34;table&#34;&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/0201745682.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0201745682%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Pragmatic ADO.NET: Data Access for the Internet World&lt;/a&gt; by Shawn Wildermuth&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/0321126971.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0321126971%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Design Patterns C#&lt;/a&gt; by Steven John Metsker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/078214327X.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/078214327X%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Coder to Developer: Tools and Strategies for Delivering Your Software&lt;/a&gt; by Mike Gunderloy, Sybex&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/0735619670.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0735619670%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Code Complete, Second Edition&lt;/a&gt; by Steve McConnell&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/0974514039.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.amazon.com/gp/product/0974514039%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Pragmatic Project Automation: How to Build, Deploy, and Monitor Java Apps&lt;/a&gt; by Mike Clark&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&#34;//images.amazon.com/images/P/1590591372.01.THUMBZZZ.jpg&#34; border=&#34;0&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;//www.amazon.com/gp/product/1590591372%3ftag=kalsey-20%26link_code=xm2%26camp=2025%26dev-t=D3N456YOPQ5G79&#34;&gt;Code Generation in Microsoft .NET&lt;/a&gt; by Kathleen Dollard&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Add-ins for Reflector</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-26-175/</link>
      <pubDate>Thu, 26 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-26-175/</guid>
      <description>&lt;p&gt;之前的文章有提過 Lutz Roeder 的 &lt;A href=&#34;http://www.aisto.com/roeder/dotnet/&#34;&gt;Reflector&lt;/A&gt;，最近它已成為我每天必用的工具。這麼棒的東西想當然愛用者不只我一個人，有許多人已經開始為它&lt;A href=&#34;http://www.google.com/search?hl=en&amp;amp;ie=UTF-8&amp;amp;q=reflector+add-in&amp;amp;btnG=Search&amp;amp;lr=&#34;&gt;擴充新的功能&lt;/A&gt;，例如：&lt;/p&gt;
&lt;p&gt;&lt;A class=&#34;large&#34; href=&#34;http://www.denisbauer.com/NETTools/FileDisassembler.aspx&#34;&gt;Reflector.FileDisassembler&lt;/A&gt;&lt;/p&gt;
&lt;p&gt;&lt;A href=&#34;http://blog.dotnetwiki.org/category/21.aspx&#34;&gt;Reflector.Graph&lt;/A&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>XAML &amp; Avalon</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-14-173/</link>
      <pubDate>Sat, 14 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-14-173/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://www.ondotnet.com/pub/au/980&#34;&gt;Ian Griffiths&lt;/A&gt;&amp;rsquo;s articles about XAML and Avalon:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;A href=&#34;http://www.oreillynet.com/pub/a/dotnet/2004/01/19/longhorn.html&#34;&gt;Inside XAML&lt;/A&gt;&lt;/li&gt;
&lt;li&gt;&lt;A href=&#34;http://www.oreillynet.com/pub/a/dotnet/2004/03/08/winfs_detail_3.html&#34;&gt;Graphical Composition in Avalon&lt;/A&gt;Besides, &lt;A href=&#34;http://weblogs.asp.net/dmarsh/articles/40513.aspx&#34;&gt;Avalon Dissected&lt;/A&gt; is a series of articles about the architecture of Avalon. IMO, Avalon will enable Windows programmers to develop much richer applications than the ones we have today. It will change how we think about Windows application. I am excited about that. :-)&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Minidump</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-08-10-172/</link>
      <pubDate>Tue, 10 Aug 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-08-10-172/</guid>
      <description>&lt;p&gt;Some links about minidump:&lt;/p&gt;
&lt;p&gt;John Robbins - &lt;A href=&#34;http://msdn.microsoft.com/msdnmag/issues/02/06/Bugslayer/default.aspx&#34;&gt;Symbols and Crash Dumps&lt;/A&gt;&lt;BR&gt;Matt Pietrek - &lt;A href=&#34;http://msdn.microsoft.com/msdnmag/issues/02/03/hood/default.aspx&#34;&gt;Improved Error Reporting with DBGHELP 5.1 APIs&lt;/A&gt;&lt;BR&gt;Andy Pennell - &lt;A href=&#34;http://www.codeproject.com/debug/postmortemdebug_standalone1.asp&#34;&gt;Post-Mortem Debugging Your Application&amp;hellip;&lt;/A&gt;&lt;BR&gt;Kim Gräsman - &lt;A href=&#34;http://www.winwonk.com/writing/minidump/&#34;&gt;Minidumps and Security&lt;/A&gt;&lt;BR&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Comments in Windows Source Code</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-30-168/</link>
      <pubDate>Wed, 30 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-30-168/</guid>
      <description>&lt;p&gt;相信很多人看過流傳在網路上的 Windows 原始碼，有沒有注意到&lt;A href=&#34;http://www.kuro5hin.org/story/2004/2/15/71552/7795&#34;&gt;這些在原始碼裡的有趣註解&lt;/A&gt;？&lt;/p&gt;

  &lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;private\shell\shell32\util.cpp:
// the fucking alpha cpp compiler seems to fuck up the goddam type
&amp;#34;LPITEMIDLIST&amp;#34;, so to work&amp;lt;BR&amp;gt;// around the fucking peice of shit compiler we
pass the last param as an void *instead of a LPITEMIDLIST

private\windows\media\avi\verinfo.16\verinfo.h:
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!IF YOU CHANGE TABS TO SPACES, YOU WILL BE KILLED!!!!!!!
*       !!!!!!!!!!!!!!DOING SO FUCKS THE BUILD PROCESS!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

private\ntos\rtl\heap.c:
// The specific idiot in this case is Office95, which likes
// to free a random pointer when you start Word95 from a desktop
// shortcut.

private\ntos\w32\ntuser\kernel\swp.c:
* for idiots like MS-Access 2.0 who SetWindowPos( SWP_BOZO
* and blow away themselves on the shell, then lets
* just ignore their plea to be removed from the tray

private\ntos\w32\ntuser\kernel\swp.c:
* for idiots like MS-Access 2.0 who SetWindowPos( SWP_BOZO
* and blow away themselves on the shell, then lets
* just ignore their plea to be removed from the tray

private\inet\mshtml\src\core\cdbase\baseprop.cxx:
// HACK! HACK! HACK! (MohanB) In order to fix #64710 at this very late
private\inet\mshtml\src\core\cdutil\genutil.cxx:
// HACK HACK HACK. REMOVE THIS ONCE MARLETT IS AROUND

private\inet\mshtml\src\other\moniker\resprot.cxx:
//
goto EndHack;
//

private\inet\mshtml\src\site\layout\flowlyt.cxx:
// God, I hate this hack ...

private\inet\wininet\urlcache\cachecfg.cxx:
// Dumb hack for back compat. *sigh*

private\inet\wininet\urlcache\filemgr.cxx:
// ACHTUNG!!! this is a special hack for IBM antivirus software

private\ispu\pkitrust\trustui\acuictl.cpp:
// HACK ALERT, believe it or not there is no way to get the height of the current
// HACK ON TOP OF HACK ALERT,

private\ntos\udfs\devctrl.c:
// Add the hack-o-ramma to fix formats.

private\shell\shdoc401\unicpp\sendto.cpp:
// Mondo hackitude-o-rama.

private\ntos\w32\ntcon\server\link.c:
// HUGE, HUGE hack-o-rama to get NTSD started on this process!

private\ntos\w32\ntuser\client\dlgmgr.c:
// HACK OF DEATH:

private\shell\lib\util.cpp:
// TERRIBLE HORRIBLE NO GOOD VERY BAD HACK

private\ntos\w32\ntuser\client\nt6\user.h:
* The magnitude of this hack compares favorably with that of the national debt.&lt;/code&gt;&lt;/pre&gt;

</description>
    </item>
    
    <item>
      <title>Programming Quotes from WikiQuote</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-30-167/</link>
      <pubDate>Wed, 30 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-30-167/</guid>
      <description>&lt;p&gt;Programmer 真的是一個很怪的族群，因為他們看到這些對平常人根本是無厘頭的話居然會覺得好笑：&lt;/p&gt;
&lt;p&gt;&amp;ldquo;God is Real, unless declared Integer&amp;rdquo; - J.Allan Toogood, FORTRAN programmer&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Pascal keeps your hand tied. C gives you enough rope to hang yourself.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;He who hasn&amp;rsquo;t hacked assemply language as a youth has no heart. He who does as an adult has no brain.&amp;rdquo; - John Moore&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Real programmers can write assembly code in any language.&amp;rdquo; - Larry Wall&lt;/p&gt;
&lt;p&gt;&amp;ldquo;In C++ it&amp;rsquo;s harder to shoot yourself in the foot, but when you do, you blow off your whole leg&amp;rdquo; - Bjarne Stroustrup&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.&amp;rdquo; - Brian W. Kernighan&lt;/p&gt;
&lt;p&gt;&amp;ldquo;If debugging is the process of removing bugs, then programming must be the process of putting them in.&amp;rdquo; - Edsger Dijkstra&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Real Programmers always confuse Christmas and Halloween because Oct31 == Dec25&amp;rdquo; - Andrew Rutherford&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Real Programmers don&amp;rsquo;t write in PASCAL, or BLISS, or ADA, or any of those pinko computer science languages. Strong typing is for people with weak memories.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Real Programmers don&amp;rsquo;t write in LISP. Only idiots&amp;rsquo; programs contain more parenthesis than actual code.&amp;rdquo;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The BASIC Programming Language</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-30-166/</link>
      <pubDate>Wed, 30 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-30-166/</guid>
      <description>&lt;p&gt;&amp;ldquo;It is practically impossible to teach good programming to students that have had a prior exposure to BASIC: as potential programmers they are mentally mutilated beyond hope of regeneration.&amp;rdquo; - Edsger Dijkstra&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Teaching BASIC should be a criminal offense.&amp;rdquo; - Edsger Dijkstra&lt;/p&gt;
&lt;p&gt;&amp;ldquo;BASIC - A programming language. Related to certain social diseases in that those who have it will not admit it in polite company.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Real Programmers don&amp;rsquo;t write in BASIC. Actually, no programmers write in BASIC&amp;hellip; after age twelve.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;上面有關 BASIC 的評論是在 &lt;A href=&#34;http://wikiquote.org/&#34;&gt;Wikiquote&lt;/A&gt; 找到的。當然別太嚴肅地對待這些話，我想作者只是純粹幽默而誇張地表達了大多數人對於 BASIC 的看法。 &lt;BR&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>.NET, Just for Fun</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-24-165/</link>
      <pubDate>Thu, 24 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-24-165/</guid>
      <description>&lt;p&gt;好久沒看過這麼精彩的文章了！Joel 在 &lt;A href=&#34;How Microsoft Lost the API War&#34;&gt;How Microsoft Lost the API War&lt;/A&gt; 裡的文筆依然犀利卻也帶著一貫的幽默。&lt;/p&gt;
&lt;p&gt;雖然我第一個學會的程式語言是 Basic，就在我厭煩了要把行號從 50 改成 100 來放入更多的程式碼時，我就移情別戀，投入了 C 的懷抱。好吧，我承認我不用 Visual Basic 的部分原因是跟它的名字裡有 &lt;STRONG&gt;Basic&lt;/STRONG&gt;  這個字有關，雖然有時候用它來開發程式真的又快又方便。因此當 C#出現時，它有著 VB 的簡單及方便性，但是語法及名字又是根源於 C 時，我就迷上它了。&lt;/p&gt;
&lt;p&gt;因此 .NET 的出現對於已經厭煩了惱人的記憶體管理的我，如同 C 與 Basic 比較起來，不啻是個極大的誘惑。對一個 programmer 而言，.NET is fun，它可以我在陰暗的 Win32 API 角落裡還看得到一絲絲的希望。至於 .NET 是不是會普及，我倒是不那麼擔心，畢竟 Microsoft 把賭注都下在上面了，就讓他們去操心好了。&lt;/p&gt;
&lt;p&gt;我覺得 Joel 有點太悲觀了，畢竟 Win32 API 仍然存在於 Longhorn 或 Windows &lt;EM&gt;N&lt;/EM&gt;；舊的 Win32 程式依然可以在 Longhorn 上執行；許多公司依然使用 Win32 API 開發 Longhorn 的程式；只是 developers 多了一種新的、可以讓 developers 少掉幾根頭髮的選擇，不是很好嗎？&lt;/p&gt;
&lt;p&gt;『Just for Fun』是我現在對 .NET 所持的態度。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>NoStepInto in VS 2003</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-17-164/</link>
      <pubDate>Thu, 17 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-17-164/</guid>
      <description>&lt;p&gt;今天發現在 Visual Studio 6 可以&lt;A href=&#34;http://www.codeguru.com/Cpp/V-S/debug/article.php/c1281&#34;&gt;用 autoexp.dat 來取消 step into&lt;/A&gt;的功能在 VS 2003 沒有作用。Google 了一下，原來是做法改了，詳情參考《 &lt;A href=&#34;http://blogs.msdn.com/andypennell/archive/2004/02/06/69004.aspx&#34;&gt;How to Not Step Into Functions using the Visual C++ Debugger&lt;/A&gt; 》。 &lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Custom Attribues and eXtensible C#</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-09-161/</link>
      <pubDate>Wed, 09 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-09-161/</guid>
      <description>&lt;p&gt;Pierre Nallet 的文章《&lt;A href=&#34;http://www.devx.com/dotnet/Article/11579/1954?pf=true&#34;&gt;Get Personal with C# Custom Attributes&lt;/A&gt;》介紹了 custom attributes 的應用。他把 custom attributes 分成了三類：user attributes, runtime attributes, 及 compile time attributes。一般常用的 &lt;A href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/cpref/html/frlrfSystemRuntimeInteropServicesStructLayoutAttributeClassTopic.asp&#34;&gt;System.Runtime.InteropServices.StructLayoutAttribute&lt;/A&gt; 就是屬於 runtime attributes，因為 JIT 是在執行時期才決定物件資料欄位的排列方式。&lt;/p&gt;
&lt;p&gt;如果你有仔細查閱 System.Diagnostics 裡面的一些 attribute class，你會發現一些有趣的 attribute 應用，如 &lt;A href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/cpref/html/frlrfsystemdiagnosticsdebuggerhiddenattributeclasstopic.asp&#34;&gt;DebuggerHiddenAttribute&lt;/A&gt; 可以阻止 debugger 設定中斷點、&lt;A href=&#34;http://msdn.microsoft.com/library/en-us/cpref/html/frlrfSystemDiagnosticsDebuggerStepThroughAttributeClassTopic.asp?frame=true&#34;&gt;DebuggerStepThroughAttribute&lt;/A&gt; 可以阻止 debugger 的 step into 功能。&lt;/p&gt;
&lt;p&gt;Pierre Nallet 同時也是 &lt;A href=&#34;http://www.resolvecorp.com/XCSharp_files/frame.htm&#34;&gt;eXtensible C# (XC#)&lt;/A&gt; 的作者。&lt;/p&gt;
&lt;p&gt;對 Attributed Programming 有興趣的人可以參考《&lt;A href=&#34;http://www.apress.com/book/bookDisplay.html?bID=227&#34;&gt;Applied .NET Attributes&lt;/A&gt;》這本書。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Enjoy Code</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-04-160/</link>
      <pubDate>Fri, 04 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-04-160/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://blog.joycode.com/&#34;&gt;博客堂 (&lt;a href=&#34;http://blog.joycode.com/&#34;&gt;http://blog.joycode.com/&lt;/a&gt;)&lt;/A&gt; 有蠻多對岸的 .NET 技術人員聚集，有興趣的人可以訂閱他們的 &lt;A href=&#34;http://blog.joycode.com/Opml.aspx&#34;&gt;RSS&lt;/A&gt;。 對我而言，除了從中吸收別人的知識經驗，也是一個不錯的管道可以了解對岸的程序員文化。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Nullable types</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-04-159/</link>
      <pubDate>Fri, 04 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-04-159/</guid>
      <description>&lt;p&gt;又有一項新的功能或者說是 syntax sugar 加入 C# 2.0 的規格，詳情參考 &lt;A href=&#34;http://blogs.msdn.com/ericgu/archive/2004/05/27/143221.aspx&#34;&gt;Nullable types in C#&lt;/A&gt; 中的討論。&lt;/p&gt;
&lt;p&gt;簡單地說就是『允許 value type 也能有 null 值』。例如&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int?&lt;/span&gt; x = &lt;span style=&#34;color:#ae81ff&#34;&gt;125&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (x != &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;我喜歡這個概念，總比一般把『整數初始化成 -1 代表不合法值』的手法好多了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Weird &#34;break;&#34; in switch/case</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-04-158/</link>
      <pubDate>Fri, 04 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-04-158/</guid>
      <description>&lt;p&gt;&lt;A href=&#34;http://msdn.microsoft.com/vcsharp/team/language/ask/default.aspx&#34; name=&#34;Intro&#34;&gt;Ask a Language Designer&lt;/A&gt; 解答了一個困惑我很久的問題：&lt;A href=&#34;http://msdn.microsoft.com/vcsharp/team/language/ask/switch/default.aspx&#34;&gt;為什麼 C# 中的 switch/case 不允許 fall-through 卻需要 break 來離開 case 區塊？&lt;/A&gt;&lt;/p&gt;
&lt;p&gt;雖然這個答案還是不能說服我去接受它，但至少我知道了為什麼。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>x86-64</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-05-31-155/</link>
      <pubDate>Mon, 31 May 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-05-31-155/</guid>
      <description>&lt;p&gt;Yes, the age of 64-bit computing is coming: &lt;A href=&#34;http://arstechnica.com/cpu/03q1/x86-64/x86-64-1.html&#34;&gt;An Introduction to 64-bit Computing and x86-64&lt;/A&gt;.&lt;/p&gt;
&lt;p&gt;在個人電腦上的 RAM 動輒以 GB 來計算的今日，32-bit 帶來的 4GB 定址空間已經不再是個遙不可及的龐大數字。就讓我們猜猜 &lt;A href=&#34;http://www.x86-64.org/&#34;&gt;x86-64&lt;/A&gt; 及 &lt;A href=&#34;http://www.google.com/search?hl=zh-TW&amp;amp;ie=UTF-8&amp;amp;q=IA-64&amp;amp;btnG=%E6%90%9C%E5%B0%8B&amp;amp;lr=&#34;&gt;IA-64 &lt;/A&gt;何者能勝出&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Free Visual C&#43;&#43; Compiler</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-05-07-152/</link>
      <pubDate>Fri, 07 May 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-05-07-152/</guid>
      <description>&lt;p&gt;Microsoft 提供免費的 &lt;A href=&#34;http://msdn.microsoft.com/visualc/vctoolkit2003/&#34;&gt;Microsoft Visual C++ Toolkit 2003&lt;/A&gt;，其中包含了跟 Visual Studio .NET 2003 一樣的 C++ compiler。其實 Microsoft 早就應該這樣做了，畢竟現在有誰在 Windows 上不用整合開發環境 (IDE) 來寫程式，提供免費的 C++ compiler 一點也不會影響 Visual Studio 的銷售。提供免費的 C++ 編譯器來推廣 .NET 平台的普及，我想是這個事情最主要的原因吧。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CC2</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-16-146/</link>
      <pubDate>Fri, 16 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-16-146/</guid>
      <description>&lt;img src=&#34;//images.amazon.com/images/P/0735619670.01.TZZZZZZZ.jpg&#34; class=&#34;photo&#34;/&gt;
&lt;p&gt;我已經不記得第一次讀 Code Complete 是幾年前了，但是對於書中的許多內容我還是記憶猶新，它可說是影響我程式設計風格最重要的一本書。十年後，令人引頸期盼的 &lt;a href=&#34;http://www.stevemcconnell.com/cc2/cc.htm&#34;&gt;Code Complete 第二版&lt;/a&gt; 即將於六月就要上市。想靠 progamming 吃飯卻沒看過這本書的人一定要看，而看過第一版的人可以買第二版再看一遍&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Avalon &amp; Indigo</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-09-144/</link>
      <pubDate>Fri, 09 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-09-144/</guid>
      <description>&lt;p&gt;兩篇入門 Avalon 及 Indigo 的文章:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnlong/html/avalongraphics.asp&#34;&gt;Introducing the New Avalon Graphics Model&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnlong/html/avalongraphics.asp&#34;&gt;Inside &amp;ldquo;Indigo,&amp;rdquo; Chapter 2: The Journey of a Message&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Quit thinking and look</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-02-140/</link>
      <pubDate>Fri, 02 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-02-140/</guid>
      <description>&lt;p&gt;最近遇到了一個頗為難纏的 bug，症狀是當燒錄光碟的動作完成後，有些視窗的背景會變成黑色而不是原來的背景圖案；如果燒錄的資料量越大，這問題就越快出現；更奇怪的是這問題只會發生在安裝的版本而不是開發人員自己編譯出來的版本。&lt;/p&gt;
&lt;p&gt;根據 &lt;a href=&#34;http://www.debuggingrules.com/&#34;&gt;debugging rules&lt;/a&gt; 的第二條規則 &amp;ldquo;Make it fail&amp;rdquo;，最重要的事情是在開發人員的機器上重現這個問題。我們首先嘗試將開發人員編譯的執行碼來覆蓋安裝的版本，結果問題還是會發生；反之，用安裝版本來覆蓋開發人員編譯的執行碼也不會有問題。對於這樣的結果，我們感到相當困惑，因為如果不是程式碼造成的差異，那會是什麼因素造成這樣的結果？&lt;/p&gt;
&lt;p&gt;根據 rule 3 &amp;ldquo;Quit thinking and look&amp;rdquo;，我們決定多做一點嘗試，完整複製整個環境而不是只有執行碼。花了一番功夫，我們發現居然是執行檔 manifest 的問題，關鍵在於 manifest 中的這一段：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;dependentAssembly&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;assemblyIdentity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;type=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;win32&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Microsoft.Windows.Common-Controls&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;version=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6.0.0.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;publicKeyToken=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6595b64144ccf1df&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;language=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;processorArchitecture=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x86&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/dependentAssembly&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這差異會導致 common control 6.0 被使用，於是我們在開發人員的電腦採用這樣的 manifest 很快就重現這症狀了。現在問題是那裡的程式碼導致這樣的錯誤？由於當初猜測是 GDI 方面的問題，我們把 Windows Task Manager 叫出來，並且追蹤程式執行時的 GDI objects 數量，才赫然發現當問題發生前的一瞬間，GDI objects 的數量會暴增至 10000。此時我們很確定這是由 GDI leak 產生的問題，但對於為什麼換用新版的 common control 會導致這個 bug 卻是沒什麼頭緒。&lt;/p&gt;
&lt;p&gt;於是我們採用檢查問題發生點附近的程式碼，一邊單步執行一邊觀察 GDI Objects 的數量。用這樣的方法慢慢檢查，發現只要一呼叫 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/vclib/html/_mfc_cstatic.3a3a.setbitmap.asp&#34;&gt;CStatic::SetBitmap&lt;/a&gt;，就會有一個 GDI leak 產生。我們終於明瞭新版的 common control 對於 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/shellcc/platform/commctls/staticcontrols/staticcontrolreference/staticcontrolmessages/stm_setimage.asp&#34;&gt;STM_SETIMAGE&lt;/a&gt; 有不一樣的處理方式：static control 有可能複製我們傳進去的 bitmap handle，因此我們有義務把傳回來的 bitmap handle 釋放掉。&lt;/p&gt;
&lt;p&gt;這個問題給我們的啟示是：當遇到瓶頸時，開發人員應該多&lt;b&gt;觀察&lt;/b&gt; (look)，不要瞎猜 (quit thinking。因為根據我的經驗，問題發生的原因往往超出你的想像，真的讓你矇上的機率非常地小。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The n Habits of Highly Defective Windows Applications</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-01-139/</link>
      <pubDate>Thu, 01 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-01-139/</guid>
      <description>&lt;p&gt;這篇文章《&lt;a href=&#34;http://www.flounder.com/badprogram.htm&#34;&gt;The &lt;i&gt;n&lt;/i&gt; Habits of Highly Defective Windows Applications&lt;/a&gt;》是上班時努力地 google，想要找出方法來解決一個 GDI leak 時，不小心發現的。文章點出了許多撰寫 Windows 程式的壞方法、壞習慣，裡面包含了許多我曾經犯過而且其他新手也常常在犯的錯誤。假如你想把 Windows programming 學好，你應該嚴肅地看待文章中提出的警告。&lt;/p&gt;
&lt;p&gt;文章作者對於 Win32 programming 相當有研究，他的其他相關的技術文章可以在 &lt;a href=&#34;http://www.flounder.com/mvp_tips.htm&#34;&gt;MVP Tips, Techniques, and Goodies&lt;/a&gt; 找到，篇篇精采。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>10 Tips from the Ruby Creator</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-03-30-138/</link>
      <pubDate>Tue, 30 Mar 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-03-30-138/</guid>
      <description>&lt;p&gt;出自於 &lt;a href=&#34;http://www.cips.ca/news/national/news.asp?aID=1224&amp;amp;OP=anyWords&amp;amp;SF=Yukihiro+Matsumoto&#34;&gt;Ruby Creator Y. Matsumoto&lt;/a&gt;, CIPS Connections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Learn more than one programming languages, preferably many different style ones, like scripting, object-oriented, functional, logic, etc. Learning languages teaches you many about programming.&lt;/li&gt;
&lt;li&gt;Read good books, for example, &amp;ldquo;Pragmatic Programmers&amp;rdquo;, &amp;ldquo;Refactoring&amp;rdquo;, and &amp;ldquo;Art of Computer Science&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Read the source code. The source code is the source of information and knowledge. Thanks to the opensource.&lt;/li&gt;
&lt;li&gt;Don&amp;rsquo;t focus too much on tools. Tools changes. Algorithms and basic fundamentals don&amp;rsquo;t.&lt;/li&gt;
&lt;li&gt;Don&amp;rsquo;t focus too much on machines. Programmers often fall in the computer&amp;rsquo;s view point. But human make programs, programs serve human. Don&amp;rsquo;t forget that programming is a human oriented activity.&lt;/li&gt;
&lt;li&gt;Be lazy. Machines should serve human being. Often programmers serve machines unconsciously. Let machines serve you. Do everything you can to make you lazy.&lt;/li&gt;
&lt;li&gt;Test early, test often. Write test suites before you code, if possible.&lt;/li&gt;
&lt;li&gt;Be nice to others. Consider interface first, man to man, man to machine, and machine to machine. Again, remember, human factor is important.&lt;/li&gt;
&lt;li&gt;Be creative.&lt;/li&gt;
&lt;li&gt;Enjoy programming and life. I believe that is one of the purposes of life.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Anonymous Methods in C# 2.0</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-24-133/</link>
      <pubDate>Tue, 24 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-24-133/</guid>
      <description>&lt;p&gt;Anonymous method 是 C# 2.0 的新功能之一，從這兩篇文章可以看到 C# 如何在 CLR 上實作 &lt;a href=&#34;http://en2.wikipedia.org/wiki/Closure_(programming)&#34;&gt;closure&lt;/a&gt; 的機制。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.interact-sw.co.uk/iangblog/2004/02/16/anondelegates&#34;&gt;C# V2.0 Delegate Syntax and Conceptual Integrity&lt;/a&gt;, Ian Griffiths&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdnaa.net/Resources/display.aspx?ResID=2488&#34;&gt;Introduction to Anonymous Methods and Higher-Order Procedures in C#&lt;/a&gt;, Steve Maine&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hard Reading on Garbage Collection</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-24-134/</link>
      <pubDate>Tue, 24 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-24-134/</guid>
      <description>&lt;p&gt;幾篇跟 CLR 的 garbage collection 有關的技術文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blogs.msdn.com/cbrumme/archive/2004/02/20/77460.aspx&#34;&gt;Finalization&lt;/a&gt;, &lt;a href=&#34;http://blogs.msdn.com/cbrumme/&#34;&gt;Chris Brumme&lt;/a&gt; 對於 finalization 的機制做了深入的探討，包括 finalizer 帶來的成本、一些使用限制的緣由、及一些必須謹記在心的原則。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blogs.gotdotnet.com/tristanc/permalink.aspx/db0f31c8-fd9e-48c6-8093-7879bfb06d77&#34;&gt;Dispose Idiom&lt;/a&gt;, &lt;a href=&#34;http://blogs.gotdotnet.com/tristanc/&#34;&gt;Tristan Cartony&lt;/a&gt; 提供了範例程式說明在各種情況下如何實作 Dispose Idiom。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://discuss.develop.com/archives/wa.exe?A2=ind0010A&amp;amp;L=DOTNET&amp;amp;P=R28572&amp;amp;I=3&#34;&gt;Resource management&lt;/a&gt;, Brian Harry 探討了如何在 garbage collection 的環境下實現 deterministic finalization。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.gotdotnet.com/team/libraries/whitepapers/resourcemanagement/resourcemanagement.aspx&#34;&gt;.NET Framework Resource Management&lt;/a&gt;  把所有的 type 根據管理資源的方式分成了 simple, finalizable, disposable, 及 disposable and finalizable (both) 四種類型，並且詳細地說明了各種類型適用的時機。除此之外，有幾個比較少被談到的主題也涵括在內，如 threading issues, versioning, resource collector pattern, IEnumerable with expensive resources。個人認為是蠻實用的一篇文章。&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Visual Assist</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-19-130/</link>
      <pubDate>Thu, 19 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-19-130/</guid>
      <description>&lt;p&gt;打一下廣告： &lt;a href=&#34;http://www.wholetomato.com/products/index.html&#34;&gt;Visual Assist&lt;/a&gt; 有&lt;a href=&#34;http://www.wholetomato.com/x/index.html&#34;&gt;新的 beta 版本&lt;/a&gt;了。我不知道該怎麼形容這個東西，但是寫程式時沒有它我就渾身不自在&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>名人談軟體</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-10-129/</link>
      <pubDate>Tue, 10 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-10-129/</guid>
      <description>&lt;p&gt;看完了Anders Hejlsberg 的訪談錄之後，我才發現 Bill Venners 其實&lt;a href=&#34;http://www.artima.com/intv/&#34;&gt;訪問過許多軟體業界的知名人物&lt;/a&gt;，如 James Gosling, Bruce Eckel, Andy Hunt &amp;amp; Dave Thomas, Guido van Rossum, Scott Meyers, Martin Fowler, Josh Bloch, Ward Cunningham, Bertrand Meyer, Bjarne Stroustrup, &amp;hellip; 哇！都是我的偶像！&lt;/p&gt;
&lt;p&gt;只是我的 To-Read List 霎時多了&lt;a href=&#34;http://www.artima.com/articles/index.jsp?topic=intv&#34;&gt;八、九十篇文章&lt;/a&gt;&amp;hellip; 傻眼&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Bruce Eckel&#39;s Weblog</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-08-128/</link>
      <pubDate>Sun, 08 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-08-128/</guid>
      <description>&lt;p&gt;今天在閱讀一些關於 checked/unchecked exception 爭議的文章時，忽然發現 Bruce Eckel 也有自己的 weblog: &lt;a href=&#34;http://www.mindview.net/WebLog&#34;&gt;Thinking About Computing&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;從 &lt;a href=&#34;http://mindview.net/WebLog/log-0025&#34;&gt;5-2-03 Strong Typing vs. Strong Testing&lt;/a&gt; 及 &lt;a href=&#34;http://www.mindview.net/Etc/Discussions/CheckedExceptions&#34;&gt;Does Java need Checked Exceptions?&lt;/a&gt; 可以看出 Bruce 是傾向於支持 unchecked exception。&lt;/p&gt;
&lt;p&gt;下面是我找到這些文章的連結路徑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.manageability.org/blog/stuff/exceptional-exception-handling-techniques&#34;&gt;13 Exceptional Exception Handling Techniques  &lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.onjava.com/pub/a/onjava/2003/11/19/exceptions.html&#34;&gt;Best Practices for Exception Handling&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.mindview.net/Etc/Discussions/CheckedExceptions&#34;&gt;Does Java need Checked Exceptions?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://today.java.net/pub/a/today/2003/12/04/exceptions.html&#34;&gt;Three Rules for Effective Exception Handling&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Leaky Abstractions</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-05-126/</link>
      <pubDate>Thu, 05 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-05-126/</guid>
      <description>&lt;p&gt;Joel 總是能將事情解釋地比別人更好：《 &lt;a href=&#34;http://www.joelonsoftware.com/articles/LeakyAbstractions.html&#34;&gt;The Law of Leaky Abstractions&lt;/a&gt;》(&lt;a href=&#34;http://discuss.fogcreek.com/joelonsoftware/default.asp?cmd=show&amp;amp;ixPost=19200&#34;&gt;相關討論&lt;/a&gt;) 是 Joel 的文章中我最喜歡的幾篇之ㄧ。&lt;/p&gt;
&lt;p&gt;寫過 Java 或是 .NET 程式的人大概都知道什麼是 garbage collection，甚至連 garbage collection 是什麼都不知道的人還是可以寫出一個正確無誤的程式。在這裡 garbage collection 就是一個簡化記憶體配置機制的抽象概念，這概念大大簡化了程式員要花在追蹤記憶體配置情況的心力；然而從此程式員就過著幸福快樂的日子了嗎？喔不&amp;hellip; 根據 The Law of Leaky Abstractions，garbage collection 在某些情況下反而會帶來更多問題。其中一個明顯的漏洞就是它的不可預期性，也就是你無法預期系統那時候會進行 garbage collection，因此這漏洞逼迫你要了解 garbage collection 的基本運作原理，並且要用&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/cpguide/html/cpconimplementingdisposemethod.asp&#34;&gt;另外一個方法&lt;/a&gt;來彌補它。因此 garbage collection 帶給我們的並不是完美的世界，如果你不了解其中的運作原理，很容易誤入背後潛藏的陷阱而不自知。&lt;/p&gt;
&lt;p&gt;所以最好的策略就是：&lt;b&gt;Try your best to know what&amp;rsquo;s under the hood.&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;附帶一提，對 .NET Framework 的 garbage collection 機制有興趣的人可以參考 Jeffrey Richter 的兩篇文章，《&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/1100/GCI/default.aspx&#34;&gt;Garbage Collection: Automatic Memory Management in the Microsoft .NET Framework&lt;/a&gt;》及《&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/1200/GCI2/default.aspx&#34;&gt;Garbage Collection-Part 2: Automatic Memory Management in the Microsoft .NET Framework&lt;/a&gt;》。&lt;/p&gt;
&lt;p&gt;對於我們這些喜歡鑽研系統底層運作原理的人，感謝 The Law of Leaky Abstractions  讓我們在激烈的競爭之下還能混口飯吃。 :-)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>科技設計</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-05-127/</link>
      <pubDate>Thu, 05 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-05-127/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://tds.ic.polyu.edu.hk/td/theme1/t1_content_c.htm&#34;&gt;科技演進及其對社會的影響 The evolution of technology and its social impacts&lt;/a&gt;：蠻有趣的，我想應該大學的資訊科系應該開一些類似的課程，尤其是偏重軟體設計的。&lt;/p&gt;
&lt;p&gt;我想我們需要更多有品味的軟體開發人員。:-)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>.NET Performace Optimization</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-04-125/</link>
      <pubDate>Wed, 04 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-04-125/</guid>
      <description>&lt;p&gt;Several articles about .NET performace from Microsoft CLR Performance Team:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Gregor Noriskin, &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dndotnet/html/highperfmanagedapps.asp&#34;&gt;Writing High-Performance Managed Applications : A Primer&lt;/a&gt;, MSDN.&lt;/li&gt;
&lt;li&gt;Jan Gray, &lt;a HREF=&#34;http://msdn.microsoft.com/library/en-us/dndotnet/html/fastmanagedcode.asp&#34;&gt;Writing Faster Code: Knowing What Things Cost&lt;/a&gt;, MSDN.&lt;/li&gt;
&lt;li&gt;Rico Mariani, &lt;a HREF=&#34;http://msdn.microsoft.com/library/en-us/dndotnet/html/dotnetgcbasics.asp&#34;&gt;Garbage Collector Basics and Performance Hints&lt;/a&gt;, MSDN.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>A Conversation with Anders Hejlsberg</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-02-124/</link>
      <pubDate>Mon, 02 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-02-124/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.artima.com/intv/generics.html&#34;&gt;Anders Hejlsberg 在 Bill Venners 及 Bruce Eckel 的專訪下暢談了 C# 的設計理念&lt;/a&gt;，一共有八篇訪文，我直接條列如下以方便點閱。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/csdes.html&#34;&gt;Part I: The C# Design Process&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/handcuffs.html&#34;&gt;Part II: The Trouble with Checked Exceptions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/simplexity.html&#34;&gt;Part III: Delegates, Components, and Simplexity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/nonvirtual.html&#34;&gt;Part IV: Versioning, Virtual, and Override&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/interop.html&#34;&gt;Part V: Contracts and Interoperability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/abstract.html&#34;&gt;Part VI: Inappropriate Abstractions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/generics.html&#34;&gt;Part VII: Generics in C#, Java, and C++&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.artima.com/intv/choices.html&#34;&gt;Part VIII: CLR Design Choices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;訪問的內容篇篇精彩，我個人尤其佩服 Anders 設計 C# 時採行的務實 (pragmatic) 觀點。事實上，了解「一個程式語言為何被如此設計」消極地能避免語言特性的誤用，積極地能讓你寫出更好的程式。&amp;ldquo;Know Why&amp;rdquo; 絕對是精通一個語言的必經過程。&lt;/p&gt;
&lt;p&gt;這裡是另外一篇更早的專訪 (08/01/2000)：&lt;a href=&#34;http://windows.oreilly.com/news/hejlsberg_0800.html&#34;&gt;Deep Inside C#: An Interview with Microsoft Chief Architect Anders Hejlsberg&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;再過一兩年等 C# 的規格穩定下來，不曉得 Anders 是否會寫一本 &amp;ldquo;The Design and Evolution of C#&amp;rdquo;?&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>C# Generics</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-02-123/</link>
      <pubDate>Mon, 02 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-02-123/</guid>
      <description>&lt;p&gt;兩篇關於 C# Generics 的技術文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dv_vstechart/html/csharp_generics.asp&#34;&gt;An Introduction to C# Generics&lt;/a&gt; by Juval Lowy&lt;/li&gt;
&lt;li&gt;Brandon Bray 對 C++ Templates 及 C# Generics 做了&lt;a href=&#34;http://blogs.msdn.com/branbray/archive/2003/11/19/51023.aspx&#34;&gt;一番深入的比較&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Partial Types</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-02-01-121/</link>
      <pubDate>Sun, 01 Feb 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-02-01-121/</guid>
      <description>&lt;p&gt;由這段話可以一窺 partial types 的原始構想：&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;Host: Anders (Microsoft)&lt;br&gt;Q: What&#39;s the aim of partial types in C#?&lt;br&gt;A: Two reasons. First, people often ask us for include files. When we dig a little deeper, it turns out they want to split large classes into multiple files. Partial types will allow you to do that, but in a structured fashion. Second, partial classes solve the round trip problem with auto generated code. The code generator can create one file and the user&#39;s additions can be placed in another file. When code is regenerated, the user&#39;s changes aren&#39;t lost.&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;這是 C# 2.0 specification 對 partial types 的解釋：&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;Partial types allow classes, structs, and interfaces to be broken into multiple pieces stored in different source files for easier development and maintenance. Additionally, partial types allow separation of machine-generated and user-written parts of types so that it is easier to augment code generated by a tool.&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;依我的看法，第二個理由『可以分離 machine-generated code 及 user-written code』才是 partial types 的真正的價值所在，而分離這兩者又是 &lt;a href=&#34;http://longhorn.msdn.microsoft.com/lhsdk/core/overviews/about%20xaml.aspx&#34;&gt;XAML&lt;/a&gt; 及新版的 ASP.NET 必須要有的功能，正因為如此 partial types 也就順理成章地成為 C# 2.0 的新規格。以 XAML 為例，XAML 的核心精神就是『分離 presentation 及 behavior』。
Presentation 指的是使用者界面，通常是由美工人員負責撰寫如下的 XAML 檔來達成〈很像寫 HTML 網頁〉：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;Canvas&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ID=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;root&amp;#34;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;xmlns=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://schemas.microsoft.com/2003/xaml&amp;#34;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;xmlns:def=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Definition&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;Button&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Click=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Button_Click&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Click Me!&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/Button&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/Canvas&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;而 Behavior 指的是 UI 背後的行為邏輯，這部份通常是由程序員使用 C# 或其他的 .NET Language 來撰寫：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; System;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; MSAvalon.Windows;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; MSAvalon.Windows.Controls;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; MSAvalon.Windows.Media;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;namespace&lt;/span&gt; Button {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Default&lt;/span&gt; : Panel {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Event handler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Button_Click(&lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt; sender, MSAvalon.Windows.Controls.ClickEventArgs e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      btn1.Background = MSAvalon.Windows.Media.Brushes.Red;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;將二者分離對開發程序的影響就是可以讓美工人員跟程序員可以獨立作業。在這個例子中，machine-generated code 指的就是由 XAML 產生的 C# code，user-written code 就是由程序員自行撰寫的 event handlers，最後二者藉由 partial types 的機制合併而成為單一的 class 來執行，很酷不是嗎？&lt;br /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>W32 API -&gt; .NET Framework</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-01-30-119/</link>
      <pubDate>Fri, 30 Jan 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-01-30-119/</guid>
      <description>&lt;p&gt;在寫 .NET 的程式時，我最常有的疑問就是“某個 Win32 API 是否在 .NET Framework 有相對應的部分？”&lt;/p&gt;
&lt;p&gt;意外地發現 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dndotnet/html/win32map.asp&#34;&gt;Microsoft Win32 to Microsoft .NET Framework API Map&lt;/a&gt; 就是這個問題的解答。此外 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/vclib/html/vclrfrun-timeroutinesnetframeworkequivalents.asp&#34;&gt;C Run-Time Library Routines and .NET Framework Equivalents&lt;/a&gt; 也是很棒的參考。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Selected Software Engineering Books</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-01-28-118/</link>
      <pubDate>Wed, 28 Jan 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-01-28-118/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.ics.uci.edu/~jrobbins/&#34;&gt;Jason Elliot Robbins&lt;/a&gt; 推薦的一些&lt;a href=&#34;http://www.ics.uci.edu/~jrobbins//books/&#34;&gt;軟體技術書籍&lt;/a&gt;。Jason 同時也是 &lt;a href=&#34;http://readyset.tigris.org/&#34;&gt;ReadySET&lt;/a&gt; 的作者。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Calling Convention</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-01-14-116/</link>
      <pubDate>Wed, 14 Jan 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-01-14-116/</guid>
      <description>&lt;p&gt;我知道有點硬，但是有興趣的就看看吧。&lt;/p&gt;
&lt;p&gt;一系列的四篇文章介紹 calling convention：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/01/02/47184.aspx&#34;&gt;The history of calling conventions, part 1&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/01/07/48303.aspx&#34;&gt;The history of calling conventions, part 2&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/01/08/48616.aspx&#34;&gt;The history of calling conventions, part 3&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/01/13/58199.aspx&#34;&gt;The history of calling conventions, part 4: ia64&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://weblogs.asp.net/oldnewthing/archive/2004/01/09/49028.aspx&#34;&gt;Why do member functions need to be &amp;ldquo;static&amp;rdquo; to be used as a callback?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://blogs.msdn.com/oldnewthing/archive/2004/01/15/58973.aspx&#34;&gt;What can go wrong when you mismatch the calling convention? &lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;多了解一些 assembly language 對 programmer 是絕對有益的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;__fastcall 在大部分的情況下並不會讓你的程式變快多少。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IA64 終於可以終結 &lt;a href=&#34;http://www.windowsecurity.com/articles/Analysis_of_Buffer_Overflow_Attacks.html&#34;&gt;Buffer Overflow Attacks&lt;/a&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;對 IA64 有興趣的可以先瞧瞧這篇文章：&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/1100/hood/&#34;&gt;Programming for 64-bit Windows &lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Exception Handling Techniques</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-01-14-117/</link>
      <pubDate>Wed, 14 Jan 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-01-14-117/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.manageability.org/blog/stuff/exceptional-exception-handling-techniques&#34;&gt;13 Exceptional Exception Handling Techniques&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.onjava.com/pub/a/onjava/2003/11/19/exceptions.html&#34;&gt;Best Practices for Exception Handling&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Pragmatic Starter Kit</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-26-111/</link>
      <pubDate>Fri, 26 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-26-111/</guid>
      <description>&lt;p&gt;驚喜地發現 Andy 跟 Dave 出新書了，不需要多考慮，掏錢買就對了。&lt;/p&gt;
&lt;p&gt;看《&lt;a href=&#34;http://www.pragmaticprogrammer.com/starter_kit/vc/&#34;&gt;Pragmatic Version Control using CVS&lt;/a&gt;》的目錄感覺內容有點單薄，當成入門書籍還說的過去。我個人比較期待《&lt;a href=&#34;http://www.pragmaticprogrammer.com/starter_kit/ut/index.html&#34;&gt;Pragmatic Unit Testing&lt;/a&gt;》及《&lt;a href=&#34;http://www.pragmaticprogrammer.com/starter_kit/au/index.html&#34;&gt;Pragmatic Project Automation&lt;/a&gt; 》。&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;Software development is difficult enough; if you try to build on a shaky foundation it can make development almost impossible; (which might account for the fact that about 50% of software projects fail).&lt;br&gt;&lt;br&gt;The Starter Kit fixes that. It&#39;s a set of three books covering basic practices that are applicable in all software development situations. It doesn&#39;t matter if you&#39;re using Extreme Programming or RUP, developing web services or code embedded in a cell phone. The practices of version control, unit testing, and project automation are crucial to your success!&lt;br&gt;
&lt;/blockquote&gt;

</description>
    </item>
    
    <item>
      <title>學習 - 最值得投資的事</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-22-110/</link>
      <pubDate>Mon, 22 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-22-110/</guid>
      <description>&lt;p&gt;身為一位 software engineer，你有多久沒有買書了？&lt;/p&gt;
&lt;p&gt;我尤其指跟 software  development 有關的書。在軟體業已經工作了四年的我很訝異地發現：大部分的人投資在技術書籍上的錢真的少的可憐。許多人的藉口都是『原文書太貴了』、『英文看不懂或是閱讀英文速度很慢』、『網路上找方法就好了，何必買書？』、『下班回家後就已經很累了，根本不想看書』。但我認為這些都是推託的藉口：原文書太貴？也沒看到你買中文書來看；英文能力不好？那你可能不太適合這個行業；網路可以找到所有的答案？網路上的知識都太零散了，沒辦法提供完整而有組織的學習；加班太累，沒時間讀？早點回家唸書，想想該怎麼有效率的工作，你就會發現不用每天加班了。&lt;/p&gt;
&lt;p&gt;想要在這個產業成功，『積極學習』絶對是不二法門。我強力推薦 Eric 的短文《&lt;a title=&#34;Career Calculus&#34; href=&#34;http://software.ericsink.com/Career_Calculus.html&#34;&gt;Career Calculus&lt;/a&gt;》。你也可以參考 How to Keep Your Job。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Design Guidelines for Class Library Developers</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-20-108/</link>
      <pubDate>Sat, 20 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-20-108/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/en-us/cpgenref/html/cpconNETFrameworkDesignGuidelines.asp?frame=true&#34; title=&#34;Design Guidelines for Class Library Developers (.NET Framework General Reference)&#34;&gt;Design Guidelines for Class Library Developers (.NET Framework General Reference)&lt;/a&gt; should be a good reference document for .NET developers.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Debugging</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-12-105/</link>
      <pubDate>Fri, 12 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-12-105/</guid>
      <description>&lt;p&gt;最令程式員頭痛的莫過於各式各樣的 bug，它們也通常是讓程式員每天加班晚歸的最大兇手。程式新手通常缺乏 debug 的有效技巧，對於問題的應對方式不是瞎子摸象就是一籌莫展。然而你會發現老經驗的程式員總是能很快地把 bug 解決掉，差別就是聰明的他們會從過去的經驗累積一些經驗法則，運用這些法則往往能將 90% 的 bug 一網打盡。&lt;/p&gt;
&lt;p&gt;《&lt;a href=&#34;http://www.debuggingrules.com/Get_the_book.html&#34;&gt;Debugging&lt;/a&gt;》是一本奇特的書，David Agans 教導程式員如何使用系統化及科學化的方法來對付各種 bug。整本書的重點在於 David 提出的的九大原則：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Understand the system&lt;/li&gt;
&lt;li&gt;Make it fail&lt;/li&gt;
&lt;li&gt;Quit thinking and look&lt;/li&gt;
&lt;li&gt;Divide and conquer&lt;/li&gt;
&lt;li&gt;Change one thing at a time&lt;/li&gt;
&lt;li&gt;Keep an audit trail&lt;/li&gt;
&lt;li&gt;Check the plug&lt;/li&gt;
&lt;li&gt;Get a fresh view&lt;/li&gt;
&lt;li&gt;If you didn&amp;rsquo;t fix it, it ain&amp;rsquo;t fixed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不論你是新手或是老手，我相信你一定能在這本書中獲益良多。Don&amp;rsquo;t Debug Hard - Debug Smart.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>News Aggregator in C#</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-03-102/</link>
      <pubDate>Wed, 03 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-03-102/</guid>
      <description>&lt;p&gt;由於常逛的 blog 實在太多了，還是找了個 &lt;a href=&#34;http://www.yole.ru/projects/syndirella/&#34;&gt;RSS reader&lt;/a&gt; 來用。如果你對用 C# 實作一個 &lt;a href=&#34;http://www.xml.com/pub/a/2002/12/18/dive-into-xml.html&#34;&gt;RSS&lt;/a&gt; reader 有興趣的話，請看《&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnexxml/html/xml02172003.asp&#34;&gt;Building a Desktop News Aggregator&lt;/a&gt;》。此外 O&amp;rsquo;Reilly 出版的《&lt;a href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/0596003838/102-7370492-6512164?v=glance&#34;&gt;Content Syndication with RSS&lt;/a&gt;》也是不錯的參考。&lt;/p&gt;
&lt;p&gt;哈哈，用 &lt;a href=&#34;http://www.yole.ru/projects/syndirella/&#34;&gt;Syndirella&lt;/a&gt; 看&lt;a href=&#34;http://dwlt.net/tapestry/dilbert.rdf&#34;&gt;呆伯特漫畫&lt;/a&gt;比用瀏覽器輕鬆多了。&lt;a href=&#34;http://www.bradsoft.com/feeddemon/index.asp&#34;&gt;FeedDemon&lt;/a&gt; 也是不錯的選擇。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Compiling a Compiler</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-12-02-100/</link>
      <pubDate>Tue, 02 Dec 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-12-02-100/</guid>
      <description>&lt;p&gt;最近不知道為什麼又對 Programming Language 感興趣起來了，算了，看這個關於 C compiler 的有趣故事吧：《&lt;a href=&#34;http://www.cis.nctu.edu.tw/chinese/doc/research/doc/cismagazine/cis-magazine-83-12.html&#34;&gt;Compiling a Compiler&lt;/a&gt;》。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Beyond Chaos</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-24-95/</link>
      <pubDate>Mon, 24 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-24-95/</guid>
      <description>&lt;p&gt;《&lt;a href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/0201719606/002-1545132-4855230?v=glance&#34;&gt;Beyond Chaos: The Expert Edge in Managing Software Development&lt;/a&gt;》&lt;/p&gt;
&lt;p&gt;是我最近在 Amazon 買的一本二手書，請在美國出差的同事幫我帶回來。價錢 $4.14 加上運費 $3.49，折合台幣才兩百五十元，實在是非常划算。對於常買原文書的我，這樣的方式倒是能幫我省下不少錢。&lt;/p&gt;
&lt;p&gt;喜歡買原文技術書籍的人，可以試試看 &lt;a href=&#34;http://www.addall.com&#34;&gt;AddALL&lt;/a&gt; 或是 Google 新的比價服務 &lt;a href=&#34;http://froogle.google.com/&#34;&gt;Froogle&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Programming Embedded Systems</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-24-94/</link>
      <pubDate>Mon, 24 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-24-94/</guid>
      <description>&lt;p&gt;最近剛讀完《&lt;a title=&#34;Amazon.com: Books: Programming Embedded Systems in C and C++&#34; href=&#34;http://www.amazon.com/exec/obidos/tg/detail/-/1565923545/002-1545132-4855230?v=glance&#34;&gt;Programming Embedded Systems in C and C++&lt;/a&gt;》，讓完全不懂 embedded system 的我很快地就對嵌入式系統有了一定程度的了解。推薦給任何對 embedded system programming 有興趣的人。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>程式員救星</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-21-93/</link>
      <pubDate>Fri, 21 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-21-93/</guid>
      <description>&lt;p&gt;程式員都不喜歡寫 spec，因為寫 spec 比寫程式難多了。儘管如此，《&lt;a title=&#34;Critical Section - The Lead Bullet - Writing Specs&#34; href=&#34;http://w-uh.com/noframes.cgi/articles/030724-writing_specs.html&#34;&gt;The Lead Bullet - Writing Specs&lt;/a&gt;》告訴我們：好的 spec 是過勞的程式員值得依賴的救星。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>數位的花園</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-21-92/</link>
      <pubDate>Fri, 21 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-21-92/</guid>
      <description>&lt;p&gt;第一次看到這方面的話題：《&lt;a title=&#34;Critical Section - Turning Over Software&#34; href=&#34;http://w-uh.com/noframes.cgi/articles/030102-turning_over_softw.html&#34;&gt;Turning Over Software&lt;/a&gt;》討論如何順利地移交你的程式碼給其他人接手。&lt;/p&gt;
&lt;p&gt;我喜歡作者把程式比喻成需要細心灌溉維護的花園：&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;Programs are not static creations like buildings, &lt;b&gt;they are more like gardens&lt;/b&gt;.  They have an initial plan and form and implementation, but they require ongoing care and maintenance, and enhancements.  &lt;b&gt;If you don&#39;t turn your code over to someone else, eventually you will spend all your time caring for your existing code, and you&#39;ll be trapped.&lt;/b&gt;&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;而這句話我舉雙手贊成：
&amp;ldquo;&lt;b&gt;In order for programmers to be productive and happy, they must feel a sense of ownership.&lt;/b&gt;&amp;rdquo;&lt;/p&gt;
&lt;p&gt;因此結論就是簡單的四個字：&amp;quot;&lt;b&gt;Finish it&lt;/b&gt;&amp;quot; 及 &amp;ldquo;&lt;b&gt;Stay out&lt;/b&gt;&amp;quot;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Two Switches</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-20-91/</link>
      <pubDate>Thu, 20 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-20-91/</guid>
      <description>&lt;p&gt;一個有趣的易智題目： &lt;a title=&#34;Critical Section - The Two Switches&#34; href=&#34;http://w-uh.com/index.cgi/articles/030530-the_two_switches.html&#34;&gt;The Two Switches&lt;/a&gt;，在 &lt;a title=&#34;Critical Section - Moving Mount Fuji&#34; href=&#34;http://w-uh.com/noframes.cgi/articles/030524-moving_Mount_Fuji.html&#34;&gt;Moving Mount Fuji&lt;/a&gt; 可以找到更多類似的題目。喜歡出這些奇奇怪怪的題目來測試應徵者的公司中，最有名的就是 Microsoft 了，有興趣的可以看 &lt;a title=&#34;Microsoft Interview Questions&#34; href=&#34;http://www.sellsbrothers.com/fun/msiview/&#34;&gt;Microsoft Interview Questions&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;要進 MS 似乎不是件容易的事。 :-)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Microsoft and G5</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-11-04-86/</link>
      <pubDate>Tue, 04 Nov 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-11-04-86/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.michaelhanscom.com/eclecticism/2003/10/even_microsoft_.html&#34;&gt;Even Microsoft wants G5s&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;因為 blog 而丟了工作？&lt;/p&gt;
&lt;p&gt;我想 Michael 也沒想到拍一張照片會把這新聞炒的這麼大。正所謂樹大招風，Microsoft 開除了這名員工，反而引來更多的人來關注這件事。&lt;/p&gt;
&lt;p&gt;雖然我認為 Microsoft 以違反公司安全為由開除員工有他的道理，只是更輕鬆地處理這件事不是很好？畢竟 Microsoft 有太多的負面消息了，還是他們不在乎多這一則？&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Aspect-Oriented Programming, Part II</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-09-29-76/</link>
      <pubDate>Mon, 29 Sep 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-09-29-76/</guid>
      <description>&lt;p&gt;&lt;a title=&#34;IBM、JBoss聯手Java新功能&#34; href=&#34;http://taiwan.cnet.com/enterprise/topic/story/0,2000053735,20083749,00.htm&#34;&gt;IBM、JBoss聯手Java新功能&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;IBM與開放原始碼Java軟體商JBoss有意進行一項Java標準化計劃，意在反制日益受到歡迎的微軟C#語言。&lt;br&gt;&lt;br&gt;兩家公司目前獨立投資於一項軟體開發技術稱為AOP(aspect-oriented programming)，可加速應用開發速度，且更具彈性，同時也更不容易出錯。&lt;br&gt;&lt;br&gt;JBoss企業開發與策略副總裁Bob Bickel透露，現在兩家公司則有意把AOP變成Java的標準功能。&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;看來 AOP 將成為 Java 與 C# 互較長短的新戰場。Java 方面已經有頗為成熟的 &lt;a href=&#34;http://aspectj.org&#34;&gt;AspectJ&lt;/a&gt;，而 C# 方面則是積極發展中。就我看來，要普及 AOP 並讓程式員了解並使用這個嶄新的概念，整合開發環境的支援扮演了一個重要的角色；在這方面，似乎又是 Java 領先 (參考 &lt;a href=&#34;http://www.eclipse.org/ajdt/&#34;&gt;AJDT in Eclipse&lt;/a&gt;)。&lt;/p&gt;
&lt;p&gt;對 AOP 有興趣的可以參考&lt;a href=&#34;http://william.cswiz.org&#34;&gt;葉秉哲&lt;/a&gt;在 JavaTwo 2003 研討會的演講《&lt;a href=&#34;http://william.cswiz.org/present/20030812-javatwo/&#34;&gt;AspectJ: Beyond OOP&lt;/a&gt;》。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SSCLI</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-09-16-74/</link>
      <pubDate>Tue, 16 Sep 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-09-16-74/</guid>
      <description>&lt;p&gt;《&lt;a href=&#34;http://dotnet.di.unipi.it/Content/DOTNET/Teaching/SSCLI/ExtSSCLI.ppt&#34;&gt;Extending SSCLI&lt;/a&gt;》非常酷的一份教學，告訴你如何擴充 CLI 的功能。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;msdn.microsoft.com/netframework/using/ understanding/cli/default.aspx&#34;&gt;SSCLI&lt;/a&gt; (Shared Source Common Language Infrestrcuture) 是 Microsoft 代號為 Rotor 的一個計畫，目的是公開 CLI 的原始碼，讓更多的人參與 .NET 的開發與研究。微軟的這些傢伙真的非常聰明，曉得就是會有許多無聊的人(例如我)喜歡去探究系統內部的運作，當這些人對整個系統熟悉了自然就會成為 .NET 技術的支持者。不可否認地，閱讀 SSCLI 的原始碼真的有讓人如入寶庫的感覺，正如同這份教學裡的一段話:&lt;/p&gt;
&lt;p&gt;&lt;q&gt;A runtime such as SSCLI is a neat example of knowledge repository of the past 30 years of computer science.&lt;/q&gt;&lt;/p&gt;
&lt;p&gt;或許 computer science 30 年的精華是有點誇張，但你絕對可以從中學到一點東西。然而學習最快的方法就是親自動手去做囉，這份教學藉由增加一個新的 IL instruction 來讓你對整個 CLI 的架構有一個大致的了解，值得一試!&lt;/p&gt;
&lt;p&gt;如果你對 SSCLI 有興趣，歡迎一起來討論。Jason Whittington 在 MSDN 的這篇文章《&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/02/07/sharedsourcecli/toc.asp&#34;&gt;Rotor: Shared Source CLI Provides Source Code for a FreeBSD Implementation of .NET&lt;/a&gt;》也值得一看：&lt;/p&gt;
&lt;div class=&#34;quote&#34;&gt;your effectiveness as a programmer is directly proportional to how well you understand the layers of technology underneath you. ATL programmers never made it very far without understanding CLSIDs and QueryInterface. MFC programmers before them eventually had to face the music and learn about WNDPROCs.&lt;/div&gt;
&lt;p&gt;下面是另外兩篇 google 到的資料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://plaswww2.fit.qut.edu.au/RotorWiki/index.html&#34;&gt;Shared Source Common Language Infrastructure in RotorWiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://my.mindvision.com/~ben/clr_notes/load_runtime_and_types.htm&#34;&gt;Loading of the Runtime and of Managed Types in the SSCLI&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Multithreading in Windows Froms</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-09-08-71/</link>
      <pubDate>Mon, 08 Sep 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-09-08-71/</guid>
      <description>&lt;p&gt;Four interesting articles about multitheading programming in Windows Form by &lt;a href=&#34;http://www.sellsbrothers.com/writing/&#34;&gt;Chris Sells&lt;/a&gt; and Ian Griffiths:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnforms/html/winforms06112002.asp&#34;&gt;Safe, Simple Multithreading in Windows Forms, Part 1&lt;/a&gt;, Chris Sells&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnforms/html/winforms08162002.asp&#34;&gt;Safe, Simple Multithreading in Windows Forms, Part 2&lt;/a&gt;, Chris Sells&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/dnforms/html/winforms01232003.asp&#34;&gt;Safe, Simple Multithreading in Windows Forms, Part 3&lt;/a&gt;, Chris Sells&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/03/02/Multithreading/default.aspx&#34;&gt;Give Your .NET-based Application a Fast and Responsive UI with Multiple Threads&lt;/a&gt;, Ian Griffiths&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You should read this article if you don&amp;rsquo;t know what delegate is:
&lt;a href=&#34;http://www.sellsbrothers.com/writing/default.aspx?content=delegates.htm&#34;&gt;.NET Delegates: A C# Bedtime Story&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>developer vs. programmer, part II</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-07-05-65/</link>
      <pubDate>Sat, 05 Jul 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-07-05-65/</guid>
      <description>&lt;p&gt;我在之前的一篇文章中提到了 Developer 跟 Programmer 的差別，而 Eric 的文章《&lt;a title=&#34;Eric.Weblog() Small ISVs: You need Developers, not Programmers&#34; href=&#34;http://software.ericsink.com/No_Programmers.html&#34;&gt;Small ISVs: You need Developers, not Programmers&lt;/a&gt;》把這一點講的更清楚了。&lt;/p&gt;
&lt;p&gt;Developers 可以比喻為軟體設計的『通才』，而 Programmers 則是軟體設計的『專才』。正如其他一般的行業，通才是比較吃得開的，因為他們的彈性比起專才大的多，也較受企業的歡迎。然而現實上，一般的大學教育還是以訓練專才為主，也就是寫程式的能力。在學校，沒有人教你如何寫 spec、如何管理 software configuration、如何寫程式文件、如何測試及偵錯程式等等必需的技能，這些東西往往是到業界來才邊做邊學的。事實上，別小看這些看起來很簡單的事情，如果你能比同儕更快學會這些事或是做的更好，你很有可能就會得到上司的賞識而晉升。&lt;/p&gt;
&lt;p&gt;總之，別侷限於自己的專精領域，看的更廣會讓你做的更好。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Refactoring &amp; Patterns</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-07-03-62/</link>
      <pubDate>Thu, 03 Jul 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-07-03-62/</guid>
      <description>&lt;p&gt;《&lt;a title=&#34;Refactoring&#34; href=&#34;http://industriallogic.com/xp/refactoring/&#34;&gt;Refactoring To Patterns&lt;/a&gt;》提供了許多『經由 refactoring 的手法來改善物件導向程式架構的方法』，我個人認為相當地具有實用價值，值得一看。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Aspect-Oriented Programming</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-07-01-59/</link>
      <pubDate>Tue, 01 Jul 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-07-01-59/</guid>
      <description>&lt;p&gt;「&lt;a href=&#34;http://www.google.com/search?hl=en&amp;amp;ie=UTF-8&amp;amp;oe=UTF-8&amp;amp;q=AOP&#34;&gt;Aspect-Oriented Programming&lt;/a&gt;」是繼OOP之後的新程式設計思維， 大陸的譯名是「面向方面」(有夠饒口的)。&lt;/p&gt;
&lt;p&gt;aspect 在字典裡的定義是:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A distinct feature or element in a problem&lt;/li&gt;
&lt;li&gt;A characteristic to be considered&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我想 1. 跟 2. 的解釋是比較貼近 AOP 中 Aspect 的定義。&lt;/p&gt;
&lt;p&gt;我個人比較有興趣的是 AOP 與 C# 的結合，在 Google 可以找到一些&lt;a href=&#34;http://www.google.com/search?hl=en&amp;amp;ie=UTF-8&amp;amp;oe=UTF-8&amp;amp;q=AOP+C%23&#34;&gt;相關的資訊&lt;/a&gt;。在這個領域將會產生許多有趣的東西，我想。&lt;/p&gt;
&lt;p&gt;這裡是一些介紹 AOP 的入門文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.extremepattern.com/dp/java_aspectj.html&#34;&gt;Extract Aspect Refactoring ?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.javaworld.com/javaworld/jw-01-2002/jw-0118-aspect.html&#34;&gt;I want my AOP!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://aspectj.org/doc/dist/progguide/index.html&#34; target=&#34;_blank&#34;&gt;The AspectJ Programming Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www-106.ibm.com/developerworks/java/library/j-aspectj/?dwzone=java&#34; target=&#34;_blank&#34;&gt;Improve modularity with aspect-oriented programming&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>M.C. Escher</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-17-52/</link>
      <pubDate>Tue, 17 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-17-52/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;escher-google-doodle.gif&#34; alt=&#34;Birthday of M.C. Escher&#34;&gt;&lt;/p&gt;
&lt;p&gt;很驚訝地發現今天 Google 的 Logo 是模仿 M.C. Escher 的名畫『互繪的雙手』。 在 &lt;a href=&#34;http://www.google.com/holidaylogos.html&#34;&gt;Google Holiday Logos&lt;/a&gt; 可以找到所有的 Logo。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Hardware breakpoints</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-10-46/</link>
      <pubDate>Tue, 10 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-10-46/</guid>
      <description>&lt;p&gt;嗯，VC++ 的確有提供 data breakpoint，但是使用起來卻不大方便，原因是你必須知道資料的位址然後填入例如 *((DWORD*)0x12345678) 的表示式才行。&lt;/p&gt;
&lt;p&gt;現在，試試 &lt;a href=&#34;mailto:mike@morearty.com&#34;&gt;Mike Morearty&lt;/a&gt; 的 &lt;a href=&#34;http://www.morearty.com/code/breakpoint/&#34;&gt;CBreakpoint&lt;/a&gt;，你可以這樣做：&lt;/p&gt;

  &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DWORD x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; CBreakpoint bp; bp.Set(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;x, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(x), CBreakpoint&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Write);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;相當地酷！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ILDASM</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-10-47/</link>
      <pubDate>Tue, 10 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-10-47/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://msdn.microsoft.com/msdnmag/issues/01/05/bugslayer/default.aspx&#34;&gt;ILDASM is Your New Best Friend&lt;/a&gt; John Robbins 在 MSDN 上簡介 MSIL (Microsoft Intermediate Language) 及 CLR 的基本概念，想要成為 .Net 的專家，對於 MSIL 必然要下一番功夫。&lt;/p&gt;
&lt;blockquote&gt;
&lt;br&gt;Knowing how things work at the lowest level does make it easier to see the big picture.&lt;br&gt;
&lt;/blockquote&gt;

</description>
    </item>
    
    <item>
      <title>Winamp author</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-10-48/</link>
      <pubDate>Tue, 10 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-10-48/</guid>
      <description>&lt;blockquote&gt;
&lt;br&gt;For me, coding is a form of self-expression.&lt;br&gt;It&#39;s probably the form I&#39;m most effective at.&lt;br&gt;&lt;br&gt;-- Justin Frankel&lt;br&gt;
&lt;/blockquote&gt;

</description>
    </item>
    
    <item>
      <title>developer vs. programmer</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-09-45/</link>
      <pubDate>Mon, 09 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-09-45/</guid>
      <description>&lt;blockquote&gt;
&lt;br&gt;Being a good developer in BCB requires that you remember you are a developer rather than a programmer - which is to say that you have responsibility for much more than the excellence of developed code. You are also responsible for the excellence of the design of the software and databases, the user interface, and for the reusability and maintainability of the result. And of course, an understanding and appreciation of the business context of your development effort is essential.&lt;br&gt;&lt;br&gt;&lt;a href=&#34;http://www.temporaldoorway.com/programming/cbuilder/philosophy/beingabetterprogrammer.htm&#34;&gt;Being A Better C++ Builder Developer&lt;/a&gt;&lt;br&gt;by Mark Cashman&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;Developer 應該要比 Programmer 看的更廣，更能綜觀全局。就我的觀察，大部分的 programmer 都太過侷限於自己熟悉的領域，甚少花時間去拓展自己專業知識的廣度，造成的結果就是對於許多問題的解決都採取了不恰當的方式，
所謂『不洽當』指的是『就長期與通盤的考量而言，並非最佳』。&lt;/p&gt;
&lt;p&gt;作者在這篇文章中對於 program design、UI design、及 database design 提出許多中肯及實用的建議；然而要做到這樣的程度，你需要的是『經驗』及『品味』。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Assertions and Error Handling</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-08-43/</link>
      <pubDate>Sun, 08 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-08-43/</guid>
      <description>&lt;p&gt;Andrei 在 C++ User Journal 發表了幾篇關於 C++ error handling 的文章，蠻有趣的，也解決了一些困擾我很久的問題。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cuj.com/documents/s=8248/cujcexp2104alexandr/alexandr.htm&#34;&gt;Assertions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cuj.com/documents/s=8250/cujcexp2106alexandr/&#34;&gt;Enforcements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cuj.com/documents/s=8000/cujcexp1812alexandr/alexandr.htm&#34;&gt;Change the Way You Write Exception-Safe Code — Forever&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;關於 Exception，大部分的人已經能夠接受其觀念，並且也被許多主流的的程式語言所支援。然而 Exception 帶來的似乎不是期待中的天堂，而是更多的困惑。也就是 Exception 解決了舊的問題，卻也帶來了新的挑戰。程序員慢慢地了解『撰寫 exception-safe 的程式碼卻不容易』，而解決的方法往往需要去使用一些非內建的機制，如 Andrei 所提到的方法。例如 C++ 中缺乏 finally 的支援就使我覺得非常困擾。&lt;/p&gt;
&lt;p&gt;我想程式語言除了支援 Exception 外，還需再多提供一些錯誤處理的支援，像我就蠻喜歡 C# 中的 using (…) {}。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Language of the Year</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-06-04-38/</link>
      <pubDate>Wed, 04 Jun 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-06-04-38/</guid>
      <description>&lt;blockquote&gt;
&lt;br&gt;Learn at least one new [programming] language every year. Different languages solve the same problems in different ways. By learning several different approaches, you can help broaden your thinking and avoid getting stuck in a rut.&lt;br&gt;&lt;br&gt;— The Pragmatic Programmer&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;檢視一下你現在手頭熟悉的技術，你是否很久都沒學什麼新東西了？所謂『老狗變不出新花樣』，該接觸一些新事物來充實一下自己了。採用新的流程、新的思考方式、新的設計方式、或是新的程式語言都可幫你提昇自己思考的廣度。別懼怕『樣樣通，樣樣鬆』的批評，學習新的事物反而可以提昇自己專精領域的深度。
準備好了嗎？一起參加 &lt;a href=&#34;http://www.pragmaticprogrammer.com/loty/index.html&#34;&gt;Language of the Year&lt;/a&gt; 來學習 &lt;a href=&#34;http://www.haskell.org/&#34;&gt;Haskell&lt;/a&gt; 吧。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Exceptional C&#43;&#43;</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-22-35/</link>
      <pubDate>Thu, 22 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-22-35/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://www.gotw.ca/images/xc++cover-small.gif&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;C++ 的信徒應該對 &lt;a href=&#34;http://www.gotw.ca/&#34; title=&#34;GotW.ca Home Page&#34;&gt;Herb Sutter&lt;/a&gt; 不感到陌生。草藥兄最常發表技術文章的地方是&lt;a href=&#34;http://www.cuj.com/&#34;&gt;C/C++ Users Journal&lt;/a&gt; 的 C++ 專欄。不才也有一本他寫的 &lt;a href=&#34;http://www.gotw.ca/publications/xc++.htm&#34;&gt;Exceptional C++&lt;/a&gt;，雖是薄薄的一本卻是字字珠璣，沒有多餘的廢話。任何自認為 C++ 的專家都應該來挑戰看看書中所提的問題。每次我誤入書中所設的的陷阱時，彷彿都能聽見 Herb 在耳邊說 &amp;ldquo;&lt;a href=&#34;http://info.astrian.net/jargon/terms/g/gotcha.html&#34;&gt;gotcha&lt;/a&gt;&amp;quot;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cleaning up code</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-21-33/</link>
      <pubDate>Wed, 21 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-21-33/</guid>
      <description>&lt;blockquote&gt;
&lt;br&gt;&#39;Cleaning up code&#39; is a terrible thing. Redesigning WORKING code into different WORKING code (also known as refactoring) is terrible.  The reason is that once you touch WORKING code, it becomes NON-WORKING code, and the changes you make (once you get it working again) will never be known.  It&#39;s like Programmer masturbation, it might make you feel good, but no one will probably know you did it.&lt;br&gt;&lt;br&gt;-- Paul Tyma&lt;br&gt;
&lt;/blockquote&gt;

&lt;p&gt;很有趣的比喻…&lt;/p&gt;
&lt;p&gt;不過如果作者所謂的 ‘Cleaning up code’ 是指 ‘Refactoring’ 的話，我並不認同這樣的看法。在軟體界向來有『If it ain’t broke, don’t fix it.』的說法，盲目地遵從這樣的規則反而會導致破壞軟體架構的完整性與可維護性，程序員不該把它當成偷懶的藉口。&lt;/p&gt;
&lt;p&gt;就我的經驗，一般存在於程式碼最大的問題就是『重複』，重複的程式碼不但佔用更多的記憶體，更是許多 bug 的潛在原因。 &lt;a href=&#34;http://www.pragmaticprogrammer.com&#34;&gt;The Pragmatic Programmer&lt;/a&gt; 告訴我們『Don’t Repeat Yourself』及『Make It Easy to Reuse』，短短簡單的兩句話卻是良好設計風格的基礎。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>C# and Beautiful Code</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-20-31/</link>
      <pubDate>Tue, 20 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-20-31/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.oreillynet.com/pub/wlg/3201&#34; title=&#34;O&#39;Reilly Network: Beautiful Code [May 20, 2003]&#34;&gt;O’Reilly Network: Beautiful Code&lt;/a&gt; C++ 或是 Java
的語法的確是 boring 了一點，但就可讀性而言的確可以讓 programmer
把程式寫得中規中矩一點。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://info.astrian.net/jargon/terms/p/Perl.html&#34;&gt;Perl&lt;/a&gt; 提供了許多 &lt;a href=&#34;http://info.astrian.net/jargon/terms/s/syntactic_sugar.html&#34;&gt;syntactic sugar&lt;/a&gt;，但讀起別人寫的 Perl 程式可就不是那麼輕鬆…&lt;/p&gt;
&lt;p&gt;我想這傢伙是不是在暗指 C# 比 Java 寫起來漂亮些，因為這段程式用 C#
來表示就相當地簡明易懂：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;foreach&lt;/span&gt; (User user &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; dao.getUsers())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// do something with user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>To Speak Perl</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-17-29/</link>
      <pubDate>Sat, 17 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-17-29/</guid>
      <description>&lt;p&gt;似乎是最近才對 Perl 開了竅，不會覺得寫 Perl Script 是件很彆扭的事。也許是自己拋棄了以前對它的成見，願意用異於平常的觀點去了解其背後的設計哲學。&lt;/p&gt;
&lt;p&gt;希望有一天也能做到 &amp;ldquo;I don&amp;rsquo;t write Perl, I speak it.&amp;rdquo; 的境界。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Programmer Dvorak Keyboard Layout</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-14-26/</link>
      <pubDate>Wed, 14 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-14-26/</guid>
      <description>&lt;p&gt;常常寫 C++ 的你是否有想過『為什麼 { 是 shift + ] ?』，畢竟 { 比 [ 更常被用到不是嗎？如果你是 LISP 的愛好者， 我更可以了解你對於要輸入許多 () 的無奈。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.kaufmann.no/roland/dvorak/&#34;&gt;Programmer Dvorak&lt;/a&gt; 似乎是 programmer 的救星。只是在這個被 QWERTY 鍵盤佔據的世界中，當個使用 Dvorak 鍵盤的異類是很辛苦的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>~ ! @ # $ % ^ &amp; * 到底要怎麼唸?</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-07-20/</link>
      <pubDate>Wed, 07 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-07-20/</guid>
      <description>&lt;p&gt;有時跟老外交談時會不曉得這些符號怎麼唸，就查查這篇文章《&lt;a href=&#34;http://www.eeng.brad.ac.uk/help/.faq/.unix/.pronun.html&#34;&gt;pronunciation guide for unix&lt;/a&gt;》吧。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Pragmatic Programmers</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-05-14/</link>
      <pubDate>Mon, 05 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-05-14/</guid>
      <description>&lt;p&gt;Dave Thomas 跟 Andy Hunt 在 IEEE Software 的&lt;a href=&#34;http://www.pragmaticprogrammer.com/articles/index.html&#34;&gt;專欄&lt;/a&gt;是我最近最喜歡看的文章。幽默簡潔而務實是我對他們文章的最大印象，喜歡談大道理的作者一向不是我的偏好，這兩位就剛剛合我的胃口。是除了 Demarco &amp;amp; Lister 外我最喜歡的一對作者。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gödel, Escher, Bach</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-02-10/</link>
      <pubDate>Fri, 02 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-02-10/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;geb.jpg&#34; alt=&#34;Gödel, Escher, Bach - An Eternal Golden Braid&#34;&gt;&lt;/p&gt;
&lt;p&gt;或許是今天太閒了吧，心血來潮地把 Douglas Hofstadter 的《Gödel, Escher,
Bach - An Eternal Golden Braid》拿出來翻了一遍。&lt;/p&gt;
&lt;p&gt;如果要硬掰一個理由解釋為什麼買這本書以來從沒能夠好好地把它讀懂，我只能說 Escher 的版畫太迷人了。往往書一拿起來，就有一股衝動想把所有的畫看一遍。畢竟我對巴哈的音樂不熟悉，歌德爾的數學又太難懂了… :-)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.hischool.net.cn/ashen/cvsx/kjdlj.htm&#34;&gt;Escher 的數學藝術&lt;/a&gt; &lt;a href=&#34;http://directory.google.com/Top/Computers/Artificial_Intelligence/Creativity/Hofstadter,_Douglas_R./G%C3%B6del,_Escher,_Bach_-_An_Eternal_Golden_Braid/?il=1&#34;&gt;Google 的相關連結&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Applied Microsoft .Net framework programming</title>
      <link>https://blog.simplypatrick.com/posts/2003/2003-05-01-9/</link>
      <pubDate>Thu, 01 May 2003 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2003/2003-05-01-9/</guid>
      <description>&lt;p&gt;衝著 Jeffrey Richter 的名字，我還是買了這本由&lt;a href=&#34;http://www.kingsinfo.com.tw/&#34;&gt;文魁&lt;/a&gt;出版的中譯本。看了三章後，我後悔了。&lt;/p&gt;
&lt;p&gt;這本書被翻的實在是慘不忍睹，不僅文義謬誤而且錯字連篇，專有名詞也翻得非常饒口，你能想像什麼是『資料名單中繼資料表格』嗎？最經典的例子是原文的：&lt;/p&gt;
&lt;p&gt;『You Can’t Have Too Many finally Blocks - I think finally blocks are awesome!』&lt;/p&gt;
&lt;p&gt;正確意思應該是：&lt;/p&gt;
&lt;p&gt;『finally 區塊再多也不為過 - 我覺得 finally 區塊實在是棒透了！』&lt;/p&gt;
&lt;p&gt;在中譯本的 18-26 頁居然被翻成：&lt;/p&gt;
&lt;p&gt;『&lt;font color=&#34;#ff0000&#34;&gt;不能使用太多&lt;/font&gt; finally 區段 - 我認為 finally 區段&lt;font color=&#34;#ff0000&#34;&gt;式&lt;/font&gt;&lt;font color=&#34;#ff0000&#34;&gt;可怕的！&lt;/font&gt;』&lt;/p&gt;
&lt;p&gt;連續兩個句子都譯成相反的意思，而且還有錯字『是』=&amp;gt;『式』。&lt;/p&gt;
&lt;p&gt;為了省五百元，買了生平第一本&lt;a href=&#34;http://www.kingsinfo.com.tw&#34;&gt;文魁&lt;/a&gt;出版的書，現在只想『趕快把內容看完，然後把書丟掉』。&lt;/p&gt;
&lt;p&gt;在此向 Jeffrey 表達深深的懺悔。 Jeffrey, Your book is great but &lt;a href=&#34;http://www.kingsinfo.com.tw&#34;&gt;Kingsinfo&lt;/a&gt; sucks.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
